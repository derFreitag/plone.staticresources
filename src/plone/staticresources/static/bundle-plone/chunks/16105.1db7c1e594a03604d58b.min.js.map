{"version":3,"file":"chunks/16105.1db7c1e594a03604d58b.min.js","mappings":"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","sources":["webpack://plone.staticresources/./node_modules/@plone/mockup/src/pat/controlpanels/discussion-moderation--implementation.js"],"sourcesContent":["import registry from \"@patternslib/patternslib/src/core/registry\";\nimport $ from \"jquery\";\n\nexport default class Contentrules {\n    constructor(el) {\n        this.el = el;\n    }\n\n    init_moderation_eventhandler() {\n        let self = this;\n        /**********************************************************************\n         * Delete a single comment.\n         **********************************************************************/\n        $(\"button[name='form.button.moderation.DeleteComment']\").click(function (e) {\n            e.preventDefault();\n            var row = $(this).closest(\"tr\");\n            var path = row.find(\"[name='selected_obj_paths:list']\").attr(\"value\");\n            var auth_key = $('input[name=\"_authenticator\"]').val();\n            var target = path + \"/@@moderate-delete-comment?_authenticator=\" + auth_key;\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                success: function (msg) {\n                    // fade out row\n                    row.fadeOut(250).fadeIn(250, function () {\n                        row.remove();\n                    });\n                    // reload page if all comments have been removed\n                    var comments = $(\"table#review-comments > tbody > tr\");\n                    if (comments.length === 1) {\n                        location.reload();\n                    }\n                },\n                error: function (msg) {\n                    alert(\"Error sending AJAX request:\" + target);\n                },\n            });\n        });\n        /**********************************************************************\n         * Transmit a single comment.\n         **********************************************************************/\n        $('button[name=\"form.button.moderation.TransmitComment\"]').click(function (e) {\n            e.preventDefault();\n            let button = $(this);\n            var row = $(this).closest(\"tr\");\n            var path = $(row).find(\"[name='selected_obj_paths:list']\").attr(\"value\");\n            var workflow_action = $(this).attr(\"data-transition\");\n            var auth_key = $('input[name=\"_authenticator\"]').val();\n            // distinction of workflow_action\n            var target =\n                path +\n                \"/@@transmit-comment?_authenticator=\" +\n                auth_key +\n                \"&workflow_action=\" +\n                workflow_action;\n            var moderate =\n                $(this).closest(\"fieldset\").attr(\"id\") == \"fieldset-moderate-comments\";\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                success: function (msg) {\n                    if (moderate) {\n                        let url = location.href;\n                        $(\"#review-comments\").load(\n                            url + \" #review-comments > *\",\n                            function () {\n                                self.init_moderation_eventhandler();\n                                $(\".pat-plone-modal\").patPloneModal();\n                            }\n                        );\n                    } else {\n                        location.reload();\n                    }\n                },\n                error: function (msg) {\n                    alert(\n                        \"Error transmitting comment. (Error sending AJAX request:\" +\n                            target +\n                            \")\"\n                    );\n                },\n            });\n        });\n\n        /**********************************************************************\n         * Bulk actions for comments (delete, publish)\n         **********************************************************************/\n        $(\"button[name='form.button.BulkAction']\").click(function (e) {\n            e.preventDefault();\n            var form = $(this).closest(\"form\");\n            var target = $(form).attr(\"action\");\n            var params = $(form).serialize();\n            var valArray = $(\"input:checkbox:checked\");\n            var selectField = $(form).find(\"[name='form.select.BulkAction']\");\n\n            if (selectField.val() === \"-1\") {\n                // TODO: translate message\n                alert(\"You haven't selected a bulk action. Please select one.\");\n            } else if (valArray.length === 0) {\n                // TODO: translate message\n                alert(\n                    \"You haven't selected any comment for this bulk action.\" +\n                        \"Please select at least one comment.\"\n                );\n            } else {\n                $.post(target, params, function (data) {\n                    // reset the bulkaction select\n                    selectField.find(\"option[value='-1']\").attr(\"selected\", \"selected\");\n                    // reload filtered comments\n                    $(\"#review-comments\").load(\n                        window.location + \" #review-comments\",\n                        function () {\n                            self.init_moderation_eventhandler();\n                            $(\".pat-plone-modal\").patPloneModal();\n                        }\n                    );\n                });\n            }\n        });\n\n        /**********************************************************************\n         * Check or uncheck all checkboxes from the batch moderation page.\n         **********************************************************************/\n        $(\"input[name='check_all']\").click(function () {\n            if ($(this).val() === \"0\") {\n                $(this).parents(\"table\").find(\"input:checkbox\").prop(\"checked\", true);\n                $(this).val(\"1\");\n            } else {\n                $(this).parents(\"table\").find(\"input:checkbox\").prop(\"checked\", false);\n                $(this).val(\"0\");\n            }\n        });\n\n        /**********************************************************************\n         * select comments with review_state\n         **********************************************************************/\n\n        $(\"input[name='review_state']\").click(function () {\n            let review_state = $(this).val();\n            let url = location.href;\n            if (location.search) {\n                url = location.href.replace(\n                    location.search,\n                    \"?review_state=\" + review_state\n                );\n            } else {\n                url = location.href + \"?review_state=\" + review_state;\n            }\n\n            $(\"#fieldset-moderate-comments\")\n                .parent()\n                .load(url + \" #content form > *\", function () {\n                    self.init_moderation_eventhandler();\n                    $(\".pat-plone-modal\").patPloneModal();\n                    let stateObj = { review_state: review_state };\n                    history.pushState(stateObj, \"moderate comments\", url);\n                });\n        });\n\n        /**********************************************************************\n         * Show full text of a comment in the batch moderation page.\n         **********************************************************************/\n        $(\".show-full-comment-text\").click(function (e) {\n            e.preventDefault();\n            var target = $(this).attr(\"href\");\n            var parent = $(this).parent();\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                data: \"\",\n                success: function (data) {\n                    // show full text\n                    parent.html(data);\n                },\n                error: function (msg) {\n                    alert(\"Error getting full comment text:\" + target);\n                },\n            });\n        });\n\n        /**********************************************************************\n         * Comments published: Load history for publishing date.\n         **********************************************************************/\n        $(\".last-history-entry\").each(function () {\n            var lasthistoryentry = $(this);\n            $.ajax({\n                url: lasthistoryentry.attr(\"data-href\"),\n                success: function (data) {\n                    lasthistoryentry.html($(data).find(\".historyByLine\").first());\n                    // format date\n                    registry.scan(lasthistoryentry);\n                },\n                error: function (msg) {\n                    console.error(\"Error getting history.\");\n                },\n            });\n        });\n    } // end init_moderation_eventhandler\n\n    init() {\n        let self = this;\n        self.init_moderation_eventhandler();\n    }\n}\n"],"names":["Contentrules","el","this","self","$","click","e","preventDefault","row","closest","target","find","attr","val","type","url","success","msg","fadeOut","fadeIn","remove","length","location","reload","error","alert","path","workflow_action","moderate","href","load","init_moderation_eventhandler","patPloneModal","form","params","serialize","valArray","selectField","data","window","parents","prop","review_state","search","replace","parent","stateObj","history","pushState","html","each","lasthistoryentry","first","registry","console"],"sourceRoot":""}