{"version":3,"file":"chunks/59075.2fe395389430acc9b26e.min.js","mappings":"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","sources":["webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/discussion-comments--implementation.js"],"sourcesContent":["import $ from \"jquery\";\n\nexport default class Contentrules {\n    constructor(el) {\n        this.el = el;\n    }\n    /**************************************************************************\n     * Create a reply-to-comment form right beneath the form that is passed to\n     * the function. We do this by copying the regular comment form and\n     * adding a hidden in_reply_to field to the form.\n     **************************************************************************/\n    createReplyForm(comment_div) {\n        var comment_id = comment_div.attr(\"id\");\n\n        var reply_button = comment_div.find(\".reply-to-comment-button\");\n\n        /* Clone the reply div at the end of the page template that contains\n         * the regular comment form.\n         */\n        var reply_div = $(\"#commenting\").clone(true);\n\n        /* Remove the ReCaptcha JS code before appending the form. If not\n         * removed, this causes problems\n         */\n        reply_div.find(\"#formfield-form-widgets-captcha\").find(\"script\").remove();\n\n        /* Insert the cloned comment form right after the reply button of the\n         * current comment.\n         */\n        reply_div.appendTo(comment_div).css(\"display\", \"none\");\n\n        /* Remove id='commenting' attribute, since we use it to uniquely define\n            the main reply form. */\n        // Still belongs to class='reply'\n        reply_div.removeAttr(\"id\");\n\n        /* Hide the reply button (only hide, because we may want to show it\n         * again if the user hits the cancel button).\n         */\n        $(reply_button).css(\"display\", \"none\");\n\n        /* Fetch the reply form inside the reply div */\n        var reply_form = reply_div.find(\"form\");\n\n        /* Change the id of the textarea of the reply form\n         * To avoid conflict later between textareas with same id 'form-widgets-comment-text' while implementing a seperate instance of TinyMCE\n         * */\n        reply_form\n            .find(\"#formfield-form-widgets-comment-text\")\n            .attr(\"id\", \"formfield-form-widgets-new-textarea\" + comment_id);\n        reply_form\n            .find(\"#form-widgets-comment-text\")\n            .attr(\"id\", \"form-widgets-new-textarea\" + comment_id);\n\n        /* Populate the hidden 'in_reply_to' field with the correct comment\n            id */\n        reply_form.find('input[name=\"form.widgets.in_reply_to\"]').val(comment_id);\n\n        /* Add a remove-reply-to-comment Javascript function to remove the\n            form */\n        var cancel_reply_button = reply_div.find(\".cancelreplytocomment\");\n        cancel_reply_button.attr(\"id\", comment_id);\n\n        /* Show the cancel buttons. */\n        reply_form.find('input[name=\"form.buttons.cancel\"]').css(\"display\", \"inline\");\n\n        /* Show the reply layer with a slide down effect */\n        reply_div.slideDown(\"slow\");\n\n        /* Show the cancel button in the reply-to-comment form */\n        cancel_reply_button.css(\"display\", \"inline\");\n    }\n\n    /**************************************************************************\n     * Remove all error messages and field values from the form that is passed\n     * to the function.\n     **************************************************************************/\n    clearForm(form_div) {\n        form_div.find(\".error\").removeClass(\"error\");\n        form_div.find(\".fieldErrorBox\").remove();\n        form_div.find('input[type=\"text\"]').attr(\"value\", \"\");\n        form_div.find(\"textarea\").attr(\"value\", \"\");\n        /* XXX: Clean all additional form extender fields. */\n    }\n\n    init_comment_eventhandler() {\n        /**********************************************************************\n         * Transmit a single comment.\n         **********************************************************************/\n        $('input[name=\"form.button.TransmitComment\"]').on(\"click\", (e) => {\n            e.preventDefault();\n            const trigger = e.currentTarget;\n            const $trigger = $(trigger);\n            const form = $trigger.parents(\"form\");\n            const $form = $(form);\n            const data = $form.serialize();\n            const form_url = $form.attr(\"action\");\n            const comment_id = $trigger.parents(\".comment\").attr(\"id\");\n            $.ajax({\n                type: \"GET\",\n                url: form_url,\n                data: data,\n                context: trigger,\n                success: () => {\n                    let url = location.href;\n                    $trigger.parents(\".comment\").load(\n                        // loading child nodes is not enough,\n                        // class attributes are needed for visualization of workflow_state\n                        `${url} #${comment_id}.comment`,\n                        () => {\n                            $trigger.find(\".comment\").unwrap();\n                            this.init_comment_eventhandler();\n                            $(\".pat-plone-modal\").patPloneModal();\n                        }\n                    );\n                },\n                error: () => true,\n            });\n            return false;\n        });\n\n        /**********************************************************************\n         * Edit a comment\n         **********************************************************************/\n        if ($.fn.prepOverlay) {\n            $('form[name=\"edit\"]').prepOverlay({\n                cssclass: \"overlay-edit-comment\",\n                width: \"60%\",\n                subtype: \"ajax\",\n                filter: \"#content>*\",\n            });\n        }\n\n        /**********************************************************************\n         * Delete a comment and its answers.\n         **********************************************************************/\n        $('input[name=\"form.button.DeleteComment\"]').on(\"click\", function (e) {\n            e.preventDefault();\n            var trigger = this;\n            var form = $(this).parents(\"form\");\n            var data = $(form).serialize();\n            var form_url = $(form).attr(\"action\");\n            $.ajax({\n                type: \"POST\",\n                url: form_url,\n                data: data,\n                context: $(trigger).parents(\".comment\"),\n                success: function () {\n                    var comment = $(this);\n                    var clss = comment.attr(\"class\");\n                    // remove replies\n                    var treelevel = parseInt(\n                        clss[clss.indexOf(\"replyTreeLevel\") + \"replyTreeLevel\".length],\n                        10\n                    );\n                    // selector for all the following elements of lower level\n                    var selector = \".replyTreeLevel\" + treelevel;\n                    for (var i = 0; i < treelevel; i++) {\n                        selector += \", .replyTreeLevel\" + i;\n                    }\n                    comment.nextUntil(selector).each(function () {\n                        $(this).fadeOut(\"fast\", function () {\n                            $(this).remove();\n                        });\n                    });\n                    // Add delete button to the parent\n                    var parent = comment.prev(\n                        '[class*=\"replyTreeLevel' + (treelevel - 1) + '\"]'\n                    );\n                    parent.find('form[name=\"delete\"]').css(\"display\", \"inline\");\n                    // remove comment\n                    $(this).fadeOut(\"fast\", function () {\n                        $(this).remove();\n                    });\n                },\n                error: function () {\n                    return true;\n                },\n            });\n            return false;\n        });\n    }\n\n    init() {\n        let self = this;\n        self.init_comment_eventhandler();\n\n        /**********************************************************************\n         * If the user has hit the reply button of a reply-to-comment form\n         * (form was submitted with a value for the 'in_reply_to' field in the\n         * request), create a reply-to-comment form right under this comment.\n         **********************************************************************/\n        var post_comment_div = $(\"#commenting\");\n        var in_reply_to_field = post_comment_div.find(\n            'input[name=\"form.widgets.in_reply_to\"]'\n        );\n        if (in_reply_to_field.length !== 0 && in_reply_to_field.val() !== \"\") {\n            var current_reply_id = \"#\" + in_reply_to_field.val();\n            var current_reply_to_div = $(\".discussion\").find(current_reply_id);\n            self.createReplyForm(current_reply_to_div);\n            self.clearForm(post_comment_div);\n        }\n\n        /**********************************************************************\n         * If the user hits the 'reply' button of an existing comment, create a\n         * reply form right beneath this comment.\n         **********************************************************************/\n        $(\".reply-to-comment-button\").on(\"click\", function () {\n            var comment_div = $(this).parents().filter(\".comment\");\n            self.createReplyForm(comment_div);\n            self.clearForm(comment_div);\n        });\n\n        /**********************************************************************\n         * If the user hits the 'clear' button of an open reply-to-comment form,\n         * remove the form and show the 'reply' button again.\n         **********************************************************************/\n        $(\"#commenting #form-buttons-cancel\").on(\"click\", function (e) {\n            e.preventDefault();\n            var reply_to_comment_button = $(this)\n                .parents()\n                .filter(\".comment\")\n                .find(\".reply-to-comment-button\");\n\n            /* Find the reply-to-comment form and hide and remove it again. */\n            self.reply_to_comment_form = $(this).parents().filter(\".reply\");\n            self.reply_to_comment_form.slideUp(\"slow\", function () {\n                $(this).remove();\n            });\n\n            /* Show the reply-to-comment button again. */\n            reply_to_comment_button.css(\"display\", \"inline\");\n        });\n\n        /**********************************************************************\n         * By default, hide the reply and the cancel button for the regular add\n         * comment form.\n         **********************************************************************/\n        $(\".reply\").find('input[name=\"form.buttons.reply\"]').css(\"display\", \"none\");\n        $(\".reply\").find('input[name=\"form.buttons.cancel\"]').css(\"display\", \"none\");\n\n        /**********************************************************************\n         * By default, show the reply button only when Javascript is enabled.\n         * Otherwise hide it, since the reply functions only work with JS\n         * enabled.\n         **********************************************************************/\n        $(\".reply-to-comment-button\").removeClass(\"hide\");\n    }\n}\n"],"names":["Contentrules","constructor","el","this","createReplyForm","comment_div","comment_id","attr","reply_button","find","reply_div","clone","remove","appendTo","css","removeAttr","reply_form","val","cancel_reply_button","slideDown","clearForm","form_div","removeClass","init_comment_eventhandler","on","e","preventDefault","trigger","currentTarget","$trigger","form","parents","$form","data","serialize","form_url","type","url","context","success","location","href","load","unwrap","patPloneModal","error","prepOverlay","cssclass","width","subtype","filter","comment","clss","treelevel","parseInt","indexOf","selector","i","nextUntil","each","fadeOut","prev","init","self","post_comment_div","in_reply_to_field","length","current_reply_id","current_reply_to_div","reply_to_comment_button","reply_to_comment_form","slideUp"],"sourceRoot":""}