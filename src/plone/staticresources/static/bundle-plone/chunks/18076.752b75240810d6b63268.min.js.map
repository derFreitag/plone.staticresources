{"version":3,"file":"chunks/18076.752b75240810d6b63268.min.js","mappings":"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","sources":["webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/discussion-moderation--implementation.js"],"sourcesContent":["import registry from \"@patternslib/patternslib/src/core/registry\";\nimport $ from \"jquery\";\n\nexport default class Contentrules {\n    constructor(el) {\n        this.el = el;\n    }\n\n    init_moderation_eventhandler() {\n        let self = this;\n        /**********************************************************************\n         * Delete a single comment.\n         **********************************************************************/\n        // eslint-disable-next-line no-unused-vars\n        $(\"button[name='form.button.moderation.DeleteComment']\").on(\"click\", function (e) {\n            e.preventDefault();\n            var row = $(this).closest(\"tr\");\n            var path = row.find(\"[name='selected_obj_paths:list']\").attr(\"value\");\n            var auth_key = $('input[name=\"_authenticator\"]').val();\n            var target = path + \"/@@moderate-delete-comment?_authenticator=\" + auth_key;\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                // eslint-disable-next-line no-unused-vars\n                success: function (msg) {\n                    // fade out row\n                    row.fadeOut(250).fadeIn(250, function () {\n                        row.remove();\n                    });\n                    // reload page if all comments have been removed\n                    var comments = $(\"table#review-comments > tbody > tr\");\n                    if (comments.length === 1) {\n                        location.reload();\n                    }\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    alert(\"Error sending AJAX request:\" + target);\n                },\n            });\n        });\n        /**********************************************************************\n         * Transmit a single comment.\n         **********************************************************************/\n        $('button[name=\"form.button.moderation.TransmitComment\"]').on(\"click\", function (e) {\n            e.preventDefault();\n            var row = $(this).closest(\"tr\");\n            var path = $(row).find(\"[name='selected_obj_paths:list']\").attr(\"value\");\n            var workflow_action = $(this).attr(\"data-transition\");\n            var auth_key = $('input[name=\"_authenticator\"]').val();\n            // distinction of workflow_action\n            var target =\n                path +\n                \"/@@transmit-comment?_authenticator=\" +\n                auth_key +\n                \"&workflow_action=\" +\n                workflow_action;\n            var moderate =\n                $(this).closest(\"fieldset\").attr(\"id\") == \"fieldset-moderate-comments\";\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                // eslint-disable-next-line no-unused-vars\n                success: function (msg) {\n                    if (moderate) {\n                        let url = location.href;\n                        $(\"#review-comments\").load(\n                            url + \" #review-comments > *\",\n                            function () {\n                                self.init_moderation_eventhandler();\n                                $(\".pat-plone-modal\").patPloneModal();\n                            }\n                        );\n                    } else {\n                        location.reload();\n                    }\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    alert(\n                        \"Error transmitting comment. (Error sending AJAX request:\" +\n                            target +\n                            \")\"\n                    );\n                },\n            });\n        });\n\n        /**********************************************************************\n         * Bulk actions for comments (delete, publish)\n         **********************************************************************/\n        $(\"button[name='form.button.BulkAction']\").on(\"click\", function (e) {\n            e.preventDefault();\n            var form = $(this).closest(\"form\");\n            var target = $(form).attr(\"action\");\n            var params = $(form).serialize();\n            var valArray = $(\"input:checkbox:checked\");\n            var selectField = $(form).find(\"[name='form.select.BulkAction']\");\n\n            if (selectField.val() === \"-1\") {\n                // TODO: translate message\n                alert(\"You haven't selected a bulk action. Please select one.\");\n            } else if (valArray.length === 0) {\n                // TODO: translate message\n                alert(\n                    \"You haven't selected any comment for this bulk action.\" +\n                        \"Please select at least one comment.\"\n                );\n            } else {\n                // eslint-disable-next-line no-unused-vars\n                $.post(target, params, function (data) {\n                    // reset the bulkaction select\n                    selectField.find(\"option[value='-1']\").attr(\"selected\", \"selected\");\n                    // reload filtered comments\n                    $(\"#review-comments\").load(\n                        window.location + \" #review-comments\",\n                        function () {\n                            self.init_moderation_eventhandler();\n                            $(\".pat-plone-modal\").patPloneModal();\n                        }\n                    );\n                });\n            }\n        });\n\n        /**********************************************************************\n         * Check or uncheck all checkboxes from the batch moderation page.\n         **********************************************************************/\n        $(\"input[name='check_all']\").on(\"click\", function () {\n            if ($(this).val() === \"0\") {\n                $(this).parents(\"table\").find(\"input:checkbox\").prop(\"checked\", true);\n                $(this).val(\"1\");\n            } else {\n                $(this).parents(\"table\").find(\"input:checkbox\").prop(\"checked\", false);\n                $(this).val(\"0\");\n            }\n        });\n\n        /**********************************************************************\n         * select comments with review_state\n         **********************************************************************/\n\n        $(\"input[name='review_state']\").on(\"click\", function () {\n            let review_state = $(this).val();\n            let url = location.href;\n            if (location.search) {\n                url = location.href.replace(\n                    location.search,\n                    \"?review_state=\" + review_state\n                );\n            } else {\n                url = location.href + \"?review_state=\" + review_state;\n            }\n\n            $(\"#fieldset-moderate-comments\")\n                .parent()\n                .load(url + \" #content form > *\", function () {\n                    self.init_moderation_eventhandler();\n                    $(\".pat-plone-modal\").patPloneModal();\n                    let stateObj = { review_state: review_state };\n                    history.pushState(stateObj, \"moderate comments\", url);\n                });\n        });\n\n        /**********************************************************************\n         * Show full text of a comment in the batch moderation page.\n         **********************************************************************/\n        $(\".show-full-comment-text\").on(\"click\", function (e) {\n            e.preventDefault();\n            var target = $(this).attr(\"href\");\n            var parent = $(this).parent();\n            $.ajax({\n                type: \"GET\",\n                url: target,\n                data: \"\",\n                success: function (data) {\n                    // show full text\n                    parent.html(data);\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    alert(\"Error getting full comment text:\" + target);\n                },\n            });\n        });\n\n        /**********************************************************************\n         * Comments published: Load history for publishing date.\n         **********************************************************************/\n        $(\".last-history-entry\").each(function () {\n            var lasthistoryentry = $(this);\n            $.ajax({\n                url: lasthistoryentry.attr(\"data-href\"),\n                success: function (data) {\n                    lasthistoryentry.html($(data).find(\".historyByLine\").first());\n                    // format date\n                    registry.scan(lasthistoryentry);\n                },\n                // eslint-disable-next-line no-unused-vars\n                error: function (msg) {\n                    console.error(\"Error getting history.\");\n                },\n            });\n        });\n    } // end init_moderation_eventhandler\n\n    init() {\n        let self = this;\n        self.init_moderation_eventhandler();\n    }\n}\n"],"names":["Contentrules","constructor","el","this","init_moderation_eventhandler","self","on","e","preventDefault","row","closest","target","find","attr","val","type","url","success","msg","fadeOut","fadeIn","remove","length","location","reload","error","alert","path","workflow_action","moderate","href","load","patPloneModal","form","params","serialize","valArray","selectField","data","window","parents","prop","review_state","search","replace","parent","stateObj","history","pushState","html","each","lasthistoryentry","first","scan","console","init"],"sourceRoot":""}