{"version":3,"file":"chunks/4573.2fb44aaf98b70c7458cd.min.js","mappings":"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","sources":["webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/core/i18n-wrapper.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/core/i18n.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/core/utils.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/backdrop/backdrop.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/datatables/datatables.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/modal/modal.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/querystring/querystring.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/relateditems/relateditems.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/select2/select2.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/sortable/sortable.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/upload/upload.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/jquery-ext.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/checklist/checklist.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/datetime-picker/datetime-picker.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/validation/validation.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/ajax/ajax.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/inject/inject.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/depends/depends.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/autotoc/autotoc.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/contentloader/contentloader.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/cookietrigger/cookietrigger.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/formautofocus/formautofocus.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/formunloadalert/formunloadalert.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/livesearch/livesearch.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/markspeciallinks/markspeciallinks.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/navigationmarker/navigationmarker.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/passwordstrength/passwordstrength.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/preventdoublesubmit/preventdoublesubmit.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/manageportlets/manageportlets.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/recurrence/recurrence.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/search/search.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/structure/structure.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/toggle/toggle.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/toolbar/toolbar.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/tree/tree.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/dexterity-types-listing.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/registry.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/schemaeditor.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/contentrules.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/contentrule-elements.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/discussion.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/discussion-comments.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/pat/controlpanels/discussion-moderation.js","webpack://plone.staticresources/./node_modules/@der-freitag/mockup/src/patterns.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/mockup-parser.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/base.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/basepattern.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/dom.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/events.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/logging.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/parser.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/polyfills.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/registry.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/core/utils.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/date-picker/date-picker.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/display-time/display-time.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/close-panel/close-panel.js","webpack://plone.staticresources/./node_modules/@patternslib/patternslib/src/pat/tooltip/tooltip.js"],"sourcesContent":["/* i18n integration.\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport I18N from \"./i18n\";\n\n// we're creating a singleton here so we can potentially\n// delay the initialization of the translate catalog\n// until after the dom is available\nlet _translation_domains = {\n    plone: null,\n    widgets: null,\n};\n\nconst translate = function (domain, msgid, keywords) {\n    if (_translation_domains[domain] === null) {\n        var i18n = new I18N();\n        i18n.loadCatalog(domain);\n        _translation_domains[domain] = i18n.MessageFactory(domain);\n    }\n    return _translation_domains[domain](msgid, keywords);\n};\n\nconst translate_widgets = function (msgid, keywords) {\n    return translate(\"widgets\", msgid, keywords);\n};\n\nconst translate_plone = function (msgid, keywords) {\n    return translate(\"plone\", msgid, keywords);\n};\n\n// backwards compatibilty: \"widgets\" domain is default factory\nexport default translate_widgets;\n\n// explicit export of translation domain factories\nexport { translate_widgets, translate_plone };\n","/* i18n integration. This is forked from jarn.jsi18n\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport $ from \"jquery\";\n\nconst i18n = function () {\n    var self = this;\n    self.baseUrl = $(\"body\").attr(\"data-i18ncatalogurl\");\n    self.currentLanguage = $(\"html\").attr(\"lang\") || \"en\";\n\n    // Fix for country specific languages\n    if (self.currentLanguage.split(\"-\").length > 1) {\n        self.currentLanguage =\n            self.currentLanguage.split(\"-\")[0] +\n            \"_\" +\n            self.currentLanguage.split(\"-\")[1].toUpperCase();\n    }\n\n    self.storage = null;\n    self.catalogs = {};\n    self.ttl = 24 * 3600 * 1000;\n\n    // Internet Explorer 8 does not know Date.now() which is used in e.g. loadCatalog, so we \"define\" it\n    if (!Date.now) {\n        Date.now = function () {\n            return new Date().valueOf();\n        };\n    }\n\n    try {\n        if (\n            \"localStorage\" in window &&\n            window.localStorage !== null &&\n            \"JSON\" in window &&\n            window.JSON !== null\n        ) {\n            self.storage = window.localStorage;\n        }\n    } catch (e) {\n        console.log(\"Failed to set local storage\");\n    }\n\n    self.configure = function (config) {\n        for (var key in config) {\n            self[key] = config[key];\n        }\n    };\n\n    self._setCatalog = function (domain, language, catalog) {\n        if (domain in self.catalogs) {\n            self.catalogs[domain][language] = catalog;\n        } else {\n            self.catalogs[domain] = {};\n            self.catalogs[domain][language] = catalog;\n        }\n    };\n\n    self._storeCatalog = function (domain, language, catalog) {\n        var key = domain + \"-\" + language;\n        if (self.storage !== null && catalog !== null) {\n            self.storage.setItem(key, JSON.stringify(catalog));\n            self.storage.setItem(key + \"-updated\", Date.now());\n        }\n    };\n\n    self.getUrl = function (domain, language) {\n        return self.baseUrl + \"?domain=\" + domain + \"&language=\" + language;\n    };\n\n    self.loadCatalog = function (domain, language) {\n        if (language === undefined) {\n            language = self.currentLanguage;\n        }\n        if (self.storage !== null) {\n            var key = domain + \"-\" + language;\n            if (key in self.storage) {\n                if (\n                    Date.now() - parseInt(self.storage.getItem(key + \"-updated\"), 10) <\n                    self.ttl\n                ) {\n                    var catalog = JSON.parse(self.storage.getItem(key));\n                    self._setCatalog(domain, language, catalog);\n                    return;\n                }\n            }\n        }\n        if (!self.baseUrl) {\n            return;\n        }\n        $.getJSON(self.getUrl(domain, language), function (catalog) {\n            if (catalog === null) {\n                return;\n            }\n            self._setCatalog(domain, language, catalog);\n            self._storeCatalog(domain, language, catalog);\n        });\n    };\n\n    self.MessageFactory = function (domain, language) {\n        language = language || self.currentLanguage;\n        return function translate(msgid, keywords) {\n            var msgstr;\n            if (\n                domain in self.catalogs &&\n                language in self.catalogs[domain] &&\n                msgid in self.catalogs[domain][language]\n            ) {\n                msgstr = self.catalogs[domain][language][msgid];\n            } else {\n                msgstr = msgid;\n            }\n            if (keywords) {\n                var regexp, keyword;\n                for (keyword in keywords) {\n                    if (Object.prototype.hasOwnProperty.call(keywords, keyword)) {\n                        regexp = new RegExp(\"\\\\$\\\\{\" + keyword + \"\\\\}\", \"g\");\n                        msgstr = msgstr.replace(regexp, keywords[keyword]);\n                    }\n                }\n            }\n            return msgstr;\n        };\n    };\n};\n\nexport default i18n;\n","import $ from \"jquery\";\nimport logging from \"@patternslib/patternslib/src/core/logging\";\n\nconst logger = logging.getLogger(\"core utils\");\n\nvar QueryHelper = function (options) {\n    /* if pattern argument provided, it can implement the interface of:\n     *    - browsing: boolean if currently browsing\n     *    - currentPath: string of current path to apply to search if browsing\n     *    - basePath: default path to provide if no subpath used\n     */\n\n    var self = this;\n    var defaults = {\n        pattern: null, // must be passed in\n        vocabularyUrl: null,\n        searchParam: \"SearchableText\", // query string param to pass to search url\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        attributes: [\"UID\", \"Title\", \"Description\", \"getURL\", \"portal_type\"],\n        batchSize: 10, // number of results to retrive\n        baseCriteria: [],\n        sort_on: \"is_folderish\",\n        sort_order: \"reverse\",\n        pathDepth: 1,\n    };\n    self.options = $.extend({}, defaults, options);\n\n    self.pattern = self.options.pattern;\n    if (self.pattern === undefined || self.pattern === null) {\n        self.pattern = {\n            browsing: false,\n            basePath: \"/\",\n        };\n    }\n\n    if (self.options.url && !self.options.vocabularyUrl) {\n        self.options.vocabularyUrl = self.options.url;\n    } else if (self.pattern.vocabularyUrl) {\n        self.options.vocabularyUrl = self.pattern.vocabularyUrl;\n    }\n    self.valid = Boolean(self.options.vocabularyUrl);\n\n    self.getBatch = function (page) {\n        return {\n            page: page ? page : 1,\n            size: self.options.batchSize,\n        };\n    };\n\n    self.getCurrentPath = function () {\n        var pattern = self.pattern;\n        var currentPath;\n        /* If currentPath is set on the QueryHelper object, use that first.\n         * Then, check on the pattern.\n         * Finally, see if it is a function and call it if it is.\n         */\n        if (self.currentPath) {\n            currentPath = self.currentPath;\n        } else {\n            currentPath = pattern.currentPath;\n        }\n        if (typeof currentPath === \"function\") {\n            currentPath = currentPath();\n        }\n        var path = currentPath;\n        if (!path) {\n            if (pattern.basePath) {\n                path = pattern.basePath;\n            } else if (pattern.options.basePath) {\n                path = pattern.options.basePath;\n            } else {\n                path = \"/\";\n            }\n        }\n        return path;\n    };\n\n    self.getCriterias = function (term, searchOptions) {\n        if (searchOptions === undefined) {\n            searchOptions = {};\n        }\n        searchOptions = $.extend(\n            {},\n            {\n                useBaseCriteria: true,\n                additionalCriterias: [],\n            },\n            searchOptions\n        );\n\n        var criterias = [];\n        if (searchOptions.useBaseCriteria) {\n            criterias = self.options.baseCriteria.slice(0);\n        }\n        if (term) {\n            term += \"*\";\n            criterias.push({\n                i: self.options.searchParam,\n                o: \"plone.app.querystring.operation.string.contains\",\n                v: term,\n            });\n        }\n        if (searchOptions.searchPath) {\n            criterias.push({\n                i: \"path\",\n                o: self.options.pathOperator,\n                v: searchOptions.searchPath + \"::\" + self.options.pathDepth,\n            });\n        } else if (self.pattern.browsing) {\n            criterias.push({\n                i: \"path\",\n                o: self.options.pathOperator,\n                v: self.getCurrentPath() + \"::\" + self.options.pathDepth,\n            });\n        }\n        criterias = criterias.concat(searchOptions.additionalCriterias);\n        return criterias;\n    };\n\n    self.getQueryData = function (term, page) {\n        var data = {\n            query: JSON.stringify({\n                criteria: self.getCriterias(term),\n                sort_on: self.options.sort_on,\n                sort_order: self.options.sort_order,\n            }),\n            attributes: JSON.stringify(self.options.attributes),\n        };\n        if (page) {\n            data.batch = JSON.stringify(self.getBatch(page));\n        }\n        return data;\n    };\n\n    self.getUrl = function () {\n        var url = self.options.vocabularyUrl;\n        if (url.indexOf(\"?\") === -1) {\n            url += \"?\";\n        } else {\n            url += \"&\";\n        }\n        return url + $.param(self.getQueryData());\n    };\n\n    self.selectAjax = function () {\n        return {\n            url: self.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: 100,\n            data: function (term, page) {\n                return self.getQueryData(term, page);\n            },\n            results: function (data, page) {\n                var more = page * 10 < data.total; // whether or not there are more results available\n                // notice we return the value of more so Select2 knows if more results can be loaded\n                return {\n                    results: data.results,\n                    more: more,\n                };\n            },\n        };\n    };\n\n    self.search = function (term, operation, value, callback, useBaseCriteria, type) {\n        if (useBaseCriteria === undefined) {\n            useBaseCriteria = true;\n        }\n        if (type === undefined) {\n            type = \"GET\";\n        }\n        var criteria = [];\n        if (useBaseCriteria) {\n            criteria = self.options.baseCriteria.slice(0);\n        }\n        criteria.push({\n            i: term,\n            o: operation,\n            v: value,\n        });\n        var data = {\n            query: JSON.stringify({\n                criteria: criteria,\n            }),\n            attributes: JSON.stringify(self.options.attributes),\n        };\n        $.ajax({\n            url: self.options.vocabularyUrl,\n            dataType: \"JSON\",\n            data: data,\n            type: type,\n            success: callback,\n        });\n    };\n\n    return self;\n};\n\nvar Loading = function (options) {\n    /*\n     * Options:\n     *   backdrop(pattern): if you want to have the progress indicator work\n     *                      seamlessly with backdrop pattern\n     *   zIndex(integer or function): to override default z-index used\n     */\n    var self = this;\n    self.className = \"spinner-border\";\n    var defaults = {\n        backdrop: null,\n        zIndex: 10005, // can be a function\n    };\n    if (!options) {\n        options = {};\n    }\n    self.options = $.extend({}, defaults, options);\n\n    self.init = function () {\n        self.$el = $(\".\" + self.className);\n        if (self.$el.length === 0) {\n            self.$el = $(\"<div><div></div></div>\");\n            self.$el.addClass(self.className).hide().appendTo(\"body\");\n        }\n    };\n\n    self.show = function (closable) {\n        self.init();\n        self.$el.show();\n        self.$el.css(\"position\", \"absolute\");\n        self.$el.css(\"top\", \"50%\");\n        self.$el.css(\"left\", \"50%\");\n        var zIndex = self.options.zIndex;\n        if (typeof zIndex === \"function\") {\n            zIndex = Math.max(zIndex(), 10005);\n        } else {\n            // go through all modals and backdrops and make sure we have a higher\n            // z-index to use\n            zIndex = 10005;\n            $(\".modal-wrapper,.-modal-backdrop\").each(function () {\n                zIndex = Math.max(zIndex, $(this).css(\"zIndex\") || 10005);\n            });\n            zIndex += 1;\n        }\n        self.$el.css(\"zIndex\", zIndex);\n\n        if (closable === undefined) {\n            closable = true;\n        }\n        if (self.options.backdrop) {\n            self.options.backdrop.closeOnClick = closable;\n            self.options.backdrop.closeOnEsc = closable;\n            self.options.backdrop.init();\n            self.options.backdrop.show();\n        }\n    };\n\n    self.hide = function () {\n        self.init();\n        self.$el.hide();\n    };\n\n    return self;\n};\n\nvar getAuthenticator = function () {\n    var $el = $('input[name=\"_authenticator\"]');\n    if ($el.length === 0) {\n        $el = $('a[href*=\"_authenticator\"]');\n        if ($el.length > 0) {\n            return $el.attr(\"href\").split(\"_authenticator=\")[1];\n        }\n        return \"\";\n    } else {\n        return $el.val();\n    }\n};\n\nvar generateId = function (prefix) {\n    if (prefix === undefined) {\n        prefix = \"id\";\n    }\n    return (\n        prefix +\n        Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1)\n    );\n};\n\nvar setId = function ($el, prefix) {\n    if (prefix === undefined) {\n        prefix = \"id\";\n    }\n    var id = $el.attr(\"id\");\n    if (id === undefined) {\n        id = generateId(prefix);\n    } else {\n        /* hopefully we don't screw anything up here... changing the id\n         * in some cases so we get a decent selector */\n        id = id.replace(/\\./g, \"-\");\n    }\n    $el.attr(\"id\", id);\n    return id;\n};\n\nvar getWindow = function () {\n    var win = window;\n    if (win.parent !== window) {\n        win = win.parent;\n    }\n    return win;\n};\n\nvar parseBodyTag = function (txt) {\n    return $(\n        /<body[^>]*>[^]*<\\/body>/im\n            .exec(txt)[0]\n            .replace(\"<body\", \"<div\")\n            .replace(\"</body>\", \"</div>\")\n    )\n        .eq(0)\n        .html();\n};\n\nvar featureSupport = {\n    /* Well tested feature support for things we use in mockup.\n     * All gathered from: http://diveintohtml5.info/everything.html\n     * Alternative to using some form of modernizr.\n     */\n    dragAndDrop: function () {\n        return \"draggable\" in document.createElement(\"span\");\n    },\n    fileApi: function () {\n        return typeof FileReader != \"undefined\";\n    },\n    history: function () {\n        return !!(window.history && window.history.pushState);\n    },\n};\n\nvar bool = function (val) {\n    if (typeof val === \"string\") {\n        val = val.trim(val).toLowerCase();\n    }\n    return [\"false\", false, \"0\", 0, \"\", undefined, null].indexOf(val) === -1;\n};\n\nvar escapeHTML = function (val) {\n    return $(\"<div/>\").text(val).html();\n};\n\nvar removeHTML = function (val) {\n    return val.replace(/<[^>]+>/gi, \"\");\n};\n\nvar storage = {\n    // Simple local storage wrapper, which doesn't break down if it's not available.\n    get: function (name) {\n        if (window.localStorage) {\n            var val = window.localStorage[name];\n            return typeof val === \"string\" ? JSON.parse(val) : undefined;\n        }\n    },\n\n    set: function (name, val) {\n        if (window.localStorage) {\n            window.localStorage[name] = JSON.stringify(val);\n        }\n    },\n};\n\nexport const ICON_CACHE = new Map();\n\n/**\n * Return a <svg> element from a icon name.\n *\n * Example:\n *     const dropdownIcon: await utils.resolveIcon('plone-settings');\n *\n * @param {String} name - The name of the icon as stored in the plone registry.\n * @returns {String} - The SVG markup for the icon.\n */\nconst resolveIcon = async function (name) {\n    // if (name === 'plone.icon.plone-rearrange'){debugger}\n    const icon_lookup_name = `plone.icon.${name}`;\n    const cache_key = icon_lookup_name;\n\n    // ATTENTION: async/await trick ahead!\n    if (!ICON_CACHE.has(cache_key)) {\n        // 1) Immediately set the asynchronous function call to _resolve_icon in the icon cache.\n        // Subsequent calls will not re-set this because the cache_key is already set.\n        ICON_CACHE.set(cache_key, _resolve_icon());\n        logger.debug(`Loading icon \"${icon_lookup_name}\"`);\n    }\n    // 2) Await the promise for resolving the icon or just return the icon itself.\n    return await ICON_CACHE.get(cache_key);\n\n    async function _resolve_icon() {\n        // Do the actual loading.\n\n        let icon = \"\";\n        const base_url = document.body.getAttribute(\"data-portal-url\");\n        if (base_url) {\n            const url = base_url + \"/@@iconresolver\";\n            if (url) {\n                try {\n                    // Fetch timeout\n                    const controller = new AbortController();\n                    // 5 second timeout:\n                    setTimeout(() => controller.abort(), 5000);\n\n                    const resp = await fetch(`${url}/${name}`, {\n                        signal: controller.signal,\n                    });\n                    icon = await resp.text();\n                } catch (e) {\n                    logger.warn(`Loading icon \"${name}\" from URL ${url} failed.`);\n                    console.warn(e);\n                }\n            }\n        }\n        if (!icon) {\n            // fallback\n            name = icon_lookup_name;\n            try {\n                import(\"../styles/icons.scss\");\n                const iconmap = await import(\"../iconmap.json\");\n                const parts = iconmap[name]?.split?.(\"/\");\n                if (parts[0].includes(\"bootstrap-icons\")) {\n                    icon = await import(`bootstrap-icons/icons/${parts[1]}`);\n                    icon = icon?.default;\n                }\n            } catch (e) {\n                // import error\n                logger.warn(`Loading icon \"${icon_lookup_name}\" failed from fallback.`);\n                console.warn(e);\n            }\n        }\n        return icon;\n    }\n};\n\nexport default {\n    bool: bool,\n    escapeHTML: escapeHTML,\n    removeHTML: removeHTML,\n    featureSupport: featureSupport,\n    generateId: generateId,\n    getAuthenticator: getAuthenticator,\n    getWindow: getWindow,\n    Loading: Loading,\n    loading: new Loading(), // provide default loader\n    parseBodyTag: parseBodyTag,\n    QueryHelper: QueryHelper,\n    resolveIcon: resolveIcon,\n    setId: setId,\n    storage: storage,\n};\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"backdrop\",\n    trigger: \".pat-backdrop\",\n    parser: \"mockup\",\n    defaults: {\n        zIndex: null,\n        opacity: 0.8,\n        className: \"plone-backdrop\",\n        classActiveName: \"plone-backdrop-active\",\n        closeOnEsc: true,\n        closeOnClick: true,\n    },\n    init: function () {\n        var self = this;\n        self.$backdrop = $(\"> .\" + self.options.className, self.$el);\n        if (self.$backdrop.length === 0) {\n            self.$backdrop = $(\"<div/>\")\n                .hide()\n                .appendTo(self.$el)\n                .addClass(self.options.className);\n            if (self.options.zIndex !== null) {\n                self.$backdrop.css(\"z-index\", self.options.zIndex);\n            }\n        }\n        if (self.options.closeOnEsc === true) {\n            // eslint-disable-next-line no-unused-vars\n            $(document).on(\"keydown\", function (e, data) {\n                if (self.$el.is(\".\" + self.options.classActiveName)) {\n                    if (e.keyCode === 27) {\n                        // ESC key pressed\n                        self.hide();\n                    }\n                }\n            });\n        }\n        if (self.options.closeOnClick === true) {\n            self.$backdrop.on(\"click\", function () {\n                if (self.$el.is(\".\" + self.options.classActiveName)) {\n                    self.hide();\n                }\n            });\n        }\n    },\n    show: function () {\n        var self = this;\n        if (!self.$el.hasClass(self.options.classActiveName)) {\n            self.emit(\"show\");\n            self.$backdrop.css(\"opacity\", \"0\").show();\n            self.$el.addClass(self.options.classActiveName);\n            self.$backdrop.animate({ opacity: self.options.opacity }, 500);\n            self.emit(\"shown\");\n        }\n    },\n    hide: function () {\n        var self = this;\n        if (self.$el.hasClass(self.options.classActiveName)) {\n            self.emit(\"hide\");\n            self.$backdrop.animate({ opacity: \"0\" }, 500).hide();\n            self.$el.removeClass(self.options.classActiveName);\n            self.emit(\"hidden\");\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"datatables\",\n    trigger: \".pat-datatables\",\n    parser: \"mockup\",\n    table: null,\n\n    defaults: {\n        // Default values for attributes\n    },\n\n    async init() {\n        import(\"datatables.net-bs5/css/dataTables.bootstrap5.min.css\");\n        import(\"datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css\");\n        import(\"datatables.net-colreorder-bs5/css/colReorder.bootstrap5.min.css\");\n        import(\"datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css\"); // prettier-ignore\n        import(\"datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css\"); // prettier-ignore\n        import(\"datatables.net-rowreorder-bs5/css/rowReorder.bootstrap5.min.css\");\n        import(\"datatables.net-select-bs5/css/select.bootstrap5.min.css\");\n\n        await import(\"datatables.net\");\n        await import(\"datatables.net-bs5\");\n        await import(\"datatables.net-buttons\");\n        await import(\"datatables.net-buttons-bs5\");\n        await import(\"datatables.net-buttons/js/buttons.colVis\");\n        await import(\"datatables.net-buttons/js/buttons.html5\");\n        await import(\"datatables.net-buttons/js/buttons.print\");\n        await import(\"datatables.net-colreorder\");\n        await import(\"datatables.net-colreorder-bs5\");\n        await import(\"datatables.net-fixedcolumns\");\n        await import(\"datatables.net-fixedcolumns-bs5\");\n        await import(\"datatables.net-fixedheader\");\n        await import(\"datatables.net-fixedheader-bs5\");\n        await import(\"datatables.net-rowreorder\");\n        await import(\"datatables.net-rowreorder-bs5\");\n        await import(\"datatables.net-select\");\n        await import(\"datatables.net-select-bs5\");\n\n        $(this.el).DataTable(this.options);\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _ from \"underscore\";\nimport Backdrop from \"../backdrop/backdrop\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport _t from \"../../core/i18n\";\n\nimport \"jquery-form\";\n\nexport default Base.extend({\n    name: \"plone-modal\",\n    trigger: \".pat-plone-modal\",\n    parser: \"mockup\",\n    createModal: null,\n    $model: null,\n    defaults: {\n        width: \"\",\n        height: \"\",\n        modalSizeClass: \"\",\n        margin: 0,\n        position: \"center middle\", // format: '<horizontal> <vertical>' -- allowed values: top, bottom, left, right, center, middle\n        triggers: [],\n        zIndexSelector: \".modal-wrapper,.modal-backdrop\",\n        backdrop: \"body\", // Element to initiate the Backdrop on.\n        backdropOptions: {\n            zIndex: \"1040\",\n            opacity: \"0.85\",\n            className: \"modal-backdrop\",\n            classActiveName: \"backdrop-active\",\n            closeOnEsc: true,\n            closeOnClick: true,\n        },\n        title: null,\n        titleSelector: \"h1:first\",\n        buttons: '.formControls > input[type=\"submit\"], .formControls > button',\n        content: \"#content\",\n        automaticallyAddButtonActions: true,\n        loadLinksWithinModal: true,\n        prependContent: \".portalMessage, #global_statusmessage\",\n        onRender: null,\n        templateOptions: {\n            className: \"modal fade\",\n            classDialog: \"modal-dialog\",\n            classModal: \"modal-content\",\n            classHeaderName: \"modal-header\",\n            classBodyName: \"modal-body\",\n            classFooterName: \"modal-footer\",\n            classWrapperName: \"modal-wrapper\",\n            classWrapperInnerName: \"modal-wrapper-inner\",\n            classActiveName: \"show\",\n            classPrependName: \"\", // String, css class to be applied to the wrapper of the prepended content\n            classContentName: \"\", // String, class name to be applied to the content of the modal, useful for modal specific styling\n            template:\n                \"\" +\n                '<div class=\"<%= options.className %>\">' +\n                '  <div class=\"<%= options.classDialog %><% if (modalSizeClass) { %> <%= modalSizeClass %><% } %>\" role=\"dialog\" <% if (title) { %>aria-labelledby=\"modal-title\" <% } %> tabindex=\"-1\">' +\n                '    <div class=\"<%= options.classModal %>\" role=\"document\">' +\n                '      <div class=\"<%= options.classHeaderName %>\">' +\n                '        <% if (title) { %><h5 class=\"modal-title\" id=\"modal-title\" tabindex=\"0\"><%= title %></h5><% } %>' +\n                '        <button type=\"button\" class=\"btn-close modal-close\" aria-label=\"Close\"></button>' +\n                \"      </div>\" +\n                '      <div class=\"<%= options.classBodyName %>\">' +\n                '        <div class=\"<%= options.classPrependName %>\"><%= prepend %></div> ' +\n                '        <div class=\"<%= options.classContentName %>\"><%= content %></div>' +\n                \"      </div>\" +\n                '      <div class=\"<%= options.classFooterName %>\"> ' +\n                \"        <% if (buttons) { %><%= buttons %><% } %>\" +\n                \"      </div>\" +\n                \"    </div>\" +\n                \"  </div>\" +\n                \"</div>\",\n        },\n        actions: {},\n        actionOptions: {\n            eventType: \"click\",\n            disableAjaxFormSubmit: false,\n            target: null,\n            ajaxUrl: null, // string, or function($el, options) that returns a string\n            modalFunction: null, // String, function name on self to call\n            isForm: false,\n            timeout: 5000,\n            displayInModal: true,\n            reloadWindowOnClose: true,\n            error: \".portalMessage.error, .alert-danger\",\n            formFieldError: \".field.error\",\n            onSuccess: null,\n            onError: null,\n            onFormError: null,\n            onTimeout: null,\n            redirectOnResponse: false,\n            redirectToUrl: function ($action, response) {\n                var reg;\n                reg = /<body.*data-view-url=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // view url as data attribute on body (Plone 5)\n                    return reg[1].split('\"')[0];\n                }\n                reg = /<body.*data-base-url=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // Base url as data attribute on body (Plone 5)\n                    return reg[1].split('\"')[0];\n                }\n                reg = /<base.*href=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // base tag available (Plone 4)\n                    return reg[1];\n                }\n                return \"\";\n            },\n        },\n        form: function (actions) {\n            var self = this;\n            var $modal = self.$modal;\n\n            if (self.options.automaticallyAddButtonActions) {\n                actions[self.options.buttons] = {};\n            }\n            actions.a = {};\n\n            $.each(actions, function (action, options) {\n                var actionKeys = _.union(_.keys(self.options.actionOptions), [\n                    \"templateOptions\",\n                ]);\n                var actionOptions = $.extend(\n                    true,\n                    {},\n                    self.options.actionOptions,\n                    _.pick(options, actionKeys)\n                );\n                options.templateOptions = $.extend(\n                    true,\n                    options.templateOptions,\n                    self.options.templateOptions\n                );\n\n                var patternKeys = _.union(_.keys(self.options.actionOptions), [\n                    \"actions\",\n                    \"actionOptions\",\n                ]);\n                var patternOptions = $.extend(\n                    true,\n                    _.omit(options, patternKeys),\n                    self.options\n                );\n                $(action, $(\".\" + options.templateOptions.classBodyName, $modal)).each(\n                    function () {\n                        var $action = $(this);\n                        $action.on(actionOptions.eventType, function (e) {\n                            e.stopPropagation();\n                            e.preventDefault();\n\n                            self.loading.show(false);\n\n                            // handle event on $action using a function on self\n                            if (actionOptions.modalFunction !== null) {\n                                self[actionOptions.modalFunction]();\n                                // handle event on input/button using jquery.form library\n                            } else if (\n                                $.nodeName($action[0], \"input\") ||\n                                $.nodeName($action[0], \"button\") ||\n                                options.isForm === true\n                            ) {\n                                self.options.handleFormAction.apply(self, [\n                                    $action,\n                                    actionOptions,\n                                    patternOptions,\n                                ]);\n                                // handle event on link with jQuery.ajax\n                            } else if (\n                                options.ajaxUrl !== null ||\n                                $.nodeName($action[0], \"a\")\n                            ) {\n                                self.options.handleLinkAction.apply(self, [\n                                    $action,\n                                    actionOptions,\n                                    patternOptions,\n                                ]);\n                            }\n                        });\n                    }\n                );\n            });\n        },\n        handleFormAction: function ($action, options, patternOptions) {\n            var self = this;\n\n            // pass action that was clicked when submiting form\n            var extraData = {};\n            extraData[$action.attr(\"name\")] = $action.attr(\"value\");\n\n            var $form;\n\n            if ($.nodeName($action[0], \"form\")) {\n                $form = $action;\n            } else {\n                $form = $action.parents(\"form:not(.disableAutoSubmit)\");\n            }\n\n            var url;\n            if (options.ajaxUrl !== null) {\n                if (typeof options.ajaxUrl === \"function\") {\n                    url = options.ajaxUrl.apply(self, [$action, options]);\n                } else {\n                    url = options.ajaxUrl;\n                }\n            } else {\n                url = $action.parents(\"form\").attr(\"action\");\n            }\n\n            if (options.disableAjaxFormSubmit) {\n                if ($action.attr(\"name\") && $action.attr(\"value\")) {\n                    $form.append(\n                        $(\n                            '<input type=\"hidden\" name=\"' +\n                                $action.attr(\"name\") +\n                                '\" value=\"' +\n                                $action.attr(\"value\") +\n                                '\" />'\n                        )\n                    );\n                }\n                $form.trigger(\"submit\");\n                return;\n            }\n            // We want to trigger the form submit event but NOT use the default\n            $form.on(\"submit\", function (e) {\n                e.preventDefault();\n            });\n            $form.trigger(\"submit\");\n\n            self.loading.show(false);\n            $form.ajaxSubmit({\n                timeout: options.timeout,\n                data: extraData,\n                url: url,\n                error: function (xhr, textStatus, errorStatus) {\n                    self.loading.hide();\n                    if (textStatus === \"timeout\" && options.onTimeout) {\n                        options.onTimeout.apply(self, xhr, errorStatus);\n                        // on \"error\", \"abort\", and \"parsererror\"\n                    } else if (options.onError) {\n                        if (typeof options.onError === \"string\") {\n                            window[options.onError](xhr, textStatus, errorStatus);\n                        } else {\n                            options.onError(xhr, textStatus, errorStatus);\n                        }\n                    } else {\n                        // window.alert(_t('There was an error submitting the form.'));\n                        console.log(\"error happened\", textStatus, \" do something\");\n                    }\n                    self.emit(\"formActionError\", [xhr, textStatus, errorStatus]);\n                },\n                success: function (response, state, xhr, form) {\n                    self.loading.hide();\n                    // if error is found (NOTE: check for both the portal errors\n                    // and the form field-level errors)\n                    if (\n                        $(options.error, response).length !== 0 ||\n                        $(options.formFieldError, response).length !== 0\n                    ) {\n                        if (options.onFormError) {\n                            if (typeof options.onFormError === \"string\") {\n                                window[options.onFormError](\n                                    self,\n                                    response,\n                                    state,\n                                    xhr,\n                                    form\n                                );\n                            } else {\n                                options.onFormError(self, response, state, xhr, form);\n                            }\n                        } else {\n                            self.redraw(response, patternOptions);\n                        }\n                        return;\n                    }\n\n                    if (options.redirectOnResponse === true) {\n                        if (typeof options.redirectToUrl === \"function\") {\n                            window.parent.location.href = options.redirectToUrl.apply(\n                                self,\n                                [$action, response, options]\n                            );\n                        } else {\n                            window.parent.location.href = options.redirectToUrl;\n                        }\n                        return; // cut out right here since we're changing url\n                    }\n\n                    if (options.onSuccess) {\n                        if (typeof options.onSuccess === \"string\") {\n                            window[options.onSuccess](self, response, state, xhr, form);\n                        } else {\n                            options.onSuccess(self, response, state, xhr, form);\n                        }\n                    }\n\n                    if (options.displayInModal === true) {\n                        self.redraw(response, patternOptions);\n                    } else {\n                        $action.trigger(\"destroy.plone-modal.patterns\");\n                        // also calls hide\n                        if (options.reloadWindowOnClose) {\n                            self.reloadWindow();\n                        }\n                    }\n                    self.emit(\"formActionSuccess\", [response, state, xhr, form]);\n                },\n            });\n        },\n        handleLinkAction: function ($action, options, patternOptions) {\n            var self = this;\n            var url;\n            if ($action.hasClass(\"pat-plone-modal\")) {\n                // if link is a modal pattern, do not reload the page\n                return;\n            }\n\n            // Figure out URL\n            if (options.ajaxUrl) {\n                if (typeof options.ajaxUrl === \"function\") {\n                    url = options.ajaxUrl.apply(self, [$action, options]);\n                } else {\n                    url = options.ajaxUrl;\n                }\n            } else {\n                url = $action.attr(\"href\");\n            }\n\n            // Non-ajax link (I know it says \"ajaxUrl\" ...)\n            if (options.displayInModal === false) {\n                if ($action.attr(\"target\") === \"_blank\") {\n                    window.open(url, \"_blank\");\n                    self.loading.hide();\n                } else {\n                    window.location = url;\n                }\n                return;\n            }\n\n            // ajax version\n            $.ajax({\n                url: url,\n            })\n                .fail(function (xhr, textStatus, errorStatus) {\n                    if (textStatus === \"timeout\" && options.onTimeout) {\n                        options.onTimeout(self.$modal, xhr, errorStatus);\n\n                        // on \"error\", \"abort\", and \"parsererror\"\n                    } else if (options.onError) {\n                        options.onError(xhr, textStatus, errorStatus);\n                    } else {\n                        window.alert(_t(\"There was an error loading modal.\"));\n                    }\n                    self.emit(\"linkActionError\", [xhr, textStatus, errorStatus]);\n                })\n                .done(function (response, state, xhr) {\n                    self.redraw(response, patternOptions);\n                    if (options.onSuccess) {\n                        if (typeof options.onSuccess === \"string\") {\n                            window[options.onSuccess](self, response, state, xhr);\n                        } else {\n                            options.onSuccess(self, response, state, xhr);\n                        }\n                    }\n\n                    self.emit(\"linkActionSuccess\", [response, state, xhr]);\n                })\n                .always(function () {\n                    self.loading.hide();\n                });\n        },\n        render: function (options) {\n            var self = this;\n\n            self.emit(\"before-render\");\n\n            if (!self.$raw) {\n                return;\n            }\n            var $raw = self.$raw.clone();\n            // fix for IE9 bug (see http://bugs.jquery.com/ticket/10550)\n            $(\"input:checked\", $raw).each(function () {\n                if (this.setAttribute) {\n                    this.setAttribute(\"checked\", \"checked\");\n                }\n            });\n\n            // Object that will be passed to the template\n            var tplObject = {\n                title: \"\",\n                prepend: \"<div />\",\n                content: \"\",\n                modalSizeClass: options.modalSizeClass,\n                buttons: '<div class=\"pattern-modal-buttons\"></div>',\n                options: options.templateOptions,\n            };\n\n            // setup the Title\n            if (options.title === null) {\n                var $title = $(options.titleSelector, $raw);\n                tplObject.title = $title.html();\n                $(options.titleSelector, $raw).remove();\n            } else {\n                tplObject.title = options.title;\n            }\n\n            // Grab items to to insert into the prepend area\n            if (options.prependContent) {\n                tplObject.prepend = $(\"<div />\")\n                    .append($(options.prependContent, $raw).clone())\n                    .html();\n                $(options.prependContent, $raw).remove();\n            }\n\n            // Filter out the content if there is a selector provided\n            if (options.content) {\n                tplObject.content = $(options.content, $raw).html();\n            } else {\n                tplObject.content = $raw.html();\n            }\n\n            // Render html\n            self.$modal = $(\n                _.template(self.options.templateOptions.template)(tplObject)\n            );\n            self.$modalDialog = $(\n                \"> .\" + self.options.templateOptions.classDialog,\n                self.$modal\n            );\n            self.$modalContent = $(\n                \"> .\" + self.options.templateOptions.classModal,\n                self.$modalDialog\n            );\n\n            // In most browsers, when you hit the enter key while a form element is focused\n            // the browser will trigger the form 'submit' event.  Google Chrome also does this,\n            // but not when when the default submit button is hidden with 'display: none'.\n            // The following code will work around this issue:\n            $(\"form\", self.$modal).on(\"keydown\", function (event) {\n                // ignore keys which are not enter, and ignore enter inside a textarea.\n                if (event.keyCode !== 13 || event.target.nodeName === \"TEXTAREA\") {\n                    return;\n                }\n                event.preventDefault();\n                $(\"input[type=submit], button[type=submit], button:not(type)\", this)\n                    .eq(0)\n                    .trigger(\"click\");\n            });\n\n            // Setup buttons\n            $(options.buttons, self.$modal).each(function () {\n                var $button = $(this);\n                $button\n                    .on(\"click\", function (e) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                    })\n                    .clone()\n                    .appendTo($(\".pattern-modal-buttons\", self.$modal))\n                    .off(\"click\")\n                    .on(\"click\", function (e) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                        $button.trigger(\"click\");\n                    });\n                $button.hide();\n            });\n\n            self.emit(\"before-events-setup\");\n\n            // Wire up events\n            self.$modal[0]\n                .querySelectorAll(\n                    `.modal-header > .modal-close,\n                 .modal-footer > .pattern-modal-buttons > .modal-close,\n                 .modal-footer [name=\"form.buttons.Cancel\" i]`\n                )\n                .forEach((el) => {\n                    $(el)\n                        .off(\"click\")\n                        .on(\"click\", (e) => {\n                            e.stopPropagation();\n                            e.preventDefault();\n                            $(e.target).trigger(\"destroy.plone-modal.patterns\");\n                        });\n                });\n\n            // form\n            if (options.form) {\n                options.form.apply(self, [options.actions]);\n            }\n\n            self.$modal\n                .addClass(self.options.templateOptions.className)\n                .on(\"destroy.plone-modal.patterns\", function (e) {\n                    e.stopPropagation();\n                    self.hide();\n                })\n                .on(\"resize.plone-modal.patterns\", function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    self.positionModal();\n                })\n                .appendTo(self.$wrapperInner);\n\n            if (self.options.loadLinksWithinModal) {\n                self.$modal.on(\"click\", function (e) {\n                    e.stopPropagation();\n                    if ($.nodeName(e.target, \"a\")) {\n                        e.preventDefault();\n                        // TODO: open links inside modal\n                        // and slide modal body\n                    }\n                    self.$modal.trigger(\"modal-click\");\n                });\n            }\n            self.$modal.data(\"pattern-\" + self.name, self);\n            self.emit(\"after-render\");\n            if (options.onRender) {\n                if (typeof options.onRender === \"string\") {\n                    window[options.onRender](self);\n                } else {\n                    options.onRender(self);\n                }\n            }\n        },\n    },\n    reloadWindow: function () {\n        window.parent.location.reload();\n    },\n    init: function () {\n        import(\"./modal.scss\");\n\n        var self = this;\n        self.options.loadLinksWithinModal = $.parseJSON(\n            self.options.loadLinksWithinModal\n        );\n\n        if (self.options.backdropOptions.closeOnEsc === true) {\n            $(document).on(\"keydown\", function (e) {\n                if (self.$el.is(\".\" + self.options.templateOptions.classActiveName)) {\n                    if (e.keyCode === 27) {\n                        // ESC key pressed\n                        self.hide();\n                    }\n                }\n            });\n        }\n\n        $(window.parent).resize(function () {\n            self.positionModal();\n        });\n\n        if (self.options.triggers) {\n            $.each(self.options.triggers, function (i, item) {\n                var e = item.substring(0, item.indexOf(\" \"));\n                var selector = item.substring(item.indexOf(\" \"), item.length);\n                $(selector || self.$el).on(e, function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    self.show();\n                });\n            });\n        }\n\n        if (self.$el.is(\"a\")) {\n            if (self.$el.attr(\"href\") && !self.options.image) {\n                if (\n                    !self.options.target &&\n                    self.$el.attr(\"href\").substr(0, 1) === \"#\" &&\n                    self.$el.attr(\"href\").length > 1\n                ) {\n                    self.options.target = self.$el.attr(\"href\");\n                    self.options.content = \"\";\n                }\n                if (\n                    !self.options.ajaxUrl &&\n                    self.$el.attr(\"href\").substr(0, 1) !== \"#\"\n                ) {\n                    self.options.ajaxUrl = function () {\n                        // Resolve ``href`` attribute later, when modal is shown.\n                        return self.$el.attr(\"href\");\n                    };\n                }\n            }\n            self.$el.on(\"click\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                self.show();\n            });\n        }\n        self.initModal();\n    },\n\n    createAjaxModal: function () {\n        var self = this;\n        self.emit(\"before-ajax\");\n        self.loading.show();\n\n        var ajaxUrl = self.options.ajaxUrl;\n        if (typeof ajaxUrl === \"function\") {\n            ajaxUrl = ajaxUrl.apply(self, [self.options]);\n        }\n\n        self.ajaxXHR = $.ajax({\n            url: ajaxUrl,\n            type: self.options.ajaxType,\n        })\n            .done(function (response, textStatus, xhr) {\n                self.ajaxXHR = undefined;\n                self.$raw = $(\"<div />\").append($(utils.parseBodyTag(response)));\n                self.emit(\"after-ajax\", self, textStatus, xhr);\n                self._show();\n            })\n            .fail(function (xhr, textStatus, errorStatus) {\n                var options = self.options.actionOptions;\n                if (textStatus === \"timeout\" && options.onTimeout) {\n                    options.onTimeout(self.$modal, xhr, errorStatus);\n                } else if (options.onError) {\n                    options.onError(xhr, textStatus, errorStatus);\n                } else {\n                    window.alert(_t(\"There was an error loading modal.\"));\n                    self.hide();\n                }\n                self.emit(\"linkActionError\", [xhr, textStatus, errorStatus]);\n            })\n            .always(function () {\n                self.loading.hide();\n            });\n    },\n\n    createTargetModal: function () {\n        var self = this;\n        self.$raw = $(self.options.target).clone();\n        self._show();\n    },\n\n    createBasicModal: function () {\n        var self = this;\n        self.$raw = $(\"<div/>\").html(self.$el.clone());\n        self._show();\n    },\n\n    createHtmlModal: function () {\n        var self = this;\n        var $el = $(self.options.html);\n        self.$raw = $el;\n        self._show();\n    },\n\n    createImageModal: function () {\n        var self = this;\n        self.$wrapper.addClass(\"image-modal\");\n        var src = self.$el.attr(\"href\");\n        var srcset = self.$el.attr(\"data-modal-srcset\") || \"\";\n        var title = $.trim(self.$el.context.innerText) || \"Image\";\n        // XXX aria?\n        self.$raw = $(\n            \"<div><h1>\" +\n                title +\n                '</h1><div id=\"content\"><div class=\"modal-image\"><img src=\"' +\n                src +\n                '\" srcset=\"' +\n                srcset +\n                '\" /></div></div></div>'\n        );\n        self._show();\n    },\n\n    initModal: function () {\n        var self = this;\n        if (self.options.ajaxUrl) {\n            self.createModal = self.createAjaxModal;\n        } else if (self.options.target) {\n            self.createModal = self.createTargetModal;\n        } else if (self.options.html) {\n            self.createModal = self.createHtmlModal;\n        } else if (self.options.image) {\n            self.createModal = self.createImageModal;\n        } else {\n            self.createModal = self.createBasicModal;\n        }\n    },\n\n    findPosition: function (\n        horpos,\n        vertpos,\n        margin,\n        modalWidth,\n        modalHeight,\n        wrapperInnerWidth,\n        wrapperInnerHeight\n    ) {\n        var returnpos = {};\n        var absTop, absBottom, absLeft, absRight;\n        absRight = absLeft = absTop = absLeft = \"auto\";\n\n        // -- HORIZONTAL POSITION -----------------------------------------------\n        if (horpos === \"left\") {\n            absLeft = margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the left to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absLeft = \"0px\";\n            }\n            returnpos.left = absLeft;\n        } else if (horpos === \"right\") {\n            absRight = margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the right to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absRight = \"0px\";\n            }\n            returnpos.right = absRight;\n            returnpos.left = \"auto\";\n        }\n        // default, no specified location, is to center\n        else {\n            absLeft = wrapperInnerWidth / 2 - modalWidth / 2 - margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the left to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absLeft = \"0px\";\n            }\n            returnpos.left = absLeft;\n        }\n\n        // -- VERTICAL POSITION -------------------------------------------------\n        if (vertpos === \"top\") {\n            absTop = margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the top to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absTop = \"0px\";\n            }\n            returnpos.top = absTop;\n        } else if (vertpos === \"bottom\") {\n            absBottom = margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the bottom to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absBottom = \"0px\";\n            }\n            returnpos.bottom = absBottom;\n            returnpos.top = \"auto\";\n        } else {\n            // default case, no specified location, is to center\n            absTop = wrapperInnerHeight / 2 - modalHeight / 2 - margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the top to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absTop = \"0px\";\n            }\n            returnpos.top = absTop;\n        }\n        return returnpos;\n    },\n\n    modalInitialized: function () {\n        var self = this;\n        return self.$modal !== null && self.$modal !== undefined;\n    },\n\n    activateFocusTrap: function () {\n        var self = this;\n        var inputsBody = self.$modal\n            .find(\".\" + self.options.templateOptions.classBodyName)\n            .first()\n            .find(\"select, input[type!=hidden], textarea, button, a\");\n        var inputsFooter = self.$modal\n            .find(\".\" + self.options.templateOptions.classFooterName)\n            .first()\n            .find(\"select, input[type!=hidden], textarea, button, a\");\n        var inputs = [];\n        for (var i = 0; i < inputsBody.length; i++) {\n            if ($(inputsBody[i]).is(\":visible\")) {\n                inputs.push(inputsBody[i]);\n            }\n        }\n        for (var j = 0; j < inputsFooter.length; j++) {\n            if ($(inputsFooter[j]).is(\":visible\")) {\n                inputs.push(inputsFooter[j]);\n            }\n        }\n\n        if (inputs.length === 0) {\n            inputs = self.$modal.find(\".modal-title\");\n        }\n        var firstInput = inputs[0];\n        var lastInput = inputs[inputs.length - 1];\n        var closeInput = self.$modal.find(\".modal-close\").first();\n        $(document).on(\n            \"keydown\",\n            \".\" + self.options.templateOptions.classDialog,\n            function (e) {\n                if (e.which === 9) {\n                    e.preventDefault();\n\n                    var $target = $(e.target);\n                    var currentIndex = $.inArray($target[0], inputs);\n                    if (currentIndex >= 0 && currentIndex < inputs.length) {\n                        var nextIndex = currentIndex + (e.shiftKey ? -1 : 1);\n                        if (nextIndex < 0 || nextIndex >= inputs.length) {\n                            closeInput.focus();\n                        } else {\n                            inputs[nextIndex].focus();\n                        }\n                    } else if (e.shiftKey) {\n                        lastInput.focus();\n                    } else {\n                        firstInput.focus();\n                    }\n                }\n            }\n        );\n        if (self.options.backdropOptions.closeOnClick === true) {\n            self.$modal.on(\"click\", function (e) {\n                if (\n                    !$(e.target).closest(\".\" + self.options.templateOptions.classModal)\n                        .length\n                ) {\n                    self.hide();\n                }\n            });\n        }\n\n        self.$modal.find(\".modal-title\").focus();\n    },\n\n    positionModal: function () {\n        /* re-position modal at any point.\n         *\n         * Uses:\n         *  options.margin\n         *  options.width\n         *  options.height\n         *  options.position\n         */\n        var self = this;\n        // modal isn't initialized\n        if (!self.modalInitialized()) {\n            return;\n        }\n        // clear out any previously set styling\n        self.$modal.removeAttr(\"style\");\n\n        // if backdrop wrapper is set on body, then wrapper should have height of\n        // the window, so we can do scrolling of inner wrapper\n        if (self.$wrapper.parent().is(\"body\")) {\n            self.$wrapper.height($(window.parent).height());\n        }\n\n        var margin =\n            typeof self.options.margin === \"function\"\n                ? self.options.margin()\n                : self.options.margin;\n        let modalCss = {\n            position: \"absolute\",\n        };\n        if (margin !== \"0\") {\n            modalCss[\"padding\"] = margin;\n        }\n        self.$modal.css(modalCss);\n        self.$modalDialog.css({\n            // margin: \"0\",\n            // padding: \"0\",\n            width: self.options.width, // defaults to \"\", which doesn't override other css\n            height: self.options.height, // defaults to \"\", which doesn't override other css\n        });\n        self.$modalContent.css({\n            width: self.options.width, // defaults to \"\", which doesn't override other css\n        });\n\n        var posopt = self.options.position.split(\" \"),\n            horpos = posopt[0],\n            vertpos = posopt[1];\n        var modalWidth = self.$modalDialog.outerWidth(true);\n        var modalHeight = self.$modalDialog.outerHeight(true);\n        var wrapperInnerWidth = self.$wrapperInner.width();\n        var wrapperInnerHeight = self.$wrapperInner.height();\n        var pos = self.findPosition(\n            horpos,\n            vertpos,\n            margin,\n            modalWidth,\n            modalHeight,\n            wrapperInnerWidth,\n            wrapperInnerHeight\n        );\n        for (var key in pos) {\n            self.$modalDialog.css(key, pos[key]);\n        }\n    },\n\n    render: function (options) {\n        var self = this;\n        self.emit(\"render\");\n        self.options.render.apply(self, [options]);\n        self.emit(\"rendered\");\n    },\n\n    show: function () {\n        var self = this;\n        self.backdrop = self.createBackdrop();\n        self.createModal();\n    },\n\n    createBackdrop: function () {\n        var self = this,\n            backdrop = new Backdrop(\n                self.$el.parents(self.options.backdrop),\n                self.options.backdropOptions\n            ),\n            zIndex = self.options.backdropOptions.zIndex || 1041;\n\n        $(self.options.zIndexSelector).each(function () {\n            zIndex = Math.max(zIndex, parseInt($(this).css(\"zIndex\")) + 1 || 1041);\n        });\n\n        self.$wrapper = $(\"<div/>\")\n            .hide()\n            .css({\n                \"z-index\": zIndex,\n                \"overflow-y\": \"auto\",\n                \"position\": \"fixed\",\n                \"height\": \"100%\",\n                \"width\": \"100%\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"right\": \"0\",\n                \"top\": \"0\",\n            })\n            .addClass(self.options.templateOptions.classWrapperName)\n            .insertBefore(backdrop.$backdrop)\n            .on(\"click\", function (e) {\n                if (self.options.backdropOptions.closeOnClick) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    backdrop.hide();\n                }\n            });\n        backdrop.on(\"hidden\", function () {\n            if (\n                self.$modal !== undefined &&\n                self.$modal.hasClass(self.options.templateOptions.classActiveName)\n            ) {\n                self.hide();\n            }\n        });\n        self.loading = new utils.Loading({\n            backdrop: backdrop,\n        });\n        self.$wrapperInner = $(\"<div/>\")\n            .addClass(self.options.classWrapperInnerName)\n            .css({\n                position: \"absolute\",\n                bottom: \"0\",\n                left: \"0\",\n                right: \"0\",\n                top: \"0\",\n            })\n            .appendTo(self.$wrapper);\n        return backdrop;\n    },\n\n    _show: function () {\n        var self = this;\n        self.render.apply(self, [self.options]);\n        self.emit(\"show\");\n        self.backdrop.show();\n        self.$wrapper.show();\n        self.loading.hide();\n        self.$el.addClass(self.options.templateOptions.classActiveName);\n        self.$modal.addClass(self.options.templateOptions.classActiveName);\n        registry.scan(self.$modal);\n        self.positionModal();\n        $(window.parent).on(\"resize.plone-modal.patterns\", function () {\n            self.positionModal();\n        });\n        $(\"body\").addClass(\"modal-open\");\n        self.emit(\"shown\");\n        self.activateFocusTrap();\n    },\n    hide: function () {\n        var self = this;\n        if (self.ajaxXHR) {\n            self.ajaxXHR.abort();\n        }\n        self.emit(\"hide\");\n        if (self._suppressHide) {\n            if (!window.confirm(self._suppressHide)) {\n                return;\n            }\n        }\n        self.loading.hide();\n        self.$el.removeClass(self.options.templateOptions.classActiveName);\n        if (self.$modal !== undefined) {\n            self.$modal.remove();\n            self.initModal();\n        }\n        self.$wrapper.remove();\n        if ($(\".modal\", $(\"body\")).length < 1) {\n            self._suppressHide = undefined;\n            self.backdrop.hide();\n            $(\"body\").removeClass(\"modal-open\");\n            $(window.parent).off(\"resize.plone-modal.patterns\");\n        }\n        self.emit(\"hidden\");\n        self.$el.focus();\n    },\n\n    redraw: function (response, options) {\n        var self = this;\n        self.emit(\"beforeDraw\");\n        self.$modal.remove();\n        self.$raw = $(\"<div />\").append($(utils.parseBodyTag(response)));\n        self.render.apply(self, [options || self.options]);\n        self.$modal.addClass(self.options.templateOptions.classActiveName);\n        self.positionModal();\n        registry.scan(self.$modal);\n        self.emit(\"afterDraw\");\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nvar Criteria = function () {\n    this.init.apply(this, arguments);\n};\nCriteria.prototype = {\n    defaults: {\n        indexWidth: \"20em\",\n        remove: \"\",\n        classBetweenDtName: \"querystring-criteria-betweendt\",\n        classWrapperName: \"querystring-criteria-wrapper\",\n        classIndexName: \"querystring-criteria-index\",\n        classOperatorName: \"querystring-criteria-operator\",\n        classValueName: \"querystring-criteria-value\",\n        classRemoveName: \"querystring-criteria-remove\",\n        classResultsName: \"querystring-criteria-results\",\n        classClearName: \"querystring-criteria-clear\",\n        classDepthName: \"querystring-criteria-depth\",\n    },\n    init: function (\n        $el,\n        app,\n        options,\n        indexes,\n        index,\n        operator,\n        value,\n        baseUrl,\n        patternDateOptions,\n        patternAjaxSelectOptions,\n        patternRelateditemsOptions\n    ) {\n        var self = this;\n        self.app = app;\n\n        self.options = $.extend(true, {}, self.defaults, options);\n        self.indexes = indexes;\n        self.indexGroups = {};\n        self.baseUrl = baseUrl;\n        self.advanced = false;\n        self.initial = value;\n        // create wrapper criteria and append it to DOM\n        self.$wrapper = $(\"<div/>\")\n            .addClass(self.options.classWrapperName)\n            .appendTo($el);\n\n        // Sub widgets options\n        self.patternDateOptions = patternDateOptions || {};\n        self.patternAjaxSelectOptions = patternAjaxSelectOptions || {};\n        self.patternRelateditemsOptions = patternRelateditemsOptions || {};\n        // Defaults\n        self.patternAjaxSelectOptions = $.extend(\n            { width: \"250px\" },\n            self.patternAjaxSelectOptions\n        );\n        self.patternRelateditemsOptions = $.extend(\n            {\n                vocabularyUrl:\n                    self.baseUrl +\n                    \"@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems\",\n                width: \"400px\",\n            },\n            self.patternRelateditemsOptions\n        );\n        // Force set\n        self.patternRelateditemsOptions[\"maximumSelectionSize\"] = 1;\n\n        // Remove button\n        self.$remove = $(\"<div>\" + self.options.remove + \"</div>\")\n            .addClass(self.options.classRemoveName)\n            .appendTo(self.$wrapper)\n            .on(\"click\", function (e) {\n                e.stopPropagation();\n                self.remove();\n            });\n\n        // Index selection\n        self.$index = $(\"<select><option></option></select>\").attr(\n            \"placeholder\",\n            _t(\"Select criteria\")\n        );\n\n        // list of indexes\n        $.each(self.indexes, function (value, options) {\n            if (options.enabled) {\n                if (!self.indexGroups[options.group]) {\n                    self.indexGroups[options.group] = $(\"<optgroup/>\")\n                        .attr(\"label\", options.group)\n                        .appendTo(self.$index);\n                }\n                self.indexGroups[options.group].append(\n                    $(\"<option/>\").attr(\"value\", value).html(options.title)\n                );\n            }\n        });\n\n        // attach index select to DOM\n        self.$wrapper.append(\n            $(\"<div/>\").addClass(self.options.classIndexName).append(self.$index)\n        );\n\n        // add blink (select2)\n        self.$index.patternSelect2({\n            width: self.options.indexWidth,\n            placeholder: _t(\"Select criteria\"),\n        });\n        self.$index.on(\"change\", function (e) {\n            self.removeValue();\n            self.createOperator(e.val);\n            self.createClear();\n            self.trigger(\"index-changed\");\n        });\n\n        if (typeof index !== \"undefined\") {\n            self.$index.val(index);\n            self.createOperator(index, operator, value);\n            self.createClear();\n        }\n\n        self.trigger(\"create-criteria\");\n    },\n    appendOperators: function (index) {\n        var self = this;\n\n        self.$operator = $(\"<select/>\");\n\n        if (self.indexes[index]) {\n            _.each(self.indexes[index].operations, function (value) {\n                var options = self.indexes[index].operators[value];\n                $(\"<option/>\")\n                    .attr(\"value\", value)\n                    .html(options.title)\n                    .appendTo(self.$operator);\n            });\n        }\n\n        // attach operators select to DOM\n        self.$wrapper.append(\n            $(\"<div/>\").addClass(self.options.classOperatorName).append(self.$operator)\n        );\n\n        // add blink (select2)\n        self.$operator.patternSelect2({ width: \"10em\" });\n        self.$operator.on(\"change\", function () {\n            self.createValue(index);\n            self.createClear();\n            self.trigger(\"operator-changed\");\n        });\n    },\n    convertPathOperators: function (oval) {\n        var self = this;\n\n        if (self.advanced) {\n            return oval;\n        }\n        //This allows us to use the same query operation for multiple dropdown options.\n        oval = oval.replace(\"advanced\", \"relativePath\").replace(\"path\", \"relativePath\");\n        return oval;\n    },\n    createPathOperators: function () {\n        var self = this;\n\n        if (self.advanced) {\n            self.resetPathOperators();\n            return;\n        }\n        var newOperator = \"plone.app.querystring.operation.string.advanced\";\n\n        if (typeof self.indexes.path.operators[newOperator] === \"undefined\") {\n            self.indexes.path.operations.push(newOperator);\n            self.indexes.path.operators[newOperator] = {\n                title: \"Advanced\",\n                widget: \"AdvancedPathWidget\",\n                description: \"Enter a custom path string\",\n                operation: \"plone.app.querystring.queryparser._relativePath\",\n            };\n        }\n\n        $.each(self.indexes.path.operators, function (key, value) {\n            var options = value;\n            if (key.indexOf(\"absolute\") > 0) {\n                options.title = \"Custom\";\n            } else if (key.indexOf(\"relative\") > 0) {\n                options.title = \"Parent (../)\";\n            } else if (key.indexOf(\"advanced\") > 0) {\n                options.title = \"Advanced Mode\";\n            } else {\n                options.title = \"Current (./)\";\n                options.widget = \"RelativePathWidget\";\n            }\n        });\n    },\n    resetPathOperators: function () {\n        var self = this;\n        $.each(self.indexes.path.operators, function (key, value) {\n            var options = value;\n            if (key.indexOf(\"absolute\") > 0) {\n                options.title = \"Absolute Path\";\n            } else if (key.indexOf(\"relative\") > 0) {\n                options.title = \"Relative Path\";\n            } else if (key.indexOf(\"advanced\") > 0) {\n                options.title = \"Simple Mode\";\n            } else {\n                options.title = \"Navigation Path\";\n                options.widget = \"ReferenceWidget\";\n            }\n        });\n\n        return;\n    },\n    createOperator: function (index, operator, value) {\n        var self = this;\n\n        self.removeOperator();\n        self.createPathOperators();\n\n        // We must test if we have a \"simple\" path or an \"advanced\" one and change the widgets accordingly\n        if (\n            index === \"path\" &&\n            value &&\n            value !== \".::1\" &&\n            value !== \"..::1\" &&\n            !value.match(/^[0-9a-f\\-]{32,36}::-?[0-9]+$/)\n        ) {\n            self.advanced = true;\n            self.resetPathOperators();\n        }\n\n        self.appendOperators(index);\n\n        if (typeof operator === \"undefined\") {\n            operator = self.$operator.val();\n        }\n\n        self.$operator.val(operator);\n        self.createValue(index, value);\n\n        self.trigger(\"create-operator\");\n    },\n    createValue: function (index, value) {\n        var self = this,\n            widget = self.indexes[index].operators[self.$operator.val()].widget,\n            $wrapper = $(\"<div/>\")\n                .addClass(self.options.classValueName)\n                .appendTo(self.$wrapper);\n\n        self.removeValue();\n\n        var createDepthSelect = function (selected) {\n            // remove previous depth-select-box items\n            $wrapper.remove(\".depth-select-box\");\n            var select =\n                \"<div class='depth-select-box'>\" +\n                \"<label for='depth-select'>Depth</label>\" +\n                \"<select name='depth-select' class='\" +\n                self.options.classDepthName +\n                \"'>\" +\n                \"<option value='-1' selected='selected'>Unlimited</option>\";\n\n            for (var i = 0; i <= 10; i += 1) {\n                select += \"<option value=\" + i + \" \";\n                if (\"\" + i === selected) {\n                    select += \"selected='selected' \";\n                }\n                select += \">\" + i + \"</option>\";\n            }\n            select += \"</select>\" + \"</div>\";\n\n            return $(select).on(\"change\", function () {\n                self.trigger(\"depth-changed\");\n            });\n        };\n\n        if (widget === \"StringWidget\") {\n            self.$value = $('<input type=\"text\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"DateWidget\") {\n            self.$value = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"DateRangeWidget\") {\n            var startwrap = $(\"<span/>\").appendTo($wrapper);\n            var val1 = \"\";\n            var val2 = \"\";\n\n            if (value) {\n                val1 = value[0] ? value[0] : \"\";\n                val2 = value[1] ? value[1] : \"\";\n            }\n\n            var startdt = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .addClass(self.options.classValueName + \"-\" + widget + \"-start\")\n                .val(val1)\n                .appendTo(startwrap)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            $wrapper.append(\n                $(\"<span/>\").html(_t(\"to\")).addClass(self.options.classBetweenDtName)\n            );\n            var endwrap = $(\"<span/>\").appendTo($wrapper);\n            var enddt = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .addClass(self.options.classValueName + \"-\" + widget + \"-end\")\n                .val(val2)\n                .appendTo(endwrap)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            self.$value = [startdt, enddt];\n        } else if (widget === \"RelativeDateWidget\") {\n            self.$value = $('<input type=\"text\"/>')\n                .after($(\"<span/>\").html(_t(\"days\")))\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"AdvancedPathWidget\") {\n            if (self.advanced) {\n                self.advanced = false;\n            } else {\n                self.advanced = true;\n            }\n            self.createPathOperators();\n            self.removeOperator();\n            self.appendOperators(index);\n            self.createValue(index);\n        } else if (widget === \"RelativePathWidget\") {\n            if (self.advanced) {\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(value)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n            } else {\n                console.log(value);\n                var pathAndDepth = [\".\", \"1\"];\n                if (typeof value !== \"undefined\") {\n                    pathAndDepth = value.split(\"::\");\n                    if (pathAndDepth[0] === \".\") {\n                        self.$operator.val(\n                            \"plone.app.querystring.operation.string.path\"\n                        );\n                    } else {\n                        self.$operator.val(\n                            \"plone.app.querystring.operation.string.relativePath\"\n                        );\n                    }\n                } else if (\n                    self.$operator.val() ===\n                    \"plone.app.querystring.operation.string.relativePath\"\n                ) {\n                    pathAndDepth = [\"..\", \"1\"];\n                }\n\n                self.$value = $('<input type=\"hidden\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(pathAndDepth[0]);\n                self.$value.after(createDepthSelect(pathAndDepth[1]));\n            }\n        } else if (widget === \"ReferenceWidget\") {\n            if (self.advanced) {\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .val(value)\n                    .appendTo($wrapper)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n            } else {\n                pathAndDepth = [\"\", \"-1\"];\n                if (typeof value !== \"undefined\") {\n                    pathAndDepth = value.split(\"::\");\n                }\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(pathAndDepth[0])\n                    .patternRelateditems(self.patternRelateditemsOptions)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n                $wrapper.addClass(\"break-line\");\n                self.$value.after(createDepthSelect(pathAndDepth[1]));\n            }\n        } else if (widget === \"MultipleSelectionWidget\") {\n            self.$value = $(\"<select/>\")\n                .prop(\"multiple\", true)\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            if (self.indexes[index]) {\n                $.each(self.indexes[index].values, function (value, options) {\n                    $(\"<option/>\")\n                        .attr(\"value\", value)\n                        .html(options.title)\n                        .appendTo(self.$value);\n                });\n            }\n            self.$value.patternSelect2(self.patternAjaxSelectOptions);\n        }\n\n        if (typeof value !== \"undefined\" && typeof self.$value !== \"undefined\") {\n            if (Array.isArray(self.$value)) {\n                $.each(value, function (i, v) {\n                    self.$value[i].val(v);\n                });\n            } else {\n                var trimmedValue = value;\n                if (typeof value === \"string\" && widget !== \"RelativePathWidget\") {\n                    trimmedValue = value.replace(/::-?[0-9]+/, \"\");\n                }\n                self.$value.val(trimmedValue);\n            }\n        }\n\n        self.trigger(\"create-value\");\n    },\n    createClear: function () {\n        var self = this;\n        self.removeClear();\n        self.$clear = $(\"<div/>\")\n            .addClass(self.options.classClearName)\n            .appendTo(self.$wrapper);\n    },\n    remove: function () {\n        var self = this;\n        self.trigger(\"remove\");\n        self.$remove.remove();\n        self.$index.parent().remove();\n        self.removeOperator();\n        self.removeValue();\n        self.removeClear();\n        self.$wrapper.remove();\n    },\n    removeClear: function () {\n        var self = this;\n        self.trigger(\"remove-clear\");\n        if (self.$clear) {\n            self.$clear.remove();\n        }\n    },\n    removeOperator: function () {\n        var self = this;\n        self.trigger(\"remove-operator\");\n        if (self.$operator) {\n            self.$operator.parent().remove();\n        }\n    },\n    removeValue: function () {\n        var self = this;\n        self.trigger(\"remove-value\");\n        if (self.$value) {\n            if (Array.isArray(self.$value)) {\n                // date ranges have 2 values\n                self.$value[0].parents(\".querystring-criteria-value\").remove();\n            } else {\n                self.$value.parents(\".querystring-criteria-value\").remove();\n            }\n        }\n    },\n    // builds the parameters to go into the http querystring for requesting\n    // results from the query builder\n    buildQueryPart: function () {\n        var self = this;\n\n        // index\n        var ival = self.$index.val();\n        if (ival === \"\") {\n            // no index selected, no query\n            return \"\";\n        }\n        var istr = \"query.i:records=\" + ival;\n\n        // operator\n        if (typeof self.$operator === \"undefined\") {\n            // no operator, no query\n            return \"\";\n        }\n        var oval = self.$operator.val();\n\n        if (ival === \"path\") {\n            if (oval.indexOf(\"advanced\") > 0) {\n                return \"\";\n            }\n            oval = self.convertPathOperators(oval);\n        }\n\n        var ostr = \"query.o:records=\" + oval;\n\n        // value(s)\n        var vstrbase = \"query.v:records=\",\n            vstrlistbase = \"query.v:records:list=\",\n            vstr = [];\n        if (typeof self.$value === \"undefined\") {\n            vstr.push(vstrbase);\n        } else if (Array.isArray(self.$value)) {\n            // handles only datepickers from the 'between' operator right now\n            $.each(self.$value, function () {\n                vstr.push(vstrlistbase + $(this).val());\n            });\n        } else if (Array.isArray(self.$value.val())) {\n            // handles multible values\n            $.each(self.$value.val(), function (i, v) {\n                vstr.push(vstrlistbase + v);\n            });\n        } else {\n            var str = vstrbase + self.$value.val();\n            if (ival === \"path\" && self.$value.val() !== \"\") {\n                str += self.getDepthString();\n            } else if (typeof self.initial !== \"undefined\") {\n                str = vstrbase + self.initial;\n                //Sometimes the RelatedItemsWidget won't be loaded by this point.\n                //This only should happen on the initial page load.\n                delete self.initial;\n            }\n            vstr.push(str);\n        }\n\n        return istr + \"&\" + ostr + \"&\" + vstr.join(\"&\");\n    },\n    getJSONListStr: function () {\n        var self = this;\n\n        // index\n        var ival = self.$index.val();\n        if (ival === \"\") {\n            // no index selected, no query\n            return \"\";\n        }\n\n        // operator\n        if (typeof self.$operator === \"undefined\") {\n            // no operator, no query\n            return \"\";\n        }\n        var oval = self.$operator.val();\n\n        if (ival === \"path\") {\n            if (oval.indexOf(\"advanced\") > 0) {\n                //The advanced function is just a placeholder,\n                //We don't want to send an actual query\n                return \"\";\n            }\n            oval = self.convertPathOperators(oval);\n        }\n        // value(s)\n        var varr = [];\n        if (Array.isArray(self.$value)) {\n            // handles only datepickers from the 'between' operator right now\n            $.each(self.$value, function () {\n                varr.push($(this).val());\n            });\n        } else if (typeof self.$value !== \"undefined\") {\n            var value = self.$value.val();\n            if (ival === \"path\" && value) {\n                var depth = self.getDepthString();\n                if (depth) {\n                    value += depth;\n                }\n            }\n            varr.push(value);\n        }\n        var vval;\n        if (varr.length > 1) {\n            vval = '[\"' + varr.join('\",\"') + '\"]';\n        } else if (varr.length === 1) {\n            vval = JSON.stringify(varr[0]);\n        } else {\n            vval = '\"\"';\n        }\n\n        if (typeof self.indexes[ival].operators[oval] === \"undefined\") {\n            return;\n        }\n\n        return '{\"i\":\"' + ival + '\", \"o\":\"' + oval + '\", \"v\":' + vval + \"}\";\n    },\n    getDepthString: function () {\n        var self = this,\n            out = \"\",\n            depth = $(\".\" + self.options.classDepthName).val();\n\n        if (depth !== \"\" && typeof depth !== \"undefined\") {\n            out += \"::\" + depth;\n        }\n        return out;\n    },\n    trigger: function (name) {\n        this.$wrapper.trigger(name + \"-criteria.querystring.patterns\", [this]);\n    },\n    on: function (name, callback) {\n        this.$wrapper.on(name + \"-criteria.querystring.patterns\", callback);\n    },\n};\n\nexport default Base.extend({\n    name: \"querystring\",\n    trigger: \".pat-querystring\",\n    parser: \"mockup\",\n    defaults: {\n        indexes: [],\n        classWrapperName: \"querystring-wrapper\",\n        criteria: {},\n        indexOptionsUrl: null,\n        previewURL: \"portal_factory/@@querybuilder_html_results\", // base url to use to request preview information from\n        previewCountURL: \"portal_factory/@@querybuildernumberofresults\",\n        patternDateOptions: {},\n        patternAjaxSelectOptions: {},\n        patternRelateditemsOptions: {},\n        classSortLabelName: \"querystring-sort-label\",\n        classSortReverseName: \"querystring-sortreverse\",\n        classSortReverseLabelName: \"querystring-sortreverse-label\",\n        classPreviewCountWrapperName: \"querystring-previewcount-wrapper\",\n        classPreviewResultsWrapperName: \"querystring-previewresults-wrapper\",\n        classPreviewWrapperName: \"querystring-preview-wrapper\",\n        classPreviewName: \"querystring-preview\",\n        classPreviewTitleName: \"querystring-preview-title\",\n        classPreviewDescriptionName: \"querystring-preview-description\",\n        classSortWrapperName: \"querystring-sort-wrapper\",\n        showPreviews: true,\n    },\n    init: async function () {\n        await import(\"../select2/select2\");\n        await import(\"../relateditems/relateditems\");\n\n        import(\"./querystring.scss\");\n\n        var self = this;\n\n        // hide input element\n        self.$el.hide();\n\n        // create wrapper for out criteria\n        self.$wrapper = $(\"<div/>\");\n        self.$el.after(self.$wrapper);\n\n        // initialization can be detailed if by ajax\n        self.initialized = false;\n\n        // get remove icon for criterias\n        self.options.criteria.remove = await utils.resolveIcon(\"x-circle\");\n\n        if (self.options.indexOptionsUrl) {\n            try {\n                const response = await fetch(self.options.indexOptionsUrl);\n                const data = await response.json();\n                self.options.indexes = data.indexes;\n                self.options[\"sortable_indexes\"] = data[\"sortable_indexes\"];\n                self._init();\n            } catch (e) {\n                // XXX handle this...\n            }\n        }\n    },\n    _init: function () {\n        var self = this;\n        self.$criteriaWrapper = $(\"<div/>\")\n            .addClass(self.options.classWrapperName)\n            .appendTo(self.$wrapper);\n\n        self.$sortWrapper = $(\"<div/>\")\n            .addClass(self.options.classSortWrapperName)\n            .appendTo(self.$wrapper);\n\n        if (self.options.showPreviews === \"false\") {\n            self.options.showPreviews = false;\n        }\n        if (self.options.showPreviews) {\n            self.$previewWrapper = $(\"<div/>\")\n                .addClass(self.options.classPreviewWrapperName)\n                .appendTo(self.$wrapper);\n\n            // preview title and description\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewTitleName)\n                .html(_t(\"Preview\"))\n                .appendTo(self.$previewWrapper);\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewDescriptionName)\n                .html(_t(\"Preview of at most 10 items\"))\n                .appendTo(self.$previewWrapper);\n        }\n\n        self.criterias = [];\n\n        // create populated criterias\n        if (self.$el.val()) {\n            $.each(JSON.parse(self.$el.val()), function (i, item) {\n                self.createCriteria(item.i, item.o, item.v);\n            });\n        }\n\n        // add empty criteria which enables users to create new cr\n        self.createCriteria();\n\n        // add sort/order fields\n        self.createSort();\n\n        // add criteria preview pane to see results from criteria query\n        if (self.options.showPreviews) {\n            self.refreshPreviewEvent();\n        }\n        self.$el.trigger(\"initialized\");\n        self.initialized = true;\n    },\n    createCriteria: function (index, operator, value) {\n        var self = this,\n            baseUrl = self.options.indexOptionsUrl.replace(/(@@.*)/g, \"\"),\n            criteria = new Criteria(\n                self.$criteriaWrapper,\n                self,\n                self.options.criteria,\n                self.options.indexes,\n                index,\n                operator,\n                value,\n                baseUrl,\n                self.options.patternDateOptions,\n                self.options.patternAjaxSelectOptions,\n                self.options.patternRelateditemsOptions\n            );\n\n        criteria.on(\"remove\", function () {\n            if (self.criterias[self.criterias.length - 1] === criteria) {\n                self.createCriteria();\n            }\n        });\n\n        criteria.on(\"index-changed\", function () {\n            if (self.criterias[self.criterias.length - 1] === criteria) {\n                self.createCriteria();\n            }\n        });\n\n        //This prevents multiple requests from going off after making a single change\n        var _doupdates = function () {\n            self.refreshPreviewEvent();\n            self.updateValue();\n        };\n        var _updateTimeout = -1;\n        var doupdates = function () {\n            clearTimeout(_updateTimeout);\n            _updateTimeout = setTimeout(_doupdates, 100);\n        };\n\n        criteria.on(\"remove\", function (e, criteria) {\n            if (self.criterias.indexOf(criteria) !== -1) {\n                self.criterias.splice(self.criterias.indexOf(criteria), 1);\n            }\n            doupdates(e, criteria);\n        });\n        criteria.on(\"remove-clear\", doupdates);\n        criteria.on(\"remove-operator\", doupdates);\n        criteria.on(\"remove-value\", doupdates);\n        criteria.on(\"index-changed\", doupdates);\n        criteria.on(\"operator-changed\", doupdates);\n        criteria.on(\"create-criteria\", doupdates);\n        criteria.on(\"create-operator\", doupdates);\n        criteria.on(\"create-value\", doupdates);\n        criteria.on(\"value-changed\", doupdates);\n        criteria.on(\"depth-changed\", doupdates);\n\n        self.criterias.push(criteria);\n    },\n    createSort: function () {\n        var self = this;\n\n        // elements that may exist already on the page\n        // XXX do this in a way so it'll work with other forms will work\n        // as long as they provide sort_on and sort_reversed fields in z3c form\n        var existingSortOn = $('[id$=\"-sort_on\"]').filter('[id^=\"formfield-\"]');\n        var existingSortOrder = $('[id*=\"-sort_reversed\"]').filter('[id^=\"formfield-\"]');\n\n        $(\"<span/>\")\n            .addClass(self.options.classSortLabelName)\n            .html(_t(\"Sort on\"))\n            .appendTo(self.$sortWrapper);\n        self.$sortOn = $(\"<select/>\")\n            .attr(\"name\", \"sort_on\")\n            .appendTo(self.$sortWrapper)\n            .on(\"change\", function () {\n                self.refreshPreviewEvent.call(self);\n                $('[id$=\"sort_on\"]', existingSortOn).val($(this).val());\n            });\n\n        self.$sortOn.append($('<option value=\"\">' + _t(\"No sorting\") + \"</option>\")); // default no sorting\n        for (var key in self.options[\"sortable_indexes\"]) {\n            self.$sortOn.append(\n                $(\"<option/>\").attr(\"value\", key).html(self.options.indexes[key].title)\n            );\n        }\n        self.$sortOn.patternSelect2({ width: \"150px\" });\n\n        self.$sortOrder = $('<input type=\"checkbox\" />')\n            .attr(\"name\", \"sort_reversed:boolean\")\n            .on(\"change\", function () {\n                self.refreshPreviewEvent.call(self);\n                if ($(this).prop(\"checked\")) {\n                    $('input[type=\"checkbox\"]', existingSortOrder).prop(\"checked\", true);\n                } else {\n                    $('input[type=\"checkbox\"]', existingSortOrder).prop(\n                        \"checked\",\n                        false\n                    );\n                }\n            });\n\n        $(\"<span/>\")\n            .addClass(self.options.classSortReverseName)\n            .appendTo(self.$sortWrapper)\n            .append(self.$sortOrder)\n            .append(\n                $(\"<span/>\")\n                    .html(_t(\"Reversed Order\"))\n                    .addClass(self.options.classSortReverseLabelName)\n            );\n\n        // if the form already contains the sort fields, hide them! Their values\n        // will be synced back and forth between the querystring's form elements\n        if (existingSortOn.length >= 1 && existingSortOrder.length >= 1) {\n            var reversed = $('input[type=\"checkbox\"]', existingSortOrder).prop(\n                \"checked\"\n            );\n            var sortOn = $('[id$=\"-sort_on\"]', existingSortOn).val();\n            if (reversed) {\n                self.$sortOrder.prop(\"checked\", true);\n            }\n            self.$sortOn.val(sortOn);\n            $(existingSortOn).hide();\n            $(existingSortOrder).hide();\n        }\n    },\n    refreshPreviewEvent: function () {\n        var self = this;\n\n        if (!self.options.showPreviews) {\n            return; // cut out of this if there are no previews available\n        }\n\n        if (typeof self._previewXhr !== \"undefined\") {\n            self._previewXhr.abort();\n        }\n\n        if (typeof self.$previewPane !== \"undefined\") {\n            self.$previewPane.remove();\n        }\n\n        var query = [];\n        $.each(self.criterias, function (i, criteria) {\n            var querypart = criteria.buildQueryPart();\n            if (querypart !== \"\") {\n                query.push(querypart);\n            }\n        });\n\n        self.$previewPane = $(\"<div/>\")\n            .addClass(self.options.classPreviewName)\n            .appendTo(self.$previewWrapper);\n\n        if (query.length <= 0) {\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewCountWrapperName)\n                .html(\"No results to preview\")\n                .prependTo(self.$previewPane);\n            return; // no query means nothing to send out requests for\n        }\n\n        query.push(\"sort_on=\" + self.$sortOn.val());\n        if (self.$sortOrder.prop(\"checked\")) {\n            query.push(\"sort_order=reverse\");\n        }\n\n        self._previewXhr = $.get(self.options.previewURL + \"?\" + query.join(\"&\")).done(\n            function (data) {\n                $(\"<div/>\")\n                    .addClass(self.options.classPreviewResultsWrapperName)\n                    .html(data)\n                    .appendTo(self.$previewPane);\n            }\n        );\n    },\n    updateValue: function () {\n        // updating the original input with json data in the form:\n        // [\n        //    {i:'index', o:'operator', v:'value'}\n        // ]\n\n        var self = this;\n\n        var criteriastrs = [];\n        $.each(self.criterias, function (i, criteria) {\n            var jsonstr = criteria.getJSONListStr();\n            if (jsonstr !== \"\") {\n                criteriastrs.push(jsonstr);\n            }\n        });\n        var val = \"[\" + criteriastrs.join(\",\") + \"]\";\n        self.$el.val(val);\n        self.$el.trigger(\"change\");\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport Select2 from \"../select2/select2\";\n\nconst KEY = {\n    LEFT: 37,\n    RIGHT: 39,\n};\n\nexport default Base.extend({\n    name: \"relateditems\",\n    trigger: \".pat-relateditems\",\n    parser: \"mockup\",\n    currentPath: undefined,\n    selectedUIDs: [],\n    openAfterInit: undefined,\n    defaults: {\n        // main option\n        vocabularyUrl: null, // must be set to work\n\n        // more options\n        attributes: [\n            \"UID\",\n            \"Title\",\n            \"portal_type\",\n            \"path\",\n            \"getURL\",\n            \"getIcon\",\n            \"is_folderish\",\n            \"review_state\",\n        ], // used by utils.QueryHelper\n        basePath: \"\",\n        pageSize: 10,\n        browsing: undefined,\n        closeOnSelect: true,\n        contextPath: undefined,\n        dropdownCssClass: \"pat-relateditems-dropdown\",\n        favorites: [],\n        recentlyUsed: false,\n        recentlyUsedMaxItems: 20,\n        recentlyUsedKey: \"relateditems_recentlyused\",\n        maximumSelectionSize: -1,\n        minimumInputLength: 0,\n        mode: \"browse\", // possible values are 'auto', 'search' and 'browse'.\n        orderable: true, // mockup-patterns-select2\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        rootPath: \"/\",\n        rootUrl: \"\", // default to be relative.\n        scanSelection: false, // False, to no unnecessarily use CPU time on this.\n        selectableTypes: null, // null means everything is selectable, otherwise a list of strings to match types that are selectable\n        separator: \",\",\n        sortOn: null,\n        sortOrder: \"ascending\",\n        tokenSeparators: [\",\", \" \"],\n        upload: false,\n        uploadAllowView: undefined,\n\n        // templates\n        breadcrumbTemplateSelector: null,\n        favoriteTemplateSelector: null,\n        recentlyusedTemplateSelector: null,\n        resultTemplateSelector: null,\n        selectionTemplateSelector: null,\n        toolbarTemplateSelector: null,\n\n        // needed\n        multiple: true,\n\n        // ajax settings\n        ajaxTimeout: 500,\n    },\n\n    recentlyUsed(filterSelectable) {\n        let ret = utils.storage.get(this.options.recentlyUsedKey) || [];\n        // hard-limit to 1000 entries\n        ret = ret.slice(ret.length - 1000, ret.length);\n        if (filterSelectable) {\n            // Filter out only selectable items.\n            // This is used only to create the list of items to be displayed.\n            // the list to be stored is unfiltered and can be reused among\n            // different instances of this widget with different settings.\n            ret.filter(this.isSelectable.bind(this));\n        }\n        // max is applied AFTER filtering selectable items.\n        const max = parseInt(this.options.recentlyUsedMaxItems, 10);\n        if (max) {\n            // return the slice from the end, as we want to display newest items first.\n            ret = ret.slice(ret.length - max, ret.length);\n        }\n        return ret;\n    },\n\n    applyTemplate(tpl, item) {\n        let template;\n        if (this.options[tpl + \"TemplateSelector\"]) {\n            template = $(this.options[tpl + \"TemplateSelector\"]).html();\n        }\n        if (!template) {\n            if (this.options[tpl + \"Template\"]) {\n                template = this.options[tpl + \"Template\"];\n            } else {\n                template = this[tpl + \"Template\"];\n            }\n        }\n        // let's give all the options possible to the template generation\n        const options = $.extend(true, {}, this.options, item, {\n            browsing: this.browsing,\n            open_folder: _t(\"Open folder\"),\n            current_directory: _t(\"current directory:\"),\n            one_level_up: _t(\"Go one level up\"),\n        });\n        options._item = item;\n        return _.template(template)(options);\n    },\n\n    setAjax() {\n        const ajaxTimeout = parseInt(this.options.ajaxTimeout || 500, 10);\n\n        const ajax = {\n            url: this.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: ajaxTimeout,\n\n            data: (term, page) => {\n                const criterias = [];\n                if (term) {\n                    term = \"*\" + term + \"*\";\n                    criterias.push({\n                        i: \"SearchableText\",\n                        o: \"plone.app.querystring.operation.string.contains\",\n                        v: term,\n                    });\n                }\n\n                // We don't restrict for selectable types while browsing...\n                if (!this.browsing && this.options.selectableTypes) {\n                    criterias.push({\n                        i: \"portal_type\",\n                        o: \"plone.app.querystring.operation.selection.any\",\n                        v: this.options.selectableTypes,\n                    });\n                }\n\n                criterias.push({\n                    i: \"path\",\n                    o: this.options.pathOperator,\n                    v:\n                        this.options.rootPath +\n                        this.currentPath +\n                        (this.browsing ? \"::1\" : \"\"),\n                });\n\n                let sort_on = this.options.sortOn;\n                let sort_order = sort_on ? this.options.sortOrder : null;\n                if (this.browsing && sort_on === null) {\n                    sort_on = \"getObjPositionInParent\";\n                    sort_order = \"ascending\";\n                }\n\n                const data = {\n                    query: JSON.stringify({\n                        criteria: criterias,\n                        sort_on: sort_on,\n                        sort_order: sort_order,\n                    }),\n                    attributes: JSON.stringify(this.options.attributes),\n                    batch: JSON.stringify({\n                        page: page ? page : 1,\n                        size: this.options.pageSize,\n                    }),\n                };\n                return data;\n            },\n\n            results: (data, page) => {\n                const more = page * this.options.pageSize < data.total;\n                let results = data.results;\n\n                this.selectedUIDs = (this.$el.select2(\"data\") || []).map((el) => {\n                    // populate current selection. Reuse in formatResult\n                    return el.UID;\n                });\n\n                // Filter out items:\n                // While browsing: always include folderish items\n                // Browsing and searching: Only include selectable items which are not already selected, and all folders\n                // even if they're selected, as we need them available for browsing/selecting their children\n                results = results.filter((item) => {\n                    if (\n                        (this.browsing && item.is_folderish) ||\n                        (this.isSelectable(item) &&\n                            this.selectedUIDs.indexOf(item.UID) === -1)\n                    ) {\n                        return true;\n                    }\n                    return false;\n                });\n\n                // Extend ``data`` with a ``oneLevelUp`` item when browsing\n                const path = this.currentPath.split(\"/\");\n                if (\n                    page === 1 && // Show level up only on top.\n                    this.browsing && // only level up when browsing\n                    path.length > 1 && // do not try to level up one level under root.\n                    this.currentPath !== \"/\" // do not try to level up beyond root\n                ) {\n                    results = [\n                        {\n                            oneLevelUp: true,\n                            Title: _t(\"One level up\"),\n                            path: path.slice(0, path.length - 1).join(\"/\") || \"/\",\n                            currentPath: this.currentPath,\n                            is_folderish: true,\n                            selectable: false,\n                        },\n                    ].concat(results);\n                }\n                return {\n                    results: results,\n                    more: more,\n                };\n            },\n        };\n        this.options.ajax = ajax;\n    },\n\n    async renderToolbar() {\n        const path = this.currentPath;\n        let html;\n\n        const parts = path.split(\"/\");\n        let itemPath = \"\";\n        let itemsHtml = \"\";\n        for (const part of parts) {\n            if (part !== \"\") {\n                const item = {};\n                item.path = itemPath = `${itemPath}/${part}`;\n                item.text = part;\n                itemsHtml = itemsHtml + this.applyTemplate(\"breadcrumb\", item);\n            }\n        }\n\n        // favorites\n        let favoritesHtml = \"\";\n        for (const item of this.options.favorites) {\n            const item_copy = _.clone(item);\n            item_copy.path = item_copy.path.substr(this.options.rootPath.length) || \"/\";\n            favoritesHtml = favoritesHtml + this.applyTemplate(\"favorite\", item_copy);\n        }\n\n        let recentlyUsedHtml = \"\";\n        if (this.options.recentlyUsed) {\n            const recentlyUsed = this.recentlyUsed(true); // filter out only those items which can actually be selected\n            for (const item of recentlyUsed.reverse()) {\n                // reverse to get newest first.\n                recentlyUsedHtml =\n                    recentlyUsedHtml + this.applyTemplate(\"recentlyused\", item);\n            }\n        }\n\n        html = this.applyTemplate(\"toolbar\", {\n            items: itemsHtml,\n            favItems: favoritesHtml,\n            favText: _t(\"Favorites\"),\n            searchText: _t(\"Current path:\"),\n            searchModeText: _t(\"Search\"),\n            browseModeText: _t(\"Browse\"),\n            recentlyUsedItems: recentlyUsedHtml,\n            recentlyUsedText: _t(\"Recently Used\"),\n            icon_root: await utils.resolveIcon(\"house-fill\"),\n            icon_recently_used: await utils.resolveIcon(\"grid-fill\"),\n            icon_favorites: await utils.resolveIcon(\"star-fill\"),\n            icon_upload: await utils.resolveIcon(\"cloud-arrow-up\"),\n            upload: this.options.upload,\n            upload_text: _t(\"Upload\"),\n        });\n\n        this.$toolbar.html(html);\n\n        // unbind mouseup event from select2 to override the behavior:\n        $(\".pat-relateditems-dropdown\").off(\"mouseup\");\n        $(\".pat-relateditems-dropdown\").on(\"mouseup\", (e) => {\n            e.stopPropagation();\n        });\n\n        $(\"button.mode.search\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                this.browsing = false;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"button.mode.browse\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (!this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                this.browsing = true;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"a.crumb\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        $(\"a.fav\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        if (this.options.recentlyUsed) {\n            $(\".pat-relateditems-recentlyused-select\", this.$toolbar).on(\n                \"click\",\n                (event) => {\n                    event.preventDefault();\n                    const uid = $(event.currentTarget).data(\"uid\");\n                    let item = this.recentlyUsed().filter((it) => {\n                        return it.UID === uid;\n                    });\n                    if (item.length > 0) {\n                        item = item[0];\n                    } else {\n                        return;\n                    }\n                    this.selectItem(item);\n                    if (this.options.maximumSelectionSize > 0) {\n                        const items = this.$el.select2(\"data\");\n                        if (items.length >= this.options.maximumSelectionSize) {\n                            return;\n                        }\n                    }\n                }\n            );\n        }\n\n        // upload\n        if (\n            this.options.upload &&\n            utils.featureSupport.dragAndDrop() &&\n            utils.featureSupport.fileApi()\n        ) {\n            if (this.options.uploadAllowView) {\n                // Check, if uploads are allowed in current context\n                $.ajax({\n                    url: this.options.uploadAllowView,\n                    // url: this.currentUrl() + this.options.uploadAllowView,  // not working yet\n                    dataType: \"JSON\",\n                    data: {\n                        path: this.options.rootPath + this.currentPath,\n                    },\n                    type: \"GET\",\n                    success: (result) => {\n                        this.initUploadView(!result.allowUpload);\n                    },\n                });\n            } else {\n                // just initialize upload view without checking, if uploads are allowed.\n                this.initUploadView();\n            }\n        }\n    },\n\n    async initUploadView(disabled) {\n        let Upload = await import(\"../upload/upload\");\n        Upload = Upload.default;\n\n        const upload_button = this.$toolbar[0].querySelector(\".upload button\");\n        upload_button.disabled = disabled;\n\n        const upload_el = this.$toolbar[0].querySelector(\".upload .pat-upload\");\n\n        const upload_config = {\n            success: (e, response) => {\n                const uid = response.UID;\n                if (uid) {\n                    const query = new utils.QueryHelper({\n                        vocabularyUrl: this.options.vocabularyUrl,\n                        attributes: this.options.attributes,\n                    });\n                    query.search(\n                        \"UID\",\n                        \"plone.app.querystring.operation.selection.is\",\n                        uid,\n                        (e) => {\n                            const data = this.$el.select2(\"data\");\n                            data.push.apply(data, e.results);\n                            this.$el.select2(\"data\", data, true);\n                            this.emit(\"selected\");\n                            this.popover.hide();\n                        },\n                        false\n                    );\n                }\n            },\n            uloadMultiple: true,\n            allowPathSelection: false,\n            relativePath: \"fileUpload\",\n            baseUrl: this.options.rootUrl,\n        };\n        const upload = new Upload($(upload_el), upload_config);\n\n        upload_button.addEventListener(\"show.bs.dropdown\", () => {\n            if (this.currentPath !== upload.currentPath) {\n                upload.setPath(this.currentPath);\n            }\n        });\n    },\n\n    browseTo(path) {\n        this.emit(\"before-browse\");\n        this.currentPath = path;\n        this.$el.select2(\"close\");\n        this.renderToolbar();\n        this.$el.select2(\"open\");\n        this.emit(\"after-browse\");\n    },\n\n    selectItem(item) {\n        this.emit(\"selecting\");\n        const data = $(this.el).select2(\"data\");\n        data.push(item);\n        $(this.el).select2(\"data\", data, true);\n\n        if (this.options.recentlyUsed) {\n            // add to recently added items\n            const recentlyUsed = this.recentlyUsed(); // do not filter for selectable but get all. append to that list the new item.\n            const alreadyPresent = recentlyUsed.filter((it) => {\n                return it.UID === item.UID;\n            });\n            if (alreadyPresent.length > 0) {\n                recentlyUsed.splice(recentlyUsed.indexOf(alreadyPresent[0]), 1);\n            }\n            recentlyUsed.push(item);\n            utils.storage.set(this.options.recentlyUsedKey, recentlyUsed);\n        }\n\n        this.emit(\"selected\");\n    },\n\n    deselectItem(item) {\n        this.emit(\"deselecting\");\n        const data = this.$el.select2(\"data\");\n        data.forEach((obj, i) => {\n            if (obj.UID === item.UID) {\n                data.splice(i, 1);\n            }\n        });\n        this.$el.select2(\"data\", data, true);\n        this.emit(\"deselected\");\n    },\n\n    isSelectable(item) {\n        if (item.selectable === false) {\n            return false;\n        }\n        if (this.options.selectableTypes === null) {\n            return true;\n        } else {\n            return this.options.selectableTypes.indexOf(item.portal_type) !== -1;\n        }\n    },\n\n    async init() {\n        (await import(\"bootstrap\")).Dropdown;\n        import(\"./relateditems.scss\");\n\n        // templates\n        this.breadcrumbTemplate = (await import(\"./templates/breadcrumb.xml\")).default; // prettier-ignore\n        this.favoriteTemplate = (await import(\"./templates/favorite.xml\")).default; // prettier-ignore\n        this.recentlyusedTemplate = (await import(\"./templates/recentlyused.xml\")).default; // prettier-ignore\n        this.resultTemplate = (await import(\"./templates/result.xml\")).default; // prettier-ignore\n        this.selectionTemplate = (await import(\"./templates/selection.xml\")).default; // prettier-ignore\n        this.toolbarTemplate = (await import(\"./templates/toolbar.xml\")).default; // prettier-ignore\n\n        this.browsing = this.options.mode !== \"search\";\n\n        // Remove trailing slash\n        this.options.rootPath = this.options.rootPath.replace(/\\/$/, \"\");\n        // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'\n        this.currentPath =\n            this.options.basePath.substr(this.options.rootPath.length) || \"/\";\n\n        this.setAjax();\n\n        this.$el.wrap('<div class=\"pat-relateditems-container\" />');\n        this.$container = this.$el.parents(\".pat-relateditems-container\");\n\n        Select2.prototype.initializeValues.call(this);\n        Select2.prototype.initializeTags.call(this);\n\n        this.options.formatSelection = (item) => {\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                },\n                item\n            );\n\n            // activate petterns on the result set.\n            const $selection = $(this.applyTemplate(\"selection\", item));\n            if (this.options.scanSelection) {\n                registry.scan($selection);\n            }\n            if (this.options.maximumSelectionSize == 1) {\n                // If this related field accepts only 1 item, the breadcrumbs should\n                // reflect the location for this particular item\n                let itemPath = item.path;\n                let path_split = itemPath.split(\"/\");\n                path_split = path_split.slice(0, -1); // Remove last part of path, we always want the parent path\n                itemPath = path_split.join(\"/\");\n                this.currentPath = itemPath;\n                this.renderToolbar();\n            }\n            return $selection;\n        };\n\n        const icon_level_up = await utils.resolveIcon(\"arrow-left-circle\");\n        const icon_level_down = await utils.resolveIcon(\"arrow-right-circle\");\n\n        this.options.formatResult = (item) => {\n            item.selectable = this.isSelectable(item);\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    is_folderish: false,\n                    oneLevelUp: false,\n                    iconLevelUp: icon_level_up,\n                    iconLevelDown: icon_level_down,\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                    selectable: false,\n                },\n                item\n            );\n\n            if (this.selectedUIDs.indexOf(item.UID) !== -1) {\n                // do not allow already selected items to be selected again.\n                item.selectable = false;\n            }\n            const result = $(this.applyTemplate(\"result\", item));\n\n            $(\".pat-relateditems-result-select\", result).on(\"click\", (event) => {\n                const _el = event.currentTarget;\n                event.preventDefault();\n                // event.stopPropagation();\n                if ($(_el).is(\".selectable\")) {\n                    const $parent = $(_el).parents(\".pat-relateditems-result\");\n                    if ($parent.is(\".pat-relateditems-active\")) {\n                        $parent.removeClass(\"pat-relateditems-active\");\n                        this.deselectItem(item);\n                    } else {\n                        if (this.options.maximumSelectionSize > 0) {\n                            const items = this.$el.select2(\"data\");\n                            if (items.length >= this.options.maximumSelectionSize) {\n                                this.$el.select2(\"close\");\n                            }\n                        }\n                        this.selectItem(item);\n                        $parent.addClass(\"pat-relateditems-active\");\n                        if (this.options.closeOnSelect) {\n                            this.$el.select2(\"close\");\n                        }\n                    }\n                }\n            });\n\n            $(\".pat-relateditems-result-browse\", result).on(\"click\", (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                const path = $(event.currentTarget).data(\"path\");\n                this.browseTo(path);\n            });\n\n            return $(result);\n        };\n\n        this.options.initSelection = (element, callback) => {\n            const value = $(element).val();\n            if (value !== \"\") {\n                const ids = value.split(this.options.separator);\n                const query = new utils.QueryHelper(\n                    $.extend(true, {}, this.options, {\n                        pattern: this,\n                    })\n                );\n                query.search(\n                    \"UID\",\n                    \"plone.app.querystring.operation.list.contains\",\n                    ids,\n                    (data) => {\n                        const results = data.results.reduce((prev, item) => {\n                            prev[item.UID] = item;\n                            return prev;\n                        }, {});\n\n                        try {\n                            callback(\n                                ids\n                                    .map((uid) => results[uid])\n                                    .filter((item) => item !== undefined)\n                            );\n                        } catch (e) {\n                            // Select2 3.5.4 throws an error in some cases in\n                            // updateSelection, ``this.selection.find(\".select2-search-choice\").remove();``\n                            // No idea why, hard to track.\n                        }\n\n                        if (this.openAfterInit) {\n                            // open after initialization\n                            this.$el.select2(\"open\");\n                            this.openAfterInit = undefined;\n                        }\n                    },\n                    false\n                );\n            }\n        };\n\n        this.options.tokenizer = (input) => {\n            if (this.options.mode === \"auto\") {\n                this.browsing = input ? false : true;\n            }\n        };\n\n        this.options.id = (item) => item.UID;\n\n        await Select2.prototype.initializeSelect2.call(this);\n        await Select2.prototype.initializeOrdering.call(this);\n\n        this.$toolbar = $('<div class=\"toolbar d-flex\" />');\n        this.$container.prepend(this.$toolbar);\n        this.$el.on(\"select2-selecting\", (event) => {\n            if (!this.isSelectable(event.choice)) {\n                event.preventDefault();\n            }\n        });\n        this.renderToolbar();\n        this.$el.on(\"select2-loaded\", () => {\n            let yMax = window.innerHeight || document.documentElement.clientHeight;\n            const element = $(\n                \".pat-relateditems-dropdown.select2-drop-active .select2-results\"\n            )[0];\n            const rect = element.getBoundingClientRect();\n            const maxHeight = yMax - rect.top - 18;\n            $(element).css(\"max-height\", `${maxHeight}px`);\n        });\n\n        $(document).on(\"keyup\", this.$el, (event) => {\n            const isOpen = Select2.prototype.opened.call(this);\n            if (!isOpen) {\n                return;\n            }\n\n            if (event.which === KEY.LEFT || event.which === KEY.RIGHT) {\n                event.stopPropagation();\n\n                const selectorContext =\n                    event.which === KEY.LEFT\n                        ? \".pat-relateditems-result.one-level-up\"\n                        : \".select2-highlighted\";\n\n                const browsableItemSelector = \".pat-relateditems-result-browse\";\n                const browsableItem = $(browsableItemSelector, selectorContext);\n\n                if (browsableItem.length !== 1) {\n                    return;\n                }\n\n                const path = browsableItem.data(\"path\");\n\n                this.browseTo(path);\n            }\n        });\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport I18n from \"../../core/i18n\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"select2\",\n    trigger: \".pat-select2\",\n    parser: \"mockup\",\n    defaults: {\n        separator: \",\",\n        ajaxTimeout: 300,\n    },\n\n    initializeValues() {\n        // Init Selection ---------------------------------------------\n        if (this.options.initialValues) {\n            this.options.id = (term) => {\n                return term.id;\n            };\n            this.options.initSelection = ($el, callback) => {\n                const data = [];\n                const value = $el.val();\n                let seldefaults = this.options.initialValues;\n\n                // Create the initSelection value that contains the default selection,\n                // but in a javascript object\n                if (\n                    typeof this.options.initialValues === \"string\" &&\n                    this.options.initialValues !== \"\"\n                ) {\n                    // if default selection value starts with a '{', then treat the value as\n                    // a JSON object that needs to be parsed\n                    if (this.options.initialValues[0] === \"{\") {\n                        seldefaults = JSON.parse(this.options.initialValues);\n                    }\n                    // otherwise, treat the value as a list, separated by the defaults.separator value of\n                    // strings in the format \"id:text\", and convert it to an object\n                    else {\n                        seldefaults = {};\n                        const initial_values = $(\n                            this.options.initialValues.split(this.options.separator)\n                        );\n                        for (const it of initial_values) {\n                            const selection = it.split(\":\");\n                            const id = selection[0].trim();\n                            const text = selection[1].trim();\n                            seldefaults[id] = text;\n                        }\n                    }\n                }\n\n                const items = $(value.split(this.options.separator));\n                for (const it of items) {\n                    let text = it;\n                    if (seldefaults[it]) {\n                        text = seldefaults[it];\n                    }\n                    data.push({\n                        id: utils.removeHTML(it),\n                        text: utils.removeHTML(text),\n                    });\n                }\n                callback(data);\n            };\n        }\n    },\n\n    initializeTags() {\n        if (this.options.tags && typeof this.options.tags === \"string\") {\n            if (this.options.tags.substr(0, 1) === \"[\") {\n                this.options.tags = JSON.parse(this.options.tags);\n            } else {\n                this.options.tags = this.options.tags.split(this.options.separator);\n            }\n        }\n\n        if (this.options.tags && !this.options.allowNewItems) {\n            this.options.data = this.options.tags.map((value) => {\n                return { id: value, text: value };\n            });\n            this.options.multiple = true;\n            delete this.options.tags;\n        }\n    },\n\n    async initializeOrdering() {\n        if (!this.options.orderable) {\n            return;\n        }\n        const Sortable = (await import(\"sortablejs\")).default;\n        const _initializeOrdering = () => {\n            const sortable_el = this.$select2[0].querySelector(\".select2-choices\");\n            new Sortable(sortable_el, {\n                draggable: \"li\",\n                dragClass: \"select2-choice-dragging\",\n                chosenClass: \"dragging\",\n                onStart: () => this.$el.select2(\"onSortStart\"),\n                onEnd: () => this.$el.select2(\"onSortEnd\"),\n            });\n        };\n        this.$el.on(\"change\", _initializeOrdering.bind(this));\n        _initializeOrdering();\n    },\n\n    async initializeSelect2() {\n        import(\"select2/select2.css\");\n        import(\"./select2.scss\");\n        await import(\"select2\");\n        try {\n            // Don't load \"en\" which is the default where no separate language file exists.\n            if (this.options.language && this.options.language !== \"en\") {\n                await import(`select2/select2_locale_${this.options.language}`);\n            }\n        } catch {\n            console.warn(\"Language file could not be loaded\", this.options.language);\n        }\n\n        this.options.formatResultCssClass = (ob) => {\n            if (ob.id) {\n                return (\n                    \"select2-option-\" +\n                    ob.id.toLowerCase().replace(/[ \\:\\)\\(\\[\\]\\{\\}\\_\\+\\=\\&\\*\\%\\#]/g, \"-\")\n                );\n            }\n        };\n\n        function callback(action, e) {\n            if (action) {\n                if (this.options.debug) {\n                    console.debug(\"callback\", action, e);\n                }\n                if (typeof action === \"string\") {\n                    action = window[action];\n                }\n                return action(e);\n            } else {\n                return action;\n            }\n        }\n\n        this.$el.select2(this.options);\n        this.$el.on(\"select2-selected\", (e) => callback(this.options.onSelected, e));\n        this.$el.on(\"select2-selecting\", (e) => callback(this.options.onSelecting, e));\n        this.$el.on(\"select2-deselecting\", (e) =>\n            callback(this.options.onDeselecting, e)\n        );\n        this.$el.on(\"select2-deselected\", (e) => callback(this.options.onDeselected, e));\n        this.$select2 = this.$el.parent().find(\".select2-container\");\n        this.$el.parent().off(\"close.plone-modal.patterns\");\n        if (this.options.orderable) {\n            this.$select2.addClass(\"select2-orderable\");\n        }\n    },\n\n    opened() {\n        const isOpen = $(\".select2-dropdown-open\", this.$el.parent()).length === 1;\n        return isOpen;\n    },\n\n    async init() {\n        const i18n = new I18n();\n        this.options.language = i18n.currentLanguage;\n        this.options.allowNewItems = this.options.allowNewItems\n            ? JSON.parse(this.options.allowNewItems)\n            : true;\n\n        // TODO: Select2 respects the select fields multiple attribute.\n        //       Currently, only when multiple is set in the pattern options\n        //       the replacement to a hidden input field is done.\n        //       A collection's querystring widget has the multiple attribute\n        //       but must not be replaced with a hidden inout, otherwise robot\n        //       tests fail.\n        //if (this.el.hasAttribute(\"multiple\")) {\n        //    this.options.multiple = true;\n        //}\n\n        if (this.options.ajax || this.options.vocabularyUrl) {\n            if (this.options.vocabularyUrl) {\n                this.options.multiple =\n                    this.options.multiple === undefined ? true : this.options.multiple;\n                this.options.ajax = this.options.ajax || {};\n                this.options.ajax.url = this.options.vocabularyUrl;\n                // XXX removing the following function does'nt break tests. dead code?\n                this.options.initSelection = ($el, callback) => {\n                    const data = [];\n                    const value = $el.val();\n                    for (const val of value.split(this.options.separator)) {\n                        const _val = utils.removeHTML(val);\n                        data.push({ id: _val, text: _val });\n                    }\n                    callback(data);\n                };\n            }\n\n            let queryTerm = \"\";\n\n            const ajaxTimeout = parseInt(this.options.ajaxTimeout || 300, 10);\n            delete this.options.ajaxTimeout;\n            this.options.ajax = $.extend(\n                {\n                    quietMillis: ajaxTimeout,\n                    data: (term, page) => {\n                        queryTerm = term;\n                        return {\n                            query: term,\n                            page_limit: 10,\n                            page: page,\n                        };\n                    },\n                    results: (data) => {\n                        let results = data.results;\n                        if (this.options.vocabularyUrl) {\n                            const dataIds = [];\n                            for (const it of data.results) {\n                                dataIds.push(it.id);\n                            }\n                            results = [];\n\n                            const haveResult =\n                                queryTerm === \"\" || dataIds.includes(queryTerm);\n                            if (this.options.allowNewItems && !haveResult) {\n                                queryTerm = utils.removeHTML(queryTerm);\n                                results.push({\n                                    id: queryTerm,\n                                    text: queryTerm,\n                                });\n                            }\n\n                            for (const it of data.results) {\n                                results.push(it);\n                            }\n                        }\n                        return { results: results };\n                    },\n                },\n                this.options.ajax\n            );\n        } else if (this.options.multiple && this.$el.is(\"select\")) {\n            // Multiselects are converted to input[type=hidden] for Select2\n            // TODO: This should actually not be necessary.\n            //       This is kept for backwards compatibility but should be\n            //       re-checked and removed if possible.\n            this.$el.attr(\"multiple\", true);\n            const vals = this.$el.val() || [];\n            const options = [...this.el.querySelectorAll(\"option\")].map((it) => {\n                return { text: it.innerHTML, id: it.value };\n            });\n\n            const el = document.createElement(\"input\");\n            el.type = \"hidden\";\n            el.value = vals.join(this.options.separator);\n            el.className = this.el.getAttribute(\"class\");\n            el.name = this.el.name;\n            el.id = this.el.id;\n            this.el.after(el);\n            this.el.remove();\n            this.el = el;\n            this.$el = $(el);\n\n            this.options.data = options;\n        }\n        this.initializeValues();\n        this.initializeTags();\n        await this.initializeSelect2();\n        await this.initializeOrdering();\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"sortable\",\n    trigger: \".pat-sortable\",\n    parser: \"mockup\",\n    defaults: {\n        selector: \"li\",\n        dragClass: \"item-dragging\",\n        cloneClass: \"dragging\",\n        drop: undefined, // callback function or name of global function\n    },\n    init: async function () {\n        let Sortable = await import(\"sortablejs\");\n        Sortable = Sortable.default;\n        this.sortable = new Sortable(this.$el[0], {\n            animation: 150,\n            draggable: this.options.selector,\n            chosenClass: this.options.dragClass,\n            dragClass: this.options.cloneClass,\n            onEnd: function (e) {\n                var cb = this.options.drop;\n                if (!cb) {\n                    return;\n                }\n                if (typeof cb === \"string\") {\n                    cb = window[this.options.drop];\n                }\n                cb($(e.item), e.newIndex - e.oldIndex);\n            }.bind(this),\n        });\n    },\n    disableSort: function () {\n        this.sortable.option(\"sort\", false);\n    },\n    enableSort: function () {\n        this.sortable.option(\"sort\", true);\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport utils from \"../../core/utils\";\n\nconst log = logger.getLogger(\"pat-upload\");\n\nlet Dropzone;\n\nexport default Base.extend({\n    name: \"upload\",\n    trigger: \".pat-upload\",\n    parser: \"mockup\",\n    defaults: {\n        showTitle: true,\n        url: null, // XXX MUST provide url to submit to OR be in a form\n        className: \"upload\",\n        wrap: false,\n        wrapperTemplate: '<div class=\"upload-wrapper\"/>',\n        fileaddedClassName: \"dropping\",\n        useTus: false,\n        container: \"\",\n        ajaxUpload: true,\n\n        paramName: \"file\",\n        addRemoveLinks: false,\n        autoCleanResults: true,\n        previewsContainer: \".previews\",\n        previewTemplate: null,\n        maxFiles: null,\n        maxFilesize: 99999999, // let's not have a max by default...\n\n        allowPathSelection: undefined,\n        relatedItems: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"getURL\",\n                \"portal_type\",\n                \"path\",\n                \"ModificationDate\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: 500,\n            maximumSelectionSize: 1,\n            selectableTypes: [\"Folder\"],\n        },\n    },\n\n    init: async function () {\n        import(\"dropzone/dist/dropzone.css\");\n        import(\"./upload.scss\");\n        Dropzone = (await import(\"dropzone\")).default;\n        /* we do not want this plugin to auto discover */\n        Dropzone.autoDiscover = false;\n\n        const UploadTemplate = (await import(\"./templates/upload.xml\")).default;\n\n        var self = this;\n\n        if (self.$el.find(\".upload-area\").length) {\n            log.info(\"Found already a dropzone on element, skipping!\");\n            return;\n        }\n\n        if (typeof self.options.allowPathSelection === \"undefined\") {\n            // Set allowPathSelection to true, if we can use path based urls.\n            self.options.allowPathSelection =\n                self.options.baseUrl && self.options.relativePath;\n        }\n\n        // TODO: find a way to make this work in firefox (and IE)\n        $(document).on(\"paste\", function (e) {\n            var oe = e.originalEvent;\n            var items = oe.clipboardData.items;\n            if (items) {\n                for (var i = 0; i < items.length; i++) {\n                    if (items[i].type.indexOf(\"image\") !== -1) {\n                        var blob = items[i].getAsFile();\n                        self.dropzone.addFile(blob);\n                    }\n                }\n            }\n        });\n        // values that will change current processing\n        self.currentPath = self.options.currentPath;\n        self.currentFile = 0;\n\n        let template = _.template(UploadTemplate)({\n            _t: _t,\n            allowPathSelection: self.options.allowPathSelection,\n        });\n        self.$el.addClass(self.options.className);\n        self.$el.append(template);\n\n        self.$progress = $(\".progress-bar-success\", self.$el);\n\n        if (!self.options.showTitle) {\n            self.$el.find(\"h2.title\").hide();\n        }\n\n        if (!self.options.ajaxUpload) {\n            // no ajax upload, drop the fallback\n            $(\".fallback\", this.$el).remove();\n            if (this.$el.hasClass(\".upload-container\")) {\n                this.$el.addClass(\"no-ajax-upload\");\n            } else {\n                this.$el.closest(\".upload-container\").addClass(\"no-ajax-upload\");\n            }\n        }\n\n        if (self.options.wrap) {\n            self.$el.wrap(self.options.wrapperTemplate);\n            self.$el = self.$el.parent();\n        }\n\n        if (self.options.allowPathSelection) {\n            // only use related items if we can generate path based urls and if it's not turned off.\n            self.$pathInput = $('input[name=\"location\"]', self.$el);\n            self.relatedItems = await self.setupRelatedItems(self.$pathInput);\n        } else {\n            $('input[name=\"location\"]', self.$el).parent().remove();\n            self.relatedItems = null;\n        }\n\n        self.$dropzone = $(\".upload-area\", self.$el);\n\n        $(\"div.browse-select button.browse\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (\n                !self.options.maxFiles ||\n                self.dropzone.files.length < self.options.maxFiles\n            ) {\n                self.dropzone.hiddenFileInput.click();\n            }\n        });\n\n        var dzoneOptions = await this.getDzoneOptions();\n\n        try {\n            // if init of Dropzone fails it says nothing and\n            // it fails silently. Using this block we make sure\n            // that if you break it w/ some weird or missing option\n            // you can get a proper log of it\n            //\n            self.dropzone = new Dropzone(self.$dropzone[0], dzoneOptions);\n        } catch (e) {\n            if (window.DEBUG) {\n                // log it!\n                console.log(e);\n            }\n            throw e;\n        }\n\n        self.dropzone.on(\"maxfilesreached\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"addedfile\", function (/* file */) {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"removedfile\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"success\", function (e, response) {\n            // Trigger event 'uploadAllCompleted' and pass the server's reponse and\n            // the path uid. This event can be listened to by patterns using the\n            // upload pattern, e.g. the TinyMCE pattern's link plugin.\n            var data;\n            try {\n                data = $.parseJSON(response);\n            } catch (ex) {\n                data = response;\n            }\n            self.$el.trigger(\"uploadAllCompleted\", {\n                data: data,\n                path_uid: self.$pathInput ? self.$pathInput.val() : null,\n            });\n        });\n\n        if (self.options.autoCleanResults) {\n            self.dropzone.on(\"complete\", function (file) {\n                if (file.status === Dropzone.SUCCESS) {\n                    setTimeout(function () {\n                        $(file.previewElement).fadeOut();\n                    }, 3000);\n                }\n            });\n        }\n\n        self.dropzone.on(\"complete\", function (file) {\n            if (file.status === Dropzone.SUCCESS && self.dropzone.files.length === 1) {\n                self.showHideControls();\n            }\n        });\n\n        self.dropzone.on(\"error\", function (file, response, xmlhr) {\n            if (typeof xmlhr !== \"undefined\" && xmlhr.status !== 403) {\n                // If error other than 403, just print a generic message\n                $(\".dz-error-message span\", file.previewElement).html(\n                    _t(\"The file transfer failed\")\n                );\n            }\n        });\n\n        self.dropzone.on(\"totaluploadprogress\", function (pct) {\n            // need to caclulate total pct here in reality since we're manually\n            // processing each file one at a time.\n            pct =\n                (((self.currentFile - 1) * 100 + pct) /\n                    (self.dropzone.files.length * 100)) *\n                100;\n            self.$progress.attr(\"aria-valuenow\", pct).css(\"width\", pct + \"%\");\n        });\n\n        $(\".upload-all\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.processUpload({\n                finished: function () {\n                    self.$progress.attr(\"aria-valuenow\", 0).css(\"width\", \"0%\");\n                },\n            });\n        });\n        if (self.options.clipboardfile) {\n            self.dropzone.addFile(self.options.clipboardfile);\n        }\n    },\n\n    showHideControls: function () {\n        /* we do this delayed because this can be called multiple times\n         AND we need to do this hide/show AFTER dropzone is done with\n         all it's own events. This is NASTY but the only way we can\n         enforce some numFiles with dropzone! */\n        var self = this;\n        if (self._showHideTimeout) {\n            clearTimeout(self._showHideTimeout);\n        }\n        self._showHideTimeout = setTimeout(function () {\n            self._showHideControls();\n        }, 50);\n    },\n\n    _showHideControls: function () {\n        var self = this;\n        var $controls = $(\".controls\", self.$el);\n        var $browse = $(\".browse-select\", self.$el);\n        var $input = $(\".dz-hidden-input\");\n\n        if (self.options.maxFiles) {\n            if (self.dropzone.files.length < self.options.maxFiles) {\n                $browse.show();\n                $input.prop(\"disabled\", false);\n            } else {\n                $browse.hide();\n                $input.prop(\"disabled\", true);\n            }\n        }\n        if (self.dropzone.files.length > 0) {\n            $controls.fadeIn(\"slow\");\n            var file = self.dropzone.files[0];\n            $(\".dz-error-message span\", file.previewElement).html(\"\");\n        } else {\n            $controls.fadeOut(\"slow\");\n        }\n    },\n\n    pathJoin: function () {\n        var parts = [];\n        _.each(arguments, function (part) {\n            if (!part) {\n                return;\n            }\n            if (part[0] === \"/\") {\n                part = part.substring(1);\n            }\n            if (part[part.length - 1] === \"/\") {\n                part = part.substring(0, part.length - 1);\n            }\n            parts.push(part);\n        });\n        return parts.join(\"/\");\n    },\n\n    getUrl: function () {\n        var self = this;\n        var url = self.options.url;\n        if (!url) {\n            if (self.options.baseUrl && self.options.relativePath) {\n                url = self.options.baseUrl;\n                if (url[url.length - 1] !== \"/\") {\n                    url = url + \"/\";\n                }\n                url = url + self.pathJoin(self.currentPath, self.options.relativePath);\n            } else {\n                var $form = self.$el.parents(\"form\");\n                if ($form.length > 0) {\n                    url = $form.attr(\"action\");\n                } else {\n                    url = window.location.href;\n                }\n            }\n        }\n        return url;\n    },\n\n    getDzoneOptions: async function () {\n        let PreviewTemplate = await import(\"./templates/preview.xml\");\n        PreviewTemplate = PreviewTemplate.default;\n\n        var self = this;\n\n        // This pattern REQUIRE dropzone to be clickable\n        self.options.clickable = true;\n\n        var options = $.extend({}, self.options);\n        options.url = self.getUrl();\n\n        options.headers = {\n            \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n        };\n\n        // XXX force to only upload one to the server at a time,\n        // right now we don't support multiple for backends\n        options.uploadMultiple = false;\n\n        delete options.wrap;\n        delete options.wrapperTemplate;\n        delete options.resultTemplate;\n        delete options.autoCleanResults;\n        delete options.fileaddedClassName;\n        delete options.useTus;\n\n        if (self.options.previewsContainer) {\n            /*\n             * if they have a select but it's not an id, let's make an id selector\n             * so we can target the correct container. dropzone is weird here...\n             */\n            var $preview = self.$el.find(self.options.previewsContainer);\n            if ($preview.length > 0) {\n                options.previewsContainer = $preview[0];\n            }\n        }\n\n        // XXX: do we need to allow this?\n        options.autoProcessQueue = false;\n        // options.addRemoveLinks = true;  // we show them in the template\n        options.previewTemplate = PreviewTemplate;\n\n        // if our element is a form we should force some values\n        // https://github.com/enyo/dropzone/wiki/Combine-normal-form-with-Dropzone\n        return options;\n    },\n\n    processUpload: function (options) {\n        if (!options) {\n            options = {};\n        }\n\n        var self = this,\n            processing = false,\n            useTus = self.options.useTus,\n            fileaddedClassName = self.options.fileaddedClassName,\n            finished = options.finished;\n\n        self.currentFile = 0;\n\n        function process() {\n            processing = true;\n            if (self.dropzone.files.length === 0) {\n                processing = false;\n            }\n\n            var file = self.dropzone.files[0];\n            if (processing && file.status === Dropzone.ERROR) {\n                // Put the file back as \"queued\" for retrying\n                file.status = Dropzone.QUEUED;\n                processing = false;\n            }\n\n            if (!processing) {\n                self.$el.removeClass(fileaddedClassName);\n                if (finished !== undefined && typeof finished === \"function\") {\n                    finished();\n                }\n                return;\n            }\n\n            if ([Dropzone.SUCCESS, Dropzone.CANCELED].indexOf(file.status) !== -1) {\n                // remove it\n                self.dropzone.removeFile(file);\n                process();\n            } else if (file.status !== Dropzone.UPLOADING) {\n                // start processing file\n                if (useTus && window.tus) {\n                    // use tus upload if installed\n                    self.handleTusUpload(file);\n                } else {\n                    // otherwise, just use dropzone to process\n                    self.currentFile += 1;\n                    self.dropzone.processFile(file);\n                }\n                setTimeout(process, 100);\n            } else {\n                // currently processing\n                setTimeout(process, 100);\n            }\n        }\n        process();\n    },\n\n    handleTusUpload: function (file) {\n        /* this needs fixing... */\n        var self = this,\n            chunkSize = 1024 * 1024 * 5; // 5mb chunk size\n\n        file.status = Dropzone.UPLOADING;\n\n        window.tus\n            .upload(file, {\n                endpoint: self.dropzone.options.url,\n                headers: {\n                    \"FILENAME\": file.name,\n                    \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n                },\n                chunkSize: chunkSize,\n            })\n            .fail(function () {\n                if (window.DEBUG) {\n                    console.alert(_t(\"Error uploading with TUS resumable uploads\"));\n                }\n                file.status = Dropzone.ERROR;\n            })\n            .progress(function (e, bytesUploaded, bytesTotal) {\n                var percentage = (bytesUploaded / bytesTotal) * 100;\n                self.$progress\n                    .attr(\"aria-valuenow\", percentage)\n                    .css(\"width\", percentage + \"%\");\n                self.$progress.html(\n                    _t(\"uploading...\") +\n                        \"<br />\" +\n                        self.formatBytes(bytesUploaded) +\n                        \" / \" +\n                        self.formatBytes(bytesTotal)\n                );\n            })\n            .done(function (url, file) {\n                file.status = Dropzone.SUCCESS;\n                self.dropzone.emit(\"success\", file);\n                self.dropzone.emit(\"complete\", file);\n            });\n    },\n\n    formatBytes: function (bytes) {\n        var kb = Math.round(bytes / 1024);\n        if (kb < 1024) {\n            return kb + \" KiB\";\n        }\n        var mb = Math.round(kb / 1024);\n        if (mb < 1024) {\n            return mb + \" MB\";\n        }\n        return Math.round(mb / 1024) + \" GB\";\n    },\n\n    setPath: function (path) {\n        var self = this;\n        self.currentPath = path;\n        self.options.url = null;\n        self.options.url = self.dropzone.options.url = self.getUrl();\n    },\n\n    setupRelatedItems: async function ($input) {\n        const RelatedItems = (await import(\"../relateditems/relateditems\")).default;\n\n        var self = this;\n        var options = self.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        if (self.options.initialFolder) {\n            $input.attr(\"value\", self.options.initialFolder);\n        }\n        var ri = new RelatedItems($input, options);\n        ri.$el.on(\"change\", function () {\n            var result = $(this).select2(\"data\");\n            var path = null;\n            if (result.length > 0) {\n                path = result[0].path;\n            }\n            self.setPath(path);\n        });\n        return ri;\n    },\n});\n","/**\n * @license\n * Patterns @VERSION@ jquery-ext - various jQuery extensions\n *\n * Copyright 2011 Humberto Sermeo\n */\n\nimport $ from \"jquery\";\n\nvar methods = {\n    init: function (options) {\n        var settings = {\n            time: 3 /* time it will wait before moving to \"timeout\" after a move event */,\n            initialTime: 8 /* time it will wait before first adding the \"timeout\" class */,\n            exceptionAreas: [] /* IDs of elements that, if the mouse is over them, will reset the timer */,\n        };\n        return this.each(function () {\n            var $this = $(this),\n                data = $this.data(\"timeout\");\n\n            if (!data) {\n                if (options) {\n                    $.extend(settings, options);\n                }\n                $this.data(\"timeout\", {\n                    lastEvent: new Date(),\n                    trueTime: settings.time,\n                    time: settings.initialTime,\n                    untouched: true,\n                    inExceptionArea: false,\n                });\n\n                $this.on(\"mouseover.timeout\", methods.mouseMoved);\n                $this.on(\"mouseenter.timeout\", methods.mouseMoved);\n\n                $(settings.exceptionAreas).each(function () {\n                    $this\n                        .find(this)\n                        .live(\n                            \"mouseover.timeout\",\n                            { parent: $this },\n                            methods.enteredException\n                        )\n                        .live(\n                            \"mouseleave.timeout\",\n                            { parent: $this },\n                            methods.leftException\n                        );\n                });\n\n                if (settings.initialTime > 0) $this.timeout(\"startTimer\");\n                else $this.addClass(\"timeout\");\n            }\n        });\n    },\n\n    enteredException: function (event) {\n        var data = event.data.parent.data(\"timeout\");\n        data.inExceptionArea = true;\n        event.data.parent.data(\"timeout\", data);\n        event.data.parent.trigger(\"mouseover\");\n    },\n\n    leftException: function (event) {\n        var data = event.data.parent.data(\"timeout\");\n        data.inExceptionArea = false;\n        event.data.parent.data(\"timeout\", data);\n    },\n\n    destroy: function () {\n        return this.each(function () {\n            var $this = $(this),\n                data = $this.data(\"timeout\");\n\n            $(window).off(\".timeout\");\n            data.timeout.remove();\n            $this.removeData(\"timeout\");\n        });\n    },\n\n    mouseMoved: function () {\n        var $this = $(this),\n            data = $this.data(\"timeout\");\n\n        if ($this.hasClass(\"timeout\")) {\n            $this.removeClass(\"timeout\");\n            $this.timeout(\"startTimer\");\n        } else if (data.untouched) {\n            data.untouched = false;\n            data.time = data.trueTime;\n        }\n\n        data.lastEvent = new Date();\n        $this.data(\"timeout\", data);\n    },\n\n    startTimer: function () {\n        var $this = $(this),\n            data = $this.data(\"timeout\");\n        var fn = function () {\n            var data = $this.data(\"timeout\");\n            if (data && data.lastEvent) {\n                if (data.inExceptionArea) {\n                    setTimeout(fn, Math.floor(data.time * 1000));\n                } else {\n                    var now = new Date();\n                    var diff = Math.floor(data.time * 1000) - (now - data.lastEvent);\n                    if (diff > 0) {\n                        // the timeout has not ocurred, so set the timeout again\n                        setTimeout(fn, diff + 100);\n                    } else {\n                        // timeout ocurred, so set the class\n                        $this.addClass(\"timeout\");\n                    }\n                }\n            }\n        };\n\n        setTimeout(fn, Math.floor(data.time * 1000));\n    },\n};\n\n$.fn.timeout = function (method) {\n    if (methods[method]) {\n        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));\n    } else if (typeof method === \"object\" || !method) {\n        return methods.init.apply(this, arguments);\n    } else {\n        $.error(\"Method \" + method + \" does not exist on jQuery.timeout\");\n    }\n};\n\n// Custom jQuery selector to find elements with scrollbars\n$.extend($.expr[\":\"], {\n    scrollable: function (element) {\n        var vertically_scrollable, horizontally_scrollable;\n        if (\n            $(element).css(\"overflow\") === \"scroll\" ||\n            $(element).css(\"overflowX\") === \"scroll\" ||\n            $(element).css(\"overflowY\") === \"scroll\"\n        )\n            return true;\n\n        vertically_scrollable =\n            element.clientHeight < element.scrollHeight &&\n            ($.inArray($(element).css(\"overflowY\"), [\"scroll\", \"auto\"]) !== -1 ||\n                $.inArray($(element).css(\"overflow\"), [\"scroll\", \"auto\"]) !== -1);\n\n        if (vertically_scrollable) return true;\n\n        horizontally_scrollable =\n            element.clientWidth < element.scrollWidth &&\n            ($.inArray($(element).css(\"overflowX\"), [\"scroll\", \"auto\"]) !== -1 ||\n                $.inArray($(element).css(\"overflow\"), [\"scroll\", \"auto\"]) !== -1);\n        return horizontally_scrollable;\n    },\n});\n\n// Make Visible in scroll\n$.fn.makeVisibleInScroll = function (parent_id) {\n    var absoluteParent = null;\n    if (typeof parent_id === \"string\") {\n        absoluteParent = $(\"#\" + parent_id);\n    } else if (parent_id) {\n        absoluteParent = $(parent_id);\n    }\n\n    return this.each(function () {\n        var $this = $(this),\n            parent;\n        if (!absoluteParent) {\n            parent = $this.parents(\":scrollable\");\n            if (parent.length > 0) {\n                parent = $(parent[0]);\n            } else {\n                parent = $(window);\n            }\n        } else {\n            parent = absoluteParent;\n        }\n\n        var elemTop = $this.position().top;\n        var elemBottom = $this.height() + elemTop;\n\n        var viewTop = parent.scrollTop();\n        var viewBottom = parent.height() + viewTop;\n\n        if (elemTop < viewTop) {\n            parent.scrollTop(elemTop);\n        } else if (elemBottom > viewBottom - parent.height() / 2) {\n            parent.scrollTop(elemTop - (parent.height() - $this.height()) / 2);\n        }\n    });\n};\n\n//Work around warning for jQuery 3.x:\n//JQMIGRATE: jQuery.fn.offset() requires an element connected to a document\n$.fn.safeOffset = function () {\n    var docElem,\n        elem = this[0],\n        origin = { top: 0, left: 0 };\n\n    if (!elem || !elem.nodeType) {\n        return origin;\n    }\n\n    docElem = (elem.ownerDocument || document).documentElement;\n    if (!$.contains(docElem, elem)) {\n        return origin;\n    }\n\n    return $.fn.offset.apply(this, arguments);\n};\n\n//Make absolute location\n$.fn.setPositionAbsolute = function (element, offsettop, offsetleft) {\n    return this.each(function () {\n        // set absolute location for based on the element passed\n        // dynamically since every browser has different settings\n        var $this = $(this);\n        var thiswidth = $(this).width();\n        var pos = element.safeOffset();\n        var width = element.width();\n        var height = element.height();\n        var setleft = pos.left + width - thiswidth + offsetleft;\n        var settop = pos.top + height + offsettop;\n        $this.css({\n            \"z-index\": 1,\n            \"position\": \"absolute\",\n            \"marginLeft\": 0,\n            \"marginTop\": 0,\n            \"left\": setleft + \"px\",\n            \"top\": settop + \"px\",\n            \"width\": thiswidth,\n        });\n        $this.remove().appendTo(\"body\").show();\n    });\n};\n\n$.fn.positionAncestor = function (selector) {\n    var left = 0;\n    var top = 0;\n    this.each(function () {\n        // check if current element has an ancestor matching a selector\n        // and that ancestor is positioned\n        var $ancestor = $(this).closest(selector);\n        if ($ancestor.length && $ancestor.css(\"position\") !== \"static\") {\n            var $child = $(this);\n            var childMarginEdgeLeft =\n                $child.safeOffset().left - parseInt($child.css(\"marginLeft\"), 10);\n            var childMarginEdgeTop =\n                $child.safeOffset().top - parseInt($child.css(\"marginTop\"), 10);\n            var ancestorPaddingEdgeLeft =\n                $ancestor.safeOffset().left +\n                parseInt($ancestor.css(\"borderLeftWidth\"), 10);\n            var ancestorPaddingEdgeTop =\n                $ancestor.safeOffset().top +\n                parseInt($ancestor.css(\"borderTopWidth\"), 10);\n            left = childMarginEdgeLeft - ancestorPaddingEdgeLeft;\n            top = childMarginEdgeTop - ancestorPaddingEdgeTop;\n            // we have found the ancestor and computed the position\n            // stop iterating\n            return false;\n        }\n    });\n    return {\n        left: left,\n        top: top,\n    };\n};\n\n$.fn.findInclusive = function (selector) {\n    return this.find(\"*\").addBack().filter(selector);\n};\n\n$.fn.slideIn = function (speed, easing, callback) {\n    return this.animate({ width: \"show\" }, speed, easing, callback);\n};\n\n$.fn.slideOut = function (speed, easing, callback) {\n    return this.animate({ width: \"hide\" }, speed, easing, callback);\n};\n\n// case-insensitive :contains\n$.expr[\":\"].Contains = function (a, i, m) {\n    return $(a).text().toUpperCase().indexOf(m[3].toUpperCase()) >= 0;\n};\n\n$.fn.scopedFind = function (selector) {\n    /*  If the selector starts with an object id do a global search,\n     *  otherwise do a local search.\n     */\n    if (selector.indexOf(\"#\") === 0) {\n        return $(selector);\n    } else {\n        return this.find(selector);\n    }\n};\n\nexport default undefined;\n","import Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\nimport \"../../core/jquery-ext\";\n\nexport const parser = new Parser(\"checklist\");\nparser.addArgument(\"select\", \".select-all\");\nparser.addArgument(\"deselect\", \".deselect-all\");\nparser.addArgument(\"toggle\", \".toggle-all\");\n\nexport default Base.extend({\n    name: \"checklist\",\n    trigger: \".pat-checklist\",\n    jquery_plugin: true,\n    all_selects: [],\n    all_deselects: [],\n    all_toggles: [],\n    all_checkboxes: [],\n    all_radios: [],\n\n    init() {\n        this.options = parser.parse(this.el, this.options, false);\n        this.$el.on(\"patterns-injected\", this._init.bind(this));\n\n        this.change_handler = utils.debounce(() => {\n            this.change_buttons_and_toggles();\n            this.change_checked();\n        }, 50);\n\n        this._init();\n    },\n\n    _init() {\n        this.all_checkboxes = this.el.querySelectorAll(`input[type=checkbox]`);\n        this.all_radios = this.el.querySelectorAll(\"input[type=radio]\");\n\n        this.all_selects = dom.find_scoped(this.el, this.options.select);\n        for (const btn of this.all_selects) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--select-all--click\",\n                this.select_all.bind(this)\n            );\n        }\n\n        this.all_deselects = dom.find_scoped(this.el, this.options.deselect);\n        for (const btn of this.all_deselects) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--deselect-all--click\",\n                this.deselect_all.bind(this)\n            );\n        }\n\n        this.all_toggles = dom.find_scoped(this.el, this.options.toggle);\n        for (const btn of this.all_toggles) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--toggle-all--click\",\n                this.toggle_all.bind(this)\n            );\n        }\n\n        // update select/deselect button status\n        this.change_buttons_and_toggles();\n        this.change_checked();\n        events.add_event_listener(\n            this.el,\n            \"change\",\n            \"pat-checklist--change-handler--change\",\n            this.change_handler.bind(this)\n        );\n    },\n\n    destroy() {\n        for (const it of this.all_selects) {\n            events.remove_event_listener(it, \"pat-checklist--select-all--click\");\n        }\n        for (const it of this.all_deselects) {\n            events.remove_event_listener(it, \"pat-checklist--deselect-all--click\");\n        }\n        for (const it of this.all_toggles) {\n            events.remove_event_listener(it, \"pat-checklist--toggle-all--click\");\n        }\n        events.remove_event_listener(this.el, \"pat-checklist--change-handler--change\");\n        this.$el.off(\"patterns_injected\");\n    },\n\n    find_siblings(el, sel) {\n        // Looks for the closest elements within the `el` tree that match the\n        // `sel` selector\n        let res;\n        let parent = el.parentNode;\n        while (parent) {\n            res = parent.querySelectorAll(`${sel}:not(${this.options.toggle})`);\n            if (res.length || parent === this.el) {\n                // return if results were found or we reached the pattern top\n                return res;\n            }\n            parent = parent.parentNode;\n        }\n    },\n\n    find_checkboxes(ref_el, sel) {\n        let chkbxs = [];\n        if (this.options.select.indexOf(\"#\") === 0) {\n            chkbxs = this.el.querySelectorAll(sel);\n        } else {\n            chkbxs = this.find_siblings(ref_el, sel);\n        }\n        return chkbxs;\n    },\n\n    change_buttons_and_toggles() {\n        let chkbxs;\n        for (const btn of this.all_selects) {\n            chkbxs = this.find_checkboxes(btn, \"input[type=checkbox]\");\n            btn.disabled = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === true);\n        }\n        for (const btn of this.all_deselects) {\n            chkbxs = this.find_checkboxes(btn, \"input[type=checkbox]\");\n            btn.disabled = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === false);\n        }\n        for (const tgl of this.all_toggles) {\n            chkbxs = this.find_checkboxes(tgl, \"input[type=checkbox]\");\n            tgl.checked = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === true);\n        }\n    },\n\n    select_all(e) {\n        e.preventDefault();\n        const chkbxs = this.find_checkboxes(\n            e.target,\n            \"input[type=checkbox]:not(:checked)\"\n        );\n        for (const box of chkbxs) {\n            box.checked = true;\n            box.dispatchEvent(events.change_event());\n        }\n    },\n\n    deselect_all(e) {\n        e.preventDefault();\n        const chkbxs = this.find_checkboxes(e.target, \"input[type=checkbox]:checked\");\n        for (const box of chkbxs) {\n            box.checked = false;\n            box.dispatchEvent(events.change_event());\n        }\n    },\n\n    toggle_all(e) {\n        e.preventDefault();\n        const checked = e.target.checked;\n        const chkbxs = this.find_checkboxes(e.target, \"input[type=checkbox]\");\n        for (const box of chkbxs) {\n            box.checked = checked;\n            box.dispatchEvent(events.change_event());\n        }\n    },\n\n    change_checked() {\n        for (const it of [...this.all_checkboxes, ...this.all_radios]) {\n            for (const label of it.labels) {\n                label.classList.remove(\"checked\", \"unchecked\");\n                label.classList.add(it.checked ? \"checked\" : \"unchecked\");\n            }\n        }\n\n        for (const fieldset of dom.querySelectorAllAndMe(this.el, \"fieldset\")) {\n            if (\n                fieldset.querySelectorAll(\n                    `input[type=checkbox]:checked:not(${this.options.toggle}), input[type=radio]:checked`\n                ).length\n            ) {\n                fieldset.classList.remove(\"unchecked\");\n                fieldset.classList.add(\"checked\");\n            } else {\n                fieldset.classList.remove(\"checked\");\n                fieldset.classList.add(\"unchecked\");\n            }\n        }\n    },\n});\n","/* pat-datetime-picker  - Polyfill for input type=datetime-local */\nimport Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport utils from \"../../core/utils\";\nimport dom from \"../../core/dom\";\n\nexport const parser = new Parser(\"datetime-picker\");\nparser.addArgument(\"format\", \"YYYY-MM-DD\");\nparser.addArgument(\"week-numbers\", [], [\"show\", \"hide\"]);\nparser.addArgument(\"i18n\"); // URL pointing to JSON resource with i18n values\nparser.addArgument(\"today\", \"Today\");\nparser.addArgument(\"clear\", \"Clear\");\nparser.addArgument(\"first-day\", 0);\n\nexport default Base.extend({\n    name: \"datetime-picker\",\n    trigger: \".pat-datetime-picker\",\n    parser: parser,\n    el_date: null,\n    el_time: null,\n\n    async init() {\n        const el = this.el;\n        this.options = parser.parse(this.el, this.options);\n\n        if (utils.checkInputSupport(\"datetime-local\", \"invalid date\")) {\n            return;\n        }\n\n        if (window.__patternslib_import_styles) {\n            import(\"./_datetime-picker.scss\");\n        }\n        const DatePicker = (await import(\"../date-picker/date-picker\")).default;\n\n        const value = this.el.value.split(\"T\");\n        const date_value = value[0] || \"\";\n        const time_value = value[1] || \"\";\n\n        const el_wrapper = document.createElement(\"div\");\n        el_wrapper.setAttribute(\"class\", \"pat-datetime-picker__wrapper\");\n\n        dom.hide(el);\n\n        // let the buttons be of type button otherwise they are submit buttons\n        const html_btn_now = `\n            <button type=\"button\" class=\"_btn _now\" title=\"${this.options.today}\">\n                <span class=\"_icon\"/>\n                <span class=\"_text\">${this.options.today}</span>\n            </button>`;\n        const html_btn_clear = `\n            <button type=\"button\" class=\"_btn _clear\" title=\"${this.options.clear}\">\n                <span class=\"_icon\"/>\n                <span class=\"_text\">${this.options.clear}</span>\n            </button>`;\n\n        el_wrapper.innerHTML = `\n            <input type=\"date\" placeholder=\"YYYY-MM-DD\" value=\"${date_value}\" />\n            <input type=\"time\" placeholder=\"hh:mm\" value=\"${time_value}\" />\n            ${this.options.today ? html_btn_now : \"\"}\n            ${this.options.clear ? html_btn_clear : \"\"}\n        `;\n\n        this.el_time = el_wrapper.querySelector(\"input[type=time]\");\n        this.el_time.addEventListener(\"change\", () => this.update());\n\n        this.el_date = el_wrapper.querySelector(\"input[type=date]\");\n        this.el_date.addEventListener(\"change\", () => {\n            if (!this.el_time.value) {\n                // Set time on date change, if time was empty.\n                this.el_time.value = this.isotime();\n            }\n            this.update();\n        });\n\n        const date_options = {\n            behavior: \"native\",\n            format: this.options.format,\n            weekNumbers: this.options.weekNumbers,\n            firstDay: this.options.firstDay,\n        };\n        await DatePicker.init(this.el_date, date_options);\n\n        if (this.options.today) {\n            const btn_now = el_wrapper.querySelector(\"._btn._now\");\n            btn_now.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                this.el_date.value = this.isodate();\n                this.el_time.value = this.isotime();\n                this.update();\n            });\n        }\n\n        if (this.options.clear) {\n            const btn_clear = el_wrapper.querySelector(\"._btn._clear\");\n            btn_clear.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                this.el_date.value = \"\";\n                this.el_time.value = \"\";\n                this.update();\n            });\n        }\n\n        // TODO: timezone\n        el.parentNode.insertBefore(el_wrapper, el);\n    },\n\n    update() {\n        if (this.el_date.value && this.el_time.value) {\n            this.el.value = `${this.el_date.value}T${this.el_time.value}`;\n        } else {\n            this.el.value = \"\";\n        }\n        this.el.dispatchEvent(new Event(\"change\", { bubbles: true, cancelable: true }));\n    },\n\n    isodate() {\n        const now = new Date();\n        return now.toISOString().substr(0, 10);\n    },\n\n    isotime() {\n        const now = new Date();\n        return now.toTimeString().substr(0, 5);\n    },\n});\n","// Patterns validate - Form vlidation\nimport \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport { BasePattern } from \"../../core/basepattern\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport logging from \"../../core/logging\";\nimport utils from \"../../core/utils\";\nimport registry from \"../../core/registry\";\n\nconst logger = logging.getLogger(\"pat-validation\");\n//logger.setLevel(logging.Level.DEBUG);\n\nexport const parser = new Parser(\"validation\");\nparser.addArgument(\"disable-selector\", \"[type=submit], button:not([type=button])\"); // Elements which must be disabled if there are errors\nparser.addArgument(\"message-date\", \"\"); // \"This value must be a valid date\");\nparser.addArgument(\"message-datetime\", \"\"); // \"This value must be a valid date and time\");\nparser.addArgument(\"message-email\", \"\"); // \"This value must be a valid email address\");\nparser.addArgument(\"message-max\", \"\"); // \"This value must be less than or equal to %{count}\");\nparser.addArgument(\"message-min\", \"\"); // \"This value must be greater than or equal to %{count}\"); // prettier-ignore\nparser.addArgument(\"message-number\", \"\"); // \"This value must be a number\");\nparser.addArgument(\"message-required\", \"\"); // \"This field is required\");\nparser.addArgument(\"message-equality\", \"is not equal to %{attribute}.\");\nparser.addArgument(\"not-after\", null);\nparser.addArgument(\"not-before\", null);\nparser.addArgument(\"equality\", null);\nparser.addArgument(\"delay\", 100); // Delay before validation is done to avoid validating while typing.\n\n// BBB\n// TODO: deprecated. Will be removed with next major version.\nparser.addAlias(\"message-integer\", \"message-number\");\nparser.addArgument(\"error-template\");\n\nconst KEY_ERROR_EL = \"__patternslib__input__error__el\";\nconst KEY_ERROR_MSG = \"__patternslib__input__error__msg\";\n\nclass Pattern extends BasePattern {\n    static name = \"validation\";\n    static trigger = \"form.pat-validation\";\n    static parser = parser;\n\n    init() {\n        events.add_event_listener(\n            this.el,\n            \"submit\",\n            `pat-validation--submit--validator`,\n            (e) => {\n                // On submit, check all.\n                // Immediate, non-debounced check with submit. Otherwise submit\n                // is not cancelable.\n                for (const input of this.inputs) {\n                    logger.debug(\"Checking input for submit\", input, e);\n                    this.check_input({ input: input, event: e });\n                }\n            },\n            // Make sure this event handler is run early, in the capturing\n            // phase in order to be able to cancel later non-capturing submit\n            // events.\n            { capture: true }\n        );\n\n        this.initialize_inputs();\n        $(this.el).on(\"pat-update\", () => {\n            this.initialize_inputs();\n        });\n\n        // Set ``novalidate`` attribute to disable the browser's validation\n        // bubbles but not disable the validation API.\n        this.el.setAttribute(\"novalidate\", \"\");\n    }\n\n    initialize_inputs() {\n        this.inputs = [\n            ...this.el.querySelectorAll(\"input[name], select[name], textarea[name]\"),\n        ];\n        this.disabled_elements = [\n            ...this.el.querySelectorAll(this.options.disableSelector),\n        ];\n\n        for (const [cnt, input] of this.inputs.entries()) {\n            // Cancelable debouncer.\n            const debouncer = utils.debounce((e) => {\n                logger.debug(\"Checking input for event\", input, e);\n                this.check_input({ input: input, event: e });\n            }, this.options.delay);\n\n            events.add_event_listener(\n                input,\n                \"input\",\n                `pat-validation--input-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n            events.add_event_listener(\n                input,\n                \"change\",\n                `pat-validation--change-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n            events.add_event_listener(\n                input,\n                \"blur\",\n                `pat-validation--blur-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n        }\n    }\n\n    check_input({ input, event, stop = false }) {\n        if (input.disabled) {\n            // No need to check disabled inputs.\n            return;\n        }\n\n        // In any case, clear the custom validity first.\n        this.set_validity({ input: input, msg: \"\" });\n        const validity_state = input.validity;\n\n        if (event?.submitter?.hasAttribute(\"formnovalidate\")) {\n            // Do not check when a button with ``formnovalidate`` was used.\n            return;\n        }\n\n        logger.debug(`\n            validity_state.badInput ${validity_state.badInput}\n            validity_state.customError ${validity_state.customError}\n            validity_state.patternMismatch ${validity_state.patternMismatch}\n            validity_state.rangeOverflow ${validity_state.rangeOverflow}\n            validity_state.rangeUnderflow ${validity_state.rangeUnderflow}\n            validity_state.stepMismatch ${validity_state.stepMismatch}\n            validity_state.tooLong ${validity_state.tooLong}\n            validity_state.tooShort ${validity_state.tooShort}\n            validity_state.typeMismatch ${validity_state.typeMismatch}\n            validity_state.valid ${validity_state.valid}\n            validity_state.valueMissing ${validity_state.valueMissing}\n        `);\n\n        const input_options = parser.parse(input);\n\n        if (validity_state.valid) {\n            // Custom error cases or no invalid state.\n\n            if (\n                input_options.equality &&\n                this.el.querySelector(`[name=${input_options.equality}]`)?.value !==\n                    input.value\n            ) {\n                const message =\n                    input_options.message.equality ||\n                    `The value is not equal to %{attribute}`;\n                this.set_validity({\n                    input: input,\n                    msg: message,\n                    attribute: input_options.equality,\n                });\n            } else if (input_options.not.after || input_options.not.before) {\n                const msg = input_options.message.date || input_options.message.datetime;\n                const msg_default_not_before = \"The date must be after %{attribute}\";\n                const msg_default_not_after = \"The date must be before %{attribute}\";\n\n                let not_after;\n                let not_after_el;\n                if (input_options.not.after) {\n                    if (utils.is_iso_date_time(input_options.not.after, true)) {\n                        not_after = new Date(input_options.not.after);\n                    } else {\n                        // Handle value as selector\n                        not_after_el = document.querySelector(input_options.not.after);\n                        not_after = not_after_el?.value\n                            ? new Date(not_after_el?.value)\n                            : undefined;\n                    }\n\n                    // Use null if no valid date.\n                    not_after = isNaN(not_after) ? null : not_after;\n                }\n\n                let not_before;\n                let not_before_el;\n                if (input_options.not.before) {\n                    if (utils.is_iso_date_time(input_options.not.before, true)) {\n                        not_before = new Date(input_options.not.before);\n                    } else {\n                        // Handle value as selector\n                        not_before_el = document.querySelector(input_options.not.before);\n                        not_before = not_before_el?.value\n                            ? new Date(not_before_el?.value)\n                            : undefined;\n                    }\n\n                    // Use null if no valid date.\n                    not_before = isNaN(not_before) ? null : not_before;\n                }\n\n                if (\n                    input.value &&\n                    utils.is_iso_date_time(input.value, true) &&\n                    !isNaN(new Date(input.value))\n                ) {\n                    // That's 1 valid date!\n                    const date = new Date(input.value);\n\n                    if (not_after && date > not_after) {\n                        let msg_attr;\n                        // Try to construct a meaningfull error message\n                        if (!not_after_el && input_options.not.after) {\n                            // fixed date case\n                            msg_attr = input_options.not.after;\n                        } else {\n                            // Get the label + other text content within the\n                            // label and replace all whitespace and newlines\n                            // with a single space.\n                            msg_attr = not_after_el?.labels?.[0]?.textContent.replace(\n                                /\\s\\s+/g, // replace all whitespace\n                                \" \" // with a single space\n                            );\n                            msg_attr = msg_attr || not_after_el.name;\n                        }\n                        this.set_validity({\n                            input: input,\n                            msg: msg || msg_default_not_after,\n                            attribute: msg_attr.trim(),\n                        });\n                    } else if (not_before && date < not_before) {\n                        let msg_attr;\n                        // Try to construct a meaningfull error message\n                        if (!not_before_el && input_options.not.before) {\n                            // fixed date case\n                            msg_attr = input_options.not.before;\n                        } else {\n                            // Get the label + other text content within the\n                            // label and replace all whitespace and newlines\n                            // with a single space.\n                            msg_attr = not_before_el?.labels?.[0]?.textContent.replace(\n                                /\\s\\s+/g, // replace all whitespace\n                                \" \" // with a single space\n                            );\n                            msg_attr = msg_attr || not_before_el.name;\n                        }\n                        this.set_validity({\n                            input: input,\n                            msg: msg || msg_default_not_before,\n                            attribute: msg_attr.trim(),\n                        });\n                    }\n                }\n\n                // always check the other input to clear/set errors\n                // do not re-check when stop is set to avoid infinite loops\n                if (!stop && not_after_el) {\n                    logger.debug(\"Check `not-after` input.\", not_after_el);\n                    this.check_input({ input: not_after_el, stop: true });\n                }\n                if (!stop && not_before_el) {\n                    logger.debug(\"Check `no-before` input.\", not_after_el);\n                    this.check_input({ input: not_before_el, stop: true });\n                }\n            }\n\n            if (!validity_state.customError) {\n                // No error to handle. Return.\n                this.remove_error(input, true);\n                return;\n            }\n        } else {\n            // Default error cases with custom messages.\n\n            if (validity_state.valueMissing && input_options.message.required) {\n                this.set_validity({ input: input, msg: input_options.message.required });\n            } else if (validity_state.rangeUnderflow && input_options.message.min) {\n                this.set_validity({\n                    input: input,\n                    msg: input_options.message.min,\n                    min: input.getAttribute(\"min\"),\n                });\n            } else if (validity_state.rangeOverflow && input_options.message.max) {\n                this.set_validity({\n                    input: input,\n                    msg: input_options.message.max,\n                    max: input.getAttribute(\"max\"),\n                });\n            } else if (\n                (validity_state.badInput || validity_state.stepMismatch) &&\n                input.type === \"number\" &&\n                input_options.message.number\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.number });\n            } else if (\n                validity_state.typeMismatch &&\n                input.type === \"email\" &&\n                input_options.message.email\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.email });\n            } else if (\n                validity_state.rangeUnderflow &&\n                input.type === \"date\" &&\n                input_options.message.date\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.date });\n            } else if (\n                validity_state.rangeOverflow &&\n                input.type === \"date\" &&\n                input_options.message.date\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.date });\n            } else if (\n                validity_state.rangeUnderflow &&\n                input.type === \"datetime\" &&\n                input_options.message.datetime\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.datetime });\n            } else if (\n                validity_state.rangeOverflow &&\n                input.type === \"datetime\" &&\n                input_options.message.datetime\n            ) {\n                this.set_validity({ input: input, msg: input_options.message.datetime });\n            }\n        }\n\n        if (event?.type === \"submit\") {\n            // Do not submit in error case and prevent other handlers to take action.\n            event.preventDefault();\n            event.stopPropagation();\n            event.stopImmediatePropagation();\n        }\n        this.set_error_message(input);\n    }\n\n    set_validity({ input, msg, attribute = null, min = null, max = null }) {\n        // Replace some variables, as like validate.js\n        if (attribute) {\n            msg = msg.replace(/%{attribute}/g, attribute);\n        }\n        if (min) {\n            msg = msg.replace(/%{count}/g, min);\n        }\n        if (max) {\n            msg = msg.replace(/%{count}/g, max);\n        }\n        msg = msg.replace(/%{value}/g, JSON.stringify(input.value));\n\n        input.setCustomValidity(msg);\n        // Store the error message on the input.\n        // Hidden inputs do not participate in validation but we need this\n        // (e.g. styled date input).\n        input[KEY_ERROR_MSG] = msg;\n    }\n\n    remove_error(input, all_of_group = false) {\n        // Remove error message and related referencesfrom input.\n\n        let inputs = [input];\n        if (all_of_group) {\n            // Get all inputs with the same name - e.g. radio buttons, checkboxes.\n            inputs = this.inputs.filter((it) => it.name === input.name);\n        }\n        for (const it of inputs) {\n            const error_node = it[KEY_ERROR_EL];\n            it[KEY_ERROR_EL] = null;\n            error_node?.remove();\n        }\n\n        // disable selector\n        if (this.el.checkValidity()) {\n            for (const it of this.disabled_elements) {\n                if (it.disabled) {\n                    it.removeAttribute(\"disabled\");\n                    it.classList.remove(\"disabled\");\n                }\n            }\n        }\n    }\n\n    set_error_message(input) {\n        this.remove_error(input);\n\n        // Do not set a error message for a input group like radio buttons or\n        // checkboxes where one has already been set.\n        const inputs = this.inputs.filter((it) => it.name === input.name);\n        if (inputs.length > 1 && inputs.some((it) => !!it[KEY_ERROR_EL])) {\n            // error message for input group already set.\n            return;\n        }\n\n        // Create the validation error DOM node from the template\n        const validation_message = input.validationMessage || input[KEY_ERROR_MSG];\n        const error_node = dom.create_from_string(\n            this.error_template(validation_message)\n        ).firstChild;\n\n        let fieldset;\n        if (input.type === \"radio\" || input.type === \"checkbox\") {\n            fieldset = input.closest(\"fieldset.pat-checklist\");\n        }\n        if (fieldset) {\n            fieldset.append(error_node);\n        } else {\n            input.after(error_node);\n        }\n        input[KEY_ERROR_EL] = error_node;\n\n        let did_disable = false;\n        for (const it of this.disabled_elements) {\n            // Disable for melements if they are not already disabled and which\n            // do not have set the `formnovalidate` attribute, e.g.\n            // `<button formnovalidate>cancel</button>`.\n            if (!it.disabled && !it.formNoValidate) {\n                did_disable = true;\n                it.setAttribute(\"disabled\", \"disabled\");\n                it.classList.add(\"disabled\");\n                logger.debug(\"Disable element\", it);\n            }\n        }\n\n        // Do an initial check of the whole form when a form element (e.g. the\n        // submit button) was disabled. We want to show the user all possible\n        // errors at once and after the submit button is disabled there is no\n        // way to check the whole form at once. ... well we also do not want to\n        // check the whole form when one input was changed....\n        if (did_disable) {\n            logger.debug(\"Checking whole form after element was disabled.\");\n            for (const _input of this.inputs.filter((it) => it !== input)) {\n                this.check_input({ input: _input, stop: true });\n            }\n        }\n    }\n\n    error_template(message) {\n        // Template for the validation message\n        return `<em class=\"validation warning message\">${message}</em>`;\n    }\n}\n\nregistry.register(Pattern);\n\nexport default Pattern;\nexport { Pattern };\n","/**\n * Patterns ajax - AJAX injection for forms and anchors\n *\n * Copyright 2012-2013 Florian Friesdorf\n * Copyright 2012-2013 Marko Durkovic\n */\nimport \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport registry from \"../../core/registry\";\n\nconst log = logging.getLogger(\"pat.ajax\");\n\nexport const parser = new Parser(\"ajax\");\nparser.addArgument(\"accept\", \"text/html\");\nparser.addArgument(\"url\", function ($el) {\n    const el = $el[0];\n    const value =\n        el.tagName === \"A\"\n            ? el.getAttribute(\"href\")\n            : el.tagName === \"FORM\"\n            ? el.getAttribute(\"action\")\n            : \"\";\n    return (value || \"\").split(\"#\")[0];\n});\nparser.addArgument(\"browser-cache\", \"no-cache\", [\"cache\", \"no-cache\"]); // Cache ajax requests\n\nconst xhrCount = {};\nxhrCount.get = function (a) {\n    return this[a] !== undefined ? this[a] : 0;\n};\nxhrCount.inc = function (a) {\n    this[a] = this.get(a) + 1;\n    return this.get(a);\n};\n\nconst _ = {\n    name: \"ajax\",\n    trigger: \".pat-ajax\",\n    parser: parser,\n    init($el) {\n        $el.off(\".pat-ajax\");\n        $el.filter(\"a\").on(\"click.pat-ajax\", _.onTriggerEvents);\n        $el.filter(\"form\")\n            .on(\"submit.pat-ajax\", _.onTriggerEvents)\n            .on(\"click.pat-ajax\", \"[type=submit]\", _.onClickSubmit);\n        $el.filter(\":not(form,a)\").each(function () {\n            log.warn(\"Unsupported element:\", this);\n        });\n        return $el;\n    },\n    destroy($el) {\n        $el.off(\".pat-ajax\");\n    },\n    onClickSubmit(event) {\n        const el = event.submitter || event.target;\n        const form = el.form;\n        const data = {};\n        if (el.name) {\n            data[el.name] = el.value;\n        }\n        $(form).data(\"pat-ajax.clicked-data\", data);\n    },\n    onTriggerEvents(event) {\n        if (event) {\n            event.preventDefault();\n        }\n        _.request($(this));\n    },\n    request($el, opts) {\n        return $el.each(function () {\n            _._request($(this), opts);\n        });\n    },\n    _request($el, opts) {\n        const cfg = _.parser.parse($el, opts);\n        const onError = function (jqxhr, status, error) {\n            // error can also stem from a javascript\n            // exception, not only errors described in the\n            // jqxhr.\n            log.error(\"load error for \" + cfg.url + \":\", error, jqxhr);\n            $el.trigger({\n                type: \"pat-ajax-error\",\n                jqxhr: jqxhr,\n            });\n        };\n        const seqNumber = xhrCount.inc(cfg.url);\n        const onSuccess = function (data, status, jqxhr) {\n            log.debug(\"success: jqxhr:\", jqxhr);\n            if (seqNumber === xhrCount.get(cfg.url)) {\n                // if this url is requested multiple time, only return the last result\n                $el.trigger({\n                    type: \"pat-ajax-success\",\n                    jqxhr: jqxhr,\n                });\n            } else {\n                // ignore\n            }\n        };\n        const temp = $el.data(\"pat-ajax.clicked-data\");\n        const clickedData = temp ? $.param(temp) : \"\";\n        const args = {\n            context: $el,\n            data: [$el.serialize(), clickedData].filter(Boolean).join(\"&\"),\n            headers: {},\n            url: cfg.url,\n            method: $el.attr(\"method\") ? $el.attr(\"method\") : \"GET\",\n            cache: cfg.browserCache === \"cache\" ? true : false,\n        };\n\n        if (cfg.accept) {\n            args.headers.Accept = cfg.accept;\n        }\n\n        if (\n            $el.is(\"form\") &&\n            $el.attr(\"method\") &&\n            $el.attr(\"method\").toUpperCase() == \"POST\"\n        ) {\n            const formdata = new FormData($el[0]);\n            for (const key in temp) {\n                formdata.append(key, temp[key]);\n            }\n            args[\"method\"] = \"POST\";\n            args[\"data\"] = formdata;\n            args[\"cache\"] = false;\n            args[\"contentType\"] = false;\n            args[\"processData\"] = false;\n            args[\"type\"] = \"POST\";\n        }\n\n        $el.removeData(\"pat-ajax.clicked-data\");\n        log.debug(\"request:\", args, $el[0]);\n\n        // Make it happen\n        const ajax_deferred = $.ajax(args);\n\n        if (ajax_deferred) ajax_deferred.done(onSuccess).fail(onError);\n    },\n};\n\nregistry.register(_);\n\nexport default _;\n","import \"../../core/jquery-ext\"; // for findInclusive\nimport \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport ajax from \"../ajax/ajax\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport registry from \"../../core/registry\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"pat.inject\");\n//log.setLevel(logging.Level.DEBUG);\n\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\n\nexport const parser = new Parser(\"inject\");\nparser.addArgument(\"default-selector\");\nparser.addArgument(\"target\");\nparser.addArgument(\"data-type\", \"html\");\nparser.addArgument(\"next-href\");\nparser.addArgument(\"source\");\nparser.addArgument(\"trigger\", \"default\", [\n    \"default\",\n    \"autoload\",\n    \"autoload-visible\",\n    \"idle\",\n]);\nparser.addArgument(\"delay\"); // only used in autoload\nparser.addArgument(\"browser-cache\", \"no-cache\", [\"cache\", \"no-cache\"]); // Cache ajax requests. Pass to pat-ajax.\nparser.addArgument(\"confirm\", \"class\", [\"never\", \"always\", \"form-data\", \"class\"]);\nparser.addArgument(\"confirm-message\", \"Are you sure you want to leave this page?\");\nparser.addArgument(\"loading-class\", \"injecting\"); // Add a class to the target while content is still loading.\nparser.addArgument(\"executing-class\", \"executing\"); // Add a class to the element while content is still loading.\nparser.addArgument(\"executed-class\", \"executed\"); // Add a class to the element when content is loaded.\nparser.addArgument(\"class\"); // Add a class to the injected content.\nparser.addArgument(\"history\", \"none\", [\"none\", \"record\"]);\nparser.addArgument(\"push-marker\");\nparser.addArgument(\"scroll\");\n// XXX: this should not be here but the parser would bail on\n// unknown parameters and expand/collapsible need to pass the url\n// to us\nparser.addArgument(\"url\");\n\nconst inject = {\n    name: \"inject\",\n    trigger: \"a.pat-inject, form.pat-inject, .pat-subform.pat-inject\",\n    parser: parser,\n\n    async init($el, opts) {\n        // We need to wait a tick. Modern BasePattern based patterns like\n        // pat-validation do always wait a tick before initializing. The\n        // patterns registry always initializes pat-validation first but since\n        // it is waiting a tick the event handlers are registerd after the ones\n        // from pat-inject. Waiting a tick in pat-inject solves this -\n        // pat-validation's event handlers are initialized first.\n        await utils.timeout(1);\n        const cfgs = this.extractConfig($el, opts);\n        if (cfgs.some((e) => e.history === \"record\") && !(\"pushState\" in history)) {\n            // if the injection shall add a history entry and HTML5 pushState\n            // is missing, then don't initialize the injection.\n            log.warn(\"HTML5 pushState is missing, aborting\");\n            return $el;\n        }\n        $el.data(\"pat-inject\", cfgs);\n\n        if (cfgs[0].nextHref && cfgs[0].nextHref.indexOf(\"#\") === 0) {\n            // In case the next href is an anchor, and it already\n            // exists in the page, we do not activate the injection\n            // but instead just change the anchors href.\n\n            // XXX: This is used in only one project for linked\n            // fullcalendars, it's sanity is wonky and we should\n            // probably solve it differently.\n            if ($el.is(\"a\") && $(cfgs[0].nextHref).length > 0) {\n                log.debug(\n                    \"Skipping as next href is anchor, which already exists\",\n                    cfgs[0].nextHref\n                );\n                // XXX: reconsider how the injection enters exhausted state\n                return $el.attr({\n                    href: (window.location.href.split(\"#\")[0] || \"\") + cfgs[0].nextHref,\n                });\n            }\n        }\n        if (cfgs[0].pushMarker) {\n            $(\"body\").on(\"push\", (event, data) => {\n                log.debug(\"received push message: \" + data);\n                if (data == cfgs[0].pushMarker) {\n                    log.debug(\"re-injecting \" + data);\n                    this.onTrigger({ currentTarget: $el[0] });\n                }\n            });\n        }\n        if (cfgs[0].idleTrigger) {\n            this._initIdleTrigger($el, cfgs[0].idleTrigger);\n        } else {\n            switch (cfgs[0].trigger) {\n                case \"default\":\n                    cfgs.forEach((cfg) => {\n                        if (cfg.delay) {\n                            cfg.processDelay = cfg.delay;\n                        }\n                    });\n                    // setup event handlers\n                    if ($el[0]?.tagName === \"FORM\") {\n                        log.debug(\"Initializing form with injection on\", $el[0]);\n                        events.add_event_listener(\n                            $el[0],\n                            \"submit\",\n                            \"pat-inject--form-submit\",\n                            (e) => {\n                                if (\n                                    e.submitter?.matches(\n                                        \"[type=submit], button:not([type=button]), [type=image]\"\n                                    )\n                                ) {\n                                    // make sure the submitting button is sent\n                                    // with the form\n                                    ajax.onClickSubmit(e);\n                                }\n                                this.onTrigger(e);\n                            }\n                        );\n                    } else if ($el.is(\".pat-subform\")) {\n                        log.debug(\"Initializing subform with injection\");\n                    } else {\n                        $el.on(\"click.pat-inject\", this.onTrigger.bind(this));\n                    }\n                    break;\n                case \"autoload\":\n                    if (!cfgs[0].delay) {\n                        this.onTrigger({ currentTarget: $el[0] });\n                    } else {\n                        // generate UID\n                        const uid = Math.random().toString(36);\n                        $el.attr(\"data-pat-inject-uid\", uid);\n\n                        // function to trigger the autoload and mark as triggered\n                        const delayed_trigger = (uid_) => {\n                            // Check if the element has been removed from the dom\n                            const still_there = $(\n                                \"[data-pat-inject-uid='\" + uid_ + \"']\"\n                            );\n                            if (still_there.length == 0) return false;\n\n                            $el.data(\"pat-inject-autoloaded\", true);\n                            this.onTrigger({ currentTarget: $el[0] });\n                            return true;\n                        };\n                        window.setTimeout(\n                            delayed_trigger.bind(null, uid),\n                            cfgs[0].delay\n                        );\n                    }\n                    break;\n                case \"autoload-visible\":\n                    this._initAutoloadVisible($el, cfgs);\n                    break;\n                case \"idle\":\n                    this._initIdleTrigger($el, cfgs[0].delay);\n                    break;\n            }\n        }\n\n        log.debug(\"initialised:\", $el);\n        return $el;\n    },\n\n    destroy($el) {\n        $el.off(\".pat-inject\");\n        $el.data(\"pat-inject\", null);\n        return $el;\n    },\n\n    onTrigger(e) {\n        /* Injection has been triggered, either via form submission or a\n         * link has been clicked.\n         */\n\n        // Prevent the original event from doing it's work.\n        // We want an AJAX request instead.\n        e.preventDefault && e.preventDefault();\n\n        const $el = $(e.currentTarget);\n        let cfgs = $el.data(\"pat-inject\");\n        if ($el[0].tagName === \"FORM\" && e.type === \"submit\") {\n            if ($el[0].matches(\":invalid\")) {\n                // Do not submit invalid forms.\n                // Works with native form validation and with pat-validation.\n                log.debug(\"Form is invalid, aborting\");\n                return;\n            }\n\n            const submitter = e.submitter;\n            const formaction = submitter?.getAttribute(\"formaction\");\n            if (formaction) {\n                const opts = {\n                    url: formaction,\n                };\n\n                // Support custom data-pat-inject on formaction buttons.\n                const cfg_node = submitter.closest(\"[data-pat-inject]\");\n                cfgs = this.extractConfig($(cfg_node), opts);\n            }\n\n            for (const cfg of cfgs) {\n                cfg.params = $.param($el.serializeArray());\n            }\n        }\n\n        $el.trigger(\"patterns-inject-triggered\");\n        this.execute(cfgs, $el);\n    },\n\n    submitSubform($sub) {\n        /* This method is called from pat-subform\n         */\n        const $el = $sub.parents(\"form\");\n        const cfgs = $sub.data(\"pat-inject\");\n\n        // store the params of the subform in the config, to be used by history\n        $(cfgs).each((i, v) => {\n            v.params = $.param($sub.serializeArray());\n        });\n\n        try {\n            $el.trigger(\"patterns-inject-triggered\");\n        } catch (e) {\n            log.error(\"patterns-inject-triggered\", e);\n        }\n        this.execute(cfgs, $el);\n    },\n\n    extractConfig($el, opts) {\n        opts = $.extend({}, opts);\n\n        const cfgs = parser.parse($el, opts, true);\n        cfgs.forEach((cfg) => {\n            cfg.$context = $el;\n            // opts and cfg have priority, fall back to href/action\n            cfg.url =\n                opts.url ||\n                cfg.url ||\n                $el.attr(\"href\") ||\n                $el.attr(\"action\") ||\n                $el.parents(\"form\").attr(\"action\") ||\n                \"\";\n\n            // separate selector from url\n            const urlparts = cfg.url.split(\"#\");\n            cfg.url = urlparts[0];\n\n            if (urlparts.length > 2) {\n                log.warn(\"Ignoring additional source ids:\", urlparts.slice(2));\n            }\n\n            if (!cfg.defaultSelector) {\n                // if no selector, check for selector as part of original url\n                cfg.defaultSelector = (urlparts[1] && \"#\" + urlparts[1]) || \"body\";\n            }\n            if (cfg.delay) {\n                try {\n                    cfg.delay = utils.parseTime(cfg.delay);\n                } catch (e) {\n                    log.warn(\"Invalid delay value: \", cfg.delay);\n                    cfg.delay = null;\n                }\n            }\n            cfg.processDelay = 0;\n        });\n        return cfgs;\n    },\n\n    elementIsDirty(m) {\n        /* Check whether the passed in form element contains a value.\n         */\n        const data = $.map(m.find(\":input:not(select)\"), (i) => {\n            const val = $(i).val();\n            return Boolean(val) && val !== $(i).attr(\"placeholder\");\n        });\n        return $.inArray(true, data) !== -1;\n    },\n\n    askForConfirmation(cfgs) {\n        /* If configured to do so, show a confirmation dialog to the user.\n         * This is done before attempting to perform injection.\n         */\n        let should_confirm = false;\n        let message;\n\n        for (const cfg of cfgs) {\n            let _confirm = false;\n            if (cfg.confirm == \"always\") {\n                _confirm = true;\n            } else if (\n                cfg.confirm === \"form-data\" &&\n                cfg.target &&\n                cfg.target !== \"none\"\n            ) {\n                _confirm = this.elementIsDirty(cfg.$target);\n            } else if (cfg.confirm === \"class\" && cfg.target && cfg.target !== \"none\") {\n                _confirm = cfg.$target.hasClass(\"is-dirty\");\n            }\n            if (_confirm) {\n                should_confirm = true;\n                message = cfg.confirmMessage;\n            }\n        }\n        if (should_confirm) {\n            if (!window.confirm(message)) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    ensureTarget(cfg) {\n        /* Make sure that a target element exists and that it's assigned to\n         * cfg.$target.\n         */\n        // make sure target exist\n        if (cfg.target === \"none\") {\n            // special case, we don't want to inject anything\n            return true;\n        }\n        cfg.$target =\n            cfg.$target || (cfg.target === \"self\" ? cfg.$context : $(cfg.target));\n        if (cfg.$target.length === 0) {\n            if (!cfg.target) {\n                log.error(\"Need target selector\", cfg);\n                return false;\n            }\n            cfg.$target = this.createTarget(cfg.target);\n            cfg.$injected = cfg.$target;\n        }\n        return true;\n    },\n\n    verifySingleConfig(url, cfg) {\n        /* Verify one of potentially multiple configs (i.e. argument lists).\n         *\n         * Extract modifiers such as ::element or ::after.\n         * Ensure that a target element exists.\n         */\n        if (cfg.url !== url) {\n            // in case of multi-injection, all injections need to use\n            // the same url\n            log.error(\"Unsupported different urls for multi-inject\");\n            return false;\n        }\n        // defaults\n        cfg.source = cfg.source || cfg.defaultSelector;\n        cfg.target = cfg.target || cfg.defaultSelector;\n\n        if (!this.extractModifiers(cfg)) {\n            return false;\n        }\n        if (!this.ensureTarget(cfg)) {\n            return false;\n        }\n        this.listenForFormReset(cfg);\n        return true;\n    },\n\n    verifyConfig(cfgs) {\n        /* Verify and post-process all the configurations.\n         * Each \"config\" is an arguments list separated by the &&\n         * combination operator.\n         *\n         * In case of multi-injection, only one URL is allowed, which\n         * should be specified in the first config (i.e. arguments list).\n         *\n         * Verification for each cfg in the array needs to succeed.\n         */\n        return cfgs.every((cfg) => this.verifySingleConfig(cfgs[0].url, cfg));\n    },\n\n    listenForFormReset(cfg) {\n        /* if pat-inject is used to populate target in some form and when\n         * Cancel button is pressed (this triggers reset event on the\n         * form) you would expect to populate with initial placeholder\n         */\n        if (cfg.target === \"none\")\n            // Special case, we don't want to display any return value.\n            return;\n        const $form = cfg.$target.parents(\"form\");\n        if ($form.length !== 0 && cfg.$target.data(\"initial-value\") === undefined) {\n            cfg.$target.data(\"initial-value\", cfg.$target.html());\n            $form.on(\"reset\", () => {\n                cfg.$target.html(cfg.$target.data(\"initial-value\"));\n            });\n        }\n    },\n\n    extractModifiers(cfg) {\n        /* The user can add modifiers to the source and target arguments.\n         * Modifiers such as ::element, ::before and ::after.\n         * We identifiy and extract these modifiers here.\n         */\n        const source_re = /^(.*?)(::element)?$/;\n        const target_re = /^(.*?)(::element)?(::after|::before)?$/;\n        const source_match = source_re.exec(cfg.source);\n        const target_match = target_re.exec(cfg.target);\n\n        cfg.source = source_match[1];\n        cfg.sourceMod = source_match[2] ? \"element\" : \"content\";\n        cfg.target = target_match[1];\n        const targetMod = target_match[2] ? \"element\" : \"content\";\n        const targetPosition = (target_match[3] || \"::\").slice(2); // position relative to target\n\n        if (cfg.loadingClass) {\n            cfg.loadingClass += \" \" + cfg.loadingClass + \"-\" + targetMod;\n            if (targetPosition && cfg.loadingClass) {\n                cfg.loadingClass += \" \" + cfg.loadingClass + \"-\" + targetPosition;\n            }\n        }\n        cfg.action = targetMod + targetPosition;\n        // Once we start detecting illegal combinations, we'll\n        // return false in case of error\n        return true;\n    },\n\n    createTarget(selector) {\n        /* create a target that matches the selector\n         *\n         * XXX: so far we only support #target and create a div with\n         * that id appended to the body.\n         */\n        if (selector.slice(0, 1) !== \"#\") {\n            log.error(\"only id supported for non-existing target\");\n            return null;\n        }\n        const $target = $(\"<div />\").attr({ id: selector.slice(1) });\n        $(\"body\").append($target);\n        return $target;\n    },\n\n    _performInjection(target, $el, $source, cfg, trigger, title) {\n        /* Called after the XHR has succeeded and we have a new $source\n         * element to inject.\n         */\n        if (cfg.sourceMod === \"content\") {\n            $source = $source.contents();\n        }\n        let $src;\n        $src = $source.safeClone();\n        $src.findInclusive(\"img\").on(\"load\", (e) => {\n            $(e.currentTarget).trigger(\"pat-inject-content-loaded\");\n        });\n\n        const $injected = cfg.$injected || $src;\n        // Now the injection actually happens.\n        if (this._inject(trigger, $src, $(target), cfg)) {\n            // Update history\n            this._update_history(cfg, trigger, title);\n            // Post-injection\n            this._afterInjection($el, $injected, cfg);\n        }\n    },\n\n    _update_history(cfg, trigger, title) {\n        // History support. if subform is submitted, append form params\n        const glue = cfg.url.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n        if (cfg.history === \"record\" && \"pushState\" in history) {\n            if (cfg.params) {\n                history.pushState(\n                    { url: cfg.url + glue + cfg.params },\n                    \"\",\n                    cfg.url + glue + cfg.params\n                );\n            } else {\n                history.pushState({ url: cfg.url }, \"\", cfg.url);\n            }\n            // Also inject title element if we have one\n            if (title)\n                this._inject(trigger, title, $(\"title\"), {\n                    action: \"element\",\n                });\n        }\n    },\n\n    _afterInjection($el, $injected, cfg) {\n        /* Set a class on the injected elements and fire the\n         * patterns-injected event.\n         */\n        $injected\n            .filter((idx, el_) => {\n                return el_.nodeType !== TEXT_NODE;\n            })\n            .data(\"pat-injected\", { origin: cfg.url });\n\n        if ($injected.length === 1 && $injected[0].nodeType == TEXT_NODE) {\n            // Only one element injected, and it was a text node.\n            // So we trigger \"patterns-injected\" on the parent.\n            // The event handler should check whether the\n            // injected element and the triggered element are\n            // the same.\n            $injected.parent().trigger(\"patterns-injected\", [cfg, $el[0], $injected[0]]);\n        } else {\n            $injected.each((idx, el_) => {\n                // patterns-injected event will be triggered for each injected (non-text) element.\n                if (el_.nodeType !== TEXT_NODE) {\n                    $(el_)\n                        .addClass(cfg[\"class\"])\n                        .trigger(\"patterns-injected\", [cfg, $el[0], el_]);\n                }\n            });\n        }\n\n        if (cfg.scroll && cfg.scroll !== \"none\") {\n            // Get the scroll target for\n            // 1) finding the scroll container\n            // 2) getting the element to scroll to (if not \"top\")\n            const scroll_target = [\"top\", \"target\"].includes(cfg.scroll)\n                ? cfg.$target[0]\n                : $injected.findInclusive(cfg.scroll)[0];\n\n            const scroll_container = dom.find_scroll_container(\n                scroll_target,\n                null,\n                window\n            );\n\n            if (cfg.scroll === \"top\") {\n                dom.scroll_to_top(scroll_container);\n            } else if (scroll_target) {\n                dom.scroll_to_element(scroll_target, scroll_container);\n            }\n        }\n\n        $el[0].dispatchEvent(\n            new Event(\"pat-inject-success\", { bubbles: true, cancelable: true })\n        );\n    },\n\n    async _onInjectSuccess($el, cfgs, ev) {\n        let data = ev?.jqxhr?.responseText;\n        if (!data) {\n            log.warn(\"No response content, aborting\", ev);\n            return;\n        }\n        if (cfgs[0].source === \"none\") {\n            // Special case, we want to call something, but we don't want to inject anything\n            data = \"\";\n        }\n        const sources$ = await this.callTypeHandler(cfgs[0].dataType, \"sources\", $el, [\n            cfgs,\n            data,\n            ev,\n        ]);\n        /* pick the title source for dedicated handling later\n          Title - if present - is always appended at the end. */\n        let title;\n        if (\n            sources$ &&\n            sources$[sources$.length - 1] &&\n            sources$[sources$.length - 1][0] &&\n            sources$[sources$.length - 1][0].nodeName == \"TITLE\"\n        ) {\n            title = sources$[sources$.length - 1];\n        }\n        cfgs.forEach((cfg, idx1) => {\n            const perform_inject = () => {\n                if (cfg.target !== \"none\")\n                    cfg.$target.each((idx2, target) => {\n                        this._performInjection(\n                            target,\n                            $el,\n                            sources$[idx1],\n                            cfg,\n                            ev.target,\n                            title\n                        );\n                    });\n            };\n            if (cfg.processDelay) {\n                setTimeout(() => perform_inject(), cfg.processDelay);\n            } else {\n                perform_inject();\n            }\n        });\n        if (cfgs[0].nextHref && $el.is(\"a\")) {\n            // In case next-href is specified the anchor's href will\n            // be set to it after the injection is triggered.\n            $el.attr({ href: cfgs[0].nextHref.replace(/&amp;/g, \"&\") });\n            this.destroy($el);\n        }\n        $el.off(\"pat-ajax-success.pat-inject\");\n        $el.off(\"pat-ajax-error.pat-inject\");\n    },\n\n    async _onInjectError($el, cfgs, event) {\n        let explanation = \"\";\n        const status = event.jqxhr.status;\n        const timestamp = new Date();\n        if (status % 100 == 4) {\n            explanation =\n                \"Sorry! We couldn't find the page to load. Please make a screenshot and send it to support. Thank you!\";\n        } else if (status % 100 == 5) {\n            explanation =\n                \"I am very sorry! There was an error at the server. Please make a screenshot and contact support. Thank you!\";\n        } else if (status == 0) {\n            explanation =\n                \"It seems, the server is down. Please make a screenshot and contact support. Thank you!\";\n        }\n\n        let error_page;\n        let error_page_fragment;\n        const url_params = new URLSearchParams(window.location.search);\n        if (url_params.get(\"pat-inject-errorhandler.off\") === null) {\n            // Prepare a error page to be injected into the document.\n\n            // Try to get a suitable error message from pre-configured error pages.\n            const error_page_url = document\n                ?.querySelector(`meta[name^=pat-inject-status-${status}]`)\n                ?.getAttribute(\"content\", false);\n            error_page_fragment = error_page_url?.split(\"#\")[1];\n            error_page_fragment = error_page_fragment ? `#${error_page_fragment}` : null;\n\n            if (error_page_fragment) {\n                error_page = document.createElement(\"html\");\n                error_page.innerHTML = event.jqxhr.responseText;\n                error_page = error_page.querySelector(error_page_fragment);\n            }\n\n            if (!error_page && error_page_url) {\n                try {\n                    const error_page_response = await fetch(error_page_url, {\n                        method: \"GET\",\n                    });\n                    error_page = document.createElement(\"html\");\n                    error_page.innerHTML = await error_page_response.text();\n                    error_page = error_page.querySelector(error_page_fragment || \"body\");\n                } catch {\n                    // fall back to standard error message and ignore.\n                }\n            }\n        }\n\n        // clean up\n        cfgs.forEach((cfg) => {\n            if (\"$injected\" in cfg) {\n                cfg.$injected.remove();\n            }\n            cfg.$target.removeClass(cfg.loadingClass);\n            $el.removeClass(cfg.executingClass);\n        });\n        $el.off(\"pat-ajax-success.pat-inject\");\n        $el.off(\"pat-ajax-error.pat-inject\");\n\n        if (error_page) {\n            const error_zone = document.querySelector(error_page_fragment || \"body\");\n            error_zone.innerHTML = error_page.innerHTML;\n            registry.scan(error_zone); // initialize any patterns in error page\n        } else {\n            const msg_attr = `${explanation} Status is ${status} ${event.jqxhr.statusText}, time was ${timestamp}. You can click to close this.`;\n            $(\"body\").attr(\"data-error-message\", msg_attr);\n            $(\"body\").on(\"click\", () => {\n                $(\"body\").removeAttr(\"data-error-message\");\n                window.location.href = window.location.href; // reload\n            });\n        }\n    },\n\n    execute(cfgs, $el) {\n        /* Actually execute the injection.\n         *\n         * Either by making an ajax request or by spoofing an ajax\n         * request when the content is readily available in the current page.\n         */\n        // get a kinda deep copy, we scribble on it\n        cfgs = cfgs.map((cfg) => $.extend({}, cfg));\n        if (!this.verifyConfig(cfgs)) {\n            return;\n        }\n        if (!this.askForConfirmation(cfgs)) {\n            return;\n        }\n        if ($el.data(\"pat-inject-triggered\")) {\n            // Prevent double triggers;\n            return;\n        }\n        $el.data(\"pat-inject-triggered\", true);\n\n        for (const cfg of cfgs) {\n            // Add a execute class on the pat-inject element.\n            if (cfg?.executingClass) {\n                $el[0].classList.add(cfg.executingClass);\n            }\n            // Add a loading class to the target.\n            // Can be used for loading-spinners.\n            if (cfg?.loadingClass && cfg?.target !== \"none\") {\n                cfg.$target.addClass(cfg.loadingClass);\n            }\n        }\n\n        $el.on(\"pat-ajax-success.pat-inject\", async (e) => {\n            this._onInjectSuccess($el, cfgs, e);\n\n            // Wait for the next tick to ensure that the close-panel listener\n            // is called before this one, even for non-async local injects.\n            await utils.timeout(1);\n            // Remove the close-panel event listener.\n            events.remove_event_listener($el[0], \"pat-inject--close-panel\");\n            // Only close the panel if a close-panel event was catched previously.\n            if (do_close_panel) {\n                do_close_panel = false;\n                // Re-trigger close-panel event if it was caught while injection was in progress.\n                $el[0].dispatchEvent(\n                    new Event(\"close-panel\", { bubbles: true, cancelable: true })\n                );\n            }\n        });\n        $el.on(\"pat-ajax-error.pat-inject\", this._onInjectError.bind(this, $el, cfgs));\n        $el.on(\"pat-ajax-success.pat-inject pat-ajax-error.pat-inject\", () =>\n            $el.removeData(\"pat-inject-triggered\")\n        );\n\n        // Prevent closing the panel while injection is in progress.\n        let do_close_panel = false;\n        events.add_event_listener(\n            $el[0],\n            \"close-panel\",\n            \"pat-inject--close-panel\",\n            (e) => {\n                e.stopPropagation();\n                e.stopImmediatePropagation();\n                do_close_panel = true;\n            }\n        );\n\n        if (cfgs[0].url.length) {\n            ajax.request($el, {\n                \"url\": cfgs[0].url,\n                \"browser-cache\": cfgs[0].browserCache,\n            });\n        } else {\n            // If there is no url specified, then content is being fetched\n            // from the same page.\n            // No need to do an ajax request for this, so we spoof the ajax\n            // event.\n            $el.trigger({\n                type: \"pat-ajax-success\",\n                jqxhr: {\n                    responseText: $(\"body\").html(),\n                },\n            });\n        }\n    },\n\n    _inject(trigger, $source, $target, cfg) {\n        // action to jquery method mapping, except for \"content\"\n        // and \"element\"\n        const method = {\n            contentbefore: \"prepend\",\n            contentafter: \"append\",\n            elementbefore: \"before\",\n            elementafter: \"after\",\n        }[cfg.action];\n\n        if (cfg.source === \"none\") {\n            $target.replaceWith(\"\");\n            return true;\n        }\n        if ($source.length === 0) {\n            log.warn(\"Aborting injection, source not found:\", $source);\n            $(trigger).trigger(\"pat-inject-missingSource\", {\n                url: cfg.url,\n                selector: cfg.source,\n            });\n            return false;\n        }\n        if (cfg.target === \"none\")\n            // Special case. Don't do anything, we don't want any result\n            return true;\n        if ($target.length === 0) {\n            log.warn(\"Aborting injection, target not found:\", $target);\n            $(trigger).trigger(\"pat-inject-missingTarget\", {\n                selector: cfg.target,\n            });\n            return false;\n        }\n        if (cfg.action === \"content\") {\n            $target.empty().append($source);\n        } else if (cfg.action === \"element\") {\n            $target.replaceWith($source);\n        } else {\n            $target[method]($source);\n        }\n        return true;\n    },\n\n    _sourcesFromHtml(html, url, sources) {\n        const $html = this._parseRawHtml(html, url);\n        return sources.map((source) => {\n            if (source === \"body\") {\n                source = \"#__original_body\";\n            }\n            if (source === \"none\") {\n                return $(\"<!-- -->\");\n            }\n            const $source = $html.find(source);\n\n            if ($source.length === 0) {\n                if (source != \"title\") {\n                    log.warn(\"No source elements for selector:\", source, $html);\n                }\n            }\n\n            $source.find('a[href^=\"#\"]').each((idx, el_) => {\n                const href = el_.getAttribute(\"href\");\n                if (href.indexOf(\"#{1}\") !== -1) {\n                    // We ignore hrefs containing #{1} because they're not\n                    // valid and only applicable in the context of\n                    // pat-clone.\n                    return;\n                }\n                // Skip in-document links pointing to an id that is inside\n                // this fragment.\n                if (href.length === 1) {\n                    // Special case for top-of-page links\n                    el_.href = url;\n                } else if (!$source.find(href).length) {\n                    el_.href = url + href;\n                }\n            });\n            return $source;\n        });\n    },\n\n    _rebaseAttrs: {\n        A: \"href\",\n        FORM: \"action\",\n        IMG: \"data-pat-inject-rebase-src\",\n        OBJECT: \"data\",\n        SOURCE: \"data-pat-inject-rebase-src\",\n        VIDEO: \"data-pat-inject-rebase-src\",\n    },\n\n    _rebaseOptions: {\n        \"calendar\": [\"url\", \"event-sources\"],\n        \"collapsible\": [\"load-content\"],\n        \"date-picker\": [\"i18n\"],\n        \"datetime-picker\": [\"i18n\"],\n        \"inject\": [\"url\"],\n    },\n\n    _rebaseURL(base, url) {\n        if (url.indexOf(\"://\") !== -1 || url[0] === \"/\" || url.indexOf(\"data:\") === 0) {\n            return url;\n        }\n        base = new URL(base, window.location).href; // If base is relative make it absolute.\n        return base.slice(0, base.lastIndexOf(\"/\") + 1) + url;\n    },\n\n    _rebaseHTML(base, html) {\n        if (html === \"\") {\n            // Special case, source is none\n            return \"\";\n        }\n        const $page = $(\n            html.replace(/(\\s)(src\\s*)=/gi, '$1src=\"\" data-pat-inject-rebase-$2=').trim()\n        )\n            .wrapAll(\"<div>\")\n            .parent();\n\n        $page.find(Object.keys(this._rebaseAttrs).join(\",\")).each((idx, el_) => {\n            const $el_ = $(el_);\n            const attrName = this._rebaseAttrs[el_.tagName];\n            let value = $el_.attr(attrName);\n\n            if (\n                value &&\n                value.slice(0, 2) !== \"@@\" &&\n                value[0] !== \"#\" &&\n                value.slice(0, 7) !== \"mailto:\" &&\n                value.slice(0, 4) !== \"tel:\" &&\n                value.slice(0, 4) !== \"fax:\" &&\n                value.slice(0, 7) !== \"callto:\" &&\n                value.slice(0, 10) !== \"ts3server:\" &&\n                value.slice(0, 6) !== \"teams:\" &&\n                value.slice(0, 11) !== \"javascript:\"\n            ) {\n                value = this._rebaseURL(base, value);\n                $el_.attr(attrName, value);\n            }\n        });\n\n        for (const [pattern_name, opts] of Object.entries(this._rebaseOptions)) {\n            for (const el_ of dom.querySelectorAllAndMe(\n                $page[0],\n                `[data-pat-${pattern_name}]`\n            )) {\n                const pattern = registry.patterns?.[pattern_name];\n                const pattern_parser = pattern?.parser;\n                if (!pattern_parser) {\n                    continue;\n                }\n                // parse: no default options, possibly multiple configs, no grouping.\n                const options = pattern_parser.parse(el_, {}, true, false, false);\n                let changed = false;\n                for (const config of options) {\n                    for (const opt of opts) {\n                        const val = config[opt];\n                        if (!val) {\n                            continue;\n                        }\n                        changed = true;\n                        if (Array.isArray(val)) {\n                            config[opt] = val.map((it) => this._rebaseURL(base, it));\n                        } else {\n                            config[opt] = this._rebaseURL(base, val);\n                        }\n                    }\n                }\n                if (changed) {\n                    el_.setAttribute(\n                        `data-pat-${pattern_name}`,\n                        JSON.stringify(options.length === 1 ? options[0] : options)\n                    );\n                }\n            }\n        }\n\n        return $page\n            .html()\n            .replace(/src=\"\" data-pat-inject-rebase-/g, \"\")\n            .trim();\n    },\n\n    _parseRawHtml(html, url = \"\") {\n        // remove script tags and head and replace body by a div\n        const title = html.match(/\\<title\\>(.*)\\<\\/title\\>/);\n        let clean_html = html\n            .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, \"\")\n            .replace(/<head\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/head>/gi, \"\")\n            .replace(/<body([^>]*?)>/gi, '<div id=\"__original_body\">')\n            .replace(/<\\/body([^>]*?)>/gi, \"</div>\");\n        if (title && title.length == 2) {\n            clean_html = title[0] + clean_html;\n        }\n        try {\n            clean_html = this._rebaseHTML(url, clean_html);\n        } catch (e) {\n            log.error(\"Error rebasing urls\", e);\n        }\n        const $html = $(\"<div/>\").html(clean_html);\n        if ($html.children().length === 0) {\n            log.warn(\"Parsing html resulted in empty jquery object:\", clean_html);\n        }\n        return $html;\n    },\n\n    _initAutoloadVisible($el, cfgs) {\n        if ($el.data(\"pat-inject-autoloaded\")) {\n            // ignore executed autoloads\n            return false;\n        }\n\n        const el = $el[0];\n\n        // delay: default is 200ms to allow scrolling over and past autoload-visible elements without loading them.\n        const delay = cfgs[0].delay || 200;\n        log.debug(`Delay time: ${delay}`);\n\n        // function to trigger the autoload and mark as triggered\n        const trigger = (event) => {\n            if ($el.data(\"pat-inject-autoloaded\")) {\n                log.debug(`autoload-visible trigger skipped ${el}`);\n                return false;\n            }\n            $el.data(\"pat-inject-autoloaded\", true);\n            this.onTrigger({ currentTarget: el });\n            event && event.preventDefault();\n            log.debug(`autoload-visible trigger run ${el}`);\n            return true;\n        };\n\n        // Config see: https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n        const intersection_observer_config = {\n            threshold: 0, // If even one pixel is visible, the callback will be run.\n            root: null, // Root is browser viewport. If the element is visible to the user, the callback will be run.\n            margin: \"0px\", // No margins. The element is not preloaded.\n        };\n\n        let timeout_id = null;\n        const observer = new IntersectionObserver((entries) => {\n            for (const entry of entries) {\n                if (entry.isIntersecting) {\n                    // Run the callback after 200ms to prevent loading all\n                    // visible elements when scrolling over.\n                    timeout_id = window.setTimeout(() => {\n                        observer.disconnect(); // Stop observing loaded elements.\n                        trigger();\n                    }, delay);\n                    log.debug(`autoload-visible intersecting ${el}`);\n                } else {\n                    window.clearTimeout(timeout_id);\n                    log.debug(`autoload-visible not intersecting ${el}`);\n                }\n            }\n        }, intersection_observer_config);\n        observer.observe(el);\n    },\n\n    _initIdleTrigger($el, delay) {\n        // XXX TODO: handle item removed from DOM\n        const timeout = parseInt(delay, 10);\n        let timer;\n\n        const onTimeout = () => {\n            this.onTrigger({ currentTarget: $el[0] });\n            unsub();\n            clearTimeout(timer);\n        };\n\n        const onInteraction = utils.debounce(() => {\n            if (!document.body.contains($el[0])) {\n                unsub();\n                return;\n            }\n            clearTimeout(timer);\n            timer = setTimeout(onTimeout, timeout);\n        }, timeout);\n\n        const unsub = () => {\n            [\"scroll\", \"resize\"].forEach((e) =>\n                window.removeEventListener(e, onInteraction)\n            );\n            [\n                \"click\",\n                \"keypress\",\n                \"keyup\",\n                \"mousemove\",\n                \"touchstart\",\n                \"touchend\",\n            ].forEach((e) => document.removeEventListener(e, onInteraction));\n        };\n\n        onInteraction();\n\n        [\"scroll\", \"resize\"].forEach((e) => window.addEventListener(e, onInteraction));\n        [\"click\", \"keypress\", \"keyup\", \"mousemove\", \"touchstart\", \"touchend\"].forEach(\n            (e) => document.addEventListener(e, onInteraction)\n        );\n    },\n\n    // XXX: simple so far to see what the team thinks of the idea\n    registerTypeHandler(type, handler) {\n        this.handlers[type] = handler;\n    },\n\n    async callTypeHandler(type, fn, context, params) {\n        type = type || \"html\";\n        if (this.handlers[type] && $.isFunction(this.handlers[type][fn])) {\n            return await this.handlers[type][fn].bind(this)(...params);\n        } else {\n            return null;\n        }\n    },\n\n    handlers: {\n        html: {\n            sources(cfgs, data) {\n                const sources = cfgs.map((cfg) => cfg.source);\n                sources.push(\"title\");\n                return this._sourcesFromHtml(data, cfgs[0].url, sources);\n            },\n        },\n    },\n};\n\n$(document).on(\"patterns-injected.inject\", async (ev, cfg, trigger, injected) => {\n    /* Listen for the patterns-injected event.\n     *\n     * Remove the \"loading-class\" classes from all injection targets and\n     * then scan the injected content for new patterns.\n     */\n    if (cfg && cfg.skipPatInjectHandler) {\n        // Allow skipping this handler but still have other handlers in other\n        // patterns listen to ``patterns-injected``.\n        return;\n    }\n    if (cfg) {\n        cfg.$target.removeClass(cfg.loadingClass);\n        // Remove the executing class, add the executed class to the element with pat.inject on it.\n        $(trigger).removeClass(cfg.executingClass).addClass(cfg.executedClass);\n    }\n    if (injected.nodeType !== TEXT_NODE && injected.nodeType !== COMMENT_NODE) {\n        registry.scan(injected, null, { type: \"injection\", element: trigger });\n        $(injected).trigger(\"patterns-injected-scanned\");\n\n        await utils.timeout(10); // Wait a bit before dispatching next event.\n        injected.dispatchEvent(\n            new CustomEvent(\"patterns-injected-delayed\", {\n                bubbles: true,\n                cancelable: true,\n                detail: {\n                    injected: injected,\n                },\n            })\n        );\n    }\n});\n\n$(window).on(\"popstate\", (event) => {\n    // popstate also triggers on traditional anchors\n    if (!event.originalEvent.state && \"replaceState\" in history) {\n        try {\n            history.replaceState(\"anchor\", \"\", document.location.href);\n        } catch (e) {\n            log.debug(e);\n        }\n        return;\n    }\n    // Not only change the URL, also reload the page.\n    window.location.reload();\n});\n\n// this entry ensures that the initally loaded page can be reached with\n// the back button\nif (\"replaceState\" in history) {\n    try {\n        history.replaceState(\"pageload\", \"\", document.location.href);\n    } catch (e) {\n        log.debug(e);\n    }\n}\n\nregistry.register(inject);\nexport default inject;\n","import $ from \"jquery\";\nimport Base from \"../../core/base\";\nimport utils from \"../../core/utils\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\n\nconst log = logging.getLogger(\"depends\");\n\nexport const parser = new Parser(\"depends\");\nparser.addArgument(\"condition\");\nparser.addArgument(\"action\", \"show\", [\"show\", \"enable\", \"both\"]);\nparser.addArgument(\"transition\", \"none\", [\"none\", \"css\", \"fade\", \"slide\"]);\nparser.addArgument(\"effect-duration\", \"fast\");\nparser.addArgument(\"effect-easing\", \"swing\");\n\nexport default Base.extend({\n    name: \"depends\",\n    trigger: \".pat-depends\",\n    jquery_plugin: true,\n\n    async init($el, opts) {\n        const DependsHandler = (await import(\"../../lib/dependshandler\")).default; // prettier-ignore\n\n        const dependent = this.$el[0];\n        const options = parser.parse(this.$el, opts);\n        this.$modal = this.$el.parents(\".pat-modal\");\n\n        let handler;\n        try {\n            handler = new DependsHandler(this.$el, options.condition);\n        } catch (e) {\n            log.error(\"Invalid condition: \" + e.message, dependent);\n            return;\n        }\n\n        let state = handler.evaluate();\n        switch (options.action) {\n            case \"show\":\n                utils.hideOrShow($el, state, options, this.name);\n                this.updateModal();\n                break;\n            case \"enable\":\n                if (state) this.enable();\n                else this.disable();\n                break;\n            case \"both\":\n                if (state) {\n                    utils.hideOrShow($el, state, options, this.name);\n                    this.updateModal();\n                    this.enable();\n                } else {\n                    utils.hideOrShow($el, state, options, this.name);\n                    this.updateModal();\n                    this.disable();\n                }\n                break;\n        }\n\n        const data = {\n            handler: handler,\n            options: options,\n            dependent: dependent,\n        };\n\n        for (let input of handler.getAllInputs()) {\n            if (input.form) {\n                let $form = $(input.form);\n                let dependents = $form.data(\"patDepends.dependents\");\n                if (!dependents) {\n                    dependents = [data];\n                    $form.on(\"reset.pat-depends\", () => this.onReset);\n                } else if (dependents.indexOf(data) === -1) dependents.push(data);\n                $form.data(\"patDepends.dependents\", dependents);\n            }\n            $(input).on(\"change.pat-depends\", null, data, this.onChange.bind(this));\n            $(input).on(\"keyup.pat-depends\", null, data, this.onChange.bind(this));\n        }\n    },\n\n    async onReset(event) {\n        const dependents = $(event.target).data(\"patDepends.dependents\");\n        await utils.timeout(50);\n        for (let dependent of dependents) {\n            event.data = dependent;\n            this.onChange(event);\n        }\n    },\n\n    updateModal() {\n        // If we're in a modal, make sure that it gets resized.\n        if (this.$modal.length) {\n            $(document).trigger(\"pat-update\", { pattern: \"depends\" });\n        }\n    },\n\n    enable() {\n        if (this.$el.is(\":input\")) {\n            this.$el[0].disabled = null;\n        } else if (this.$el.is(\"a\")) {\n            this.$el.off(\"click.patternDepends\");\n        }\n        this.$el.removeClass(\"disabled\");\n        this.$el.trigger(\"pat-update\", {\n            pattern: \"depends\",\n            action: \"attribute-changed\",\n            dom: this.$el[0],\n            enabled: true,\n        });\n    },\n\n    disable() {\n        if (this.$el.is(\":input\")) {\n            this.$el[0].disabled = \"disabled\";\n        } else if (this.$el.is(\"a\")) {\n            this.$el.on(\"click.patternDepends\", (e) => e.preventDefault());\n        }\n        this.$el.addClass(\"disabled\");\n        this.$el.trigger(\"pat-update\", {\n            pattern: \"depends\",\n            action: \"attribute-changed\",\n            dom: this.$el[0],\n            enabled: false,\n        });\n    },\n\n    onChange(event) {\n        const handler = event.data.handler;\n        const options = event.data.options;\n        const dependent = event.data.dependent;\n        const $depdendent = $(dependent);\n        const state = handler.evaluate();\n\n        switch (options.action) {\n            case \"show\":\n                utils.hideOrShow($depdendent, state, options, this.name);\n                this.updateModal();\n                break;\n            case \"enable\":\n                if (state) {\n                    this.enable();\n                } else {\n                    this.disable();\n                }\n                break;\n            case \"both\":\n                utils.hideOrShow($depdendent, state, options, this.name);\n                this.updateModal();\n                if (state) {\n                    this.enable();\n                } else {\n                    this.disable();\n                }\n                break;\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"autotoc\",\n    trigger: \".pat-autotoc\",\n    parser: \"mockup\",\n    defaults: {\n        section: \"section\",\n        levels: \"h1,h2,h3\",\n        IDPrefix: \"autotoc-item-\",\n        classTOCName: \"autotoc-nav\",\n        classSectionName: \"autotoc-section\",\n        classLevelPrefixName: \"autotoc-level-\",\n        classActiveName: \"active\",\n        scrollDuration: \"slow\",\n        scrollEasing: \"swing\",\n    },\n    init: function () {\n        import(\"./autotoc.scss\");\n\n        var self = this;\n\n        self.$toc = $(\"<nav/>\").addClass(self.options.classTOCName);\n\n        if (self.options.prependTo) {\n            self.$toc.prependTo(self.options.prependTo);\n        } else if (self.options.appendTo) {\n            self.$toc.appendTo(self.options.appendTo);\n        } else {\n            self.$toc.prependTo(self.$el);\n        }\n\n        if (self.options.className) {\n            self.$el.addClass(self.options.className);\n        }\n\n        $(self.options.section, self.$el).addClass(self.options.classSectionName);\n\n        var asTabs = self.$el.hasClass(\"autotabs\");\n\n        var activeId = null;\n\n        $(self.options.levels, self.$el).each(function (i) {\n            var $level = $(this),\n                id = $level.prop(\"id\")\n                    ? $level.prop(\"id\")\n                    : $level.parents(self.options.section).prop(\"id\");\n            if (!id || $(\"#\" + id).length > 0) {\n                id = self.options.IDPrefix + self.name + \"-\" + i;\n            }\n            if (window.location.hash === \"#\" + id) {\n                activeId = id;\n            }\n            if (activeId === null && $level.hasClass(self.options.classActiveName)) {\n                activeId = id;\n            }\n            $level.data(\"navref\", id);\n            $(\"<a/>\")\n                .appendTo(self.$toc)\n                .text($level.text())\n                .attr(\"id\", id)\n                .attr(\"href\", \"#\" + id)\n                .addClass(self.options.classLevelPrefixName + self.getLevel($level))\n                .on(\"click\", function (e, options) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    if (!options) {\n                        options = {\n                            doScroll: true,\n                            skipHash: false,\n                        };\n                    }\n                    var $el = $(this);\n                    self.$toc\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    self.$el\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    $(e.target).addClass(self.options.classActiveName);\n                    $level\n                        .parents(self.options.section)\n                        .addClass(self.options.classActiveName);\n                    if (\n                        options.doScroll !== false &&\n                        self.options.scrollDuration &&\n                        $level &&\n                        !asTabs\n                    ) {\n                        $(\"body,html\").animate(\n                            {\n                                scrollTop: $level.offset().top,\n                            },\n                            self.options.scrollDuration,\n                            self.options.scrollEasing\n                        );\n                    }\n                    if (self.$el.parents(\".plone-modal\").length !== 0) {\n                        self.$el.trigger(\"resize.plone-modal.patterns\");\n                    }\n                    $(this).trigger(\"clicked\");\n                    if (!options.skipHash) {\n                        if (window.history && window.history.pushState) {\n                            window.history.pushState({}, \"\", \"#\" + $el.attr(\"id\"));\n                        }\n                    }\n                });\n            $level.data(\"autotoc-trigger-id\", id);\n        });\n\n        if (activeId) {\n            $(\"a#\" + activeId).trigger(\"click\", {\n                doScroll: true,\n                skipHash: true,\n            });\n        } else {\n            self.$toc.find(\"a\").first().trigger(\"click\", {\n                doScroll: false,\n                skipHash: true,\n            });\n        }\n    },\n    getLevel: function ($el) {\n        var elementLevel = 0;\n        $.each(this.options.levels.split(\",\"), function (level, levelSelector) {\n            if ($el.filter(levelSelector).length === 1) {\n                elementLevel = level + 1;\n                return false;\n            }\n        });\n        return elementLevel;\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport _ from \"underscore\";\n\nconst log = logger.getLogger(\"pat-contentloader\");\n\nexport default Base.extend({\n    name: \"contentloader\",\n    trigger: \".pat-contentloader\",\n    parser: \"mockup\",\n    defaults: {\n        url: null,\n        content: null,\n        trigger: \"click\",\n        target: null,\n        template: null,\n        dataType: \"html\",\n    },\n    init: function () {\n        var that = this;\n        if (that.options.url === \"el\" && that.$el[0].tagName === \"A\") {\n            that.options.url = that.$el.attr(\"href\");\n        }\n        that.$el.removeClass(\"loading-content\");\n        that.$el.removeClass(\"content-load-error\");\n        if (that.options.trigger === \"immediate\") {\n            that._load();\n        } else {\n            that.$el.on(that.options.trigger, function (e) {\n                e.preventDefault();\n                that._load();\n            });\n        }\n    },\n    _load: function () {\n        var that = this;\n        that.$el.addClass(\"loading-content\");\n        if (that.options.url) {\n            that.loadRemote();\n        } else {\n            that.loadLocal();\n        }\n    },\n    loadRemote: function () {\n        var that = this;\n        $.ajax({\n            url: that.options.url,\n            dataType: that.options.dataType,\n            success: function (data) {\n                var $el;\n                if (that.options.dataType === \"html\") {\n                    if (data.indexOf(\"<html\") !== -1) {\n                        data = utils.parseBodyTag(data);\n                    }\n                    $el = $(\"<div>\" + data + \"</div>\"); // jQuery starts to search at the first child element.\n                } else if (that.options.dataType.indexOf(\"json\") !== -1) {\n                    // must have template defined with json\n                    if (data.constructor === Array && data.length === 1) {\n                        // normalize json if it makes sense since some json returns as array with one item\n                        data = data[0];\n                    }\n                    try {\n                        $el = $(_.template(that.options.template)(data));\n                    } catch (e) {\n                        that.$el.removeClass(\"loading-content\");\n                        that.$el.addClass(\"content-load-error\");\n                        log.warn(\n                            \"error rendering template. pat-contentloader will not work\"\n                        );\n                        return;\n                    }\n                }\n                if (that.options.content !== null) {\n                    $el = $el.find(that.options.content);\n                }\n                that.loadLocal($el);\n            },\n            error: function () {\n                that.$el.removeClass(\"loading-content\");\n                that.$el.addClass(\"content-load-error\");\n            },\n        });\n    },\n    loadLocal: function ($content) {\n        var that = this;\n        if (!$content && that.options.content === null) {\n            that.$el.removeClass(\"loading-content\");\n            that.$el.addClass(\"content-load-error\");\n            log.warn(\"No selector configured\");\n            return;\n        }\n        var $target = that.$el;\n        if (that.options.target !== null) {\n            $target = $(that.options.target);\n            if ($target.length === 0) {\n                that.$el.removeClass(\"loading-content\");\n                that.$el.addClass(\"content-load-error\");\n                log.warn(\"No target nodes found\");\n                return;\n            }\n        }\n\n        if (!$content) {\n            $content = $(that.options.content).clone();\n        }\n        if ($content.length) {\n            $content.show();\n            $target.replaceWith($content);\n            registry.scan($content);\n        } else {\n            // empty target node instead of removing it.\n            // allows for subsequent content loader calls to work sucessfully.\n            $target.empty();\n        }\n\n        that.$el.removeClass(\"loading-content\");\n        that.emit(\"loading-done\");\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\n\nexport default Base.extend({\n    name: \"cookietrigger\",\n    trigger: \".pat-cookietrigger\",\n    parser: \"mockup\",\n\n    isCookiesEnabled: function () {\n        /* Test whether cookies are enabled by attempting to set a cookie\n         * and then change its value set test cookie.\n         */\n        var c = \"areYourCookiesEnabled=0\";\n        document.cookie = c;\n        var dc = document.cookie;\n        // cookie not set?  fail\n        if (dc.indexOf(c) === -1) {\n            return 0;\n        }\n        // change test cookie\n        c = \"areYourCookiesEnabled=1\";\n        document.cookie = c;\n        dc = document.cookie;\n        // cookie not changed?  fail\n        if (dc.indexOf(c) === -1) {\n            return 0;\n        }\n        // delete cookie\n        document.cookie = \"areYourCookiesEnabled=; expires=Thu, 01-Jan-70 00:00:01 GMT\";\n        return 1;\n    },\n\n    showIfCookiesDisabled: function () {\n        /* Show the element on which this pattern is defined if cookies are\n         * disabled.\n         */\n        if (this.isCookiesEnabled()) {\n            dom.hide(this.el);\n        } else {\n            dom.show(this.el);\n        }\n    },\n\n    init: function () {\n        this.showIfCookiesDisabled();\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"formautofocus\",\n    trigger: \".pat-formautofocus\",\n    parser: \"mockup\",\n    defaults: {\n        condition: \"div.error\",\n        target: \"div.error :input:not(.formTabs):visible:first\",\n        always: \":input:not(.formTabs):visible:first\",\n    },\n    init() {\n        if ($(this.options.condition, this.$el).length !== 0) {\n            $(this.options.target, this.$el).focus();\n        } else {\n            $(this.options.always, this.$el).focus();\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\n\nexport default Base.extend({\n    name: \"formunloadalert\",\n    trigger: \".pat-formunloadalert\",\n    parser: \"mockup\",\n    _changed: false, // Stores a listing of raised changes by their key\n    _suppressed: false, // whether or not warning should be suppressed\n    defaults: {\n        message: _t(\"Discard changes? If you click OK, any changes you have made will be lost.\"), // prettier-ignore\n        // events on which to check for changes\n        changingEvents: \"change keyup paste\",\n        // fields on which to check for changes\n        changingFields: \"input,select,textarea,fileupload\",\n    },\n    init() {\n        var self = this;\n        // if this is not a form just return\n        if (!self.$el.is(\"form\")) {\n            return;\n        }\n\n        $(self.options.changingFields, self.$el).on(self.options.changingEvents, () => {\n            self._changed = true;\n        });\n\n        var $modal = self.$el.parents(\".plone-modal\");\n        if ($modal.length !== 0) {\n            $modal.on(\"hide\", function (e) {\n                var modal = $modal.data(\"patternPloneModal\");\n                if (modal) {\n                    modal._suppressHide = self._handleUnload.call(self, e);\n                }\n            });\n        } else {\n            $(window).on(\"beforeunload\", (e) => {\n                return self._handleUnload(e);\n            });\n        }\n\n        self.$el.on(\"submit\", () => {\n            self._suppressed = true;\n        });\n    },\n    _handleUnload(e) {\n        var self = this;\n        if (self._suppressed) {\n            self._suppressed = false;\n            return undefined;\n        }\n        if (self._changed) {\n            var msg = self.options.message;\n            self._handleMsg(e, msg);\n            $(window).trigger(\"messageset\");\n            return msg;\n        }\n    },\n    _handleMsg(e, msg) {\n        (e || window.event).returnValue = msg;\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\n\nexport default Base.extend({\n    name: \"livesearch\",\n    trigger: \".pat-livesearch\",\n    parser: \"mockup\",\n    timeout: null,\n    active: false,\n    results: null,\n    selectedItem: -1,\n    resultsClass: \"livesearch-results list-group d-none\",\n    defaults: {\n        ajaxUrl: null,\n        defaultSortOn: \"\",\n        perPage: 7,\n        quietMillis: 350,\n        timeoutHide: 200,\n        minimumInputLength: 4,\n        inputSelector: 'input[type=\"text\"]',\n        itemTemplate:\n            '<li class=\"search-result <%- state %> list-group-item list-group-item-action\">' +\n            '<a class=\"text-reset text-decoration-none\" href=\"<%- url %>\">' +\n            '<div class=\"row\">' +\n            '<div class=\"col info\">' +\n            '<div class=\"heading\"><%- title %></div>' +\n            '<div class=\"description\"><%- description %></div>' +\n            \"</div>\" +\n            \"<% if (img_tag) { %> \" +\n            '<div class=\"col img\">' +\n            \"<%= img_tag %>\" +\n            \"</div>\" +\n            \"<% } %> \" +\n            \"</div>\" +\n            \"</a>\" +\n            \"</li>\",\n    },\n    doSearch: function (page) {\n        var self = this;\n        self.active = true;\n        self.render();\n        self.$el.addClass(\"searching\");\n        var query = self.$el.serialize();\n        if (page === undefined) {\n            page = 1;\n        }\n        var sort_on = (function () {\n            var parameters = location.search,\n                sorton_position = parameters.indexOf(\"sort_on\");\n            if (sorton_position === -1) {\n                // return default sort\n                var $searchResults = $(\"#search-results\");\n                if ($searchResults.length > 0) {\n                    return $searchResults.attr(\"data-default-sort\");\n                }\n                return self.options.defaultSortOn;\n            }\n            // cut string before sort_on parameter\n            var sort_on = parameters.substring(sorton_position);\n            // cut other parameters\n            sort_on = sort_on.split(\"&\")[0];\n            // get just the value\n            sort_on = sort_on.split(\"=\")[1];\n            return sort_on;\n        })();\n\n        $.ajax({\n            url:\n                self.options.ajaxUrl +\n                \"?\" +\n                query +\n                \"&page=\" +\n                page +\n                \"&perPage=\" +\n                self.options.perPage +\n                \"&sort_on=\" +\n                sort_on,\n            dataType: \"json\",\n        })\n            .done(function (data) {\n                self.results = data;\n                self.page = page;\n                // maybe odd here.. but we're checking to see if the user\n                // has typed while a search was being performed. Perhap another search if so\n                if (query !== self.$el.serialize()) {\n                    self.doSearch();\n                }\n            })\n            .fail(function () {\n                self.results = {\n                    items: [\n                        {\n                            url: \"\",\n                            title: _t(\"Error\"),\n                            description: _t(\"There was an error searching\"),\n                            state: \"error\",\n                            error: false,\n                        },\n                    ],\n                    total: 1,\n                };\n                self.page = 1;\n            })\n            .always(function () {\n                self.active = false;\n                self.selectedItem = -1;\n                self.$el.removeClass(\"searching\");\n                self.render();\n            });\n    },\n    render: function () {\n        var self = this;\n        self.$results.empty();\n\n        /* find a status message */\n\n        if (self.active) {\n            self.$results.append(\n                $('<li class=\"searching list-group-item\">' + _t(\"searching\") + \"</li>\")\n            );\n        } else if (self.results === null) {\n            // no results gathered yet\n            self.$results.append(\n                $(\n                    '<li class=\"no-results no-search list-group-item\">' +\n                        _t(\"enter search phrase\") +\n                        \"</li>\"\n                )\n            );\n        } else if (self.results.total === 0) {\n            self.$results.append(\n                $(\n                    '<li class=\"no-results list-group-item\">' +\n                        _t(\"no results found\") +\n                        \"</li>\"\n                )\n            );\n        } else {\n            self.$results.append(\n                $(\n                    '<li class=\"results-summary list-group-item\">' +\n                        _t(\"found\") +\n                        \" \" +\n                        self.results.total +\n                        \" \" +\n                        _t(\"results\") +\n                        \"</li>\"\n                )\n            );\n        }\n\n        if (self.results !== null) {\n            var template = _.template(self.options.itemTemplate);\n            _.each(self.results.items, function (item, index) {\n                var $el = $(template($.extend({ _t: _t }, item)));\n                $el.attr(\"data-url\", item.url).on(\"click\", function () {\n                    if (!item.error) {\n                        window.location = item.url;\n                    }\n                });\n                if (index === self.selectedItem) {\n                    $el.addClass(\"active\");\n                }\n                self.$results.append($el);\n            });\n            var nav = {};\n            if (self.page > 1) {\n                var $prev = $(\n                    '<a href=\"#\" class=\"prev position-absolute ps-3 start-0\">' +\n                        _t(\"Previous\") +\n                        \"</a>\"\n                );\n                $prev.on(\"click\", function (e) {\n                    self.disableHiding = true;\n                    e.preventDefault();\n                    self.doSearch(self.page - 1);\n                });\n                nav.prev = $prev;\n            }\n            if (self.page * self.options.perPage < self.results.total) {\n                var $next = $(\n                    '<a href=\"#\" class=\"next position-absolute pe-3 end-0\">' +\n                        _t(\"Next\") +\n                        \"</a>\"\n                );\n                $next.on(\"click\", function (e) {\n                    self.disableHiding = true;\n                    e.preventDefault();\n                    self.doSearch(self.page + 1);\n                });\n                nav.next = $next;\n            }\n            if (nav.next || nav.prev) {\n                var $li = $(\n                    '<li class=\"list-group-item load-more d-flex justify-content-center\"><span class=\"page\">' +\n                        self.page +\n                        \"</span></li>\"\n                );\n                if (nav.prev) {\n                    $li.prepend(nav.prev);\n                }\n                if (nav.next) {\n                    $li.append(nav.next);\n                }\n                self.$results.append($li);\n            }\n        }\n        self.show();\n    },\n    show: function () {\n        /* we are positioning directly below the\n         input box, same width */\n        var self = this;\n\n        self.$results[0].classList.remove(\"d-none\");\n        self.$el[0].classList.add(\"livesearch-active\");\n    },\n    hide: function () {\n        this.$el[0].classList.remove(\"livesearch-active\");\n        this.$results[0].classList.add(\"d-none\");\n    },\n    init: function () {\n        // import(\"./livesearch.scss\");\n\n        var self = this;\n\n        self.$input = self.$el.find(self.options.inputSelector);\n        self.$input\n            .off(\"focusout\")\n            .on(\"focusout\", function () {\n                /* we put this in a timer so click events still\n           get trigger on search results */\n                setTimeout(function () {\n                    /* hack, look above, to handle dealing with clicks\n             unfocusing element */\n                    if (!self.disableHiding) {\n                        self.hide();\n                    } else {\n                        self.disableHiding = false;\n                        // and refocus elemtn\n                        self.$input.focus();\n                    }\n                }, self.options.timeoutHide);\n            })\n            .off(\"focusin\")\n            .on(\"focusin\", function () {\n                if (!self.onceFocused) {\n                    /* Case: field already filled out but no reasons\n             present yet, do ajax search and grab some results */\n                    self.onceFocused = true;\n                    if (self.$input.val().length >= self.options.minimumInputLength) {\n                        self.doSearch();\n                    }\n                } else if (!dom.is_visible(self.$results[0])) {\n                    self.render();\n                }\n            })\n            .attr(\"autocomplete\", \"off\")\n            .off(\"keyup\")\n            .on(\"keyup\", function (e) {\n                var code = e.keyCode || e.which;\n                // first off, we're capturing esc presses\n                if (code === 27) {\n                    self.$input.val(\"\");\n                    self.hide();\n                    return;\n                }\n                // then, we're capturing up, down and enter key presses\n                if (\n                    self.results &&\n                    self.results.items &&\n                    self.results.items.length > 0\n                ) {\n                    if (code === 13) {\n                        /* enter key, check to see if there is a selected item */\n                        if (self.selectedItem !== -1) {\n                            window.location = self.results.items[self.selectedItem].url;\n                        }\n                        return;\n                    } else if (code === 38) {\n                        /* up key */\n                        if (self.selectedItem !== -1) {\n                            self.selectedItem -= 1;\n                            self.render();\n                        }\n                        return;\n                    } else if (code === 40) {\n                        /* down key */\n                        if (self.selectedItem < self.results.items.length) {\n                            self.selectedItem += 1;\n                            self.render();\n                        }\n                        return;\n                    }\n                }\n\n                /* then, we handle timeouts for doing ajax search */\n                if (self.timeout !== null) {\n                    clearTimeout(self.timeout);\n                    self.timeout = null;\n                }\n                if (self.active) {\n                    return;\n                }\n                if (self.$input.val().length >= self.options.minimumInputLength) {\n                    self.timeout = setTimeout(function () {\n                        self.doSearch();\n                    }, self.options.quietMillis);\n                } else {\n                    self.results = null;\n                    self.render();\n                }\n            });\n        $(\"#sorting-options a\").on(\"click\", function (e) {\n            e.preventDefault();\n            self.onceFocused = false;\n        });\n\n        /* create result dom */\n        self.$results = $('<ul class=\"' + self.resultsClass + '\"></ul>').insertAfter(\n            self.$el\n        );\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"markspeciallinks\",\n    trigger: \".pat-markspeciallinks\",\n    parser: \"mockup\",\n\n    defaults: {\n        external_links_open_new_window: false,\n        mark_special_links: true,\n    },\n\n    protocol_icon_map: {\n        // For a list of supported default protocol hander, see:\n        // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/registerProtocolHandler#permitted_schemes\n        https: \"link-45deg\",\n        http: \"link-45deg\",\n        ftp: \"cloud-download\", // deprecated\n        callto: \"telephone\", // non-standard for skype\n        bitcoin: \"credit-card\", // no bitcoin icon yet\n        geo: \"geo-alt\",\n        im: \"chat\",\n        irc: \"chat\",\n        ircs: \"chat\",\n        magnet: \"link-45deg\",\n        mailto: \"envelope\",\n        mms: \"chat\",\n        news: \"newspaper\",\n        nntp: \"newspaper\",\n        openpgp4fpr: \"key\",\n        sip: \"telephone\",\n        sms: \"chat\",\n        smsto: \"chat\",\n        ssh: \"lock\",\n        tel: \"telephone\",\n        urn: \"link-45deg\",\n        webcal: \"calendar\",\n        wtai: \"telephone\",\n        xmpp: \"chat\",\n    },\n\n    async init() {\n        // first make external links open in a new window, afterwards do the\n        // normal plone link wrapping in only the content area\n\n        let open_new_window = false;\n        if (typeof this.options.external_links_open_new_window === \"string\") {\n            open_new_window =\n                this.options.external_links_open_new_window.toLowerCase() === \"true\";\n        } else if (typeof this.options.external_links_open_new_window === \"boolean\") {\n            open_new_window = this.options.external_links_open_new_window;\n        }\n\n        let mark_special_links = false;\n        if (typeof this.options.mark_special_links === \"string\") {\n            mark_special_links =\n                this.options.mark_special_links.toLowerCase() === \"true\";\n        } else if (typeof this.options.mark_special_links === \"boolean\") {\n            mark_special_links = this.options.mark_special_links;\n        }\n\n        if (mark_special_links) {\n            import(\"./markspeciallinks.scss\");\n        }\n\n        // All links with an http href (without the link-plain class), not within this site,\n        // and no img children should be wrapped in a link-external span\n        const url = window.location.protocol + \"//\" + window.location.host;\n        const links = this.el.querySelectorAll(\n            `a[href]:not(.link-plain):not([href^=\"${url}\"]):not([href^=\"#\"])`\n        );\n        //:not(:has(img))\n        for (const link of links) {\n            let link_url;\n            try {\n                link_url = new URL(link.getAttribute(\"href\"));\n            } catch (e) {\n                // Not a valid URL.\n                // Ignore and continue.\n                continue;\n            }\n\n            if (open_new_window && link_url.protocol.startsWith(\"http\")) {\n                link.setAttribute(\"target\", \"_blank\");\n                link.setAttribute(\"rel\", \"noopener\");\n            }\n\n            if (mark_special_links) {\n                const icon_name =\n                    this.protocol_icon_map[link_url.protocol.split(\":\")[0]];\n                if (icon_name) {\n                    const icon = await utils.resolveIcon(icon_name);\n                    const icon_el = dom.create_from_string(icon);\n                    icon_el.querySelector(\"svg\").classList.add(\"markspeciallinks__icon\");\n                    link.parentNode.insertBefore(icon_el, link);\n                }\n            }\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"navigationmarker\",\n    trigger: \".pat-navigationmarker\",\n    parser: \"mockup\",\n    init: function () {\n        const portal_url = document.body.dataset.portalUrl;\n        var href =\n            document.querySelector('head link[rel=\"canonical\"]').href ||\n            window.location.href;\n\n        $(\"a\", this.$el).each(function () {\n            var navlink = this.href.replace(\"/view\", \"\");\n            if (href.indexOf(navlink) !== -1) {\n                var parent = $(this).parent();\n\n                // check the input-openers within the path\n                var check = parent.find(\"> input\");\n                if (check.length) {\n                    check[0].checked = true;\n                }\n\n                // set \"inPath\" to all nav items which are within the current path\n                // check if parts of navlink are in canonical url parts\n                var hrefParts = href.split(\"/\");\n                var navParts = navlink.split(\"/\");\n                var inPath = false;\n                for (var i = 0, size = navParts.length; i < size; i++) {\n                    // The last path-part must match.\n                    inPath = false;\n                    if (navParts[i] === hrefParts[i]) {\n                        inPath = true;\n                    }\n                }\n                if (navlink === portal_url && href !== portal_url) {\n                    // Avoid marking \"Home\" with \"inPath\", when not actually there\n                    inPath = false;\n                }\n                if (inPath) {\n                    parent.addClass(\"inPath\");\n                }\n\n                // set \"current\" to the current selected nav item, if it is in the navigation structure.\n                if (href === navlink) {\n                    parent.addClass(\"current\");\n                }\n            }\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nfunction loadScript(src) {\n    var s,\n        i,\n        head,\n        scripts = document.getElementsByTagName(\"script\");\n\n    // Check script element doesn't already exist\n    for (i = 0; i < scripts.length; i++) {\n        if (scripts[i].src.indexOf(src) !== -1) {\n            return;\n        }\n    }\n\n    // If not, add it to page\n    s = document.createElement(\"script\");\n    s.type = \"text/javascript\";\n    s.async = true;\n    s.src = src;\n    // use head tag to find a place to insert the script node\n    head = document.getElementsByTagName(\"head\")[0];\n    head.insertBefore(s, head.firstChild);\n}\nfunction htmlToElement(html) {\n    var htmltmp = document.createElement(\"div\");\n    html = html.trim(); // Never return a text node of whitespace as the result\n    htmltmp.innerHTML = html;\n    return htmltmp.firstElementChild;\n}\n\nexport default Base.extend({\n    name: \"passwordstrength\",\n    trigger: \".pat-passwordstrength\",\n    parser: \"mockup\",\n    defaults: {\n        zxcvbn: \"//cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js\",\n    },\n    init: function () {\n        var self = this,\n            pwfield = this.el,\n            pwmeterContainer = htmlToElement(\n                '<div class=\"progress my-3\"><div class=\"progress-bar\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\"></div></div>'\n            ),\n            pwmeter = pwmeterContainer.firstChild,\n            indicators = {\n                0: \"bg-transparent\",\n                1: \"bg-danger\",\n                2: \"bg-warning\",\n                3: \"bg-warning\",\n                4: \"bg-success\",\n            };\n        function setLevel() {\n            var score = 0;\n\n            if (pwfield.value.length > 0) {\n                // Run zxcvbn, supplying the value of any other widgets in the form\n                score = Math.max(\n                    1,\n                    window.zxcvbn(\n                        pwfield.value,\n                        [].map\n                            .call(\n                                (pwfield.form || { elements: [] }).elements,\n                                function (inp) {\n                                    if (inp === pwfield) {\n                                        return null;\n                                    }\n                                    return inp.value || null;\n                                }\n                            )\n                            .filter(function (x) {\n                                return x;\n                            })\n                    ).score\n                );\n            }\n            var wclass = \"\";\n            if (score != 0) {\n                wclass = \" w-\" + 25 * score;\n            }\n            pwmeter.className = \"progress-bar\" + wclass + \" \" + indicators[score];\n            pwmeter.setAttribute(\"aria-valuenow\", 25 * score);\n        }\n\n        pwfield.parentNode.insertBefore(pwmeterContainer, pwfield.nextSibling);\n        // set up key strokes to change the meter\n        pwfield.onkeyup = function () {\n            setLevel();\n        };\n        // init zxcvbn\n        if (typeof window.zxcvbn !== \"function\") {\n            // No zxcvbn yet, try and load it\n            loadScript(self.options.zxcvbn);\n        }\n        // initial pwmeter setting\n        setLevel();\n    },\n});\n","import $ from \"jquery\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"preventdoublesubmit\",\n    trigger: \".pat-preventdoublesubmit\",\n    parser: \"mockup\",\n    defaults: {\n        message: _t(\"You already clicked the submit button. Do you really want to submit this form again?\"), // prettier-ignore\n        guardClassName: \"submitting\",\n        optOutClassName: \"allowMultiSubmit\",\n    },\n    init() {\n        var self = this;\n\n        // if this is not a form just return\n        if (!self.$el.is(\"form\")) {\n            return;\n        }\n\n        $(\":submit\", self.$el).on(\"click\", function () {\n            // mark the button as clicked\n            $(\":submit\").removeAttr(\"clicked\");\n            $(this).attr(\"clicked\", \"clicked\");\n\n            // if submitting and no opt-out guardClassName is found\n            // pop up confirmation dialog\n            if (\n                $(this).hasClass(self.options.guardClassName) &&\n                !$(this).hasClass(self.options.optOutClassName)\n            ) {\n                return self._confirm.call(self);\n            }\n\n            $(this).addClass(self.options.guardClassName);\n        });\n    },\n\n    _confirm() {\n        return window.confirm(this.options.message);\n    },\n});\n","import $ from \"jquery\";\nimport Modal from \"../modal/modal\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport utils from \"../../core/utils\";\nimport _t from \"../../core/i18n-wrapper\";\n\nconst log = logger.getLogger(\"pat-manage-portlets\");\n\nexport default Base.extend({\n    name: \"manage-portlets\",\n    trigger: \".pat-manage-portlets\",\n    parser: \"mockup\",\n    messageTimeout: 0,\n    submitTimeout: 0,\n    switchTimeout: 0,\n    isModal: false,\n    dirty: false,\n    init: async function () {\n        (await import(\"jquery-form\")).default;\n        var that = this;\n        var $modal = that.$el.parents(\".plone-modal\");\n        if ($modal.length === 1) {\n            this.isModal = true;\n            /* want to do something on exit from modal now */\n            var modal = $modal.data(\"pattern-plone-modal\");\n            modal.on(\"hide\", function () {\n                if (that.dirty) {\n                    window.location.reload();\n                }\n            });\n            that.loading = modal.loading;\n        } else {\n            that.loading = utils.loading;\n        }\n        that.bind();\n    },\n    bind: function () {\n        var that = this;\n        that.setupAddDropdown();\n        that.setupSwitchPortletManager();\n        that.setupSavePortletsSettings();\n        that.setupPortletEdit();\n        if (that.isModal) {\n            /* if we're in a modal, it's possible we have a link to\n            parent case, bind the link so we can reload modal */\n            $(\".portlets-link-to-parent\")\n                .off(\"click\")\n                .on(\"click\", function (e) {\n                    that.loading.show();\n                    var $el = $(this);\n                    e.preventDefault();\n                    $.ajax({\n                        url: $el.attr(\"href\"),\n                        data: {\n                            ajax_load: 1,\n                        },\n                    }).done(function (html) {\n                        var $body = $(utils.parseBodyTag(html));\n                        var $modal = $el.parents(\".plone-modal-body\");\n                        $modal.empty();\n                        var $content = $(\"#content\", $body);\n                        var $h1 = $(\"h1\", $content);\n                        $(\".plone-modal-header\", $modal.parent())\n                            .find(\"h2\")\n                            .html($h1.html());\n                        $h1.remove();\n                        $modal.append($content);\n                        that.rebind($(\".pat-manage-portlets\", $content), true);\n                        that.loading.hide();\n                    });\n                });\n        }\n    },\n    rebind: function ($el, suppress) {\n        log.info(\"rebind\");\n        if ($.contains(document, this.$el[0])) {\n            // $el is not detached, replace it\n            this.$el.replaceWith($el);\n        }\n        this.$el = $el;\n        this.bind();\n        if (!suppress) {\n            this.statusMessage();\n        }\n        this.dirty = true;\n    },\n    statusMessage: function (msg) {\n        if (msg === undefined) {\n            msg = _t(\"Portlet changes saved\");\n        }\n        var that = this;\n\n        var $message = $(\"#portlet-message\");\n        if ($message.length === 0) {\n            $message = $(\n                '<div class=\"alert alert-info\" role=\"alert\" id=\"portlet-message\" style=\"opacity: 0\"></div>'\n            );\n            if (that.isModal) {\n                $(\".plone-modal-body:visible\").prepend($message);\n            } else {\n                $(\"#content-core\").prepend($message);\n            }\n        }\n        $message.html('<strong class=\"mr-1\">' + _t(\"Info\") + \"</strong>\" + msg);\n        clearTimeout(that.messageTimeout);\n        $message.fadeTo(500, 1);\n        that.messageTimeout = window.setTimeout(function () {\n            $message.fadeTo(500, 0.6);\n        }, 3000);\n    },\n    showEditPortlet: function (url) {\n        log.info(\"show edit portlet in modal\");\n        var that = this;\n        var $a = $(\"<a/>\");\n        $(\"body\").append($a);\n        var pattern = new Modal($a, {\n            ajaxUrl: url,\n            actionOptions: {\n                displayInModal: false,\n                reloadWindowOnClose: false,\n                isForm: true,\n                onSuccess: function (modal, html) {\n                    pattern.hide();\n                    var $body = $(utils.parseBodyTag(html));\n                    that.rebind($(\"#\" + that.$el.attr(\"id\"), $body).eq(0));\n                    that.statusMessage(_t(\"Portlet added\"));\n                },\n            },\n        });\n        pattern.on(\"after-render\", function () {\n            var $el = $(\"#\" + that.$el.attr(\"id\"), pattern.$raw);\n            /* this is a check that the add form doesn't just automatically\n            create the portlet without an actual form.\n            If element is found here, we can short circuit and\n            continue on. */\n            if ($el.length === 1) {\n                /* hacky, trying to prevent modal parts from flickering here */\n                $el = $el.clone();\n                pattern.on(\"shown\", function () {\n                    pattern.hide();\n                });\n                that.rebind($el);\n                that.statusMessage(_t(\"Portlet added\"));\n            }\n        });\n        pattern.show();\n    },\n    setupPortletEdit: function () {\n        var that = this;\n        $(\".managedPortlet .portletHeader > a\", that.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            that.showEditPortlet($(this).attr(\"href\"));\n        });\n    },\n    setupAddDropdown: function () {\n        var that = this;\n        $(\".add-portlet\", that.$el).on(\"change\", function (e) {\n            e.preventDefault();\n            var $select = $(this);\n            var $form = $select.parents(\"form\");\n            var contextUrl = $select.attr(\"data-context-url\");\n            var url =\n                contextUrl +\n                $select.val() +\n                \"?_authenticator=\" +\n                $('[name=\"_authenticator\"]').val() +\n                \"&referer=\" +\n                $('[name=\"referer\"]', $form).val();\n            that.showEditPortlet(url);\n        });\n    },\n    setupSavePortletsSettings: function () {\n        var that = this;\n        $(\".portlets-settings, form.portlet-action\", that.$el).ajaxForm({\n            beforeSubmit: function () {\n                that.loading.show();\n            },\n            success: function (html) {\n                that.loading.hide();\n                log.info(\"form submit\");\n                var $body = $(utils.parseBodyTag(html));\n                that.rebind($(\"#\" + that.$el.attr(\"id\"), $body).eq(0));\n            },\n        });\n        // Block/unblock inherited portlets (parent, group and content type portlets)\n        $(\".portlets-settings select\", that.$el).on(\"change\", function () {\n            log.info(\"select change\");\n            clearTimeout(that.submitTimeout);\n            that.submitTimeout = window.setTimeout(function () {\n                $(\".portlets-settings\", that.$el).trigger(\"submit\");\n            }, 100);\n        });\n    },\n    setupSwitchPortletManager: function () {\n        var that = this;\n        $(\"#main-container\").on(\"change\", \".switch-portlet-manager\", function (e) {\n            e.stopImmediatePropagation();\n            log.info(\"switch portlet manager\");\n            var url_ = $(this).val();\n            clearTimeout(that.switchTimeout);\n            that.switchTimeout = window.setTimeout(function () {\n                that._reloadPortletManager(url_);\n            }, 100);\n        });\n        // Handle back/forward browser buttons\n        $(window).on(\"popstate\", function (e) {\n            e.stopImmediatePropagation();\n            if (e && e.state === undefined) {\n                var url_ = window.location.href;\n                log.info(\"redirecting to: \" + url_);\n                that._reloadPortletManager(url_, true);\n            }\n        });\n    },\n    _reloadPortletManager: function (url_, is_popstate) {\n        var that = this;\n        that.loading.show();\n        $.get(url_, { ajax_load: 1 }).done(function (html) {\n            var $html = $(utils.parseBodyTag(html));\n            var $content = (\"#content\", $html);\n            $(\"#content\").html($content);\n            that.rebind($(\".pat-manage-portlets\", $content), true);\n            if (!is_popstate) {\n                window.history.pushState(null, null, url_);\n            } else {\n                window.history.replaceState(null, null, url_);\n            }\n            that.loading.hide();\n        });\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport DisplayTemplate from \"./templates/display.xml\";\nimport FormTemplate from \"./templates/form.xml\";\nimport OccurrenceTemplate from \"./templates/occurrence.xml\";\nimport Modal from \"../modal/modal\";\nimport utils from \"../../core/utils\";\n\n// Formatting function (mostly) from jQueryTools dateinput\nvar Re = /d{1,4}|m{1,4}|yy(?:yy)?|\"[^\"]*\"|'[^']*'/g;\n\nfunction zeropad(val, len) {\n    val = val.toString();\n    len = len || 2;\n    while (val.length < len) {\n        val = \"0\" + val;\n    }\n    return val;\n}\n\nfunction format(date, fmt, conf) {\n    var d = date.getDate(),\n        D = date.getDay(),\n        m = date.getMonth(),\n        y = date.getFullYear(),\n        flags = {\n            d: d,\n            dd: zeropad(d),\n            ddd: conf.localization.shortWeekdays[D],\n            dddd: conf.localization.weekdays[D],\n            m: m + 1,\n            mm: zeropad(m + 1),\n            mmm: conf.localization.shortMonths[m],\n            mmmm: conf.localization.months[m],\n            yy: String(y).slice(2),\n            yyyy: y,\n        };\n\n    var result = fmt.replace(Re, function ($0) {\n        return Object.prototype.hasOwnProperty.call(flags, $0)\n            ? flags[$0]\n            : $0.slice(1, $0.length - 1);\n    });\n\n    return result;\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction widgetSaveToRfc5545(form, RDATE, EXDATE, conf, tz) {\n    var value = form.find(\"select[name=rirtemplate]\").val();\n    var rtemplate = conf.rtemplate[value];\n    var result = \"RRULE:\" + rtemplate.rrule;\n    var human = conf.localization.rtemplate[value];\n    var interval, month, year, occurrences, day;\n    var weekdays, i18nweekdays, input, monthlyType, index;\n    var yearlyType, rangeType;\n\n    for (const field_id of rtemplate.fields) {\n        const field = form.find(`#${field_id}`);\n\n        switch (field.attr(\"id\")) {\n            case \"ridailyinterval\":\n                interval = field.find(\"input[name=ridailyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.dailyInterval2}`;\n                break;\n\n            case \"riweeklyinterval\":\n                interval = field.find(\"input[name=riweeklyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.weeklyInterval2}`;\n                break;\n\n            case \"riweeklyweekdays\":\n                weekdays = [];\n                i18nweekdays = [];\n                for (let j = 0; j < conf.weekdays.length; j++) {\n                    input = field.find(`input[name=riweeklyweekdays${j}]`);\n                    if (input.is(\":checked\")) {\n                        weekdays.push(conf.weekdays[j]);\n                        i18nweekdays.push(conf.localization.weekdays[j]);\n                    }\n                }\n                if (weekdays.length > 0) {\n                    result += `;BYDAY=${weekdays.join(\",\")}`;\n                    human += ` ${\n                        conf.localization.weeklyWeekdaysHuman\n                    } ${i18nweekdays.join(\",\")}`;\n                }\n                break;\n\n            case \"rimonthlyinterval\":\n                interval = field.find(\"input[name=rimonthlyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.monthlyInterval2}`;\n                break;\n\n            case \"rimonthlyoptions\":\n                monthlyType = $(\"input[name=rimonthlytype]:checked\", form).val();\n                if (monthlyType === \"DAYOFMONTH\") {\n                    day = $(\"select[name=rimonthlydayofmonthday]\", form).val();\n                    result += `;BYMONTHDAY=${day}`;\n                    human += `, ${conf.localization.monthlyDayOfMonth1Human} ${day} ${conf.localization.monthlyDayOfMonth2}`;\n                } else if (monthlyType === \"WEEKDAYOFMONTH\") {\n                    index = $(\"select[name=rimonthlyweekdayofmonthindex]\", form).val();\n                    day =\n                        conf.weekdays[\n                            $(\"select[name=rimonthlyweekdayofmonth]\", form).val()\n                        ];\n                    if ([\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"].includes(day)) {\n                        result += `;BYDAY=${index}${day}`;\n                        human += `, ${conf.localization.monthlyWeekdayOfMonth1Human} `;\n                        human += `${\n                            conf.localization.orderIndexes[\n                                conf.orderIndexes.indexOf(index)\n                            ]\n                        } ${conf.localization.monthlyWeekdayOfMonth2} `;\n                        human += `${\n                            conf.localization.weekdays[conf.weekdays.indexOf(day)]\n                        } ${conf.localization.monthlyDayOfMonth2}`;\n                    }\n                }\n                break;\n\n            case \"riyearlyinterval\":\n                interval = field.find(\"input[name=riyearlyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.yearlyInterval2}`;\n                break;\n\n            case \"riyearlyoptions\":\n                yearlyType = $(\"input[name=riyearlyType]:checked\", form).val();\n                month = \"\";\n\n                if (yearlyType === \"DAYOFMONTH\") {\n                    month = $(\"select[name=riyearlydayofmonthmonth]\", form).val();\n                    day = $(\"select[name=riyearlydayofmonthday]\", form).val();\n                    result += `;BYMONTH=${month};BYMONTHDAY=${day}`;\n                    human += `, ${conf.localization.yearlyDayOfMonth1Human} ${\n                        conf.localization.months[month - 1]\n                    } ${day}`;\n                } else if (yearlyType === \"WEEKDAYOFMONTH\") {\n                    index = $(\"select[name=riyearlyweekdayofmonthindex]\", form).val();\n                    day =\n                        conf.weekdays[\n                            $(\"select[name=riyearlyweekdayofmonthday]\", form).val()\n                        ];\n                    month = $(\"select[name=riyearlyweekdayofmonthmonth]\", form).val();\n                    result += `;BYMONTH=${month}`;\n                    if ([\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"].includes(day)) {\n                        result += `;BYDAY=${index}${day}`;\n                        human += \", \" + conf.localization.yearlyWeekdayOfMonth1Human;\n                        human +=\n                            \" \" +\n                            conf.localization.orderIndexes[\n                                $.inArray(index, conf.orderIndexes)\n                            ];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth2;\n                        human +=\n                            \" \" +\n                            conf.localization.weekdays[$.inArray(day, conf.weekdays)];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth3;\n                        human += \" \" + conf.localization.months[month - 1];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth4;\n                    }\n                }\n                break;\n\n            case \"rirangeoptions\":\n                rangeType = form.find(\"input[name=rirangetype]:checked\").val();\n                if (rangeType === \"BYOCCURRENCES\") {\n                    occurrences = form\n                        .find(\"input[name=rirangebyoccurrencesvalue]\")\n                        .val();\n                    result += `;COUNT=${occurrences}`;\n                    human += `, ${conf.localization.rangeByOccurrences1Human} ${occurrences} ${conf.localization.rangeByOccurrences2}`;\n                } else if (rangeType === \"BYENDDATE\") {\n                    let date = form.find(\"input[name=rirangebyenddatecalendar]\").val();\n                    if (date === \"\") {\n                        const today = new Date();\n                        date = `${today.getFullYear()}-${(today.getMonth() + 1)\n                            .toString()\n                            .padStart(2, \"0\")}-${today.getDate()}`;\n                    }\n                    result += `;UNTIL=${date.replaceAll(\"-\", \"\")}T000000${\n                        tz === true ? \"Z\" : \"\"\n                    }`;\n                    human += `, ${conf.localization.rangeByEndDateHuman} `;\n                    var date_parts = date.split(\"-\");\n                    human += format(\n                        new Date(date_parts[0], date_parts[1] - 1, date_parts[2]),\n                        conf.localization.longDateFormat,\n                        conf\n                    );\n                }\n                break;\n        }\n    }\n\n    if (RDATE.length) {\n        RDATE.sort();\n        let tmp_dates = [];\n        let tmp_human = [];\n\n        // make sure our additional RDATE dates have the same start time\n        // XXX: not used, remove if superfluous\n        //const rdate_time = start_date\n        //    ? `T${start_date.getHours()}:${start_date.getMinutes()}:00`\n        //    : \"T00:00:00\";\n\n        for (let rdate of RDATE) {\n            if (rdate !== \"\") {\n                // RDATE values are \"YYYY-MM-DD\"\n                // by adding \"T000000\" the recurrence sequence generator of\n                // plone.event.recurrence adds the current start time correctly\n                rdate += rdate.length === 10 ? \"T000000\" : \"\";\n                rdate += tz ? \"Z\" : \"\";\n                tmp_dates.push(rdate);\n\n                // human readable RDATE\n                year = parseInt(rdate.substring(0, 4), 10);\n                month = parseInt(rdate.substring(5, 7), 10) - 1;\n                day = parseInt(rdate.substring(8, 10), 10);\n                tmp_human.push(\n                    format(\n                        new Date(year, month, day),\n                        conf.localization.longDateFormat,\n                        conf\n                    )\n                );\n            }\n        }\n        if (tmp_dates.length) {\n            result += `\\nRDATE:${tmp_dates.join(\",\")}`;\n            human += `${conf.localization.including} ${tmp_human.join(\"; \")}`;\n        }\n    }\n\n    if (EXDATE.length) {\n        EXDATE.sort();\n        let tmp_dates = [];\n        let tmp_human = [];\n        for (let exdate of EXDATE) {\n            if (exdate !== \"\") {\n                // EXDATE values are \"YYYYMMDDTHHMMZ\"\n                tmp_dates.push(exdate);\n\n                // human readable EXDATE\n                year = parseInt(exdate.substring(0, 4), 10);\n                month = parseInt(exdate.substring(4, 6), 10) - 1;\n                day = parseInt(exdate.substring(6, 8), 10);\n                tmp_human.push(\n                    format(\n                        new Date(year, month, day),\n                        conf.localization.longDateFormat,\n                        conf\n                    )\n                );\n            }\n        }\n        if (tmp_dates.length) {\n            result += `\\nEXDATE:${tmp_dates.join(\",\")}`;\n            human += `${conf.localization.except} ${tmp_human.join(\"; \")}`;\n        }\n    }\n\n    return { result: result, description: human };\n}\n\nfunction parseLine(icalline) {\n    var result = {};\n    var pos = icalline.indexOf(\":\");\n    var property = icalline.substring(0, pos);\n    result.value = icalline.substring(pos + 1);\n\n    if (property.indexOf(\";\") !== -1) {\n        pos = property.indexOf(\";\");\n        result.parameters = property.substring(pos + 1);\n        result.property = property.substring(0, pos);\n    } else {\n        result.parameters = null;\n        result.property = property;\n    }\n    return result;\n}\n\nfunction cleanDates(dates) {\n    // Get rid of timezones\n    // TODO: We could parse dates and range here, maybe?\n    var result = [];\n\n    for (const date of dates.split(\",\")) {\n        if (date.indexOf(\"Z\") !== -1) {\n            result.push(date.substring(0, 15));\n        } else {\n            result.push(date);\n        }\n    }\n    return result;\n}\n\nfunction parseIcal(icaldata) {\n    var lines = [];\n    var result = {\n        RRULE: \"\",\n        RDATE: [],\n        EXDATE: [],\n    };\n    var line = null;\n    var nextline;\n\n    lines = icaldata.split(\"\\n\");\n    lines.reverse();\n    while (line !== \"\") {\n        if (lines.length > 0) {\n            nextline = lines.pop();\n            if (nextline.charAt(0) === \" \" || nextline.charAt(0) === \"\\t\") {\n                // Line continuation:\n                line = line + nextline;\n                continue;\n            }\n        } else {\n            nextline = \"\";\n        }\n\n        // New line; the current one is finished, add it to the result.\n        if (line !== null) {\n            line = parseLine(line);\n            // We ignore properties for now\n            if (line.property === \"RDATE\" || line.property === \"EXDATE\") {\n                result[line.property] = cleanDates(line.value);\n            } else {\n                result[line.property] = line.value;\n            }\n        }\n\n        line = nextline;\n    }\n    return result;\n}\n\nfunction widgetLoadFromRfc5545(form, conf, icaldata, force) {\n    var unsupportedFeatures = [];\n    var matches, rtemplate, d, input, index;\n    var selectors, field, radiobutton;\n    var freq, interval, byday, bymonth, bymonthday, count, until;\n    var day, month, year, weekday;\n\n    if (icaldata.RRULE === undefined) {\n        unsupportedFeatures.push(conf.localization.noRule);\n        if (!force) {\n            return -1; // Fail!\n        }\n    } else {\n        matches = /FREQ=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            freq = matches[1];\n        } else {\n            freq = \"DAILY\";\n        }\n\n        matches = /INTERVAL=([0-9]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            interval = matches[1];\n        } else {\n            interval = \"1\";\n        }\n\n        matches = /BYDAY=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            byday = matches[1];\n        } else {\n            byday = \"\";\n        }\n\n        matches = /BYMONTHDAY=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            bymonthday = matches[1].split(\",\");\n        } else {\n            bymonthday = null;\n        }\n\n        matches = /BYMONTH=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            bymonth = matches[1].split(\",\");\n        } else {\n            bymonth = null;\n        }\n\n        matches = /COUNT=([0-9]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            count = matches[1];\n        } else {\n            count = null;\n        }\n\n        matches = /UNTIL=([0-9T]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            until = matches[1];\n        } else {\n            until = null;\n        }\n\n        matches = /BYSETPOS=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            unsupportedFeatures.push(conf.localization.bysetpos);\n        }\n\n        // Find the best rule:\n        if (Object.prototype.hasOwnProperty.call(conf.rtemplate, freq.toLowerCase())) {\n            rtemplate = conf.rtemplate[freq.toLowerCase()];\n        } else {\n            for (freq of conf.rtemplate) {\n                /* fallback to first available template if no match above*/\n                rtemplate = conf.rtemplate[freq];\n                break;\n            }\n            unsupportedFeatures.push(conf.localization.noTemplateMatch);\n        }\n\n        // set rirtemplate selector to computed value\n        form.find(\"select[name='rirtemplate']\").val(freq.toLowerCase());\n\n        for (const field_id of rtemplate.fields) {\n            field = form.find(`#${field_id}`);\n            switch (field.attr(\"id\")) {\n                case \"ridailyinterval\":\n                    field.find(\"input[name=ridailyinterval]\").val(interval);\n                    break;\n\n                case \"riweeklyinterval\":\n                    field.find(\"input[name=riweeklyinterval]\").val(interval);\n                    break;\n\n                case \"riweeklyweekdays\":\n                    if (byday.length === 0) break;\n                    byday = byday.split(\",\");\n                    for (d = 0; d < conf.weekdays.length; d++) {\n                        input = field.find(`input[name=\"riweeklyweekdays${d}\"]`);\n                        if (input.length === 0) continue;\n                        day = conf.weekdays[d];\n                        input.attr(\"checked\", byday.includes(day));\n                    }\n                    break;\n\n                case \"rimonthlyinterval\":\n                    field.find(\"input[name=rimonthlyinterval]\").val(interval);\n                    break;\n\n                case \"rimonthlyoptions\":\n                    var monthlyType = \"DAYOFMONTH\"; // Default to using BYMONTHDAY\n\n                    if (bymonthday) {\n                        monthlyType = \"DAYOFMONTH\";\n                        if (bymonthday.length > 1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            // Just keep the first\n                            bymonthday = bymonthday[0];\n                        }\n                        field\n                            .find(\"select[name=rimonthlydayofmonthday]\")\n                            .val(bymonthday);\n                    }\n\n                    if (byday) {\n                        monthlyType = \"WEEKDAYOFMONTH\";\n\n                        if (byday.indexOf(\",\") !== -1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            byday = byday.split(\",\")[0];\n                        }\n                        index = byday.slice(0, -2);\n                        if (index.charAt(0) !== \"+\" && index.charAt(0) !== \"-\") {\n                            index = \"+\" + index;\n                        }\n                        weekday = byday.slice(-2);\n                        field\n                            .find(\"select[name=rimonthlyweekdayofmonthindex]\")\n                            .val(index);\n                        const day_index = conf.weekdays.indexOf(weekday);\n                        field.find(\"select[name=rimonthlyweekdayofmonth]\").val(day_index);\n                    }\n\n                    selectors = field.find(\"input[name=rimonthlytype]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\n                            \"checked\",\n                            radiobutton.value === monthlyType\n                        );\n                    }\n                    break;\n\n                case \"riyearlyinterval\":\n                    field.find(\"input[name=riyearlyinterval]\").val(interval);\n                    break;\n\n                case \"riyearlyoptions\":\n                    var yearlyType = \"DAYOFMONTH\"; // Default to using BYMONTHDAY\n\n                    if (bymonthday) {\n                        yearlyType = \"DAYOFMONTH\";\n                        if (bymonthday.length > 1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            bymonthday = bymonthday[0];\n                        }\n                        field.find(\"select[name=riyearlydayofmonthmonth]\").val(bymonth);\n                        field.find(\"select[name=riyearlydayofmonthday]\").val(bymonthday);\n                    }\n\n                    if (byday) {\n                        yearlyType = \"WEEKDAYOFMONTH\";\n\n                        if (byday.indexOf(\",\") !== -1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            byday = byday.split(\",\")[0];\n                        }\n                        index = byday.slice(0, -2);\n                        if (index.charAt(0) !== \"+\" && index.charAt(0) !== \"-\") {\n                            index = \"+\" + index;\n                        }\n                        weekday = byday.slice(-2);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthindex]\")\n                            .val(index);\n\n                        const weekday_index = conf.weekdays.indexOf(weekday);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthday]\")\n                            .val(weekday_index);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthmonth]\")\n                            .val(bymonth);\n                    }\n\n                    selectors = field.find(\"input[name=riyearlyType]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\"checked\", radiobutton.value === yearlyType);\n                    }\n                    break;\n\n                case \"rirangeoptions\":\n                    // default value per configuration\n                    var rangeType = conf.hasRepeatForeverButton ? \"NOENDDATE\" : \"BYOCCURRENCES\";\n\n                    if (count) {\n                        rangeType = \"BYOCCURRENCES\";\n                        field.find(\"input[name=rirangebyoccurrencesvalue]\").val(count);\n                    }\n\n                    if (until) {\n                        rangeType = \"BYENDDATE\";\n                        input = field.find(\"input[name=rirangebyenddatecalendar]\");\n                        year = until.slice(0, 4);\n                        month = until.slice(4, 6);\n                        day = until.slice(6, 8);\n                        input.val(`${year}-${month}-${day}`);\n                    }\n\n                    selectors = field.find(\"input[name=rirangetype]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\"checked\", radiobutton.value === rangeType);\n                    }\n                    break;\n            }\n        }\n    }\n\n    var messagearea = form.find(\"#messagearea\");\n    if (unsupportedFeatures.length !== 0) {\n        messagearea.text(\n            conf.localization.unsupportedFeatures + \" \" + unsupportedFeatures.join(\"; \")\n        );\n        messagearea.show();\n        return 1;\n    } else {\n        messagearea.text(\"\");\n        messagearea.hide();\n        return 0;\n    }\n}\n\nconst RecurrenceInput = function (conf, textarea) {\n    var self = this;\n    var $textarea = $(textarea);\n\n    // initalize parsed icaldata\n    if (textarea.innerHTML) {\n        textarea[\"ical\"] = parseIcal(textarea.innerHTML);\n    } else {\n        textarea[\"ical\"] = {\n            RRULE: \"\",\n            RDATE: [],\n            EXDATE: [],\n        };\n    }\n\n    // Extend conf with non-configurable data used by templates.\n    var orderedWeekdays = [];\n    var now_date = new Date().toISOString().substring(0, 10);\n    var index;\n\n    for (let i = 0; i < 7; i++) {\n        index = i + conf.firstDay;\n        if (index > 6) {\n            index = index - 7;\n        }\n        orderedWeekdays.push(index);\n    }\n\n    conf = {\n        ...conf,\n        orderIndexes: [\"+1\", \"+2\", \"+3\", \"+4\", \"-1\"],\n        weekdays: [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"],\n        orderedWeekdays: orderedWeekdays,\n    };\n\n    // The recurrence type dropdown should show certain fields depending\n    // on selection:\n    function displayFields(selector) {\n        // First hide all the fields\n        self.$modalForm.find(\".rifield\").hide();\n        // Then show the ones that should be shown.\n        var value = selector.val();\n        if (value) {\n            for (const rtField of conf.rtemplate[value].fields) {\n                self.$modalForm.find(`#${rtField}`).show();\n            }\n        }\n    }\n\n    function occurrenceExclude(event) {\n        event.preventDefault();\n        textarea[\"ical\"].EXDATE.push(this.attributes.date.value);\n        var $this = $(this);\n        $this.addClass(\"exdate\");\n        $this.parent().parent().addClass(\"exdate\");\n        $this.off(\"click\").on(\"click\", occurrenceInclude);\n    }\n\n    function occurrenceInclude(event) {\n        event.preventDefault();\n        textarea[\"ical\"].EXDATE.splice(\n            $.inArray(this.attributes.date.value, textarea[\"ical\"].EXDATE),\n            1\n        );\n        var $this = $(this);\n        $this.removeClass(\"exdate\");\n        $this.parent().parent().removeClass(\"exdate\");\n        $this.off(\"click\").on(\"click\", occurrenceExclude);\n    }\n\n    function occurrenceDelete(event) {\n        event.preventDefault();\n        textarea[\"ical\"].RDATE.splice(\n            $.inArray(this.attributes.date.value, textarea[\"ical\"].RDATE),\n            1\n        );\n        $(this)\n            .parent()\n            .parent()\n            .hide(\"slow\", function () {\n                $(this).remove();\n            });\n    }\n\n    function occurrenceAdd(event) {\n        event.preventDefault();\n        var datevalue = self.$modalForm.find(\".riaddoccurrence input#adddate\").val();\n        var errorarea = self.$modalForm.find(\".riaddoccurrence div.alert\");\n        errorarea.text(\"\");\n        errorarea.hide();\n\n        // Add date only if it is not already in RDATE\n        if (!textarea[\"ical\"].RDATE.includes(datevalue)) {\n            textarea[\"ical\"].RDATE.push(datevalue);\n            var date_parts = datevalue.split(\"-\");\n            var $newdate =\n                $(`<div class=\"d-flex justify-content-between occurrence rdate\">\n                <span class=\"rdate\">\n                    ${format(\n                        new Date(date_parts[0], date_parts[1] - 1, date_parts[2]),\n                        conf.localization.longDateFormat,\n                        conf\n                    )},\n                    <span class=\"rlabel\">${conf.localization.additionalDate}</span>\n                </span>\n                <span class=\"action\">\n                    <a date=\"${datevalue}\" href=\"#\" class=\"btn btn-sm btn-secondary rdate\" >\n                        ${conf.icons.remove}\n                    </a>\n                </span>\n                </div>`);\n            $newdate.hide();\n            self.$modalForm.find(\"div.rioccurrences\").prepend($newdate);\n            $newdate.slideDown();\n            $newdate.find(\"a.rdate\").on(\"click\", occurrenceDelete);\n        } else {\n            errorarea.text(conf.localization.alreadyAdded).show();\n        }\n    }\n\n    // element is where to find the tag in question. Can be the form\n    // or the display widget. Defaults to the self.$modalForm.\n    function loadOccurrences(startdate, rfc5545, start, readonly) {\n        var element, occurrenceDiv;\n\n        if (!readonly) {\n            element = self.$modalForm;\n        } else {\n            element = self.display;\n        }\n\n        occurrenceDiv = element.find(\".rioccurrences\");\n        occurrenceDiv.hide();\n\n        const year = startdate.getFullYear();\n        const month = startdate.getMonth() + 1;\n        const day = startdate.getDate();\n\n        var data = {\n            year: year,\n            month: month, // Sending January as 0? I think not.\n            day: day,\n            rrule: rfc5545,\n            format: conf.localization.longDateFormat,\n            start: start,\n        };\n\n        $.ajax({\n            url: conf.ajaxURL,\n            async: false, // Can't be tested if it's asynchronous, annoyingly.\n            type: \"post\",\n            dataType: \"json\",\n            contentType: conf.ajaxContentType,\n            cache: false,\n            data: data,\n            success: function (resp) {\n                var result;\n\n                resp.readOnly = readonly;\n                resp.localization = conf.localization;\n                resp.icons = conf.icons;\n\n                // Format dates:\n                var date, y, m, d;\n                for (let occurrence of resp.occurrences) {\n                    date = occurrence.date;\n                    y = parseInt(date.substring(0, 4), 10);\n                    m = parseInt(date.substring(4, 6), 10) - 1; // jan=0\n                    d = parseInt(date.substring(6, 8), 10);\n                    occurrence.formattedDate = format(\n                        new Date(y, m, d),\n                        conf.localization.longDateFormat,\n                        conf\n                    );\n                }\n\n                result = _.template(OccurrenceTemplate)(resp);\n                occurrenceDiv.replaceWith(result);\n\n                // Add the batch actions:\n                element.find(\".rioccurrences .batching a\").on(\"click\", function (event) {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    loadOccurrences(\n                        startdate,\n                        rfc5545,\n                        this.attributes.start.value,\n                        readonly\n                    );\n                });\n\n                // Add the delete/undelete actions:\n                if (!readonly) {\n                    element\n                        .find(\".rioccurrences .action a.rrule\")\n                        .on(\"click\", occurrenceExclude);\n                    element\n                        .find(\".rioccurrences .action a.exdate\")\n                        .on(\"click\", occurrenceInclude);\n                    element\n                        .find(\".rioccurrences .action a.rdate\")\n                        .on(\"click\", occurrenceDelete);\n                }\n                // Show the new div\n                occurrenceDiv.show();\n            },\n            error: function (jqXHR, textStatus) {\n                alert(textStatus);\n            },\n        });\n    }\n\n    function getField(field) {\n        // See if it is a field already\n        var realField = $(field);\n        if (!realField.length) {\n            // Otherwise, we assume it's an id:\n            realField = $(\"#\" + field);\n        }\n        if (!realField.length) {\n            // Still not? Then it's a name.\n            realField = $(\"input[name='\" + field + \"']\");\n        }\n        return realField;\n    }\n    function findStartDate() {\n        var startdate = null;\n        var startField, startFieldYear, startFieldMonth, startFieldDay;\n\n        // Find the default byday and bymonthday from the start date, if any:\n        if (conf.startField) {\n            startField = getField(conf.startField);\n            if (!startField.length) {\n                // Field not found\n                return null;\n            }\n            startdate = startField.val();\n            if (startdate === \"\") {\n                // Probably not an input at all. Try to see if it contains a date\n                startdate = startField.text();\n            }\n\n            if (typeof startdate === \"string\") {\n                // convert human readable, non ISO8601 dates, like\n                // '2014-04-24 19:00', where the 'T' separator is missing.\n                startdate = startdate.replace(\" \", \"T\");\n            }\n\n            startdate = new Date(startdate);\n        } else if (conf.startFieldYear && conf.startFieldMonth && conf.startFieldDay) {\n            startFieldYear = getField(conf.startFieldYear);\n            startFieldMonth = getField(conf.startFieldMonth);\n            startFieldDay = getField(conf.startFieldDay);\n            if (\n                !startFieldYear.length &&\n                !startFieldMonth.length &&\n                !startFieldDay.length\n            ) {\n                // Field not found\n                return null;\n            }\n            startdate = new Date(\n                startFieldYear.val(),\n                startFieldMonth.val() - 1,\n                startFieldDay.val()\n            );\n        }\n        if (startdate === null) {\n            return null;\n        }\n        // We have some sort of startdate:\n        if (isNaN(startdate)) {\n            return null;\n        }\n        return startdate;\n    }\n    function findEndDate() {\n        var endField, enddate;\n\n        endField = self.$modalForm.find(\"input[name=rirangebyenddatecalendar]\");\n        enddate = endField.val();\n        enddate = new Date(enddate);\n\n        // if the end date is incorrect or the field is left empty\n        if (isNaN(enddate) || endField.val() === \"\") {\n            return null;\n        }\n        return enddate;\n    }\n    function findIntField(fieldName) {\n        var field, num;\n\n        field = self.$modalForm.find(\"input[name=\" + fieldName + \"]\");\n\n        num = field.val();\n\n        // if it's not a number or the field is left empty\n        if (isNaN(num) || num.toString().indexOf(\".\") !== -1 || field.val() === \"\") {\n            return null;\n        }\n        return num;\n    }\n\n    // Loading (populating) display and form widget with\n    // passed RFC5545 string (data)\n    function loadData(form) {\n        widgetLoadFromRfc5545(form, conf, textarea[\"ical\"], true);\n\n        const startdate = findStartDate();\n\n        if (startdate !== null) {\n            // If the date is a real date, set the defaults in the form\n            document.querySelector(\"select[name=rimonthlydayofmonthday]\").value =\n                startdate.getDate();\n            const dayindex =\n                conf.orderIndexes[Math.floor((startdate.getDate() - 1) / 7)];\n            const day = conf.weekdays[startdate.getDay()];\n            document.querySelector(\"select[name=rimonthlyweekdayofmonthindex]\").value =\n                dayindex;\n            document.querySelector(\"select[name=rimonthlyweekdayofmonth]\").value = day;\n\n            document.querySelector(\"select[name=riyearlydayofmonthmonth]\").value =\n                startdate.getMonth() + 1;\n            document.querySelector(\"select[name=riyearlydayofmonthday]\").value =\n                startdate.getDate();\n            document.querySelector(\"select[name=riyearlyweekdayofmonthindex]\").value =\n                dayindex;\n            document.querySelector(\"select[name=riyearlyweekdayofmonthday]\").value = day;\n            document.querySelector(\"select[name=riyearlyweekdayofmonthmonth]\").value =\n                startdate.getMonth() + 1;\n\n            // Now when we have a start date, we can also do an ajax call to calculate occurrences:\n            var rfc5545 =\n                textarea.innerHTML ||\n                widgetSaveToRfc5545(\n                    form,\n                    textarea[\"ical\"].RDATE,\n                    textarea[\"ical\"].EXDATE,\n                    conf,\n                    false\n                ).result;\n\n            loadOccurrences(startdate, rfc5545, 0, false);\n\n            // Show the add and refresh buttons:\n            document.querySelector(\"div.rioccurrencesactions\").style.display = \"block\";\n        } else {\n            // No EXDATE/RDATE support\n            document.querySelector(\"div.rioccurrencesactions\").style.display = \"none\";\n        }\n\n        displayFields(form.find(\"select[name=rirtemplate]\"));\n    }\n\n    function recurrenceOn(form) {\n        var RFC5545 = widgetSaveToRfc5545(\n            form,\n            textarea[\"ical\"].RDATE,\n            textarea[\"ical\"].EXDATE,\n            conf,\n            false\n        );\n        var label = self.display.find(\"label[class=ridisplay-label]\");\n        label.text(conf.localization.displayActivate + \" \" + RFC5545.description);\n        textarea[\"ical\"] = parseIcal(RFC5545.result);\n        textarea.innerHTML = RFC5545.result;\n        $textarea.trigger(\"change\");\n        var startdate = findStartDate();\n        if (startdate !== null) {\n            loadOccurrences(startdate, RFC5545.result, 0, true);\n        }\n        self.display.find('a[name=\"riedit\"]').text(conf.localization.edit_rules);\n        self.display.find('a[name=\"ridelete\"]').show();\n    }\n\n    function recurrenceOff() {\n        var label = self.display.find(\"label[class=ridisplay-label]\");\n        label.text(conf.localization.displayUnactivate);\n        // reset ical object\n        textarea[\"ical\"] = {\n            RRULE: \"\",\n            RDATE: [],\n            EXDATE: [],\n        };\n        textarea.innerHTML = \"\";\n        $textarea.trigger(\"change\"); // Clear the textarea.\n        self.display.find(\".rioccurrences\").hide();\n        self.display.find('a[name=\"riedit\"]').text(conf.localization.add_rules);\n        self.display.find('a[name=\"ridelete\"]').hide();\n    }\n\n    function checkFields(form) {\n        var startDate, endDate, num, messagearea;\n        startDate = findStartDate();\n\n        // Hide any error message from before\n        messagearea = self.$modalForm.find(\"#messagearea\");\n        messagearea.text(\"\");\n        messagearea.hide();\n\n        // Hide add field errors\n        self.$modalForm.find(\".riaddoccurrence div.alert\").text(\"\").hide();\n\n        // Repeats Daily\n        if (self.$modalForm.find(\"#ridailyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"ridailyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n        }\n\n        // Repeats Weekly\n        if (self.$modalForm.find(\"#riweeklyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"riweeklyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n        }\n\n        // Repeats Monthly\n        if (self.$modalForm.find(\"#rimonthlyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"rimonthlyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n\n            // Check repeat on\n            if (self.$modalForm.find(\"#rimonthlyoptions input:checked\").length === 0) {\n                messagearea.text(conf.localization.noRepeatOn).show();\n                return false;\n            }\n        }\n\n        // Repeats Yearly\n        if (self.$modalForm.find(\"#riyearlyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"riyearlyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n\n            // Check repeat on\n            if (self.$modalForm.find(\"#riyearlyoptions input:checked\").length === 0) {\n                messagearea.text(conf.localization.noRepeatOn).show();\n                return false;\n            }\n        }\n\n        // End recurrence fields\n\n        // If after N occurences is selected, check its value\n        if (\n            self.$modalForm.find('input[value=\"BYOCCURRENCES\"]:visible:checked').length >\n            0\n        ) {\n            num = findIntField(\"rirangebyoccurrencesvalue\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noEndAfterNOccurrences).show();\n                return false;\n            }\n        }\n\n        // If end date is selected, check its value\n        if (\n            self.$modalForm.find('input[value=\"BYENDDATE\"]:visible:checked').length > 0\n        ) {\n            endDate = findEndDate(form);\n            if (!endDate) {\n                // if endDate is null that means the field is empty\n                messagearea.text(conf.localization.noEndDate).show();\n                return false;\n            } else if (endDate < startDate) {\n                // the end date cannot be before start date\n                messagearea.text(conf.localization.pastEndDate).show();\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    function save(event) {\n        event.preventDefault();\n        // if no field errors, process the request\n        if (checkFields(self.$modalForm)) {\n            // close modal\n            self.modal.hide();\n            recurrenceOn(self.$modalForm);\n            self.$modalForm = null;\n        }\n    }\n\n    function cancel(event) {\n        event.preventDefault();\n        // close modal\n        self.modal.hide();\n        self.$modalForm = null;\n    }\n\n    function updateOccurrences() {\n        var startDate;\n        startDate = findStartDate();\n\n        // if no field errors, process the request\n        if (checkFields(form)) {\n            loadOccurrences(\n                startDate,\n                widgetSaveToRfc5545(\n                    self.$modalForm,\n                    textarea[\"ical\"].RDATE,\n                    textarea[\"ical\"].EXDATE,\n                    conf,\n                    false\n                ).result,\n                0,\n                false\n            );\n        }\n    }\n\n    function initModalForm() {\n        var enddate = self.$modalForm.find(\"input[name=rirangebyenddatecalendar]\");\n        if (!enddate.val()) {\n            var start_date = findStartDate();\n            start_date.setDate(start_date.getDate() + 1);\n            enddate.val(start_date.toISOString().substring(0, 10));\n        }\n\n        self.$modalForm.find(\"input#addaction\").on(\"click\", occurrenceAdd);\n\n        // When selecting template, update what fieldsets are visible and the occurrences.\n        self.$modalForm.find('select[name=\"rirtemplate\"]').on(\"change\", function () {\n            displayFields($(this));\n            updateOccurrences();\n        });\n\n        // Update the selected dates section\n        self.$modalForm\n            .find(\n                `\n                input:radio,\n                input:checkbox,\n                .riweeklyweekday > input,\n                input[name=ridailyinterval],\n                input[name=riweeklyinterval],\n                input[name=rimonthlyinterval],\n                input[name=riyearlyinterval],\n                input[name=rirangebyoccurrencesvalue],\n                input[name=rirangebyenddatecalendar],\n                #rimonthlyoptions select,\n                #riyearlyoptions select,\n                #riyearlyinterval select`\n            )\n            .on(\"change\", function () {\n                // Update only if the occurances are shown\n                if (self.$modalForm.find(\".rioccurrencesactions:visible\").length !== 0) {\n                    updateOccurrences();\n                }\n            });\n\n        // initialize occurrence adddate value\n        self.$modalForm.find(\"div.riaddoccurrence input#adddate\").val(now_date);\n\n        /*\n        Save and cancel methods:\n        */\n        self.$modalForm.find(\".ricancelbutton\").on(\"click\", cancel);\n        self.$modalForm.find(\".risavebutton\").on(\"click\", save);\n    }\n\n    /*\n      Load the templates\n    */\n\n    self.display = $(_.template(DisplayTemplate)(conf));\n    var form = $(_.template(FormTemplate)(conf));\n\n    form.appendTo(\"body\");\n    form.hide();\n\n    // Make an modal and hide it\n    self.modal = new Modal(form, {\n        content: \"div.riform\",\n        buttons: \".ributtons > button\",\n        modalSizeClass: \"modal-lg\",\n        backdropOptions: {\n            opacity: \"0.5\",\n        },\n    });\n\n    if (textarea.innerHTML) {\n        var result = widgetLoadFromRfc5545(form, conf, textarea[\"ical\"], false);\n        if (result === -1) {\n            var label = self.display.find(\"label[class=ridisplay-label]\");\n            label.text(conf.localization.noRule);\n        } else {\n            recurrenceOn(form);\n        }\n    }\n\n    /*\n      Do all the GUI stuff:\n    */\n\n    // When you click \"Delete...\", the recurrence rules should be cleared.\n    self.display.find('a[name=\"ridelete\"]').on(\"click\", function (e) {\n        e.preventDefault();\n        recurrenceOff();\n    });\n\n    // Show form modal when you click on the \"Edit...\" link\n    self.display.find('a[name=\"riedit\"]').on(\"click\", function (e) {\n        // Load the form to set up the right fields to show, etc.\n        e.preventDefault();\n        self.modal.show();\n        self.$modalForm = $(\"form\", self.modal.$modalContent);\n        loadData(self.$modalForm);\n        initModalForm();\n    });\n};\n\nexport default Base.extend({\n    name: \"recurrence\",\n    trigger: \".pat-recurrence\",\n    parser: \"mockup\",\n    defaults: {\n        localization: {\n            displayUnactivate: \"Does not repeat\",\n            displayActivate: \"Repeats every\",\n            add_rules: \"Add\",\n            edit_rules: \"Edit\",\n            delete_rules: \"Delete\",\n            add: \"Add\",\n            refresh: \"Refresh\",\n\n            title: \"Repeat\",\n            preview: \"Selected dates\",\n            addDate: \"Add date\",\n\n            recurrenceType: \"Repeats:\",\n\n            dailyInterval1: \"Repeat every:\",\n            dailyInterval2: \"days\",\n\n            weeklyInterval1: \"Repeat every:\",\n            weeklyInterval2: \"week(s)\",\n            weeklyWeekdays: \"Repeat on:\",\n            weeklyWeekdaysHuman: \"on:\",\n\n            monthlyInterval1: \"Repeat every:\",\n            monthlyInterval2: \"month(s)\",\n            monthlyDayOfMonth1: \"Day\",\n            monthlyDayOfMonth1Human: \"on day\",\n            monthlyDayOfMonth2: \"of the month\",\n            monthlyDayOfMonth3: \"month(s)\",\n            monthlyWeekdayOfMonth1: \"The\",\n            monthlyWeekdayOfMonth1Human: \"on the\",\n            monthlyWeekdayOfMonth2: \"\",\n            monthlyWeekdayOfMonth3: \"of the month\",\n            monthlyRepeatOn: \"Repeat on:\",\n\n            yearlyInterval1: \"Repeat every:\",\n            yearlyInterval2: \"year(s)\",\n            yearlyDayOfMonth1: \"Every\",\n            yearlyDayOfMonth1Human: \"on\",\n            yearlyDayOfMonth2: \"\",\n            yearlyDayOfMonth3: \"\",\n            yearlyWeekdayOfMonth1: \"The\",\n            yearlyWeekdayOfMonth1Human: \"on the\",\n            yearlyWeekdayOfMonth2: \"\",\n            yearlyWeekdayOfMonth3: \"of\",\n            yearlyWeekdayOfMonth4: \"\",\n            yearlyRepeatOn: \"Repeat on:\",\n\n            range: \"End recurrence:\",\n            rangeNoEnd: \"Never\",\n            rangeByOccurrences1: \"After\",\n            rangeByOccurrences1Human: \"ends after\",\n            rangeByOccurrences2: \"occurrence(s)\",\n            rangeByEndDate: \"On\",\n            rangeByEndDateHuman: \"ends on\",\n\n            including: \", and also\",\n            except: \", except for\",\n\n            cancel: \"Cancel\",\n            save: \"Save\",\n\n            recurrenceStart: \"Start of the recurrence\",\n            additionalDate: \"Additional date\",\n            include: \"Include\",\n            exclude: \"Exclude\",\n            remove: \"Remove\",\n\n            orderIndexes: [\"first\", \"second\", \"third\", \"fourth\", \"last\"],\n            months: [\n                \"January\",\n                \"February\",\n                \"March\",\n                \"April\",\n                \"May\",\n                \"June\",\n                \"July\",\n                \"August\",\n                \"September\",\n                \"October\",\n                \"November\",\n                \"December\",\n            ],\n            shortMonths: [\n                \"Jan\",\n                \"Feb\",\n                \"Mar\",\n                \"Apr\",\n                \"May\",\n                \"Jun\",\n                \"Jul\",\n                \"Aug\",\n                \"Sep\",\n                \"Oct\",\n                \"Nov\",\n                \"Dec\",\n            ],\n            weekdays: [\n                \"Sunday\",\n                \"Monday\",\n                \"Tuesday\",\n                \"Wednesday\",\n                \"Thursday\",\n                \"Friday\",\n                \"Saturday\",\n            ],\n            shortWeekdays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n\n            longDateFormat: \"mmmm dd, yyyy\",\n            shortDateFormat: \"mm/dd/yyyy\",\n\n            unsupportedFeatures:\n                \"Warning: This event uses recurrence features not \" +\n                \"supported by this widget. Saving the recurrence \" +\n                \"may change the recurrence in unintended ways:\",\n            noTemplateMatch: \"No matching recurrence template\",\n            multipleDayOfMonth:\n                \"This widget does not support multiple days in monthly or yearly recurrence\",\n            bysetpos: \"BYSETPOS is not supported\",\n            noRule: \"No RRULE in RRULE data\",\n            noRepeatEvery: 'Error: The \"Repeat every\"-field must be between 1 and 1000',\n            noEndDate: \"Error: End date is not set. Please set a correct value\",\n            noRepeatOn: 'Error: \"Repeat on\"-value must be selected',\n            pastEndDate: \"Error: End date cannot be before start date\",\n            noEndAfterNOccurrences:\n                'Error: The \"After N occurrences\"-field must be between 1 and 1000',\n            alreadyAdded: \"This date was already added\",\n\n            rtemplate: {\n                daily: \"Daily\",\n                mondayfriday: \"Monday and Friday\",\n                weekdays: \"Weekday\",\n                weekly: \"Weekly\",\n                monthly: \"Monthly\",\n                yearly: \"Yearly\",\n            },\n        },\n\n        readOnly: false,\n        firstDay: 0,\n\n        // \"REMOTE\" FIELD\n        startField: null,\n        startFieldYear: null,\n        startFieldMonth: null,\n        startFieldDay: null,\n        ajaxURL: null,\n        ajaxContentType: \"application/json; charset=utf8\",\n        ributtonExtraClass: \"\",\n\n        // INPUT CONFIGURATION\n        hasRepeatForeverButton: true,\n\n        // JQUERY TEMPLATE NAMES\n        template: {\n            form: \"#jquery-recurrenceinput-form-tmpl\",\n            display: \"#jquery-recurrenceinput-display-tmpl\",\n        },\n\n        // RECURRENCE TEMPLATES\n        rtemplate: {\n            daily: {\n                rrule: \"FREQ=DAILY\",\n                fields: [\"ridailyinterval\", \"rirangeoptions\"],\n            },\n            mondayfriday: {\n                rrule: \"FREQ=WEEKLY;BYDAY=MO,FR\",\n                fields: [\"rirangeoptions\"],\n            },\n            weekdays: {\n                rrule: \"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR\",\n                fields: [\"rirangeoptions\"],\n            },\n            weekly: {\n                rrule: \"FREQ=WEEKLY\",\n                fields: [\"riweeklyinterval\", \"riweeklyweekdays\", \"rirangeoptions\"],\n            },\n            monthly: {\n                rrule: \"FREQ=MONTHLY\",\n                fields: [\"rimonthlyinterval\", \"rimonthlyoptions\", \"rirangeoptions\"],\n            },\n            yearly: {\n                rrule: \"FREQ=YEARLY\",\n                fields: [\"riyearlyinterval\", \"riyearlyoptions\", \"rirangeoptions\"],\n            },\n        },\n    },\n\n    load_icons: async function () {\n        return {\n            reload: await utils.resolveIcon(\"arrow-clockwise\"),\n            remove: await utils.resolveIcon(\"trash\"),\n            exclude: await utils.resolveIcon(\"calendar-x\"),\n            include: await utils.resolveIcon(\"plus-circle\"),\n        };\n    },\n\n    init: async function () {\n        // tmpl BEFORE recurrenceinput\n        import(\"./recurrence.scss\");\n\n        this.el.classList.add(\"recurrence-widget\");\n        var icons = await this.load_icons();\n\n        var config = {\n            ...this.options,\n            ...this.options.configuration,\n            icons: icons,\n        };\n\n        // our recurrenceinput widget instance\n        var recurrenceinput = new RecurrenceInput(config, this.el);\n        // hide textarea and place display widget after textarea\n        this.$el.after(recurrenceinput.display);\n\n        // hide the textarea\n        this.el.style.display = \"none\";\n    },\n});\n","// Plone extended search.\nimport $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"search\",\n    trigger: \".pat-search\",\n    init: function () {\n        var loading = new utils.Loading();\n\n        var $filter = $(\"#search-filter\");\n        var $filterBtn = $(\"#search-filter-toggle\", $filter);\n        var $advSearchInput = $(\"#advanced-search-input\");\n        var $ctSelectAll = $(\"#pt_toggle\");\n        var $selectAllContainer = $(\".search-type-options\");\n        var $sortingContainer = $(\"#sorting-options\");\n\n        /* handle history */\n        if (window.history && window.history.pushState) {\n            $(window).on(\"popstate\", function () {\n                /* we're just going to cheat and reload the page so\n                   we aren't keep moving around state here..\n                   Here, I'm lazy, we're not using react here... */\n                window.location = window.location.href;\n            });\n        }\n\n        var pushHistory = function () {\n            if (window.history && window.history.pushState) {\n                var url =\n                    window.location.origin +\n                    window.location.pathname +\n                    \"?\" +\n                    $(\"#searchform\").serialize();\n                window.history.pushState(null, null, url);\n            }\n        };\n\n        var timeout = 0;\n        var search = function () {\n            loading.show();\n            pushHistory();\n            $.ajax({\n                url: window.location.origin + window.location.pathname + \"?ajax_load=1\",\n                data: $(\"#searchform\").serialize(),\n            }).done(function (html) {\n                var $html = $(html);\n                $(\"#search-results\").replaceWith($(\"#search-results\", $html));\n                $(\"#search-term\").replaceWith($(\"#search-term\", $html));\n                $(\"#results-count\").replaceWith($(\"#results-count\", $html));\n                loading.hide();\n            });\n        };\n        var searchDelayed = function () {\n            clearTimeout(timeout);\n            timeout = setTimeout(search, 200);\n        };\n\n        var setBatchStart = function (b_start) {\n            $(\"#search-batch-start\").attr(\"value\", b_start);\n        };\n\n        // for sorme reason the backend always flag with active class the sorting options\n        var updateSortingState = function ($el) {\n            $(\"a\", $sortingContainer).removeClass(\"active\");\n            $el.addClass(\"active\");\n        };\n        var default_sort = $(\"#search-results\").attr(\"data-default-sort\");\n        updateSortingState($(\"a[data-sort=\" + default_sort + \"]\"));\n\n        /* sorting */\n        $(\"a\", $sortingContainer).on(\"click\", function (e) {\n            e.preventDefault();\n            updateSortingState($(this));\n            var sort = $(this).attr(\"data-sort\");\n            var order = $(this).attr(\"data-order\");\n            if (sort) {\n                $('[name=\"sort_on\"]').attr(\"value\", sort);\n                if (order && order == \"reverse\") {\n                    $('[name=\"sort_order\"]').attr(\"value\", \"reverse\");\n                } else {\n                    $('[name=\"sort_order\"]').attr(\"value\", \"\");\n                }\n            } else {\n                $('[name=\"sort_on\"]').attr(\"value\", \"\");\n                $('[name=\"sort_order\"]').attr(\"value\", \"\");\n            }\n            search();\n        });\n\n        /* form submission */\n        $(\".searchPage\").on(\"submit\", function (e) {\n            e.preventDefault();\n            setBatchStart(\"0\");\n            search();\n        });\n\n        /* filters */\n        $filterBtn.on(\"click\", function (e) {\n            e.preventDefault();\n            $filter.toggleClass(\"activated\");\n            if ($filter.hasClass(\"activated\")) {\n                $advSearchInput.attr(\"value\", \"True\");\n            } else {\n                $advSearchInput.attr(\"value\", \"False\");\n            }\n        });\n\n        $ctSelectAll.on(\"change\", function () {\n            if ($ctSelectAll[0].checked) {\n                $(\"input\", $selectAllContainer).each(function () {\n                    this.checked = true;\n                });\n            } else {\n                $(\"input\", $selectAllContainer).each(function () {\n                    this.checked = false;\n                });\n            }\n        });\n\n        $(\"input\", $filter).on(\"change\", function () {\n            setBatchStart(\"0\");\n            searchDelayed();\n        });\n\n        /* pagination */\n        $(\"#searchform\").on(\"click\", \".pagination a\", function (e) {\n            var urlParams = new URLSearchParams($(e.currentTarget).attr(\"href\")),\n                b_start = urlParams.get(\"b_start:int\");\n            if (!b_start) {\n                // not plone pagination\n                return;\n            }\n            e.preventDefault();\n            setBatchStart(b_start);\n            search();\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"structure\",\n    trigger: \".pat-structure\",\n    parser: \"mockup\",\n    defaults: {\n        // for implementing history changes\n        // Example: {base: 'http://mysite.com', appended: '/folder_contents'}\n        urlStructure: null,\n        vocabularyUrl: null,\n        indexOptionsUrl: null, // for querystring widget\n        contextInfoUrl: null, // for add new dropdown and other info\n        setDefaultPageUrl: null,\n        menuOptions: null, // default action menu options per item.\n        backdropSelector: \".plone-modal\", // Element upon which to apply backdrops used for popovers\n\n        activeColumnsCookie: \"activeColumns\",\n\n        attributes: [\n            \"CreationDate\",\n            \"EffectiveDate\",\n            \"ExpirationDate\",\n            \"exclude_from_nav\",\n            \"getIcon\",\n            \"getMimeIcon\",\n            \"getObjSize\",\n            \"getURL\",\n            \"id\",\n            \"is_folderish\",\n            \"last_comment_date\",\n            \"ModificationDate\",\n            \"path\",\n            \"portal_type\",\n            \"review_state\",\n            \"Subject\",\n            \"Title\",\n            \"total_comments\",\n            \"UID\",\n        ],\n\n        activeColumns: [\"ModificationDate\", \"EffectiveDate\", \"review_state\"],\n\n        availableColumns: {\n            id: \"ID\",\n            ModificationDate: \"Last modified\",\n            EffectiveDate: \"Published\",\n            ExpirationDate: \"Expiration\",\n            CreationDate: \"Created\",\n            review_state: \"Review state\",\n            Subject: \"Tags\",\n            portal_type: \"Type\",\n            is_folderish: \"Folder\",\n            exclude_from_nav: \"Excluded from navigation\",\n            getObjSize: \"Object Size\",\n            last_comment_date: \"Last comment date\",\n            total_comments: \"Total comments\",\n        },\n\n        typeToViewAction: {\n            File: \"/view\",\n            Image: \"/view\",\n            Blob: \"/view\",\n        },\n\n        defaultPageTypes: [\"Document\", \"Event\", \"News Item\", \"Collection\"],\n\n        language: \"en\",\n        dateFormat: {\n            dateStyle: \"medium\",\n            timeStyle: \"medium\",\n        },\n        rearrange: {\n            properties: {\n                id: \"ID\",\n                sortable_title: \"Title\",\n                // icon: \"plone-rearrange\",\n            },\n            url: \"/rearrange\",\n        },\n        moveUrl: null,\n\n        buttons: [\n            {\n                tooltip: \"Cut\",\n                url: \"/cut\",\n                icon: \"plone-cut\",\n            },\n            {\n                tooltip: \"Copy\",\n                url: \"/copy\",\n                icon: \"plone-copy\",\n            },\n            {\n                tooltip: \"Paste\",\n                url: \"/paste\",\n                icon: \"plone-paste\",\n            },\n            {\n                tooltip: \"Delete\",\n                url: \"/delete\",\n                context: \"danger\",\n                icon: \"plone-delete\",\n            },\n            {\n                tooltip: \"Workflow\",\n                url: \"/workflow\",\n                icon: \"plone-lock\",\n            },\n            {\n                tooltip: \"Tags\",\n                url: \"/tags\",\n                icon: \"tags\",\n            },\n            {\n                tooltip: \"Properties\",\n                url: \"/properties\",\n                icon: \"plone-edit\",\n            },\n            {\n                tooltip: \"Rename\",\n                url: \"/rename\",\n                icon: \"plone-rename\",\n            },\n        ],\n\n        datatables_options: {},\n\n        upload: {\n            uploadMultiple: true,\n            showTitle: true,\n        },\n    },\n\n    async init() {\n        import(\"./structure.scss\");\n        (await import(\"bootstrap\")).Dropdown;\n\n        // backbone paginator, loaded by app-view expects Backbone and\n        // Underscore to be in global namespace.\n        const _ = (await import(\"underscore\")).default;\n        const Backbone = (await import(\"backbone\")).default;\n        window._ = _;\n        window.Backbone = Backbone;\n\n        const AppView = (await import(\"./js/views/app\")).default;\n\n        this.browsing = true; // so all queries will be correct with QueryHelper\n        this.options.collectionUrl = this.options.vocabularyUrl;\n        this.options.pattern = this;\n        this.options.language =\n            document.querySelector(\"html\").getAttribute(\"lang\") || \"en\";\n\n        // the ``attributes`` options key is not compatible with backbone,\n        // but queryHelper that will be constructed by the default\n        // ResultCollection will expect this to be passed into it.\n        this.options.queryHelperAttributes = this.options.attributes;\n        delete this.options.attributes;\n\n        const view = new AppView(this.options);\n        await view.render();\n        this.$el.append(view.$el);\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\n\nconst log = logger.getLogger(\"pat-toggle\");\n\nexport default Base.extend({\n    name: \"toggle\",\n    trigger: \".pat-toggle\",\n    parser: \"mockup\",\n    defaults: {\n        attribute: \"class\",\n        event: \"click\",\n        targetScope: \"global\",\n    },\n    init: function () {\n        var self = this;\n\n        if (!self.options.target) {\n            self.$target = self.$el;\n        } else if (self.options.targetScope === \"global\") {\n            self.$target = $(self.options.target);\n        } else {\n            //self.$target = self.$el[self.options.menu](self.options.target);\n            self.$target = self.$el\n                .parents(self.options.targetScope)\n                .first()\n                .find(self.options.target);\n        }\n\n        if (!self.$target || self.$target.length === 0) {\n            log.error(`No target found for \"${self.options.target}\".`);\n        }\n\n        self.on(self.options.event, function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            self.toggle();\n        });\n    },\n    isMarked: function () {\n        var self = this;\n        var marked = false;\n\n        for (var i = 0; i < this.$target.length; i = i + 1) {\n            if (self.options.attribute === \"class\") {\n                if (this.$target.eq(i).hasClass(this.options.value)) {\n                    marked = true;\n                } else {\n                    marked = false;\n                    break;\n                }\n            } else {\n                if (\n                    this.$target.eq(i).attr(this.options.attribute) ===\n                    this.options.value\n                ) {\n                    marked = true;\n                } else {\n                    marked = false;\n                    break;\n                }\n            }\n        }\n        return marked;\n    },\n    toggle: function () {\n        var self = this;\n        if (self.isMarked()) {\n            self.remove();\n        } else {\n            self.add();\n        }\n    },\n    remove: function () {\n        var self = this;\n        self.emit(\"remove-attr\");\n        if (self.options.attribute === \"class\") {\n            self.$target.removeClass(self.options.value);\n        } else {\n            self.$target.removeAttr(self.options.attribute);\n        }\n        self.emit(\"attr-removed\");\n    },\n    add: function () {\n        var self = this;\n        self.emit(\"add-attr\");\n        if (self.options.attribute === \"class\") {\n            self.$target.addClass(self.options.value);\n        } else {\n            self.$target.attr(self.options.attribute, self.options.value);\n        }\n        self.emit(\"added-attr\");\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport Cookies from \"js-cookie\";\n\nexport default Base.extend({\n    name: \"toolbar\",\n    trigger: \".pat-toolbar\",\n    parser: \"mockup\",\n    defaults: {},\n\n    init: function () {\n        $(\"body\").on(\"structure-url-changed\", (e, path) => {\n            $.ajax({\n                url: $(\"body\").attr(\"data-portal-url\") + path + \"/@@render-toolbar\",\n            }).done((data) => {\n                const wrapper = $(utils.parseBodyTag(data));\n                const $main_toolbar = wrapper.find(\"#edit-zone .plone-toolbar-main\");\n                const $personal_tools = wrapper.find(\n                    \"#edit-zone #collapse-personaltools\"\n                );\n                // setup modals\n                registry.scan($main_toolbar);\n                $(\".plone-toolbar-main\", this.$el).replaceWith($main_toolbar);\n                $(\"#collapse-personaltools\", this.$el).replaceWith($personal_tools);\n            });\n        });\n\n        // unpin toolbar and save state\n        this.$el.on(\"click\", \".toolbar-collapse\", () => {\n            $(\"body\").removeClass(\"plone-toolbar-left-expanded\");\n            Cookies.set(\"plone-toolbar\", JSON.stringify({ expanded: false }), {\n                path: \"/\",\n            });\n        });\n\n        // pin toolbar and save state\n        this.$el.on(\"click\", \".toolbar-expand\", () => {\n            $(\"body\").addClass(\"plone-toolbar-left-expanded\");\n            Cookies.set(\"plone-toolbar\", JSON.stringify({ expanded: true }), {\n                path: \"/\",\n            });\n        });\n\n        this.el.classList.add(\"initialized\");\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"tree\",\n    trigger: \".pat-tree\",\n    parser: \"mockup\",\n    defaults: {\n        dragAndDrop: false,\n        autoOpen: false,\n        selectable: true,\n        keyboardSupport: true,\n        onLoad: null,\n    },\n\n    async init() {\n        import(\"jqtree/jqtree.css\");\n        import(\"./tree.scss\");\n        await import(\"jqtree\");\n\n        var self = this;\n        /* convert all bool options */\n        for (var optionKey in self.options) {\n            var def = self.defaults[optionKey];\n            if (def !== undefined && typeof def === \"boolean\") {\n                self.options[optionKey] = utils.bool(self.options[optionKey]);\n            }\n        }\n\n        if (self.options.onCanMoveTo === undefined) {\n            self.options.onCanMoveTo = function (moved, target, position) {\n                /* if not using folder option, just allow, otherwise, only allow if folder */\n                if (position === \"inside\") {\n                    return target.folder === undefined || target.folder === true;\n                }\n                return true;\n            };\n        }\n\n        if (self.options.data && typeof self.options.data === \"string\") {\n            self.options.data = $.parseJSON(self.options.data);\n        }\n        if (self.options.onLoad !== null) {\n            // delay generating tree...\n            var options = $.extend({}, self.options);\n\n            $.getJSON(options.dataUrl, function (data) {\n                options.data = data;\n                delete options.dataUrl;\n                self.tree = self.$el.tree(options);\n                self.options.onLoad(self);\n            }).fail(function (response) {  // eslint-disable-line no-unused-vars\n                console.log(\"failed to load json data\");\n            });\n        } else {\n            self.tree = self.$el.tree(self.options);\n        }\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"dexterity-types-listing\",\n    trigger: \"form[action$='dexterity-types']\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (\n            await import(\"./dexterity-types-listing--implementation\")\n        ).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"registry\",\n    trigger: \".pat-registry\",\n    parser: \"mockup\",\n    init: async function () {\n        const implementation = (await import(\"./registry--implementation.js\")).default;\n        const reg = new implementation(this.el);\n        reg.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"schemaeditor\",\n    trigger: \".pat-schemaeditor\",\n    parser: \"mockup\",\n    init: async function () {\n        const implementation = (await import(\"./schemaeditor--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"contentrules\",\n    trigger: \"form[name='ruleSettings']\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./contentrules--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"contentrules-elements\",\n    trigger: \"pat-contentrules-elements\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./contentrule-elements--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion\",\n    trigger: \"form#DiscussionSettingsEditForm\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion-comments\",\n    trigger: \".pat-discussion\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion-comments--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion-moderation\",\n    trigger: \"#fieldset-moderate-comments\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion-moderation--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","/* Patterns bundle configuration.\n * All imports here will go into the compiled bundle.\n */\n\n// Core\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\n// Patternslib patterns\nimport \"@patternslib/patternslib/src/pat/checklist/checklist\";\nimport \"@patternslib/patternslib/src/pat/date-picker/date-picker\";\nimport \"@patternslib/patternslib/src/pat/datetime-picker/datetime-picker\";\nimport \"@patternslib/patternslib/src/pat/display-time/display-time\";\nimport { Pattern as ValidationPattern } from \"@patternslib/patternslib/src/pat/validation/validation\"; // Also loads the Pattern itself.\nimport { parser as tooltip_parser } from \"@patternslib/patternslib/src/pat/tooltip/tooltip\";\n// import \"@patternslib/pat-code-editor/src/code-editor\";\nimport \"@patternslib/patternslib/src/pat/inject/inject\";\nimport \"@patternslib/patternslib/src/pat/depends/depends\";\n\n//import \"@patternslib/pat-content-browser/src/content-browser\";\n//import \"@patternslib/pat-tinymce/src/tinymce\";\n\n// Import all used patterns for the bundle to be generated\nimport \"./pat/autotoc/autotoc\";\nimport \"./pat/backdrop/backdrop\";\nimport \"./pat/contentloader/contentloader\";\nimport \"./pat/cookietrigger/cookietrigger\";\nimport \"./pat/datatables/datatables\";\nimport \"./pat/formautofocus/formautofocus\";\nimport \"./pat/formunloadalert/formunloadalert\";\nimport \"./pat/livesearch/livesearch\";\nimport \"./pat/markspeciallinks/markspeciallinks\";\nimport \"./pat/modal/modal\";\nimport \"./pat/navigationmarker/navigationmarker\";\nimport \"./pat/passwordstrength/passwordstrength\";\nimport \"./pat/preventdoublesubmit/preventdoublesubmit\";\nimport \"./pat/manageportlets/manageportlets.js\";\nimport \"./pat/querystring/querystring\";\nimport \"./pat/recurrence/recurrence\";\nimport \"./pat/relateditems/relateditems\";\nimport \"./pat/search/search\";\nimport \"./pat/select2/select2\";\nimport \"./pat/sortable/sortable\";\nimport \"./pat/structure/structure\";\n// import \"./pat/textareamimetypeselector/textareamimetypeselector\";\n//import \"./pat/tinymce/tinymce\";\nimport \"./pat/toggle/toggle\";\nimport \"./pat/toolbar/toolbar\";\nimport \"./pat/tree/tree\";\nimport \"./pat/upload/upload\";\n\n// REMOVE obsolete patterns\n//import \"./pat/texteditor/texteditor\";\n\n// Controlpanels\nimport \"./pat/controlpanels/dexterity-types-listing\";\nimport \"./pat/controlpanels/registry\";\nimport \"./pat/controlpanels/schemaeditor\";\nimport \"./pat/controlpanels/contentrules\";\nimport \"./pat/controlpanels/contentrule-elements\";\nimport \"./pat/controlpanels/discussion\";\nimport \"./pat/controlpanels/discussion-comments\";\nimport \"./pat/controlpanels/discussion-moderation\";\n\n// Change default value for pat-tooltip trigger\ntooltip_parser.parameters.trigger.value = \"hover\";\n\n// Change validation error template to be BS compatible\nValidationPattern.prototype.error_template = (message) =>\n    `<em class=\"invalid-feedback\">${message}</em>`;\n\n// Import pattern styles in JavaScript\nwindow.__patternslib_import_styles = true;\n\nregistry.init();\n","import $ from \"jquery\";\n\nvar parser = {\n    getOptions($el, patternName, options) {\n        /* This is the Mockup parser. An alternative parser for Patternslib\n         * patterns.\n         *\n         * NOTE: Use of the Mockup parser is discouraged and is added here for\n         * legacy support for the Plone Mockup project.\n         *\n         * It parses a DOM element for pattern configuration options.\n         */\n        options = options || {};\n        // get options from parent element first, stop if element tag name is 'body'\n        if ($el.length !== 0 && !$.nodeName($el[0], \"body\")) {\n            options = this.getOptions($el.parent(), patternName, options);\n        }\n        // collect all options from element\n        let elOptions = {};\n        if ($el.length !== 0) {\n            elOptions = $el.data(\"pat-\" + patternName);\n            if (elOptions) {\n                // parse options if string\n                if (typeof elOptions === \"string\") {\n                    const tmpOptions = {};\n                    $.each(elOptions.split(\";\"), function (i, item) {\n                        item = item.split(\":\");\n                        item.reverse();\n                        let key = item.pop();\n                        key = key.replace(/^\\s+|\\s+$/g, \"\"); // trim\n                        item.reverse();\n                        let value = item.join(\":\");\n                        value = value.replace(/^\\s+|\\s+$/g, \"\"); // trim\n                        tmpOptions[key] = value;\n                    });\n                    elOptions = tmpOptions;\n                }\n            }\n        }\n        return $.extend(true, {}, options, elOptions);\n    },\n};\n\nexport default parser;\n","/**\n * A Base pattern for creating scoped patterns. It's similar to Backbone's\n * Model class. The advantage of this approach is that each instance of a\n * pattern has its own local scope (closure).\n *\n * A new instance is created for each DOM element on which a pattern applies.\n *\n * You can assign values, such as $el, to `this` for an instance and they\n * will remain unique to that instance.\n *\n * Older Patternslib patterns on the other hand have a single global scope for\n * all DOM elements.\n */\nimport $ from \"jquery\";\nimport Registry from \"./registry\";\nimport logging from \"./logging\";\nimport mockupParser from \"./mockup-parser\";\n\nconst log = logging.getLogger(\"Patternslib Base\");\n\nconst initBasePattern = function ($el, options, trigger) {\n    if (!$el.jquery) {\n        $el = $($el);\n    }\n    const name = this.prototype.name;\n    const plog = logging.getLogger(`pat.${name}`);\n    let pattern = $el.data(`pattern-${name}`);\n    if (pattern === undefined && Registry.patterns[name]) {\n        try {\n            // Immediately set the pattern instance to the temporary value\n            // ``initializing`` before the async Base constructor is setting\n            // the value later.\n            // This prevents re-init the pattern on this element on multiple\n            // initialization calls..\n            $el.data(`pattern-${name}`, \"initializing\");\n            options =\n                this.prototype.parser === \"mockup\"\n                    ? mockupParser.getOptions($el, name, options)\n                    : options;\n            pattern = new Registry.patterns[name]($el, options, trigger);\n        } catch (e) {\n            plog.error(`Failed while initializing ${name} pattern.`, e);\n        }\n    }\n    return pattern;\n};\n\nconst Base = async function ($el, options, trigger) {\n    if (($el?.jquery && $el.length === 0) || !$el) {\n        log.warn(\"No element given to pattern.\");\n        return;\n    }\n    if (!$el.jquery) {\n        $el = $($el);\n    }\n    this.$el = $el;\n    this.el = $el[0];\n    this.options = $.extend(true, {}, this.defaults || {}, options || {});\n\n    this.emit(\"pre-init\");\n\n    await this.init($el, options, trigger);\n\n    // Store pattern instance on element\n    this.$el.data(`pattern-${this.name}`, this);\n    this.el[`pattern-${this.name}`] = this;\n\n    this.emit(\"init\");\n};\n\nBase.prototype = {\n    constructor: Base,\n    on(eventName, eventCallback) {\n        this.$el.on(`${eventName}.${this.name}.patterns`, eventCallback);\n    },\n    one(eventName, eventCallback) {\n        this.$el.one(`${eventName}.${this.name}.patterns`, eventCallback);\n    },\n    emit(eventName, args) {\n        // args should be a list\n        if (args === undefined) {\n            args = [];\n        }\n        this.$el.trigger(`${eventName}.${this.name}.patterns`, args);\n    },\n};\n\nBase.extend = function (patternProps) {\n    /* Helper function to correctly set up the prototype chain for new patterns.\n     */\n    const parent = this;\n    let child;\n\n    // Check that the required configuration properties are given.\n    if (!patternProps) {\n        throw new Error(\n            \"Pattern configuration properties required when calling Base.extend\"\n        );\n    }\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent's constructor.\n    if (Object.hasOwnProperty.call(patternProps, \"constructor\")) {\n        child = patternProps.constructor;\n    } else {\n        child = function () {\n            parent.apply(this, arguments);\n        };\n    }\n\n    // Allow patterns to be extended indefinitely\n    child.extend = Base.extend;\n\n    // Static properties required by the Patternslib registry\n    child.init = initBasePattern;\n    child.jquery_plugin = true;\n    child.trigger = patternProps.trigger;\n    child.parser = patternProps?.parser || null;\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () {\n        this.constructor = child;\n    };\n    Surrogate.prototype = parent.prototype;\n    child.prototype = new Surrogate();\n\n    // Add pattern's configuration properties (instance properties) to the subclass,\n    $.extend(true, child.prototype, patternProps);\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = parent.prototype;\n\n    // Register the pattern in the Patternslib registry.\n    if (!patternProps.name) {\n        log.warn(\"This pattern without a name attribute will not be registered!\");\n    } else if (!patternProps.trigger) {\n        log.warn(\n            `The pattern ${patternProps.name} does not have a trigger attribute, it will not be registered.`\n        );\n    } else if (patternProps.autoregister !== false) {\n        Registry.register(child, patternProps.name);\n    }\n    return child;\n};\n\nexport default Base;\n","/**\n * A Base pattern for creating scoped patterns.\n *\n * Each instance of a pattern has its own local scope.\n * A new instance is created for each DOM element on which a pattern applies.\n *\n * For usage, see basepattern.md\n */\nimport events from \"./events\";\nimport logging from \"./logging\";\n\nconst log = logging.getLogger(\"basepattern\");\n\nclass BasePattern {\n    static name; // name of pattern used in Registry.\n    static trigger; // A CSS selector to match elements that should trigger the pattern instantiation.\n    static parser; // Options parser.\n\n    // Parser options\n    parser_group_options = true;\n    parser_multiple = undefined;\n    parser_inherit = true;\n\n    constructor(el, options = {}) {\n        // Make static variables available on instance.\n        this.name = this.constructor.name;\n        this.trigger = this.constructor.trigger;\n        this.parser = this.constructor.parser;\n\n        if (!el) {\n            log.warn(`No element given to pattern ${this.name}.`);\n            return;\n        }\n        if (el.jquery) {\n            el = el[0];\n        }\n        this.el = el;\n\n        // Notify pre-init\n        this.el.dispatchEvent(\n            new Event(`pre-init.${this.name}.patterns`, {\n                bubbles: true,\n                cancelable: true,\n            })\n        );\n\n        // Initialize asynchronously.\n        //\n        // 1) We need to call the concrete implementation of ``init``, but the\n        //    inheritance chain is not yet set up and ``init`` not available.\n        //\n        // 2) We want to wait for the init() to successfuly finish and fire an\n        //    event then.\n        //    But the constructer cannot not return a Promise, thus not be\n        //    asynchronous but only return itself.\n        //\n        // Both limitations are gone in next tick.\n        //\n        window.setTimeout(async () => {\n            if (typeof this.el[`pattern-${this.name}`] !== \"undefined\") {\n                // Do not reinstantiate\n                log.debug(`Not reinstatiating the pattern ${this.name}.`, this.el);\n\n                // Notify that not instantiated\n                this.el.dispatchEvent(\n                    new Event(`not-init.${this.name}.patterns`, {\n                        bubbles: true,\n                        cancelable: false,\n                    })\n                );\n                return;\n            }\n\n            // Create the options object by parsing the element and using the\n            // optional options as default.\n            this.options =\n                this.parser?.parse(\n                    this.el,\n                    options,\n                    this.parser_multiple,\n                    this.parser_inherit,\n                    this.parser_group_options\n                ) ?? options;\n\n            // Store pattern instance on element\n            this.el[`pattern-${this.name}`] = this;\n\n            // Initialize the pattern\n            await this.init();\n\n            // Notify that now ready\n            this.el.dispatchEvent(\n                new Event(`init.${this.name}.patterns`, {\n                    bubbles: true,\n                    cancelable: true,\n                })\n            );\n        }, 0);\n    }\n\n    async init() {\n        // Extend this method in your pattern.\n    }\n\n    /**\n     * Listen to an event on the element only once.\n     *\n     * @param {string} event_name - Name of the event to listen to.\n     * @param {function} callback - Callback to call when the event is thrown.\n     */\n    one(event_name, event_callback) {\n        events.add_event_listener(\n            this.el,\n            `${event_name}.${this.name}.patterns`,\n            `basepattern-one--${event_name}.${this.name}.patterns`,\n            event_callback,\n            {\n                once: true,\n            }\n        );\n    }\n\n    /**\n     * Destroy/remove/unload the pattern from the element.\n     */\n    destroy() {\n        delete this.el[`pattern-${this.name}`];\n    }\n}\n\nexport default BasePattern;\nexport { BasePattern };\n","/* Utilities for DOM traversal or navigation */\nimport events from \"./events\";\nimport logging from \"./logging\";\n\nconst logger = logging.getLogger(\"core dom\");\n\nconst DATA_PREFIX = \"__patternslib__data_prefix__\";\nconst DATA_STYLE_DISPLAY = \"__patternslib__style__display\";\n\n/**\n * Return an array of DOM nodes.\n *\n * @param {Node|NodeList|jQuery} nodes - The DOM node to start the search from.\n *\n * @returns {Array} - An array of DOM nodes.\n */\nconst toNodeArray = (nodes) => {\n    if (nodes.jquery || nodes instanceof NodeList) {\n        // jQuery or document.querySelectorAll\n        nodes = [...nodes];\n    } else if (nodes instanceof Array === false) {\n        nodes = [nodes];\n    }\n    return nodes;\n};\n\n/**\n * Like querySelectorAll but including the element where it starts from.\n * Returns an Array, not a NodeList\n *\n * @param {Node} el - The DOM node to start the search from.\n *\n * @returns {Array} - The DOM nodes found.\n */\nconst querySelectorAllAndMe = (el, selector) => {\n    if (!el) {\n        return [];\n    }\n\n    const all = [...el.querySelectorAll(selector)];\n    if (el.matches(selector)) {\n        all.unshift(el); // start element should be first.\n    }\n    return all;\n};\n\n/**\n * Wrap a element with a wrapper element.\n *\n * The element to be wrapped will be moved into the wrapper element and the\n * wrapper element is placed just before the old element was.\n *\n * @param {Node} el - The DOM node to wrap.\n * @param {Node} wrapper - The wrapper element.\n */\nconst wrap = (el, wrapper) => {\n    // See: https://stackoverflow.com/a/13169465/1337474\n    el.parentNode.insertBefore(wrapper, el);\n    wrapper.appendChild(el);\n};\n\n/**\n * Hides the element with ``display: none`` and stores the current display value.\n *\n * @param {Node} el - The DOM node to hide.\n */\nconst hide = (el) => {\n    if (el.style.display === \"none\") {\n        // Nothing to do.\n        return;\n    }\n    if (el.style.display) {\n        el[DATA_STYLE_DISPLAY] = el.style.display;\n    }\n    el.style.display = \"none\";\n};\n\n/**\n * Shows element by removing ``display: none`` and restoring the display value\n * to whatever it was before.\n *\n * @param {Node} el - The DOM node to show.\n */\nconst show = (el) => {\n    const val = el[DATA_STYLE_DISPLAY] || null;\n    el.style.display = val;\n    delete el[DATA_STYLE_DISPLAY];\n};\n\n/**\n * Test, if a element is visible or not.\n *\n * @param {Node} el - The DOM node to test.\n * @returns {Boolean} - True if the element is visible.\n */\nconst is_visible = (el) => {\n    // Check, if element is visible in DOM.\n    // https://stackoverflow.com/a/19808107/1337474\n    return el.offsetWidth > 0 && el.offsetHeight > 0;\n};\n\n/**\n * Test, if a element is a input-type element.\n *\n * This is taken from Sizzle/jQuery at:\n * https://github.com/jquery/sizzle/blob/f2a2412e5e8a5d9edf168ae3b6633ac8e6bd9f2e/src/sizzle.js#L139\n * https://github.com/jquery/sizzle/blob/f2a2412e5e8a5d9edf168ae3b6633ac8e6bd9f2e/src/sizzle.js#L1773\n *\n * @param {Node} el - The DOM node to test.\n * @returns {Boolean} - True if the element is a input-type element.\n */\nconst is_input = (el) => {\n    const re_input = /^(?:input|select|textarea|button)$/i;\n    return re_input.test(el.nodeName);\n};\n\n/**\n * Return all direct parents of ``el`` matching ``selector``.\n * This matches against all parents but not the element itself.\n * The order of elements is from the search starting point up to higher\n * DOM levels.\n *\n * @param {Node} el - The DOM node to start the search from.\n * @param {String} selector - CSS selector to match against.\n * @returns {Array} - List of matching DOM nodes.\n */\nconst find_parents = (el, selector) => {\n    const ret = [];\n    let parent = el;\n    while (parent) {\n        parent = parent.parentNode?.closest?.(selector);\n        if (parent) ret.push(parent);\n    }\n    return ret;\n};\n\n/**\n * Find an element in the whole DOM tree if the selector is an ID selector,\n * otherwise use the given element as the starting point.\n *\n * @param {Node} el - The DOM node to start the search from.\n * @param {String} selector - The CSS selector to search for.\n *\n * @returns {NodeList} - The DOM nodes found.\n *\n */\nconst find_scoped = (el, selector) => {\n    // If the selector starts with an object id do a global search,\n    // otherwise do a local search.\n    return (selector.indexOf(\"#\") === 0 ? document : el).querySelectorAll(selector);\n};\n\n/**\n * Return all HTMLElement parents of el, starting from the direct parent of el.\n * The document itself is excluded because it's not a real DOM node.\n *\n * @param {Node} el - The DOM node to start the search from.\n *\n * @returns {Array} - The DOM nodes found.\n */\nconst get_parents = (el) => {\n    // Return all HTMLElement parents of el, starting from the direct parent of el.\n    const parents = [];\n    let parent = el?.parentNode;\n    while (parent) {\n        parents.push(parent);\n        parent = parent?.parentNode;\n        parent = parent instanceof HTMLElement ? parent : null;\n    }\n    return parents;\n};\n\n/**\n * Return the value of the first attribute found in the list of parents.\n *\n * @param {Node} el - The DOM element to start the acquisition search for the given attribute.\n * @param {string} attribute - Name of the attribute to search for.\n * @param {Boolean} include_empty - Also return empty values.\n * @param {Boolean} include_all - Return a list of attribute values found in all parents.\n *\n * @returns {*} - Returns the value of the searched attribute or a list of all attributes.\n */\nconst acquire_attribute = (\n    el,\n    attribute,\n    include_empty = false,\n    include_all = false\n) => {\n    let _el = el;\n    const ret = []; // array for ``include_all`` mode.\n    while (_el) {\n        const val = _el.getAttribute(attribute);\n        if (val || (include_empty && val === \"\")) {\n            if (!include_all) {\n                return val;\n            }\n            ret.push(val);\n        }\n        _el = _el.parentElement;\n    }\n    if (include_all) {\n        return ret;\n    }\n};\n\n/**\n * Return a DocumentFragment from a given string.\n *\n * @param {String} string - The HTML structure as a string.\n *\n * @returns {DocumentFragment} - The DOM nodes as a DocumentFragment.\n */\nconst create_from_string = (string) => {\n    // See: https://davidwalsh.name/convert-html-stings-dom-nodes\n    return document.createRange().createContextualFragment(string.trim());\n};\n\n/**\n * Return a CSS property value for a given DOM node.\n * For length-values, relative values are converted to pixels.\n * Optionally parse as pixels, if applicable.\n *\n * Note: The element must be attached to the body to make CSS caluclations work.\n *\n * @param {Node} el - DOM node.\n * @param {String} property - CSS property to query on DOM node.\n * @param {Boolean} [as_pixels=false] - Convert value to pixels, if applicable.\n * @param {Boolean} [as_float=false] - Convert value to float, if applicable.\n *\n * @returns {(String|Number)} - The CSS value to return.\n */\nfunction get_css_value(el, property, as_pixels = false, as_float = false) {\n    let value = window.getComputedStyle(el).getPropertyValue(property);\n    if (as_pixels || as_float) {\n        value = parseFloat(value) || 0.0;\n    }\n    if (as_pixels && !as_float) {\n        value = parseInt(Math.round(value), 10);\n    }\n    return value;\n}\n\n/**\n * Find a scrollable element up in the DOM tree.\n *\n * Note: Setting the ``overflow`` shorthand property also sets the individual overflow-y and overflow-y properties.\n *\n * @param {Node} el - The DOM element to start the search on.\n * @param {String} [direction=] - Not given: Search for any scrollable element up in the DOM tree.\n *                                ``x``: Search for a horizontally scrollable element.\n *                                ``y``: Search for a vertically scrollable element.\n * @param {(Node|null)} [fallback=document.body] - Fallback, if no scroll container can be found.\n *                                                     The default is to use document.body.\n *\n * @returns {Node} - Return the first scrollable element.\n *                   If no other element could be found, document.body would be returned.\n */\nconst find_scroll_container = (el, direction, fallback = document.body) => {\n    while (el && el !== document.body) {\n        if (!direction || direction === \"y\") {\n            let overflow_y = get_css_value(el, \"overflow-y\");\n            if ([\"auto\", \"scroll\"].includes(overflow_y)) {\n                return el;\n            }\n        }\n        if (!direction || direction === \"x\") {\n            let overflow_x = get_css_value(el, \"overflow-x\");\n            if ([\"auto\", \"scroll\"].includes(overflow_x)) {\n                return el;\n            }\n        }\n        el = el.parentElement;\n    }\n    return fallback;\n};\n\n/**\n * Get the horizontal scroll position.\n *\n * @param {Node} scroll_reference - The element to get the scroll position from.\n *\n * @returns {number} The horizontal scroll position.\n */\nconst get_scroll_x = (scroll_reference) => {\n    // scroll_listener == window: window.scrollX\n    // scroll_listener == html: html.scrollLeft == window.scrollX\n    // scroll_listener == DOM node: node.scrollLeft\n    return typeof scroll_reference.scrollLeft !== \"undefined\"\n        ? scroll_reference.scrollLeft\n        : scroll_reference.scrollX;\n};\n\n/**\n * Get the vertical scroll position.\n *\n * @param {Node} scroll_reference - The element to get the scroll position from.\n *\n * @returns {number} The vertical scroll position.\n */\nconst get_scroll_y = (scroll_reference) => {\n    // scroll_listener == window: window.scrollY\n    // scroll_listener == html: html.scrollTop == window.scrollY\n    // scroll_listener == DOM node: node.scrollTop\n    return typeof scroll_reference.scrollTop !== \"undefined\"\n        ? scroll_reference.scrollTop\n        : scroll_reference.scrollY;\n};\n\n/**\n * Get the elements position relative to another element.\n *\n * @param {Node} el - The DOM element to get the position for.\n * @param {Node} [reference_el=document.body] - The DOM element to get the position relative to.\n *\n * @returns {{top: number, left: number}} - The position of the element relative to the other element.\n */\nconst get_relative_position = (el, reference_el = document.body) => {\n    // Get the reference element to which against we calculate\n    // the relative position of the target.\n    // In case of a scroll container of window, we do not have\n    // getBoundingClientRect method, so get the body instead.\n    if (reference_el === window) {\n        reference_el = document.body;\n    }\n\n    // Calculate absolute [] position difference between\n    // scroll_container and scroll_target.\n    // Substract the container's border from the scrolling\n    // value, as this one isn't respected by\n    // getBoundingClientRect [] and would lead to covered\n    // items [].\n    // ) so that it doesn't make a difference, if the element\n    // is below or above the scrolling container. We just need\n    // to know the absolute difference.\n    // ) Calculations are based from the viewport.\n    // ) See:\n    //      https://docs.microsoft.com/en-us/previous-versions//hh781509(v=vs.85)\n    //      https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n    const left = Math.abs(\n        el.getBoundingClientRect().left +\n            reference_el.scrollLeft -\n            reference_el.getBoundingClientRect().left -\n            dom.get_css_value(reference_el, \"border-left-width\", true)\n    );\n    const top = Math.abs(\n        el.getBoundingClientRect().top +\n            reference_el.scrollTop -\n            reference_el.getBoundingClientRect().top -\n            dom.get_css_value(reference_el, \"border-top-width\", true)\n    );\n\n    return { top, left };\n};\n\n/**\n * Scroll to a given element.\n * The element will be scrolled to the top of the scroll container.\n *\n * @param {Node} el - The element which should be scrolled to.\n * @param {Node} scroll_container - The element which is scrollable.\n * @param {number} [offset=0] - Optional offset in pixels to stop scrolling before the target position. Can also be a negative number.\n * @param {string} [direction=\"top\"] - The direction to scroll to. Can be either \"top\", \"left\" or \"both\".\n */\nconst scroll_to_element = (el, scroll_container, offset = 0, direction = \"top\") => {\n    // Get the position of the element relative to the scroll container.\n    const position = get_relative_position(el, scroll_container);\n\n    const options = { behavior: \"auto\" };\n    if (direction === \"top\" || direction === \"both\") {\n        options.top = position.top - offset;\n    }\n    if (direction === \"left\" || direction === \"both\") {\n        options.left = position.left - offset;\n    }\n\n    // Scroll to the target position.\n    scroll_container.scrollTo(options);\n};\n\n/**\n * Scroll to the top of a scrolling container.\n *\n * @param {Node} [scroll_container = document.body] - The element which is scrollable.\n * @param {number} [offset=0] - Optional offset in pixels to stop scrolling before the target position. Can also be a negative number.\n */\nconst scroll_to_top = (scroll_container = document.body, offset = 0) => {\n    // Just scroll up, period.\n    scroll_container.scrollTo({ top: 0 - offset, behavior: \"auto\" });\n};\n\n/**\n * Scroll to the bottom of a scrolling container.\n *\n * @param {Node} [scroll_container = document.body] - The element which is scrollable.\n * @param {number} [offset=0] - Optional offset in pixels to stop scrolling before the target position. Can also be a negative number.\n */\nconst scroll_to_bottom = (scroll_container = document.body, offset = 0) => {\n    // Just scroll up, period.\n    //\n    const top = (scroll_container === window ? document.body : scroll_container)\n        .scrollHeight;\n    scroll_container.scrollTo({ top: top - offset, behavior: \"auto\" });\n};\n\n/**\n * Get data stored directly on the node instance.\n * We are using a prefix to make sure the data doesn't collide with other attributes.\n *\n * @param el {Node} - The DOM node from which we want to retrieve the data.\n * @param name {String} - The name of the variable. Note - this is stored on\n *                        the DOM node prefixed with the DATA_PREFIX.\n * @param default_value {Any} - Optional default value.\n * @returns {Any} - The value which is stored on the DOM node.\n */\nconst get_data = (el, name, default_value) => {\n    return el[`${DATA_PREFIX}${name}`] || default_value;\n};\n\n/**\n * Set and store data directly on the node instance.\n * We are using a prefix to make sure the data doesn't collide with other attributes.\n *\n * @param el {Node} - The DOM node which we want to store the data on.\n * @param name {String} - The name of the variable. Note - this is stored on\n *                        the DOM node prefixed with the DATA_PREFIX.\n * @param value {Any} - The value we want to store on the DOM node.\n */\nconst set_data = (el, name, value) => {\n    el[`${DATA_PREFIX}${name}`] = value;\n};\n\n/**\n * Delete a variable from the node instance.\n * We are using a prefix to make sure the data doesn't collide with other attributes.\n *\n * @param el {Node} - The DOM node which we want to delete the variable from.\n * @param name {String} - The name of the variable. Note - this is stored on\n *                        the DOM node prefixed with the DATA_PREFIX.\n */\nconst delete_data = (el, name) => {\n    delete el[`${DATA_PREFIX}${name}`];\n};\n\n/**\n * Simple template engine, based on JS template literal\n *\n * NOTE: This uses eval and would break if Content-Security-Policy does not\n *       allow 'unsafe-eval'.\n *       Because of this CSR problem the use of this method is not recommended.\n *\n * Please note: You cannot pass a template literal as template_string.\n * JavaScript itself would try to expand it and would fail.\n *\n * See: https://stackoverflow.com/a/37217166/1337474\n *\n * @param {String} template_string - The template string as a JavaScript template literal.\n *                                   For each variable in the template you have to use ``this``.\n *                                   E.g. if you pass ``{message: \"ok\"}`` as template_variables, you can use it like so:\n *                                   `<h1>${this.message}</h1>`\n * @param {Object} template_variables - Object literal with all the variables which should be used in the template.\n *\n * @returns {String} - Returns the a string as template expanded with the template_variables.\n */\nconst template = (template_string, template_variables = {}) => {\n    logger.warn(\n        \"Using dom.template is not recommended due to a problem with Content-Security-Policy.\"\n    );\n    return new Function(\"return `\" + template_string + \"`;\").call(template_variables);\n};\n\n/**\n * Get the visible ratio of an element compared to container.\n * If no container is given, the viewport is used.\n *\n * Note: currently only vertical ratio is supported.\n *\n * @param {Node} el - The element to get the visible ratio from.\n * @param {Node} [container] - The container to compare the element to.\n * @returns {number} - The visible ratio of the element.\n *                    0 means the element is not visible.\n *                    1 means the element is fully visible.\n */\nconst get_visible_ratio = (el, container) => {\n    if (!el) {\n        return 0;\n    }\n\n    const rect = el.getBoundingClientRect();\n    const container_rect =\n        container !== window\n            ? container.getBoundingClientRect()\n            : {\n                  top: 0,\n                  bottom: window.innerHeight,\n              };\n\n    let visible_ratio = 0;\n    if (rect.top < container_rect.bottom && rect.bottom > container_rect.top) {\n        const rect_height = rect.bottom - rect.top;\n        const visible_height =\n            Math.min(rect.bottom, container_rect.bottom) -\n            Math.max(rect.top, container_rect.top);\n        visible_ratio = visible_height / rect_height;\n    }\n\n    return visible_ratio;\n};\n\n/**\n * Get an escaped CSS selector for a given id string.\n *\n * id selectors should - but don't have to - start with a letter.\n * If the id starts with a number or a dash, it should be escaped.\n * This method does that for you.\n *\n * Alse see:\n * - https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id\n * - https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape\n *\n * @param {String} id - The id to escape.\n *\n * @returns {String} - The escaped CSS selector.\n *\n * @example\n * escape_css_id_selector(\"#123\"); // returns \"#\\\\31 23\"\"\n * escape_css_id_selector(\"#-123\"); // returns \"#-\\\\31 23\"\n */\nconst escape_css_id = (id) => {\n    return `#${CSS.escape(id.split(\"#\")[1])}`;\n};\n\n/**\n * Get a universally unique id (uuid) for a DOM element.\n *\n * This method returns a uuid for the given element. On the first call it will\n * generate a uuid and store it on the element.\n *\n * @param {Node} el - The DOM node to get the uuid for.\n * @returns {String} - The uuid.\n */\nconst element_uuid = (el) => {\n    if (!get_data(el, \"uuid\", false)) {\n        let uuid;\n        if (window.crypto.randomUUID) {\n            // Create a real UUID\n            // window.crypto.randomUUID does only exist in browsers with secure\n            // context.\n            // See: https://developer.mozilla.org/en-US/docs/Web/API/Crypto/randomUUID\n            uuid = window.crypto.randomUUID();\n        } else {\n            // Create a sufficiently unique ID\n            const array = new Uint32Array(4);\n            uuid = window.crypto.getRandomValues(array).join(\"\");\n        }\n        set_data(el, \"uuid\", uuid);\n    }\n    return get_data(el, \"uuid\");\n};\n\n/**\n * Find a related form element.\n *\n * @param {Node} el - The DOM node to start the search from.\n * @returns {Node} - The closest form element.\n *\n * @example\n * find_form(document.querySelector(\"input\"));\n */\nconst find_form = (el) => {\n    // Prefer input.form which allows for input outside form elements and fall\n    // back to search for a parent form.\n    const form =\n        el.closest(\".pat-subform\") || // Special Patternslib subform concept has precedence.\n        el.form ||\n        el.querySelector(\"input, select, textarea, button\")?.form ||\n        el.closest(\"form\");\n    return form;\n};\n\nconst dom = {\n    toNodeArray: toNodeArray,\n    querySelectorAllAndMe: querySelectorAllAndMe,\n    wrap: wrap,\n    hide: hide,\n    show: show,\n    find_parents: find_parents,\n    find_scoped: find_scoped,\n    get_parents: get_parents,\n    acquire_attribute: acquire_attribute,\n    is_visible: is_visible,\n    is_input: is_input,\n    create_from_string: create_from_string,\n    get_css_value: get_css_value,\n    find_scroll_container: find_scroll_container,\n    get_scroll_x: get_scroll_x,\n    get_scroll_y: get_scroll_y,\n    get_relative_position: get_relative_position,\n    scroll_to_element: scroll_to_element,\n    scroll_to_top: scroll_to_top,\n    scroll_to_bottom: scroll_to_bottom,\n    get_data: get_data,\n    set_data: set_data,\n    delete_data: delete_data,\n    template: template,\n    get_visible_ratio: get_visible_ratio,\n    escape_css_id: escape_css_id,\n    element_uuid: element_uuid,\n    find_form: find_form,\n    add_event_listener: events.add_event_listener, // BBB export. TODO: Remove in an upcoming version.\n    remove_event_listener: events.remove_event_listener, // BBB export. TODO: Remove in an upcoming version.\n};\n\nexport default dom;\n","import utils from \"./utils\";\n\n// Event related methods and event factories\n\n// Event listener registration for easy-to-remove event listeners.\n// once Safari supports the ``signal`` option for addEventListener we can abort\n// event handlers by calling AbortController.abort().\nexport const event_listener_map = new Map();\n\n/**\n * Add an event listener to a DOM element under a unique id.\n * If a event is registered under the same id for the same element, the old handler is removed first.\n *\n * @param {DOM Node} el - The element to register the event for.\n * @param {string} event_type - The event type to listen for.\n * @param {string} id - A unique id under which the event is registered.\n * @param {function} cb - The event handler / callback function.\n * @param {Object} opts - Options for the addEventListener API.\n *\n */\nconst add_event_listener = (el, event_type, id, cb, opts = {}) => {\n    if (!el?.addEventListener) {\n        return; // nothing to do.\n    }\n    remove_event_listener(el, id); // do not register one listener twice.\n\n    // Create event_listener_map entry if not existent.\n    if (!event_listener_map.has(el)) {\n        event_listener_map.set(el, new Map());\n    }\n    let _cb = cb;\n    if (opts?.once === true) {\n        // For `once` events, also remove the entry from the event_listener_map.\n        _cb = (e) => {\n            event_listener_map.get(el)?.delete(id);\n            cb(e);\n        };\n    }\n    // Only `capture` option is necessary for `removeEventListener`.\n    event_listener_map\n        .get(el)\n        .set(id, [event_type, _cb, opts.capture ? opts : undefined]);\n    el.addEventListener(event_type, _cb, opts);\n};\n\n/**\n * Remove an event listener from a DOM element under a unique id.\n *\n * If an element and id are given, the event listeners for the given element matching the id are removed.\n * If an element but no id is given, all event listeners for that element are removed.\n * If an id but no element is given, all event listeners for any element matching the id are removed.\n * If no element and no id are given, all event listeners are removed.\n *\n * The id can be a wildcard string, e.g. `test-*-event`, which would match any\n * event which starts with \"test-\" and ends with \"-event\". The wildcard \"*\" can\n * be anywhere in the string and also be used multiple times. If no wildcard is\n * present the search string is used for an exact match.\n *\n * @param {DOM Node} [el] - The element to register the event for.\n * @param {string} [id] - A unique id under which the event is registered.\n *                        Can be a wildcard string.\n *\n */\nconst remove_event_listener = (el, id) => {\n    const els = el ? [el] : event_listener_map.keys();\n    for (const el of els) {\n        if (!el?.removeEventListener) {\n            return; // nothing to do.\n        }\n        const el_events = event_listener_map.get(el);\n        if (!el_events) {\n            return;\n        }\n        let entries;\n        if (id) {\n            // remove event listener with matching id\n            entries = [...el_events.entries()].filter((entry) =>\n                utils.regexp_from_wildcard(id).test(entry[0])\n            );\n        } else {\n            // remove all event listeners of element\n            entries = el_events.entries();\n        }\n        for (const entry of entries || []) {\n            // Remove event listener\n            el.removeEventListener(entry[1][0], entry[1][1], entry[1][2]);\n            // Delete entry from event_listener_map\n            event_listener_map.get(el).delete(entry[0]);\n            // Delete element from event_listener_map if no more events are registered.\n            if (!event_listener_map.get(el).size) {\n                event_listener_map.delete(el);\n            }\n        }\n    }\n};\n\n/**\n * Await an event to be thrown.\n *\n * Usage:\n *     await events.await_event(button, \"click\");\n *\n * @param {DOM Node} el - The element to listen on.\n * @param {String} event_name - The event name to listen for.\n *\n * @returns {Promise} - Returns a Promise which can be used for ``await`` and which will be resolved when the event is throwm.\n *\n */\nconst await_event = (el, event_name) => {\n    // See: https://stackoverflow.com/a/44746691/1337474\n    return new Promise((resolve) =>\n        el.addEventListener(event_name, resolve, { once: true })\n    );\n};\n\n/**\n * Await pattern init.\n *\n * Usage:\n *     await events.await_pattern_init(PATTERN);\n *\n * @param {Pattern instance} pattern - The pattern instance.\n *\n * @returns {Promise} - Returns a Promise which can be used for ``await`` and which will be resolved when the event is throwm.\n *\n */\nconst await_pattern_init = (pattern) => {\n    // See: https://stackoverflow.com/a/44746691/1337474\n    return new Promise((resolve, reject) => {\n        // Case initialized\n        pattern.one(\"init\", (e) => {\n            if (e.target !== pattern.el) {\n                // Don't handle bubbling init events from child elements. We\n                // want to check on init events coming directly from this\n                // Pattern's element.\n                return;\n            }\n            // Resolve promise and unregister the not-init event handler.\n            remove_event_listener(\n                pattern.el,\n                `basepattern-one--not-init.${pattern.name}.patterns`\n            );\n            resolve();\n        });\n\n        // Case not initialized\n        pattern.one(\"not-init\", (e) => {\n            if (e.target !== pattern.el) {\n                // Don't handle bubbling not-init events from child elements.\n                // We want to check on not-init events coming directly from\n                // this Pattern's element.\n                return;\n            }\n            // Reject promise and unregister the init event handler.\n            remove_event_listener(\n                pattern.el,\n                `basepattern-one--init.${pattern.name}.patterns`\n            );\n            reject();\n        });\n    }).catch(() => {\n        throw new Error(`Pattern \"${pattern.name}\" not initialized.`);\n    });\n};\n\n/**\n * Event factories\n */\n\n/** Generic event factory.\n *\n * A event factory for a bubbling and cancelable generic event.\n *\n * @param {string} name - The event name.\n * @returns {Event} - Returns a blur event.\n */\nconst generic_event = (name) => {\n    return new Event(name, {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst blur_event = () => {\n    return new Event(\"blur\", {\n        bubbles: false,\n        cancelable: false,\n    });\n};\n\nconst click_event = () => {\n    return new Event(\"click\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst change_event = () => {\n    return new Event(\"change\", {\n        bubbles: true,\n        cancelable: false,\n    });\n};\n\nconst focus_event = () => {\n    return new Event(\"focus\", {\n        bubbles: false,\n        cancelable: false,\n    });\n};\n\nconst input_event = () => {\n    return new Event(\"input\", {\n        bubbles: true,\n        cancelable: false,\n    });\n};\n\nconst mousedown_event = () => {\n    return new Event(\"mousedown\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst mouseup_event = () => {\n    return new Event(\"mouseup\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst scroll_event = () => {\n    return new Event(\"scroll\", {\n        bubbles: true,\n        cancelable: false,\n    });\n};\n\nconst submit_event = ({ submitter } = { submitter: undefined }) => {\n    const event = new Event(\"submit\", {\n        bubbles: true,\n        cancelable: true,\n    });\n    event.submitter = submitter; // undefined or the submitting element\n    return event;\n};\n\nconst dragstart_event = () => {\n    return new Event(\"dragstart\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nconst dragend_event = () => {\n    return new Event(\"dragend\", {\n        bubbles: true,\n        cancelable: true,\n    });\n};\n\nexport default {\n    add_event_listener: add_event_listener,\n    remove_event_listener: remove_event_listener,\n    await_event: await_event,\n    await_pattern_init: await_pattern_init,\n    generic_event: generic_event,\n    blur_event: blur_event,\n    click_event: click_event,\n    change_event: change_event,\n    focus_event: focus_event,\n    input_event: input_event,\n    mousedown_event: mousedown_event,\n    mouseup_event: mouseup_event,\n    scroll_event: scroll_event,\n    submit_event: submit_event,\n    dragstart_event: dragstart_event,\n    dragend_event: dragend_event,\n};\n","/**\n * Patterns logging - minimal logging framework\n *\n * Copyright 2012 Simplon B.V.\n */\n\n// source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind\nif (!Function.prototype.bind) {\n    Function.prototype.bind = function (oThis) {\n        if (typeof this !== \"function\") {\n            // closest thing possible to the ECMAScript 5 internal IsCallable function\n            throw new TypeError(\n                \"Function.prototype.bind - what is trying to be bound is not callable\"\n            );\n        }\n\n        var aArgs = Array.prototype.slice.call(arguments, 1),\n            fToBind = this,\n            fNOP = function () {},\n            fBound = function () {\n                return fToBind.apply(\n                    this instanceof fNOP && oThis ? this : oThis,\n                    aArgs.concat(Array.prototype.slice.call(arguments))\n                );\n            };\n        fNOP.prototype = this.prototype;\n        fBound.prototype = new fNOP();\n\n        return fBound;\n    };\n}\n\nvar root, // root logger instance\n    writer; // writer instance, used to output log entries\n\nvar Level = {\n    DEBUG: 10,\n    INFO: 20,\n    WARN: 30,\n    ERROR: 40,\n    FATAL: 50,\n};\n\nfunction ConsoleWriter() {}\n\nConsoleWriter.prototype = {\n    output: function (log_name, level, messages) {\n        if (log_name) messages.unshift(log_name + \":\");\n        if (level <= Level.DEBUG) {\n            // console.debug exists but is deprecated\n            messages.unshift(\"[DEBUG]\");\n            console.log.apply(console, messages);\n        } else if (level <= Level.INFO) console.info.apply(console, messages);\n        else if (level <= Level.WARN) console.warn.apply(console, messages);\n        else console.error.apply(console, messages);\n    },\n};\n\nfunction Logger(name, parent) {\n    this._loggers = {};\n    this.name = name || \"\";\n    this._parent = parent || null;\n    if (!parent) {\n        this._enabled = true;\n        this._level = Level.WARN;\n    }\n}\n\nLogger.prototype = {\n    getLogger: function (name) {\n        var path = name.split(\".\"),\n            root = this,\n            route = this.name ? [this.name] : [];\n        while (path.length) {\n            var entry = path.shift();\n            route.push(entry);\n            if (!(entry in root._loggers))\n                root._loggers[entry] = new Logger(route.join(\".\"), root);\n            root = root._loggers[entry];\n        }\n        return root;\n    },\n\n    _getFlag: function (flag) {\n        var context = this;\n        flag = \"_\" + flag;\n        while (context !== null) {\n            if (context[flag] !== undefined) return context[flag];\n            context = context._parent;\n        }\n        return null;\n    },\n\n    setEnabled: function (state) {\n        this._enabled = !!state;\n    },\n\n    isEnabled: function () {\n        this._getFlag(\"enabled\");\n    },\n\n    setLevel: function (level) {\n        if (typeof level === \"number\") this._level = level;\n        else if (typeof level === \"string\") {\n            level = level.toUpperCase();\n            if (level in Level) this._level = Level[level];\n        }\n    },\n\n    getLevel: function () {\n        return this._getFlag(\"level\");\n    },\n\n    log: function (level, messages) {\n        if (\n            !messages.length ||\n            !this._getFlag(\"enabled\") ||\n            level < this._getFlag(\"level\")\n        )\n            return;\n        messages = Array.prototype.slice.call(messages);\n        writer.output(this.name, level, messages);\n    },\n\n    debug: function () {\n        this.log(Level.DEBUG, arguments);\n    },\n\n    info: function () {\n        this.log(Level.INFO, arguments);\n    },\n\n    warn: function () {\n        this.log(Level.WARN, arguments);\n    },\n\n    error: function () {\n        this.log(Level.ERROR, arguments);\n    },\n\n    fatal: function () {\n        this.log(Level.FATAL, arguments);\n    },\n};\n\nfunction getWriter() {\n    return writer;\n}\n\nfunction setWriter(w) {\n    writer = w;\n}\n\nsetWriter(new ConsoleWriter());\n\nroot = new Logger();\n\nvar logconfig = /loglevel(|-[^=]+)=([^&]+)/g,\n    match;\n\nwhile ((match = logconfig.exec(window.location.search)) !== null) {\n    var logger = match[1] === \"\" ? root : root.getLogger(match[1].slice(1));\n    logger.setLevel(match[2].toUpperCase());\n}\n\nvar api = {\n    Level: Level,\n    getLogger: root.getLogger.bind(root),\n    setEnabled: root.setEnabled.bind(root),\n    isEnabled: root.isEnabled.bind(root),\n    setLevel: root.setLevel.bind(root),\n    getLevel: root.getLevel.bind(root),\n    debug: root.debug.bind(root),\n    info: root.info.bind(root),\n    warn: root.warn.bind(root),\n    error: root.error.bind(root),\n    fatal: root.fatal.bind(root),\n    getWriter: getWriter,\n    setWriter: setWriter,\n};\n\nexport default api;\n","// Patterns argument parser\nimport $ from \"jquery\";\nimport utils from \"./utils.js\";\nimport logging from \"./logging\";\n\nclass ArgumentParser {\n    constructor(name) {\n        this.order = [];\n        this.parameters = {};\n        this.attribute = \"data-pat-\" + name;\n        this.enum_values = {};\n        this.enum_conflicts = [];\n        this.groups = {};\n        this.possible_groups = {};\n        this.log = logging.getLogger(name + \".parser\");\n\n        this.group_pattern = /([a-z][a-z0-9]*)-([A-Z][a-z0-0\\-]*)/i;\n        this.json_param_pattern = /^\\s*\\[?\\s*{/i;\n        this.named_param_pattern = /^\\s*([a-z][a-z0-9\\-]*)\\s*:(.*)/is;\n        this.token_pattern = /(([\"']).*?(?!\\\\)\\2)|\\s*(\\S+)\\s*/g;\n    }\n\n    _camelCase(str) {\n        return str.replace(/\\-([a-z])/g, (__, p1) => p1.toUpperCase());\n    }\n\n    addAlias(alias, original) {\n        /* Add an alias for a previously added parser argument.\n         *\n         * Useful when you want to support both US and UK english argument\n         * names.\n         */\n        if (this.parameters[original]) {\n            this.parameters[original].alias = alias;\n        } else {\n            throw `Attempted to add an alias \"${alias}\" for a non-existing parser argument \"${original}\".`;\n        }\n    }\n\n    addGroupToSpec(spec) {\n        /* Determine wether an argument being parsed can be grouped and\n         * update its specifications object accordingly.\n         *\n         * Internal method used by addArgument and addJSONArgument\n         */\n        const m = spec.name.match(this.group_pattern);\n        if (m) {\n            const group = m[1];\n            const field = m[2];\n            if (group in this.possible_groups) {\n                const first_spec = this.possible_groups[group];\n                const first_name = first_spec.name.match(this.group_pattern)[2];\n                first_spec.group = group;\n                first_spec.dest = first_name;\n                this.groups[group] = new ArgumentParser();\n                this.groups[group].addArgument(\n                    first_name,\n                    first_spec.value,\n                    first_spec.choices,\n                    first_spec.multiple\n                );\n                delete this.possible_groups[group];\n            }\n            if (group in this.groups) {\n                this.groups[group].addArgument(\n                    field,\n                    spec.value,\n                    spec.choices,\n                    spec.multiple\n                );\n                spec.group = group;\n                spec.dest = field;\n            } else {\n                this.possible_groups[group] = spec;\n                spec.dest = this._camelCase(spec.name);\n            }\n        }\n        return spec;\n    }\n\n    addJSONArgument(name, default_value) {\n        /* Add an argument where the value is provided in JSON format.\n         *\n         * This is a different usecase than specifying all arguments to\n         * the data-pat-... attributes in JSON format, and instead is part\n         * of the normal notation except that a value is in JSON instead of\n         * for example a string.\n         */\n        this.order.push(name);\n        this.parameters[name] = this.addGroupToSpec({\n            name: name,\n            value: default_value,\n            dest: name,\n            group: null,\n            type: \"json\",\n        });\n    }\n\n    addArgument(name, default_value, choices, multiple) {\n        const spec = {\n            name: name,\n            value:\n                multiple && !Array.isArray(default_value)\n                    ? [default_value]\n                    : default_value,\n            multiple: multiple,\n            dest: name,\n            group: null,\n        };\n        if (choices && Array.isArray(choices) && choices.length) {\n            spec.choices = choices;\n            spec.type = this._typeof(choices[0]);\n            for (const choice of choices) {\n                if (this.enum_conflicts.indexOf(choice) !== -1) {\n                    continue;\n                } else if (choice in this.enum_values) {\n                    this.enum_conflicts.push(choice);\n                    delete this.enum_values[choice];\n                } else {\n                    this.enum_values[choice] = name;\n                }\n            }\n        } else if (typeof spec.value === \"string\" && spec.value.slice(0, 1) === \"$\") {\n            spec.type = this.parameters[spec.value.slice(1)].type;\n        } else {\n            // Note that this will get reset by _defaults if default_value is a function.\n            spec.type = this._typeof(multiple ? spec.value[0] : spec.value);\n        }\n        this.order.push(name);\n        this.parameters[name] = this.addGroupToSpec(spec);\n    }\n\n    _typeof(obj) {\n        if (obj === null) {\n            return \"null\";\n        }\n        return typeof obj;\n    }\n\n    _coerce(name, value) {\n        const spec = this.parameters[name];\n        if (typeof value !== spec.type)\n            try {\n                switch (spec.type) {\n                    case \"json\":\n                        value = JSON.parse(value);\n                        break;\n                    case \"boolean\":\n                        if (typeof value === \"string\") {\n                            value = value.toLowerCase();\n                            const num = parseInt(value, 10);\n                            if (!isNaN(num)) value = !!num;\n                            else\n                                value =\n                                    value === \"true\" ||\n                                    value === \"y\" ||\n                                    value === \"yes\" ||\n                                    value === \"y\" ||\n                                    value === \"on\";\n                        } else if (typeof value === \"number\") {\n                            value = !!value;\n                        } else {\n                            throw `Cannot convert value for ${name} to boolean.`;\n                        }\n                        break;\n                    case \"number\":\n                        if (typeof value === \"string\") {\n                            value = parseInt(value, 10);\n                            if (isNaN(value)) {\n                                throw `Cannot convert value for ${name} to number.`;\n                            }\n                        } else if (typeof value === \"boolean\") {\n                            value = value + 0;\n                        } else {\n                            throw `Cannot convert value for ${name} to number.`;\n                        }\n                        break;\n                    case \"string\":\n                        value = value.toString();\n                        break;\n                    case \"null\": // Missing default values\n                    case \"undefined\":\n                        break;\n                    default:\n                        throw `Do not know how to convert value for ${name} of type ${typeof value} to ${\n                            spec.type\n                        }.`;\n                }\n            } catch (e) {\n                this.log.warn(e);\n                return null;\n            }\n\n        if (spec.choices && spec.choices.indexOf(value) === -1) {\n            this.log.warn(`Illegal value for ${name}: ${value}.`);\n            return null;\n        }\n        return value;\n    }\n\n    _set(opts, name, value) {\n        if (!(name in this.parameters)) {\n            this.log.debug(`Ignoring value for unknown argument: ${name}.`);\n            return;\n        }\n        const spec = this.parameters[name];\n        let parts;\n        if (spec.multiple) {\n            if (typeof value === \"string\") {\n                parts = value.split(/,+/);\n            } else {\n                parts = value;\n            }\n            value = [];\n            for (const part of parts) {\n                const v = this._coerce(name, part.trim());\n                if (v !== null) {\n                    value.push(v);\n                }\n            }\n        } else {\n            value = this._coerce(name, value);\n            if (value === null) {\n                return;\n            }\n        }\n        opts[name] = value;\n    }\n\n    _split(text) {\n        const tokens = [];\n        text.replace(this.token_pattern, (match, quoted, __, simple) => {\n            if (quoted) {\n                tokens.push(quoted);\n            } else if (simple) {\n                tokens.push(simple);\n            }\n        });\n        return tokens;\n    }\n\n    _parseExtendedNotation(argstring) {\n        const opts = {};\n        const parts = argstring\n            .replace(/;;/g, \"\\0x1f\")\n            .replace(/&amp;/g, \"&amp\\0x1f\")\n            .split(/;/)\n            .map((el) => el.replace(new RegExp(\"\\0x1f\", \"g\"), \";\"));\n        for (const part of parts) {\n            if (!part) {\n                continue;\n            }\n            const matches = part.match(this.named_param_pattern);\n            if (!matches) {\n                this.log.warn(`Invalid parameter: ${part}: ${argstring}.`);\n                continue;\n            }\n            const name = matches[1];\n            const value = matches[2].trim();\n            const arg = Object.values(this.parameters).filter((it) => it.alias === name);\n\n            const is_alias = arg.length === 1;\n\n            if (is_alias) {\n                this._set(opts, arg[0].name, value);\n            } else if (name in this.parameters) {\n                this._set(opts, name, value);\n            } else if (name in this.groups) {\n                const subopt = this.groups[name]._parseShorthandNotation(value);\n                for (const field in subopt) {\n                    this._set(opts, name + \"-\" + field, subopt[field]);\n                }\n            } else {\n                this.log.warn(`Unknown named parameter: ${matches[1]}.`);\n                continue;\n            }\n        }\n        return opts;\n    }\n\n    _parseShorthandNotation(parameter) {\n        const parts = this._split(parameter);\n        const opts = {};\n        let i = 0;\n\n        while (parts.length) {\n            const part = parts.shift().trim();\n            let sense;\n            let flag;\n            let positional = true;\n            if (part.slice(0, 3) === \"no-\") {\n                sense = false;\n                flag = part.slice(3);\n            } else {\n                sense = true;\n                flag = part;\n            }\n            if (flag in this.parameters && this.parameters[flag].type === \"boolean\") {\n                positional = false;\n                this._set(opts, flag, sense);\n            } else if (flag in this.enum_values) {\n                positional = false;\n                this._set(opts, this.enum_values[flag], flag);\n            } else if (positional) this._set(opts, this.order[i], part);\n            else {\n                parts.unshift(part);\n                break;\n            }\n            i++;\n            if (i >= this.order.length) {\n                break;\n            }\n        }\n        if (parts.length) this.log.warn(`Ignore extra arguments: ${parts.join(\" \")}.`);\n        return opts;\n    }\n\n    _parse(parameter) {\n        if (!parameter) {\n            return {};\n        }\n        if (parameter.match(this.json_param_pattern)) {\n            try {\n                return JSON.parse(parameter);\n            } catch (e) {\n                this.log.warn(`Invalid JSON argument found: ${parameter}.`);\n            }\n        }\n        if (parameter.match(this.named_param_pattern)) {\n            return this._parseExtendedNotation(parameter);\n        }\n        const sep = parameter.indexOf(\";\");\n        if (sep === -1) {\n            return this._parseShorthandNotation(parameter);\n        }\n        const opts = this._parseShorthandNotation(parameter.slice(0, sep));\n        const extended = this._parseExtendedNotation(parameter.slice(sep + 1));\n        for (const name in extended) {\n            opts[name] = extended[name];\n        }\n        return opts;\n    }\n\n    _defaults($el) {\n        const result = {};\n        for (const name in this.parameters) {\n            if (typeof this.parameters[name].value === \"function\") {\n                try {\n                    result[name] = this.parameters[name].value($el, name);\n                    this.parameters[name].type = typeof result[name];\n                } catch (e) {\n                    this.log.error(`Default function for ${name} failed.`);\n                }\n            } else {\n                result[name] = this.parameters[name].value;\n            }\n        }\n        return result;\n    }\n\n    _cleanupOptions(options, group_options = true) {\n        // Resolve references\n        for (const name of Object.keys(options)) {\n            const spec = this.parameters[name];\n            if (spec === undefined) {\n                continue;\n            }\n\n            if (\n                options[name] === spec.value &&\n                typeof spec.value === \"string\" &&\n                spec.value.slice(0, 1) === \"$\"\n            ) {\n                options[name] = options[spec.value.slice(1)];\n            }\n        }\n        if (group_options) {\n            // Move options into groups and do renames\n            for (const name of Object.keys(options)) {\n                const spec = this.parameters[name];\n                let target;\n                if (spec === undefined) {\n                    continue;\n                }\n\n                if (spec.group) {\n                    if (typeof options[spec.group] !== \"object\") {\n                        options[spec.group] = {};\n                    }\n                    target = options[spec.group];\n                } else {\n                    target = options;\n                }\n\n                if (spec.dest !== name) {\n                    target[spec.dest] = options[name];\n                    delete options[name];\n                }\n            }\n        }\n        return options;\n    }\n\n    parse($el, options, multiple, inherit = true, group_options = true) {\n        if (!$el.jquery) {\n            $el = $($el);\n        }\n        if (typeof options === \"boolean\" && multiple === undefined) {\n            // Fix argument order: ``multiple`` passed instead of ``options``.\n            multiple = options;\n            options = {};\n        }\n        const stack = inherit ? [[this._defaults($el)]] : [[{}]];\n        let $possible_config_providers;\n        let final_length = 1;\n        /*\n         * XXX this is a workaround for:\n         * - https://github.com/Patternslib/Patterns/issues/393\n         *\n         * Prevents the parser to pollute the pat-modal configuration\n         * with data-pat-inject elements define in a `.pat-modal` parent element.\n         *\n         *  Probably this function should be completely revisited, see:\n         * - https://github.com/Patternslib/Patterns/issues/627\n         *\n         */\n        if (\n            !inherit ||\n            ($el.hasClass(\"pat-modal\") && this.attribute === \"data-pat-inject\")\n        ) {\n            $possible_config_providers = $el;\n        } else {\n            $possible_config_providers = $el.parents(`[${this.attribute}]`).addBack();\n        }\n\n        for (const provider of $possible_config_providers) {\n            let frame;\n            const data = ($(provider).attr(this.attribute) || \"\").trim();\n            if (!data) {\n                continue;\n            }\n            const _parse = this._parse.bind(this);\n            if (data.match(/&&/)) {\n                frame = data.split(/\\s*&&\\s*/).map(_parse);\n            } else {\n                frame = _parse(data);\n            }\n            if (!Array.isArray(frame)) {\n                frame = [frame];\n            }\n            final_length = Math.max(frame.length, final_length);\n            stack.push(frame);\n        }\n\n        if (typeof options === \"object\") {\n            if (Array.isArray(options)) {\n                stack.push(options);\n                final_length = Math.max(options.length, final_length);\n            } else {\n                stack.push([options]);\n            }\n        }\n        if (!multiple) {\n            final_length = 1;\n        }\n        const results = utils\n            .removeDuplicateObjects(utils.mergeStack(stack, final_length))\n            .map((current_value) => this._cleanupOptions(current_value, group_options));\n        return multiple ? results : results[0];\n    }\n}\n\n// BBB\nArgumentParser.prototype.add_argument = ArgumentParser.prototype.addArgument;\n\nexport default ArgumentParser;\n","// Polyfills for modern browsers\n\n// SubmitEvent.submitter polyfill for Safari < 15.4 and jsDOM\n// Original code: https://stackoverflow.com/a/61110260/1337474\n// Also see: https://caniuse.com/?search=submitter\n//\n!(function () {\n    let last_btn = null;\n    const submitable_buttons = `button, input[type=\"button\"], input[type=\"submit\"], input[type=\"image\"]`;\n    document.addEventListener(\n        \"click\",\n        function (e) {\n            if (!e.target.closest) return;\n            last_btn = e.target.closest(submitable_buttons);\n        },\n        true\n    );\n    document.addEventListener(\n        \"submit\",\n        function (e) {\n            if (\"submitter\" in e) return;\n            const canditates = [document.activeElement, last_btn];\n            last_btn = null;\n            for (const candidate of canditates) {\n                if (!candidate) continue;\n                if (!candidate.form) continue;\n                if (!candidate.matches(submitable_buttons)) continue;\n                e.submitter = candidate;\n                return;\n            }\n            e.submitter = e.target.querySelector(submitable_buttons);\n        },\n        true\n    );\n})();\n","/**\n * Patterns registry - Central registry and scan logic for patterns\n *\n * Copyright 2012-2013 Simplon B.V.\n * Copyright 2012-2013 Florian Friesdorf\n * Copyright 2013 Marko Durkovic\n * Copyright 2013 Rok Garbas\n * Copyright 2014-2015 Syslab.com GmBH, JC Brand\n */\n\n/*\n * changes to previous patterns.register/scan mechanism\n * - if you want initialised class, do it in init\n * - init returns set of elements actually initialised\n * - handle once within init\n * - no turnstile anymore\n * - set pattern.jquery_plugin if you want it\n */\nimport $ from \"jquery\";\nimport dom from \"./dom\";\nimport logging from \"./logging\";\nimport utils from \"./utils\";\n\nconst log = logging.getLogger(\"registry\");\nconst disable_re = /patterns-disable=([^&]+)/g;\nconst dont_catch_re = /patterns-dont-catch/g;\nconst disabled = {};\nlet dont_catch = false;\nlet match;\n\nwhile ((match = disable_re.exec(window.location.search)) !== null) {\n    disabled[match[1]] = true;\n    log.info(\"Pattern disabled via url config:\", match[1]);\n}\n\nwhile ((match = dont_catch_re.exec(window.location.search)) !== null) {\n    dont_catch = true;\n    log.info(\"I will not catch init exceptions\");\n}\n\n/**\n * Global pattern registry.\n *\n * This is a singleton and shared among any instance of the Patternslib\n * registry since Patternslib version 8.\n *\n * You normally don't need this as the registry handles it for you.\n */\nif (typeof window.__patternslib_registry === \"undefined\") {\n    window.__patternslib_registry = {};\n}\nexport const PATTERN_REGISTRY = window.__patternslib_registry;\nif (typeof window.__patternslib_registry_initialized === \"undefined\") {\n    window.__patternslib_registry_initialized = false;\n}\n\nconst registry = {\n    patterns: PATTERN_REGISTRY, // reference to global patterns registry\n    // as long as the registry is not initialized, pattern\n    // registration just registers a pattern. Once init is called,\n    // the DOM is scanned. After that registering a new pattern\n    // results in rescanning the DOM only for this pattern.\n    init() {\n        $(document).ready(function () {\n            if (window.__patternslib_registry_initialized) {\n                // Do not reinitialize a already initialized registry.\n                return;\n            }\n            window.__patternslib_registry_initialized = true;\n            log.debug(\"Loaded: \" + Object.keys(registry.patterns).sort().join(\", \"));\n            registry.scan(document.body);\n            log.debug(\"Finished initial scan.\");\n        });\n    },\n\n    clear() {\n        // Removes all patterns from the registry. Currently only being\n        // used in tests.\n        for (const name in registry.patterns) {\n            delete registry.patterns[name];\n        }\n    },\n\n    transformPattern(name, content) {\n        /* Call the transform method on the pattern with the given name, if\n         * it exists.\n         */\n        if (disabled[name]) {\n            log.debug(`Skipping disabled pattern: ${name}.`);\n            return;\n        }\n\n        const pattern = registry.patterns[name];\n        const transform = pattern.transform || pattern.prototype?.transform;\n        if (transform) {\n            try {\n                transform($(content));\n            } catch (e) {\n                if (dont_catch) {\n                    throw e;\n                }\n                log.error(`Transform error for pattern ${name}.`, e);\n            }\n        }\n    },\n\n    initPattern(name, el, trigger) {\n        /* Initialize the pattern with the provided name and in the context\n         * of the passed in DOM element.\n         */\n        const $el = $(el);\n        const pattern = registry.patterns[name];\n        const plog = logging.getLogger(`pat.${name}`);\n        if (el.matches(pattern.trigger)) {\n            plog.debug(\"Initialising.\", el);\n            try {\n                if (pattern.init) {\n                    // old style initialisation\n                    pattern.init($el, null, trigger);\n                } else {\n                    // class based pattern initialisation\n                    new pattern($el, null, trigger);\n                }\n\n                plog.debug(\"done.\");\n            } catch (e) {\n                if (dont_catch) {\n                    throw e;\n                }\n                plog.error(\"Caught error:\", e);\n            }\n        }\n    },\n\n    orderPatterns(patterns) {\n        // Always add pat-validation as first pattern, so that it can prevent\n        // other patterns from reacting to submit events if form validation\n        // fails.\n        if (patterns.includes(\"validation\")) {\n            patterns.splice(patterns.indexOf(\"validation\"), 1);\n            patterns.unshift(\"validation\");\n        }\n        // Add clone-code to the very beginning - we want to copy the markup\n        // before any other patterns changed the markup.\n        if (patterns.includes(\"clone-code\")) {\n            patterns.splice(patterns.indexOf(\"clone-code\"), 1);\n            patterns.unshift(\"clone-code\");\n        }\n\n        return patterns;\n    },\n\n    scan(content, patterns, trigger) {\n        if (!content) {\n            return;\n        }\n\n        if (typeof content === \"string\") {\n            content = document.querySelector(content);\n        } else if (content instanceof Text) {\n            // No need to scan a TextNode.\n            return;\n        } else if (content.jquery) {\n            content = content[0];\n        }\n\n        const selectors = [];\n        patterns = this.orderPatterns(patterns || Object.keys(registry.patterns));\n        for (const name of patterns) {\n            this.transformPattern(name, content);\n            const pattern = registry.patterns[name];\n            if (pattern.trigger) {\n                selectors.unshift(pattern.trigger);\n            }\n        }\n\n        let matches = dom.querySelectorAllAndMe(\n            content,\n            selectors.map((it) => it.trim().replace(/,$/, \"\")).join(\",\")\n        );\n        matches = matches.filter((el) => {\n            // Filter out patterns:\n            // - with class ``.disable-patterns``\n            // - wrapped in ``.disable-patterns`` elements\n            // - wrapped in ``<pre>`` elements\n            // - wrapped in ``<template>`` elements\n            return (\n                !el.matches(\".disable-patterns\") &&\n                !el?.parentNode?.closest?.(\".disable-patterns\") &&\n                !el?.parentNode?.closest?.(\"pre\") &&\n                !el?.parentNode?.closest?.(\"template\") && // NOTE: not strictly necessary. Template is a DocumentFragment and not reachable except for IE.\n                !el.matches(\".cant-touch-this\") && // BBB. TODO: Remove with next major version.\n                !el?.parentNode?.closest?.(\".cant-touch-this\") // BBB. TODO: Remove with next major version.\n            );\n        });\n\n        // walk list backwards and initialize patterns inside-out.\n        for (const el of matches.reverse()) {\n            for (const name of patterns) {\n                this.initPattern(name, el, trigger);\n            }\n        }\n        document.body.classList.add(\"patterns-loaded\");\n    },\n\n    register(pattern, name) {\n        name = name || pattern.name;\n        if (!name) {\n            log.error(\"Pattern lacks a name.\", pattern);\n            return false;\n        }\n        if (registry.patterns[name]) {\n            log.debug(`Already have a pattern called ${name}.`);\n            return false;\n        }\n        // register pattern to be used for scanning new content\n        registry.patterns[name] = pattern;\n\n        // register pattern as jquery plugin\n        if (pattern.jquery_plugin) {\n            const plugin_name = (\"pat-\" + name).replace(\n                /-([a-zA-Z])/g,\n                function (match, p1) {\n                    return p1.toUpperCase();\n                }\n            );\n            $.fn[plugin_name] = utils.jqueryPlugin(pattern);\n            // BBB 2012-12-10 and also for Mockup patterns.\n            $.fn[plugin_name.replace(/^pat/, \"pattern\")] = $.fn[plugin_name];\n        }\n        log.debug(`Registered pattern ${name}`, pattern);\n        if (window.__patternslib_registry_initialized) {\n            // Once the first initialization has been done, do only scan for\n            // newly registered patterns.\n            registry.scan(document.body, [name]);\n            log.debug(`Re-scanned dom with newly registered pattern ${name}.`);\n        }\n        return true;\n    },\n};\n\nexport default registry;\n","import $ from \"jquery\";\nimport dom from \"./dom\";\n\nconst _MS_PER_DAY = 1000 * 60 * 60 * 24; // Milliseconds per day.\n\n$.fn.safeClone = function () {\n    var $clone = this.clone();\n    return $clone;\n};\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.18\n// Reference: http://es5.github.io/#x15.4.4.18\nif (!Array.prototype.forEach) {\n    Array.prototype.forEach = function (callback, thisArg) {\n        var T, k;\n        if (this === null) {\n            throw new TypeError(\" this is null or not defined\");\n        }\n        // 1. Let O be the result of calling ToObject passing the |this| value as the argument.\n        var O = Object(this);\n        // 2. Let lenValue be the result of calling the Get internal method of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n        // 4. If IsCallable(callback) is false, throw a TypeError exception.\n        // See: http://es5.github.com/#x9.11\n        if (typeof callback !== \"function\") {\n            throw new TypeError(callback + \" is not a function\");\n        }\n        // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n        if (arguments.length > 1) {\n            T = thisArg;\n        }\n        // 6. Let k be 0\n        k = 0;\n        // 7. Repeat, while k < len\n        while (k < len) {\n            var kValue;\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty internal method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n                // i. Let kValue be the result of calling the Get internal method of O with argument Pk.\n                kValue = O[k];\n                // ii. Call the Call internal method of callback with T as the this value and\n                // argument list containing kValue, k, and O.\n                callback.call(T, kValue, k, O);\n            }\n            // d. Increase k by 1.\n            k++;\n        }\n        // 8. return undefined\n    };\n}\n\nvar singleBoundJQueryPlugin = function (pattern, method, options) {\n    /* This is a jQuery plugin for patterns which are invoked ONCE FOR EACH\n     * matched element in the DOM.\n     *\n     * This is how the Mockup-type patterns behave. They are constructor\n     * functions which need to be invoked once per jQuery-wrapped DOM node\n     * for all DOM nodes on which the pattern applies.\n     */\n    var $this = this;\n    $this.each(function () {\n        var pat,\n            $el = $(this);\n        pat = pattern.init($el, options);\n        if (method) {\n            if (pat[method] === undefined) {\n                $.error(\n                    \"Method \" + method + \" does not exist on jQuery.\" + pattern.name\n                );\n                return false;\n            }\n            if (method.charAt(0) === \"_\") {\n                $.error(\"Method \" + method + \" is private on jQuery.\" + pattern.name);\n                return false;\n            }\n            pat[method].apply(pat, [options]);\n        }\n    });\n    return $this;\n};\n\nvar pluralBoundJQueryPlugin = function (pattern, method, options) {\n    /* This is a jQuery plugin for patterns which are invoked ONCE FOR ALL\n     * matched elements in the DOM.\n     *\n     * This is how the vanilla Patternslib-type patterns behave. They are\n     * simple objects with an init method and this method gets called once\n     * with a list of jQuery-wrapped DOM nodes on which the pattern\n     * applies.\n     */\n    var $this = this;\n    if (method) {\n        if (pattern[method]) {\n            return pattern[method].apply($this, [$this].concat([options]));\n        } else {\n            $.error(\"Method \" + method + \" does not exist on jQuery.\" + pattern.name);\n        }\n    } else {\n        pattern.init.apply($this, [$this].concat([options]));\n    }\n    return $this;\n};\n\nvar jqueryPlugin = function (pattern) {\n    return function (method, options) {\n        var $this = this;\n        if ($this.length === 0) {\n            return $this;\n        }\n        if (typeof method === \"object\") {\n            options = method;\n            method = undefined;\n        }\n        if (typeof pattern === \"function\") {\n            return singleBoundJQueryPlugin.call(this, pattern, method, options);\n        } else {\n            return pluralBoundJQueryPlugin.call(this, pattern, method, options);\n        }\n    };\n};\n\n// Is a given variable an object?\nfunction isObject(obj) {\n    var type = typeof obj;\n    return type === \"function\" || (type === \"object\" && !!obj);\n}\n\n// Extend a given object with all the properties in passed-in object(s).\nfunction extend(obj) {\n    if (!isObject(obj)) return obj;\n    var source, prop;\n    for (var i = 1, length = arguments.length; i < length; i++) {\n        source = arguments[i];\n        for (prop in source) {\n            if (hasOwnProperty.call(source, prop)) {\n                obj[prop] = source[prop];\n            }\n        }\n    }\n    return obj;\n}\n// END: Taken from Underscore.js until here.\n\nfunction findLabel(input) {\n    var $label;\n    for (\n        var label = input.parentNode;\n        label && label.nodeType !== 11;\n        label = label.parentNode\n    ) {\n        if (label.tagName === \"LABEL\") {\n            return label;\n        }\n    }\n    if (input.id) {\n        $label = $('label[for=\"' + input.id + '\"]');\n    }\n    if ($label && $label.length === 0 && input.form) {\n        $label = $('label[for=\"' + input.name + '\"]', input.form);\n    }\n    if ($label && $label.length) {\n        return $label[0];\n    } else {\n        return null;\n    }\n}\n\n// Taken from http://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\nfunction escapeRegExp(str) {\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n}\n\n/**\n * Create a RegExp object of a wildcard search string.\n *\n * @param {string} wildcard: A search string which can contain wildcards \"*\".\n *                           The wildcard \"*\" can be anywhere in the string and\n *                           can also be used multiple times. If no wildcard is\n *                           present the search string is used for an exact match.\n\n * @returns {RegExp}: A RegExp object which can be used to match strings.\n */\nfunction regexp_from_wildcard(wildcard) {\n    let regexp = wildcard.replace(/[\\-\\[\\]{}()+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n    regexp = regexp.replace(/[*]/g, \".*\");\n    regexp = new RegExp(`^${regexp}$`);\n    return regexp;\n}\n\n/**\n * Remove classes from a list of targets if they match a specific pattern.\n *\n * @param {Node, NodeList} targets: Dom Node or NodeList where the classes should be removed.\n * @param {string} classes: String matching classes to be removed.\n *                          You can add a \"*\" as wildcard to search for classes to be removed.\n *                          E.g. \"icon-*-alert\" to remove any of \"icon-1-alert icon-2-alert\".\n *\n * @returns {undefined}: This method directly operates on the targets.\n */\nfunction removeWildcardClass(targets, classes) {\n    targets = utils.ensureArray(targets);\n\n    if (classes.indexOf(\"*\") === -1) {\n        for (const target of targets) {\n            target.classList.remove(classes);\n        }\n    } else {\n        const matcher = regexp_from_wildcard(classes);\n        for (const target of targets) {\n            const class_list = (target.getAttribute(\"class\") || \"\").split(/\\s+/);\n            if (!class_list.length) {\n                continue;\n            }\n            const ok = class_list.filter((it) => !matcher.test(it));\n            if (ok.length) {\n                target.setAttribute(\"class\", ok.join(\" \"));\n            } else {\n                target.removeAttribute(\"class\");\n            }\n        }\n    }\n}\n\nfunction hasValue(el) {\n    if (el.tagName === \"INPUT\") {\n        if (el.type === \"checkbox\" || el.type === \"radio\") {\n            return el.checked;\n        }\n        return el.value !== \"\";\n    }\n    if (el.tagName === \"SELECT\") {\n        return el.selectedIndex !== -1;\n    }\n    if (el.tagName === \"TEXTAREA\") {\n        return el.value !== \"\";\n    }\n    return false;\n}\n\nconst hideOrShow = (nodes, visible, options, pattern_name) => {\n    nodes = dom.toNodeArray(nodes);\n\n    const transitions = {\n        none: { hide: \"hide\", show: \"show\" },\n        fade: { hide: \"fadeOut\", show: \"fadeIn\" },\n        slide: { hide: \"slideUp\", show: \"slideDown\" },\n    };\n\n    const duration =\n        options.transition === \"css\" || options.transition === \"none\"\n            ? null\n            : options.effect.duration;\n\n    const on_complete = (el) => {\n        el.classList.remove(\"in-progress\");\n        el.classList.add(visible ? \"visible\" : \"hidden\");\n        $(el).trigger(\"pat-update\", {\n            pattern: pattern_name,\n            action: \"attribute-changed\",\n            dom: el,\n            transition: \"complete\",\n        });\n    };\n\n    for (const el of nodes) {\n        el.classList.remove(\"visible\");\n        el.classList.remove(\"hidden\");\n        el.classList.remove(\"in-progress\");\n\n        if (duration) {\n            const t = transitions[options.transition];\n            el.classList.add(\"in-progress\");\n            $(el).trigger(\"pat-update\", {\n                pattern: pattern_name,\n                action: \"attribute-changed\",\n                dom: el,\n                transition: \"start\",\n            });\n            $(el)[visible ? t.show : t.hide]({\n                duration: duration,\n                easing: options.effect.easing,\n                complete: () => on_complete(el),\n            });\n        } else {\n            if (options.transition !== \"css\") {\n                dom[visible ? \"show\" : \"hide\"](el);\n            }\n            on_complete(el);\n        }\n    }\n};\n\nfunction addURLQueryParameter(fullURL, param, value) {\n    /* Using a positive lookahead (?=\\=) to find the given parameter,\n     * preceded by a ? or &, and followed by a = with a value after\n     * than (using a non-greedy selector) and then followed by\n     * a & or the end of the string.\n     *\n     * Taken from http://stackoverflow.com/questions/7640270/adding-modify-query-string-get-variables-in-a-url-with-javascript\n     */\n    var val = new RegExp(\"(\\\\?|\\\\&)\" + param + \"=.*?(?=(&|$))\"),\n        parts = fullURL.toString().split(\"#\"),\n        url = parts[0],\n        hash = parts[1],\n        qstring = /\\?.+$/,\n        newURL = url;\n    // Check if the parameter exists\n    if (val.test(url)) {\n        // if it does, replace it, using the captured group\n        // to determine & or ? at the beginning\n        newURL = url.replace(val, \"$1\" + param + \"=\" + value);\n    } else if (qstring.test(url)) {\n        // otherwise, if there is a query string at all\n        // add the param to the end of it\n        newURL = url + \"&\" + param + \"=\" + value;\n    } else {\n        // if there's no query string, add one\n        newURL = url + \"?\" + param + \"=\" + value;\n    }\n    if (hash) {\n        newURL += \"#\" + hash;\n    }\n    return newURL;\n}\n\nfunction removeDuplicateObjects(objs) {\n    /* Given an array of objects, remove any duplicate objects which might\n     * be present.\n     */\n    const comparator = function (k, v) {\n        return this[k] === v;\n    };\n\n    return objs.reduce(function (list, next_obj) {\n        let is_duplicate = false;\n        for (const obj of list) {\n            is_duplicate =\n                Object.keys(obj).length === Object.keys(next_obj).length &&\n                Object.entries(obj).filter(\n                    (it) => !comparator.bind(next_obj)(it[0], it[1])\n                ).length === 0;\n        }\n        if (!is_duplicate) {\n            list.push(next_obj);\n        }\n        return list;\n    }, []);\n}\n\nfunction mergeStack(stack, length) {\n    /* Given a list of lists of objects (which for brevity we call a stack),\n     * return a list of objects where each object is the merge of all the\n     * corresponding original objects at that particular index.\n     *\n     * If a certain sub-list doesn't have an object at that particular\n     * index, the last object in that list is merged.\n     */\n    const results = [];\n    for (let i = 0; i < length; i++) {\n        results.push({});\n    }\n    for (const frame of stack) {\n        const frame_length = frame.length - 1;\n        for (let x = 0; x < length; x++) {\n            results[x] = $.extend(\n                results[x] || {},\n                frame[x > frame_length ? frame_length : x]\n            );\n        }\n    }\n    return results;\n}\n\nfunction isElementInViewport(el, partial = false, offset = 0) {\n    /* returns true if element is visible to the user ie. is in the viewport.\n     * Setting partial parameter to true, will only check if a part of the element is visible\n     * in the viewport, specifically that some part of that element is touching the top part\n     * of the viewport. This only applies to the vertical direction, ie. doesnt check partial\n     * visibility for horizontal scrolling\n     * some code taken from:\n     * http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433\n     */\n    if (el instanceof $) {\n        el = el[0];\n    }\n\n    const rec = el.getBoundingClientRect();\n    const rec_values = [rec.top, rec.bottom, rec.left, rec.right];\n\n    if (rec_values.every((val) => val === 0)) {\n        // if every property of rec is 0, the element is invisible;\n        return false;\n    } else if (partial) {\n        // when using getBoundingClientRect() (in the vertical case)\n        // negative means above top of viewport, positive means below top of viewport\n        // therefore for part of the element to be touching or crossing the top of the viewport\n        // rec.top must <= 0 and rec.bottom must >= 0\n        // an optional tolerance offset can be added for when the desired element is not exactly\n        // toucing the top of the viewport but needs to be considered as touching.\n        return (\n            rec.top <= 0 + offset && rec.bottom >= 0 + offset\n            //(rec.top >= 0+offset && rec.top <= window.innerHeight) // this checks if the element\n            // touches bottom part of viewport\n            // XXX do we want to include a check for the padding of an element?\n            // using window.getComputedStyle(target).paddingTop\n        );\n    } else {\n        // this will return true if the entire element is completely in the viewport\n        return (\n            rec.top >= 0 &&\n            rec.left >= 0 &&\n            rec.bottom <=\n                (window.innerHeight || document.documentElement.clientHeight) &&\n            rec.right <= (window.innerWidth || document.documentElement.clientWidth)\n        );\n    }\n}\n\n/* parseTime - Parse a duration from a string and return the parsed time in milliseconds.\n *\n * @param {String} time - A duration/time string like ``1ms``, ``1s`` or ``1m``.\n *\n * @returns {Number} - A integer which represents the parsed time in milliseconds.\n */\nfunction parseTime(time) {\n    var m = /^(\\d+(?:\\.\\d+)?)\\s*(\\w*)/.exec(time);\n    if (!m) {\n        throw new Error(\"Invalid time\");\n    }\n    var amount = parseFloat(m[1]);\n    switch (m[2]) {\n        case \"s\":\n            return Math.round(amount * 1000);\n        case \"m\":\n            return Math.round(amount * 1000 * 60);\n        case \"ms\":\n        default:\n            return Math.round(amount);\n    }\n}\n\n/*\n\n * parseLength - Parse a length from a string and return the parsed length in\n * pixels.\n\n * @param {String} length - A length string like `1px` or `25%`. Lengths without a unit are treated as pixels.\n * @param {Number} reference_length - The reference length to use for percentage lengths.\n *\n * @returns {Number} - A integer which represents the parsed length in pixels.\n *\n * @throws {Error} - If the length string is invalid.\n *\n * @example\n * parseLength(\"1px\"); // 1\n * parseLength(\"10%\", 100); // 10\n *\n */\nfunction parseLength(length, reference_length = null) {\n    const m = /^(\\d+(?:\\.\\d+)?)\\s*(\\%?\\w*)/.exec(length);\n    if (!m) {\n        throw new Error(\"Invalid length\");\n    }\n    const amount = parseFloat(m[1]);\n    switch (m[2]) {\n        case \"px\":\n            return Math.round(amount);\n        case \"%\":\n            if (!reference_length) {\n                return 0;\n            }\n            return (reference_length / 100) * Math.round(amount);\n        case \"vw\":\n            return Math.round((amount * window.innerWidth) / 100);\n        case \"vh\":\n            return Math.round((amount * window.innerHeight) / 100);\n        case \"vmin\":\n            return Math.round(\n                (amount * Math.min(window.innerWidth, window.innerHeight)) / 100\n            );\n        case \"vmax\":\n            return Math.round(\n                (amount * Math.max(window.innerWidth, window.innerHeight)) / 100\n            );\n        default:\n            return Math.round(amount);\n    }\n}\n\n// Return a jQuery object with elements related to an input element.\nfunction findRelatives(el) {\n    var $el = $(el),\n        $relatives = $(el),\n        $label = $();\n\n    $relatives = $relatives.add($el.closest(\"label\"));\n    $relatives = $relatives.add($el.closest(\"fieldset\"));\n\n    if (el.id) $label = $(\"label[for='\" + el.id + \"']\");\n    if (!$label.length) {\n        var $form = $el.closest(\"form\");\n        if (!$form.length) $form = $(document.body);\n        $label = $form.find(\"label[for='\" + el.name + \"']\");\n    }\n    $relatives = $relatives.add($label);\n    return $relatives;\n}\n\nfunction get_bounds(el) {\n    // Return bounds of an element with it's values rounded and converted to ints.\n    const bounds = el.getBoundingClientRect();\n    return {\n        x: parseInt(Math.round(bounds.x), 10) || 0,\n        y: parseInt(Math.round(bounds.y), 10) || 0,\n        top: parseInt(Math.round(bounds.top), 10) || 0,\n        bottom: parseInt(Math.round(bounds.bottom), 10) || 0,\n        left: parseInt(Math.round(bounds.left), 10) || 0,\n        right: parseInt(Math.round(bounds.right), 10) || 0,\n        width: parseInt(Math.round(bounds.width), 10) || 0,\n        height: parseInt(Math.round(bounds.height), 10) || 0,\n    };\n}\n\nfunction checkInputSupport(type, invalid_value) {\n    /* Check input type support.\n     *  See: https://stackoverflow.com/a/10199306/1337474\n     */\n    let support = false;\n    const input = document.createElement(\"input\");\n    input.setAttribute(\"type\", type);\n    support = input.type == type;\n\n    if (invalid_value !== undefined) {\n        // Check for input type UI support\n        input.setAttribute(\"value\", invalid_value);\n        support = input.value !== invalid_value;\n    }\n    return support;\n}\n\nconst checkCSSFeature = (attribute, value, tag = \"div\") => {\n    /* Check for browser support of specific CSS feature.\n     */\n    tag = document.createElement(tag);\n    let supported = tag.style[attribute] !== undefined;\n    if (supported && value !== undefined) {\n        tag.style[attribute] = value;\n        supported = tag.style[attribute] === value;\n    }\n    return supported;\n};\n\nconst animation_frame = () => {\n    // Return promise to await next repaint cycle\n    // Use it in your async function like so: ``await utils.animation_frame()``\n    // From: http://www.albertlobo.com/fractals/async-await-requestanimationframe-buddhabrot\n    return new Promise(window.requestAnimationFrame);\n};\n\nconst timeout = (ms) => {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n};\n\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds.\n * From: https://underscorejs.org/#debounce\n *\n * @param {Function} func - The function to debounce.\n * @param {Number} ms - The time in milliseconds to debounce.\n * @param {Object} timer - A module-global timer as an object.\n * @param {Boolean} [postpone=true] - If true, the function will only be called\n * at the end, after it stops being called for N milliseconds. If false, the\n * function will be called no more than each [ms] milliseconds, ensuring that\n * the function isn't postponed for for too long.\n *\n * @returns {Function} - The debounced function.\n */\nconst debounce = (func, ms, timer = { timer: null }, postpone = true) => {\n    // Returns a function, that, as long as it continues to be invoked, will not\n    // be triggered. The function will be called after it stops being called for\n    // N milliseconds.\n    // From: https://underscorejs.org/#debounce\n    //\n    // Make sure to initialize ``debounce`` only once per to-be-debounced\n    // function to not reinitialize the timer each time and debounce not being\n    // able to cancel previouse runs.\n    //\n    // Pass a module-global timer as an object ``{ timer: null }`` if you want\n    // to also cancel debounced functions from other pattern-invocations.\n    timer.last_run = 0;\n    return function () {\n        const args = arguments;\n        if (!postpone && timer.timer && Date.now() - timer.last_run <= ms) {\n            return;\n        }\n        clearTimeout(timer.timer);\n        timer.last_run = Date.now();\n        timer.timer = setTimeout(() => {\n            func.apply(this, args);\n        }, ms);\n    };\n};\n\nconst isIE = () => {\n    // See: https://stackoverflow.com/a/9851769/1337474\n    // Internet Explorer 6-11\n    return /*@cc_on!@*/ false || !!document.documentMode;\n};\n\nconst jqToNode = (el) => {\n    // Return a DOM node if a jQuery node was passed.\n    if (el.jquery) {\n        el = el[0];\n    }\n    return el;\n};\n\n/**\n * Always return an iterable object.\n *\n * @param {any} it: The object which needs to be wrapped in an array or returned as is if it is iterable.\n * @param {boolean} force_array: If the object is iterable but not an Array, convert it to an array (e.g. For jQuery items or NodeList objects).\n *\n * @returns {Array}: Returns the object wrapped in an Array, expanded to an Array or as-is if it is already iterable.\n */\nconst ensureArray = (it, force_array) => {\n    // Ensure to return always an array\n    const array_like = !!(\n        NodeList.prototype.isPrototypeOf(it) || // eslint-disable-line no-prototype-builtins\n        Array.isArray(it) ||\n        it.jquery\n    );\n    return array_like ? (force_array ? [...it] : it) : [it];\n};\n\nconst localized_isodate = (date) => {\n    // Return a iso date (date only) in the current timezone instead of a\n    // UTC ISO 8601 date+time component which toISOString returns.\n\n    const day = date.getDate().toString().padStart(2, \"0\");\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n    const year = date.getFullYear().toString();\n\n    return `${year}-${month}-${day}`;\n};\n\n/**\n * Replace HTML reserved characters with html entities to add HTML for user\n * editing to e.g. a textarea or a contenteditable.\n *\n * See:\n *  https://stackoverflow.com/a/22706073/1337474\n *  https://developer.mozilla.org/en-US/docs/Glossary/Entity#reserved_characters\n *\n * @param {string} html - The HTML string to encode.\n *\n * @returns {string} - Returns the escaped html string:\n *                     ``&`` will be replaced with ``&amp;``.\n *                     ``<`` will be repalced with ``&lt;``,\n *                     ``>`` will be replaced with ``&gt;``,\n *                     ``\"`` will be replaced with ``&quot;``.\n */\nconst escape_html = (html) => {\n    if (!html) {\n        return \"\";\n    }\n    const el = document.createElement(\"div\");\n    el.appendChild(document.createTextNode(html));\n    // Return escaped html and also replace quotes.\n    return el.innerHTML.replace(/\"/g, \"&quot;\");\n};\n\n/**\n * Return unescaped, raw HTML from an escaped HTML  string.\n *\n * See:\n *  https://stackoverflow.com/a/34064434/1337474\n *  https://developer.mozilla.org/en-US/docs/Glossary/Entity#reserved_characters\n *\n * @param {string} escaped_html - The HTML string to decode.\n *\n * @returns {string} - Returns the escaped html string:\n *                     ``&amp;`` will be replaced with ``&``,\n *                     ``&lt;`` will be repalced with ``<``,\n *                     ``&gt;`` will be replaced with ``>``,\n *                     ``&quot;`` will be replaced with ``\"``.\n */\nconst unescape_html = (escaped_html) => {\n    if (!escaped_html) {\n        return \"\";\n    }\n    const doc = new DOMParser().parseFromString(escaped_html, \"text/html\");\n    // Return unescaped html and also unescape quote named entities.\n    return doc.documentElement.textContent.replace(/&quot;/g, '\"');\n};\n\n/**\n * Return true, if the given value is a valid ISO 8601 date/time string with or without an optional time component.\n *\n * @param {String} value - The date/time value to be checked.\n * @param {Boolean} [optional_time=false] - True, if time component is optional.\n * @return {Boolean} - True, if the given value is a valid Date string. False if not.\n */\nconst is_iso_date_time = (value, optional_time = false) => {\n    const re_date_time = optional_time\n        ? /^\\d{4}-[01]\\d-[0-3]\\d(T[0-2]\\d:[0-5]\\d)?$/\n        : /^\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d$/;\n    return re_date_time.test(value);\n};\n\n/**\n * Return true, if the given value is a valid ISO 8601 date string and without a time component.\n *\n * @param {String} value - The date value to be checked.\n * @return {Boolean} - True, if the given value is a valid ISO 8601 date string without a time component. False if not.\n */\nconst is_iso_date = (value) => {\n    const re_date_time = /^\\d{4}-[01]\\d-[0-3]\\d$/;\n    return re_date_time.test(value);\n};\n\n/**\n * Return the number of days between two dates.\n * Based on: https://stackoverflow.com/a/15289883/1337474\n *\n * @param {Date} date_1 - First date to compare. We will substract date_2 from date_1.\n * @param {Date} date_2 - Second date to compare.\n * @return {Number} - The number of days between the two dates.\n */\nconst date_diff = (date_1, date_2) => {\n    // Discard the time and time-zone information.\n    const utc_1 = Date.UTC(date_1.getFullYear(), date_1.getMonth(), date_1.getDate());\n    const utc_2 = Date.UTC(date_2.getFullYear(), date_2.getMonth(), date_2.getDate());\n\n    return Math.floor((utc_1 - utc_2) / _MS_PER_DAY);\n};\n\n/**\n * Build intersection observer threshold list.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#building_the_array_of_threshold_ratios\n *\n * @param {Number} num_steps - The number of steps to use.\n *\n * @returns {Array} - Returns the threshold list.\n */\nconst threshold_list = (num_steps = 0) => {\n    let thresholds = [];\n\n    for (let i = 1.0; i <= num_steps; i++) {\n        thresholds.push(i / num_steps);\n    }\n    thresholds.push(0);\n    return thresholds.sort();\n};\n\n/**\n * is_option_truthy - Check if an Pattern option is set.\n *\n * An option is set if it is not one of:\n * - undefined\n * - null\n * - \"none\"\n * - \"\"\n *\n * @param {String} option - The option to check.\n *\n * @returns {Boolean} - Returns true if the option is set, false otherwise.\n *\n * @example\n *\n * is_option_truthy() // false\n * is_option_truthy(undefined) // false\n * is_option_truthy(null) // false\n * is_option_truthy(\"\") // false\n * is_option_truthy(\"none\") // false\n * is_option_truthy(\"false\") // false\n * is_option_truthy(\"foo\") // true\n * is_option_truthy(true) // true\n * is_option_truthy(0) // true\n *\n */\nconst is_option_truthy = (option) => {\n    return ![undefined, null, \"none\", false, \"false\", \"\"].includes(option);\n};\n\nvar utils = {\n    jqueryPlugin: jqueryPlugin,\n    escapeRegExp: escapeRegExp,\n    isObject: isObject,\n    extend: extend,\n    findLabel: findLabel,\n    regexp_from_wildcard: regexp_from_wildcard,\n    removeWildcardClass: removeWildcardClass,\n    hideOrShow: hideOrShow,\n    addURLQueryParameter: addURLQueryParameter,\n    removeDuplicateObjects: removeDuplicateObjects,\n    mergeStack: mergeStack,\n    isElementInViewport: isElementInViewport,\n    hasValue: hasValue,\n    parseTime: parseTime,\n    parseLength: parseLength,\n    findRelatives: findRelatives,\n    get_bounds: get_bounds,\n    checkInputSupport: checkInputSupport,\n    checkCSSFeature: checkCSSFeature,\n    animation_frame: animation_frame,\n    timeout: timeout,\n    debounce: debounce,\n    isIE: isIE,\n    jqToNode: jqToNode,\n    ensureArray: ensureArray,\n    localized_isodate: localized_isodate,\n    escape_html: escape_html,\n    unescape_html: unescape_html,\n    is_iso_date_time: is_iso_date_time,\n    is_iso_date: is_iso_date,\n    date_diff: date_diff,\n    threshold_list: threshold_list,\n    is_option_truthy: is_option_truthy,\n    //getCSSValue: dom.get_css_value, // BBB: moved to dom. TODO: Remove in upcoming version.\n    elementInViewport: (el) => {\n        // BBB: Remove with next major version.\n        console.warn(\"Deprecated. Use utils.isElementInViewport\");\n        return isElementInViewport(el);\n    },\n};\n\nexport default utils;\n","/* pat-date-picker  - Polyfill for input type=date */\nimport $ from \"jquery\";\nimport Base from \"../../core/base\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"date-picker\");\n\nexport const parser = new Parser(\"date-picker\");\nparser.addArgument(\"behavior\", \"styled\", [\"native\", \"styled\"]);\nparser.addArgument(\"week-numbers\", [], [\"show\", \"hide\"]);\nparser.addArgument(\"i18n\"); // URL pointing to JSON resource with i18n values\nparser.addArgument(\"first-day\", 0);\nparser.addArgument(\"after\");\nparser.addArgument(\"offset-days\", 0);\n\nparser.add_argument(\"output-format\", null);\nparser.add_argument(\"locale\", null);\n\nparser.addAlias(\"behaviour\", \"behavior\");\n\n/* JSON format for i18n\n * { \"previousMonth\": \"Previous Month\",\n *   \"nextMonth\"    : \"Next Month\",\n *   \"months\"       : [\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\n *   \"weekdays\"     : [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"],\n *   \"weekdaysShort\": [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"]\n * } */\n\nexport default Base.extend({\n    name: \"date-picker\",\n    trigger: \".pat-date-picker\",\n    parser: parser,\n    format: \"YYYY-MM-DD\",\n\n    async init() {\n        const el = this.el;\n        const disabled = this.el.disabled;\n\n        //TODO: make parser with options extend missing options.\n        //this.options = parser.parse(el, opts);\n        this.options = $.extend(parser.parse(el), this.options);\n\n        if (!disabled && this.options.after) {\n            // Set the date depending on another date which must be ``offset-days``\n            // BEFORE this date. Only set it, if the other date is AFTER this\n            // date.\n            const befores = document.querySelectorAll(this.options.after);\n            for (const b_el of befores) {\n                b_el.addEventListener(\"change\", (e) => {\n                    let b_date = e.target.value; // the \"before-date\"\n                    b_date = b_date ? new Date(b_date) : null;\n                    if (!b_date) {\n                        return;\n                    }\n                    let a_date = this.el.value; // the \"after-date\"\n                    a_date = a_date ? new Date(a_date) : null;\n                    if (!a_date || a_date < b_date) {\n                        const offset = this.options.offsetDays || 0;\n                        b_date.setDate(b_date.getDate() + offset);\n                        this.el.value = b_date.toISOString().substring(0, 10);\n                        this.dispatch_change_event();\n                    }\n                });\n            }\n        }\n\n        let display_el;\n        if (this.options.behavior === \"styled\") {\n            dom.hide(el); // hide input, but keep active (e.g. for validation)\n\n            display_el = document.createElement(\"time\");\n            display_el.setAttribute(\"class\", \"output-field\");\n            display_el.setAttribute(\"datetime\", el.value);\n            if (disabled) {\n                display_el.classList.add(\"disabled\");\n            }\n            el.insertAdjacentElement(\"beforebegin\", display_el);\n\n            // Disable click on label, as this invokes a click on the invisible\n            // input field which opens the calendar in Firefox and masks a\n            // click on display_el on Chrome.\n            const label = display_el.closest(\"label\");\n            if (label) {\n                events.add_event_listener(\n                    label,\n                    \"click\",\n                    \"pat-date-picker--label\",\n                    (e) => {\n                        e.preventDefault();\n                    }\n                );\n            }\n\n            let pat_display_time;\n            if (this.options.outputFormat) {\n                const PatDisplayTime = (await import(\"../display-time/display-time\")).default; // prettier-ignore\n                const display_time_config = { format: this.format };\n                if (this.options.outputFormat) {\n                    display_time_config[\"output-format\"] = this.options.outputFormat;\n                }\n                if (this.options.locale) {\n                    display_time_config.locale = this.options.locale;\n                }\n                pat_display_time = new PatDisplayTime(display_el, display_time_config);\n            } else if (this.el.value) {\n                display_el.textContent = el.value;\n            }\n\n            // Add the additional elements \"clear button\" and placeholder to\n            // the `<time>` element.\n            const _add_additional = () => {\n                this.add_clear_button(display_el);\n                if (!this.el.value && this.el.placeholder) {\n                    display_el.innerHTML = `<span class=\"placeholder\">${this.el.placeholder}</span>`;\n                }\n            };\n            if (pat_display_time) {\n                // Add the additional elements after display time has\n                // eventually cleared the contents or done any other changes.\n                $(display_el).on(\"init.display-time.patterns\", () => {\n                    _add_additional();\n                });\n            } else {\n                // If no `pat-display-time` was used, add immediately.\n                _add_additional();\n            }\n\n            this.el.addEventListener(\"change\", () => {\n                display_el.setAttribute(\"datetime\", this.el.value);\n                if (pat_display_time && this.el.value) {\n                    pat_display_time.format();\n                } else {\n                    //} else if (this.el.value) {\n                    display_el.textContent = this.el.value;\n                }\n                _add_additional();\n            });\n\n            if (disabled) {\n                // nothing else to do here...\n                return;\n            }\n        } else if (disabled) {\n            return;\n        } else if (utils.checkInputSupport(\"date\", \"invalid date\")) {\n            // behavior native with native support.\n            return;\n        } else if (el.getAttribute(\"type\") === \"date\") {\n            // behavior native but no native support.\n            // Fallback JS date picker with a text input field.\n            el.setAttribute(\"type\", \"text\");\n        }\n\n        if (window.__patternslib_import_styles) {\n            import(\"./_date-picker.scss\");\n        }\n        const Pikaday = (await import(\"pikaday\")).default;\n\n        const config = {\n            field: el,\n            trigger: display_el || el,\n            format: this.format,\n            firstDay: this.options.firstDay,\n            showWeekNumber: this.options.weekNumbers === \"show\",\n            onSelect: () => this.dispatch_change_event(),\n            onClose: () => {\n                if (this.options.behavior === \"styled\" && !this.el.value) {\n                    // blur the input field so that pat-validate can kick in when\n                    // nothing was selected.\n                    el.dispatchEvent(events.blur_event());\n                }\n            },\n        };\n\n        if (el.getAttribute(\"min\")) {\n            config.minDate = new Date(el.getAttribute(\"min\"));\n        }\n        if (el.getAttribute(\"max\")) {\n            config.maxDate = new Date(el.getAttribute(\"max\"));\n        }\n\n        if (this.options.i18n) {\n            try {\n                const response = await fetch(this.options.i18n);\n                config.i18n = await response.json();\n            } catch {\n                log.error(`date-picker could not load i18n for ${this.options.i18n}`);\n            }\n        }\n        this.pikaday = new Pikaday(config);\n    },\n\n    add_clear_button(el_append_to) {\n        if (!this.el.disabled && !this.el.required && this.el.value) {\n            // Add clear button\n            const clear_button = document.createElement(\"span\");\n            clear_button.setAttribute(\"class\", \"cancel-button\");\n            clear_button.addEventListener(\"click\", (e) => {\n                e.stopPropagation();\n                this.el.value = null;\n                this.dispatch_change_event();\n            });\n            el_append_to.appendChild(clear_button);\n        }\n    },\n\n    dispatch_change_event() {\n        const event = new Event(\"change\", {\n            bubbles: true,\n            cancelable: true,\n        });\n        // Set ``firedBy` to prevent pikaday to call it's own handler and land\n        // in an infinite loop.\n        event.firedBy = this.pikaday;\n        this.el.dispatchEvent(event);\n\n        // Also trigger input-change\n        $(this.el).trigger(\"input-change\");\n        $(this.el.form).trigger(\"input-change\");\n    },\n});\n","import Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport logging from \"../../core/logging\";\nimport utils from \"../../core/utils\";\n\n// Lazy loading modules.\nlet Moment;\n\nconst log = logging.getLogger(\"pat-display-time\");\n\nexport const parser = new Parser(\"display-time\");\n// input datetime options\nparser.add_argument(\"format\", \"\");\nparser.add_argument(\"locale\", null);\nparser.add_argument(\"strict\", false);\n// output options\nparser.add_argument(\"from-now\", false);\nparser.add_argument(\"no-suffix\", false);\nparser.add_argument(\"output-format\", null);\n\nexport default Base.extend({\n    name: \"display-time\",\n    trigger: \".pat-display-time\",\n\n    async init() {\n        Moment = (await import(\"moment\")).default;\n\n        this.options = parser.parse(this.el, this.options);\n\n        let lang = this.options.locale || dom.acquire_attribute(this.el, \"lang\") || \"en\";\n        // we don't support any country-specific language variants, always use first 2 letters\n        lang = lang.substr(0, 2).toLowerCase();\n        try {\n            await import(`moment/locale/${lang}.js`);\n            Moment.locale(lang);\n            this.lang = lang;\n        } catch {\n            Moment.locale(\"en\");\n            this.lang = \"en\";\n        }\n        log.debug(`Moment.js language used: ${lang}.`);\n        this.format();\n    },\n\n    format() {\n        const datetime = this.el.getAttribute(\"datetime\");\n        let out = \"\";\n        if (datetime) {\n            const date = Moment(datetime, this.options.format, this.options.strict);\n            out = date;\n            if (this.options.fromNow === true) {\n                if (utils.is_iso_date(datetime)) {\n                    // date-only case.\n                    const rtf = new Intl.RelativeTimeFormat(this.lang, {\n                        numeric: \"auto\",\n                    });\n                    const date_diff = utils.date_diff(date.toDate(), new Date());\n                    out = date.calendar(null, {\n                        // when the date is closer, specify custom values\n                        lastWeek: `[${rtf.format(date_diff, \"day\")}]`, // translates to \"x days ago\"\n                        lastDay: `[${rtf.format(-1, \"day\")}]`, // translates to \"yesterday\"\n                        sameDay: `[${rtf.format(0, \"day\")}]`, // translates to \"today\"\n                        nextDay: `[${rtf.format(1, \"day\")}]`, // translates to \"tomorrow\"\n                        nextWeek: \"dddd\", // translates to week day name\n                        // otherwise, just use Intl.RelativeTimeFormat.\n                        sameElse: () => {\n                            return `[${rtf.format(date_diff, \"day\")}]`;\n                        },\n                    });\n                } else {\n                    // datetime case.\n                    out = date.fromNow(this.options.noSuffix);\n                }\n            } else if (this.options.outputFormat) {\n                out = date.format(this.options.outputFormat);\n            }\n        }\n        this.el.textContent = out;\n    },\n});\n","import Base from \"../../core/base\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"close-panel\",\n    trigger: \".close-panel\",\n\n    init() {\n        // Close panel support for dialog panels\n        // Other modals are handled in pat-modal.\n        const dialog_panel = this.el.closest(\"dialog\");\n        if (dialog_panel) {\n            events.add_event_listener(\n                dialog_panel,\n                \"close-panel\",\n                \"close-panel--dialog\",\n                () => {\n                    dialog_panel.close();\n                }\n            );\n        }\n\n        this.el.addEventListener(\"click\", async (e) => {\n            await utils.timeout(0); // Wait for other patterns, like pat-validation.\n\n            if (\n                e.target.matches(\":not([formnovalidate])\") &&\n                e.target.matches(\"[type=submit], button:not([type=button])\") &&\n                this.el.closest(\"form\")?.checkValidity() === false\n            ) {\n                // Prevent closing an invalid form when submitting.\n                return;\n            }\n\n            this.el.dispatchEvent(\n                new Event(\"close-panel\", { bubbles: true, cancelable: true })\n            );\n        });\n    },\n});\n","import $ from \"jquery\";\nimport { BasePattern } from \"../../core/basepattern\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport events from \"../../core/events\";\nimport registry from \"../../core/registry\";\nimport utils from \"../../core/utils\";\n\n// Initialize close-panel functionality.\nimport \"../close-panel/close-panel\";\n\nconst log = logging.getLogger(\"pat-tooltip\");\n\nexport const parser = new Parser(\"tooltip\");\nconst all_positions = [\n    \"tl\",\n    \"tm\",\n    \"tr\",\n    \"rt\",\n    \"rm\",\n    \"rb\",\n    \"br\",\n    \"bm\",\n    \"bl\",\n    \"lb\",\n    \"lm\",\n    \"lt\",\n];\nparser.addArgument(\"position-list\", [], all_positions, true);\nparser.addArgument(\"position-policy\", \"auto\", [\"auto\", \"force\"]);\nparser.addArgument(\"trigger\", \"click\", [\"click\", \"hover\", \"none\"]);\nparser.addArgument(\"source\", \"title\", [\"ajax\", \"content\", \"title\"]);\nparser.addArgument(\"ajax-data-type\", \"html\", [\"html\", \"markdown\"]);\nparser.addArgument(\"closing\", \"auto\", [\"auto\", \"sticky\", \"close-button\"]);\nparser.addArgument(\"delay\");\nparser.addArgument(\"mark-inactive\", true);\nparser.addArgument(\"class\");\nparser.addArgument(\"target\", \"body\");\nparser.addArgument(\"arrow-padding\", null);\nparser.addArgument(\"url\", null);\n\n// Tippy Lifecycle-hooks\n// See: https://tippyjs.bootcss.com/lifecycle-hooks/\n// onCreate\n// onTrigger\n// onShow\n// onMount\n// onShown\n// onUntrigger\n// onHide\n// onHidden\n//\n// onBeforeUpdate\n// onAfterUpdate\n// onDestroy\n\nclass Pattern extends BasePattern {\n    static name = \"tooltip\";\n    static trigger = \".pat-tooltip, .pat-tooltip-ng\";\n    static parser = parser;\n\n    tippy = null;\n\n    active_class = \"tooltip-active-hover\";\n    inactive_class = \"tooltip-inactive\";\n\n    async init() {\n        const el = this.el;\n\n        if (window.__patternslib_import_styles) {\n            import(\"tippy.js/dist/tippy.css\");\n        }\n        const Tippy = (await import(\"tippy.js\")).default;\n        this.tippy_options = this.parseOptionsForTippy(this.options);\n\n        const defaultProps = {\n            animation: false,\n            arrow: true,\n            //'delay': [0, 1800],\n            //'duration': [325, 275],\n            hideOnClick: this.options.closing === \"close-button\" ? false : true,\n            ignoreAttributes: true,\n            interactive: true,\n            onHide: this._onHide.bind(this),\n            onShow: this._onShow.bind(this),\n            trigger: \"click\",\n        };\n\n        Tippy.setDefaultProps(defaultProps);\n        this.tippy = new Tippy(el, this.tippy_options);\n\n        if (this.options.source === \"title\") {\n            // Remove ``title`` attribute when source is set to ``title`` to\n            // disable the browser's built-in tooltip feature\n            el.removeAttribute(\"title\");\n        }\n\n        if (this.options.trigger === \"click\" && this.options.source === \"ajax\") {\n            // prevent default action for \"click\" and \"mouseenter click\"\n            events.add_event_listener(\n                el,\n                \"click\",\n                \"pat-tooltip--click-prevent-default\",\n                (event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            );\n        }\n\n        if (this.options.trigger === \"click\") {\n            this.active_class = \"tooltip-active-click\";\n        }\n        if (this.options.markInactive) {\n            // Initially mark as inactive\n            el.classList.add(this.inactive_class);\n        }\n    }\n\n    show() {\n        // Show this tooltip\n        this.tippy.show();\n    }\n\n    async hide() {\n        // Hide this tooltip\n        await utils.timeout(1); // wait a tick for event being processed by other handlers.\n        this.tippy.hide();\n    }\n\n    destroy() {\n        // Remove this tooltip\n        super.destroy(); // Unregister\n        this.tippy.destroy();\n    }\n\n    parseOptionsForTippy(opts) {\n        const placement = (pos) => {\n            // note that Cornelis needs the positioning to be the placement of the thingy on the bubble\n            // tippy though refers to positioning as the placement of the bubble relatively to the reference element\n            // so we invert the meaning below. It's intentional.\n            const primary = (pos0) =>\n                ({\n                    t: \"bottom\",\n                    r: \"left\",\n                    b: \"top\",\n                    l: \"right\",\n                }[pos0]);\n\n            const secondary = (pos1) =>\n                ({\n                    l: \"-start\",\n                    r: \"-end\",\n                    m: \"\",\n                    t: \"-start\",\n                    b: \"-end\",\n                }[pos1]);\n\n            return `${primary(pos[0])}${secondary(pos[1])}`;\n        };\n\n        const tippy_options = { popperOptions: { modifiers: [] } };\n\n        if (opts.arrowPadding !== null) {\n            tippy_options.popperOptions.modifiers.push({\n                name: \"arrow\",\n                options: {\n                    padding: parseInt(opts.arrowPadding, 10),\n                },\n            });\n        }\n\n        const parsers = {\n            position: () => {\n                if (!opts.position?.list?.length) {\n                    return;\n                }\n                tippy_options.placement = placement(opts.position.list[0]); // main position\n\n                const flip_options = {\n                    name: \"flip\",\n                    enabled: true,\n                };\n\n                if (opts.position.policy === \"force\") {\n                    flip_options.enabled = false;\n                } else if (opts.position.length > 1) {\n                    const fallbacks = opts.position.list.slice(1).map(placement);\n                    flip_options.fallbackPlacements = fallbacks;\n                }\n\n                tippy_options.popperOptions.modifiers.push(flip_options);\n            },\n\n            trigger() {\n                if (opts.trigger === \"hover\") {\n                    tippy_options.trigger = \"mouseenter focus\";\n                } else if (opts.trigger === \"none\") {\n                    tippy_options.trigger = \"manual\";\n                    tippy_options.hideOnClick = false;\n                }\n            },\n\n            source: () => {\n                let content;\n                if (opts.source === \"title\") {\n                    // Tooltip content from title attribute\n                    content = this.el.getAttribute(\"title\");\n                } else if (opts.source === \"content\") {\n                    // Tooltip content from trigger childs.\n                    content = this.el.innerHTML;\n                    tippy_options.allowHTML = true;\n                } else if (opts.source === \"ajax\") {\n                    // Tooltiop content from AJAX request.\n                    content = document.createElement(\"progress\");\n                    tippy_options.allowHTML = true;\n                }\n                tippy_options.content = content;\n            },\n\n            delay() {\n                if (opts.delay) {\n                    tippy_options.delay = [utils.parseTime(opts.delay), 0];\n                }\n            },\n\n            target: () => {\n                if (!opts.target) {\n                    return;\n                }\n                if (opts.target === \"parent\") {\n                    tippy_options.appendTo = \"parent\";\n                } else if (opts.target === \"body\") {\n                    tippy_options.appendTo = document.body;\n                } else {\n                    tippy_options.appendTo = document.querySelector(opts.target);\n                }\n            },\n        };\n\n        for (let arg in opts) {\n            switch (arg) {\n                case \"ajax-data-type\":\n                    arg = \"ajaxDataType\";\n                    break;\n                case \"mark-inactive\":\n                    arg = \"markInactive\";\n                    break;\n            }\n            parsers[arg] && parsers[arg](arg);\n        }\n\n        return tippy_options;\n    }\n\n    _initialize_content() {\n        // Initialize any other patterns.\n        registry.scan(this.tippy.popper);\n    }\n\n    async _onShow() {\n        const tippy_classes = [];\n\n        // Group DOM manipulations\n\n        if (this.options.class) {\n            tippy_classes.push(...this.options.class.split(\" \"));\n        }\n\n        // Add a generic non-tippy related class to identify the tooltip container\n        tippy_classes.push(\"tooltip-container\");\n\n        if (this.options.closing === \"close-button\") {\n            // First, remove previously automatically added close buttons.\n            // Otherwise we would end up adding another close button with every\n            // click on it.\n            for (const close_button of this.tippy.popper.querySelectorAll(\n                \".pat-tooltip--close-button\"\n            )) {\n                close_button.remove();\n            }\n\n            const close_button = document.createElement(\"button\");\n            close_button.setAttribute(\"class\", \"close-panel pat-tooltip--close-button\");\n            const content = this.tippy.popper.querySelector(\".tippy-content\");\n            content.parentNode.insertBefore(close_button, content);\n        }\n\n        // Store reference to method for closing panels on the tooltip element instance.\n        events.add_event_listener(\n            this.tippy.popper,\n            \"close-panel\",\n            \"pat-tooltip--close-panel\",\n            () => this.hide()\n        );\n\n        this.tippy.popper.classList.add(...tippy_classes);\n\n        if (this.options.markInactive) {\n            this.el.classList.remove(this.inactive_class);\n            this.el.classList.add(this.active_class);\n        }\n\n        if (this.options.closing !== \"auto\" && this.options.trigger === \"hover\") {\n            // no auto-close when hovering when closing mode is \"sticky\" or \"close-button\".\n            this.tippy.setProps({ trigger: \"click\" });\n        }\n\n        if (this.options.source === \"ajax\") {\n            await this._get_content();\n        }\n\n        // Notify parent patterns about injected content.\n        // Do not call pat-inject's handler, because all necessary\n        // initialization after injection is done here.\n        $(this.tippy.popper).trigger(\"patterns-injected\", [\n            { skipPatInjectHandler: true },\n            this.el,\n            this.tippy.popper,\n        ]);\n\n        this._initialize_content();\n    }\n\n    _onHide() {\n        if (this.options.markInactive) {\n            this.el.classList.remove(this.active_class);\n            this.el.classList.add(this.inactive_class);\n        }\n\n        if (this.options.closing !== \"auto\" && this.options.trigger === \"hover\") {\n            // re-set hover behavior\n            this.tippy.setProps({ trigger: \"mouseenter focus\" });\n        }\n\n        if (this.options.source === \"ajax\") {\n            this.tippy.setContent(document.createElement(\"progress\"));\n        }\n    }\n\n    async _get_content(url = this.options.url) {\n        let selector;\n        ({ url, selector } = this.get_url_parts(url || this.el.getAttribute(\"href\")));\n        let content;\n        if (url) {\n            // Tooltip from remote page.\n            const handler = this.data_type_handlers[this.options.ajaxDataType];\n            try {\n                // TODO: use pat-inject, once it supports async\n                const response = await fetch(url, {\n                    headers: {\n                        Accept: \"text/html,application/xhtml+xml,application/xml\",\n                    },\n                });\n                const text = await response.text();\n                content = await handler(text, url, selector);\n            } catch (e) {\n                log.error(\"Error on ajax request. ${e}\");\n            }\n        } else if (selector) {\n            // Tooltip content from current DOM tree.\n            content = document.querySelector(selector);\n            content = content?.innerHTML || undefined;\n        }\n        if (content) {\n            this.tippy.setContent(content);\n            await utils.timeout(1); // Wait a tick before forceUpdate. Might fail due to unset popperInstance.\n            this.tippy.popperInstance.forceUpdate(); // re-position tippy after content is known.\n        }\n    }\n\n    async get_content(url = this.options.url) {\n        // API method: _get_content + _initialize_content\n        await this._get_content(url);\n        this._initialize_content();\n    }\n\n    get_url_parts(href) {\n        // Return the URL and a CSS ID selector.\n        let url, selector, query;\n        if (!href) {\n            return { url, selector };\n        }\n        [url, selector] = href.split(\"#\");\n        if (selector) {\n            selector = `#${selector}`;\n            [selector, query] = selector.split(\"?\");\n        }\n        if (query) {\n            url = `${url}?${query}`;\n        }\n        return { url, selector };\n    }\n\n    static data_type_handlers = {\n        html(text, url, selector) {\n            let tmp = document.createElement(\"div\");\n            tmp.innerHTML = text;\n            if (selector) {\n                tmp = tmp.querySelector(selector);\n            }\n            return tmp?.innerHTML || \"\";\n        },\n\n        async markdown(text, url, selector) {\n            const Markdown = registry.patterns.markdown;\n            if (!Markdown) {\n                return text;\n            }\n\n            const instance = new Markdown($(\"<div/>\"));\n            await events.await_pattern_init(instance);\n\n            const cfg = { url };\n            if (selector) {\n                cfg.source = selector;\n            }\n\n            const ret = await instance.renderForInjection(cfg, text);\n            return ret[0];\n        },\n    };\n\n    static register_type_handler(type, handler) {\n        Pattern.data_type_handlers[type] = handler;\n    }\n\n    constructor(...args) {\n        super(...args);\n\n        this.register_type_handler = this.constructor.register_type_handler;\n        this.data_type_handlers = this.constructor.data_type_handlers;\n    }\n}\n\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n"],"names":["_translation_domains","plone","widgets","translate","domain","msgid","keywords","i18n","loadCatalog","MessageFactory","translate_plone","self","this","baseUrl","attr","currentLanguage","split","length","toUpperCase","storage","catalogs","ttl","Date","now","valueOf","window","localStorage","JSON","e","console","log","configure","config","key","_setCatalog","language","catalog","_storeCatalog","setItem","stringify","getUrl","undefined","parseInt","getItem","parse","msgstr","regexp","keyword","Object","prototype","hasOwnProperty","call","RegExp","replace","logger","getLogger","Loading","options","className","backdrop","zIndex","init","$el","addClass","hide","appendTo","show","closable","css","Math","max","each","closeOnClick","closeOnEsc","generateId","prefix","floor","random","toString","substring","featureSupport","dragAndDrop","document","createElement","fileApi","FileReader","history","pushState","get","name","val","set","ICON_CACHE","Map","bool","trim","toLowerCase","indexOf","escapeHTML","text","html","removeHTML","getAuthenticator","getWindow","win","parent","loading","parseBodyTag","txt","exec","eq","QueryHelper","pattern","vocabularyUrl","searchParam","pathOperator","attributes","batchSize","baseCriteria","sort_on","sort_order","pathDepth","browsing","basePath","url","valid","Boolean","getBatch","page","size","getCurrentPath","currentPath","path","getCriterias","term","searchOptions","criterias","useBaseCriteria","additionalCriterias","slice","push","i","o","v","searchPath","concat","getQueryData","data","query","criteria","batch","selectAjax","dataType","quietMillis","results","more","total","search","operation","value","callback","type","success","resolveIcon","async","icon_lookup_name","cache_key","has","icon","base_url","body","getAttribute","controller","AbortController","setTimeout","abort","resp","fetch","signal","warn","iconmap","parts","includes","default","_resolve_icon","debug","setId","id","extend","trigger","parser","defaults","opacity","classActiveName","$backdrop","on","is","keyCode","hasClass","emit","animate","removeClass","table","el","DataTable","createModal","$model","width","height","modalSizeClass","margin","position","triggers","zIndexSelector","backdropOptions","title","titleSelector","buttons","content","automaticallyAddButtonActions","loadLinksWithinModal","prependContent","onRender","templateOptions","classDialog","classModal","classHeaderName","classBodyName","classFooterName","classWrapperName","classWrapperInnerName","classPrependName","classContentName","template","actions","actionOptions","eventType","disableAjaxFormSubmit","target","ajaxUrl","modalFunction","isForm","timeout","displayInModal","reloadWindowOnClose","error","formFieldError","onSuccess","onError","onFormError","onTimeout","redirectOnResponse","redirectToUrl","$action","response","reg","form","$modal","a","action","actionKeys","patternKeys","patternOptions","stopPropagation","preventDefault","handleFormAction","apply","handleLinkAction","$form","extraData","parents","append","ajaxSubmit","xhr","textStatus","errorStatus","state","redraw","reloadWindow","location","href","fail","alert","done","always","open","render","$raw","clone","setAttribute","tplObject","prepend","$title","remove","$modalDialog","$modalContent","event","nodeName","$button","off","querySelectorAll","forEach","positionModal","$wrapperInner","reload","resize","item","selector","image","substr","initModal","createAjaxModal","ajaxXHR","ajaxType","_show","createTargetModal","createBasicModal","createHtmlModal","createImageModal","$wrapper","src","srcset","context","innerText","findPosition","horpos","vertpos","modalWidth","modalHeight","wrapperInnerWidth","wrapperInnerHeight","absTop","absBottom","absLeft","absRight","returnpos","left","right","top","bottom","modalInitialized","activateFocusTrap","inputsBody","find","first","inputsFooter","inputs","j","firstInput","lastInput","closeInput","which","$target","currentIndex","nextIndex","shiftKey","focus","closest","removeAttr","modalCss","posopt","outerWidth","outerHeight","pos","createBackdrop","insertBefore","scan","_suppressHide","confirm","Criteria","arguments","indexWidth","classBetweenDtName","classIndexName","classOperatorName","classValueName","classRemoveName","classResultsName","classClearName","classDepthName","app","indexes","index","operator","patternDateOptions","patternAjaxSelectOptions","patternRelateditemsOptions","indexGroups","advanced","initial","$remove","$index","enabled","group","patternSelect2","placeholder","removeValue","createOperator","createClear","appendOperators","$operator","operations","operators","createValue","convertPathOperators","oval","createPathOperators","resetPathOperators","newOperator","widget","description","removeOperator","match","createDepthSelect","selected","select","$value","startwrap","val1","val2","startdt","endwrap","enddt","after","pathAndDepth","patternRelateditems","prop","values","Array","isArray","trimmedValue","removeClear","$clear","buildQueryPart","ival","istr","ostr","vstrbase","vstrlistbase","vstr","str","getDepthString","join","getJSONListStr","vval","varr","depth","out","indexOptionsUrl","previewURL","previewCountURL","classSortLabelName","classSortReverseName","classSortReverseLabelName","classPreviewCountWrapperName","classPreviewResultsWrapperName","classPreviewWrapperName","classPreviewName","classPreviewTitleName","classPreviewDescriptionName","classSortWrapperName","showPreviews","initialized","json","_init","$criteriaWrapper","$sortWrapper","$previewWrapper","createCriteria","createSort","refreshPreviewEvent","_doupdates","updateValue","_updateTimeout","doupdates","clearTimeout","splice","existingSortOn","filter","existingSortOrder","$sortOn","$sortOrder","reversed","sortOn","_previewXhr","$previewPane","querypart","prependTo","criteriastrs","jsonstr","KEY","selectedUIDs","openAfterInit","pageSize","closeOnSelect","contextPath","dropdownCssClass","favorites","recentlyUsed","recentlyUsedMaxItems","recentlyUsedKey","maximumSelectionSize","minimumInputLength","mode","orderable","rootPath","rootUrl","scanSelection","selectableTypes","separator","sortOrder","tokenSeparators","upload","uploadAllowView","breadcrumbTemplateSelector","favoriteTemplateSelector","recentlyusedTemplateSelector","resultTemplateSelector","selectionTemplateSelector","toolbarTemplateSelector","multiple","ajaxTimeout","filterSelectable","ret","isSelectable","bind","applyTemplate","tpl","open_folder","current_directory","one_level_up","_item","setAjax","ajax","select2","map","UID","is_folderish","oneLevelUp","Title","selectable","renderToolbar","itemPath","itemsHtml","part","favoritesHtml","item_copy","recentlyUsedHtml","reverse","items","favItems","favText","searchText","searchModeText","browseModeText","recentlyUsedItems","recentlyUsedText","icon_root","icon_recently_used","icon_favorites","icon_upload","upload_text","$toolbar","toggleClass","browseTo","currentTarget","uid","it","selectItem","result","initUploadView","allowUpload","disabled","Upload","upload_button","querySelector","upload_el","upload_config","popover","uloadMultiple","allowPathSelection","relativePath","addEventListener","setPath","alreadyPresent","deselectItem","obj","portal_type","Dropdown","breadcrumbTemplate","favoriteTemplate","recentlyusedTemplate","resultTemplate","selectionTemplate","toolbarTemplate","wrap","$container","initializeValues","initializeTags","formatSelection","getIcon","getURL","review_state","$selection","path_split","icon_level_up","icon_level_down","formatResult","iconLevelUp","iconLevelDown","_el","$parent","initSelection","element","ids","reduce","prev","tokenizer","input","initializeSelect2","initializeOrdering","choice","yMax","innerHeight","documentElement","clientHeight","maxHeight","getBoundingClientRect","opened","selectorContext","browsableItemSelector","browsableItem","initialValues","seldefaults","initial_values","selection","tags","allowNewItems","Sortable","_initializeOrdering","sortable_el","$select2","draggable","dragClass","chosenClass","onStart","onEnd","formatResultCssClass","ob","onSelected","onSelecting","onDeselecting","onDeselected","_val","queryTerm","page_limit","dataIds","haveResult","vals","innerHTML","cloneClass","drop","sortable","animation","cb","newIndex","oldIndex","disableSort","option","enableSort","Dropzone","showTitle","wrapperTemplate","fileaddedClassName","useTus","container","ajaxUpload","paramName","addRemoveLinks","autoCleanResults","previewsContainer","previewTemplate","maxFiles","maxFilesize","relatedItems","autoDiscover","UploadTemplate","info","originalEvent","clipboardData","blob","getAsFile","dropzone","addFile","currentFile","_t","$progress","$pathInput","setupRelatedItems","$dropzone","files","hiddenFileInput","click","dzoneOptions","getDzoneOptions","DEBUG","showHideControls","ex","path_uid","file","status","SUCCESS","previewElement","fadeOut","xmlhr","pct","processUpload","finished","clipboardfile","_showHideTimeout","_showHideControls","$controls","$browse","$input","fadeIn","pathJoin","PreviewTemplate","clickable","headers","uploadMultiple","$preview","autoProcessQueue","processing","process","ERROR","QUEUED","CANCELED","removeFile","UPLOADING","tus","handleTusUpload","processFile","endpoint","chunkSize","progress","bytesUploaded","bytesTotal","percentage","formatBytes","bytes","kb","round","mb","RelatedItems","initialFolder","ri","methods","settings","time","initialTime","exceptionAreas","$this","$","lastEvent","trueTime","untouched","inExceptionArea","mouseMoved","live","enteredException","leftException","destroy","removeData","startTimer","fn","diff","method","scrollable","scrollHeight","clientWidth","scrollWidth","makeVisibleInScroll","parent_id","absoluteParent","elemTop","elemBottom","viewTop","scrollTop","viewBottom","safeOffset","docElem","elem","origin","nodeType","ownerDocument","offset","setPositionAbsolute","offsettop","offsetleft","thiswidth","setleft","settop","positionAncestor","$ancestor","$child","childMarginEdgeLeft","childMarginEdgeTop","ancestorPaddingEdgeLeft","ancestorPaddingEdgeTop","findInclusive","addBack","slideIn","speed","easing","slideOut","Contains","m","scopedFind","Parser","addArgument","Base","jquery_plugin","all_selects","all_deselects","all_toggles","all_checkboxes","all_radios","change_handler","utils","debounce","change_buttons_and_toggles","change_checked","dom","find_scoped","btn","events","add_event_listener","select_all","deselect","deselect_all","toggle","toggle_all","remove_event_listener","find_siblings","sel","res","parentNode","find_checkboxes","ref_el","chkbxs","matches","every","tgl","checked","box","dispatchEvent","change_event","label","labels","classList","add","fieldset","querySelectorAllAndMe","el_date","el_time","checkInputSupport","__patternslib_import_styles","DatePicker","date_value","time_value","el_wrapper","html_btn_now","today","html_btn_clear","clear","update","isotime","date_options","behavior","format","weekNumbers","firstDay","isodate","Event","bubbles","cancelable","toISOString","toTimeString","logging","addAlias","KEY_ERROR_EL","KEY_ERROR_MSG","Pattern","BasePattern","static","check_input","capture","initialize_inputs","disabled_elements","disableSelector","cnt","entries","debouncer","delay","_ref","stop","set_validity","msg","validity_state","validity","submitter","hasAttribute","badInput","customError","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valueMissing","input_options","equality","message","attribute","not","before","date","datetime","msg_default_not_before","msg_default_not_after","not_after","not_after_el","not_before","not_before_el","is_iso_date_time","isNaN","msg_attr","textContent","remove_error","required","min","number","email","stopImmediatePropagation","set_error_message","_ref2","setCustomValidity","error_node","checkValidity","removeAttribute","some","validation_message","validationMessage","create_from_string","error_template","firstChild","did_disable","formNoValidate","_input","registry","register","tagName","xhrCount","_","onTriggerEvents","onClickSubmit","request","opts","_request","cfg","seqNumber","inc","temp","clickedData","args","serialize","cache","browserCache","accept","Accept","formdata","FormData","ajax_deferred","jqxhr","inject","cfgs","extractConfig","nextHref","pushMarker","onTrigger","idleTrigger","_initIdleTrigger","processDelay","delayed_trigger","uid_","_initAutoloadVisible","formaction","cfg_node","params","serializeArray","execute","submitSubform","$sub","$context","urlparts","defaultSelector","parseTime","elementIsDirty","askForConfirmation","should_confirm","_confirm","confirmMessage","ensureTarget","createTarget","$injected","verifySingleConfig","source","extractModifiers","listenForFormReset","verifyConfig","source_match","target_match","sourceMod","targetMod","targetPosition","loadingClass","_performInjection","$source","$src","contents","safeClone","_inject","_update_history","_afterInjection","glue","idx","el_","scroll","scroll_target","scroll_container","find_scroll_container","scroll_to_top","scroll_to_element","_onInjectSuccess","ev","responseText","sources$","callTypeHandler","idx1","perform_inject","idx2","_onInjectError","explanation","timestamp","error_page","error_page_fragment","URLSearchParams","error_page_url","error_page_response","executingClass","error_zone","statusText","do_close_panel","contentbefore","contentafter","elementbefore","elementafter","replaceWith","empty","_sourcesFromHtml","sources","$html","_parseRawHtml","_rebaseAttrs","A","FORM","IMG","OBJECT","SOURCE","VIDEO","_rebaseOptions","_rebaseURL","base","URL","lastIndexOf","_rebaseHTML","$page","wrapAll","keys","$el_","attrName","pattern_name","patterns","pattern_parser","changed","opt","clean_html","children","timeout_id","observer","IntersectionObserver","entry","isIntersecting","disconnect","threshold","root","observe","timer","unsub","onInteraction","contains","removeEventListener","registerTypeHandler","handler","handlers","injected","skipPatInjectHandler","executedClass","CustomEvent","detail","replaceState","DependsHandler","dependent","condition","evaluate","hideOrShow","updateModal","enable","disable","getAllInputs","dependents","onReset","onChange","$depdendent","section","levels","IDPrefix","classTOCName","classSectionName","classLevelPrefixName","scrollDuration","scrollEasing","$toc","asTabs","activeId","$level","hash","getLevel","doScroll","skipHash","elementLevel","level","levelSelector","that","_load","loadRemote","loadLocal","constructor","$content","isCookiesEnabled","c","cookie","dc","showIfCookiesDisabled","_changed","_suppressed","changingEvents","changingFields","modal","_handleUnload","_handleMsg","returnValue","active","selectedItem","resultsClass","defaultSortOn","perPage","timeoutHide","inputSelector","itemTemplate","doSearch","parameters","sorton_position","$searchResults","$results","nav","$prev","disableHiding","$next","next","$li","onceFocused","is_visible","code","insertAfter","external_links_open_new_window","mark_special_links","protocol_icon_map","https","http","ftp","callto","bitcoin","geo","im","irc","ircs","magnet","mailto","mms","news","nntp","openpgp4fpr","sip","sms","smsto","ssh","tel","urn","webcal","wtai","xmpp","open_new_window","protocol","host","links","link","link_url","startsWith","icon_name","icon_el","portal_url","dataset","portalUrl","navlink","check","hrefParts","navParts","inPath","zxcvbn","htmltmp","pwfield","pwmeterContainer","firstElementChild","pwmeter","indicators","setLevel","score","elements","inp","x","wclass","nextSibling","onkeyup","s","head","scripts","getElementsByTagName","loadScript","guardClassName","optOutClassName","messageTimeout","submitTimeout","switchTimeout","isModal","dirty","setupAddDropdown","setupSwitchPortletManager","setupSavePortletsSettings","setupPortletEdit","ajax_load","$body","$h1","rebind","suppress","statusMessage","$message","fadeTo","showEditPortlet","$a","$select","ajaxForm","beforeSubmit","url_","_reloadPortletManager","is_popstate","Re","zeropad","len","fmt","conf","d","getDate","D","getDay","getMonth","y","getFullYear","flags","dd","ddd","localization","shortWeekdays","dddd","weekdays","mm","mmm","shortMonths","mmmm","months","yy","String","yyyy","$0","widgetSaveToRfc5545","RDATE","EXDATE","tz","interval","month","year","occurrences","day","i18nweekdays","monthlyType","yearlyType","rangeType","rtemplate","rrule","human","field_id","fields","field","dailyInterval2","weeklyInterval2","weeklyWeekdaysHuman","monthlyInterval2","monthlyDayOfMonth1Human","monthlyDayOfMonth2","monthlyWeekdayOfMonth1Human","orderIndexes","monthlyWeekdayOfMonth2","yearlyInterval2","yearlyDayOfMonth1Human","yearlyWeekdayOfMonth1Human","yearlyWeekdayOfMonth2","yearlyWeekdayOfMonth3","yearlyWeekdayOfMonth4","rangeByOccurrences1Human","rangeByOccurrences2","padStart","replaceAll","rangeByEndDateHuman","date_parts","longDateFormat","sort","tmp_dates","tmp_human","rdate","including","exdate","except","parseLine","icalline","property","cleanDates","dates","parseIcal","icaldata","nextline","lines","RRULE","line","pop","charAt","widgetLoadFromRfc5545","force","selectors","radiobutton","freq","byday","bymonth","bymonthday","count","until","weekday","unsupportedFeatures","noRule","bysetpos","noTemplateMatch","multipleDayOfMonth","day_index","weekday_index","hasRepeatForeverButton","messagearea","RecurrenceInput","textarea","$textarea","orderedWeekdays","now_date","displayFields","$modalForm","rtField","occurrenceExclude","occurrenceInclude","occurrenceDelete","occurrenceAdd","datevalue","errorarea","alreadyAdded","$newdate","additionalDate","icons","slideDown","loadOccurrences","startdate","rfc5545","start","readonly","occurrenceDiv","display","ajaxURL","contentType","ajaxContentType","readOnly","occurrence","formattedDate","jqXHR","getField","realField","findStartDate","startField","startFieldYear","startFieldMonth","startFieldDay","findIntField","fieldName","num","recurrenceOn","RFC5545","displayActivate","edit_rules","checkFields","startDate","endDate","endField","enddate","noRepeatEvery","noRepeatOn","noEndAfterNOccurrences","noEndDate","pastEndDate","save","cancel","updateOccurrences","displayUnactivate","add_rules","dayindex","style","loadData","start_date","setDate","initModalForm","delete_rules","refresh","preview","addDate","recurrenceType","dailyInterval1","weeklyInterval1","weeklyWeekdays","monthlyInterval1","monthlyDayOfMonth1","monthlyDayOfMonth3","monthlyWeekdayOfMonth1","monthlyWeekdayOfMonth3","monthlyRepeatOn","yearlyInterval1","yearlyDayOfMonth1","yearlyDayOfMonth2","yearlyDayOfMonth3","yearlyWeekdayOfMonth1","yearlyRepeatOn","range","rangeNoEnd","rangeByOccurrences1","rangeByEndDate","recurrenceStart","include","exclude","shortDateFormat","daily","mondayfriday","weekly","monthly","yearly","ributtonExtraClass","load_icons","configuration","recurrenceinput","$filter","$filterBtn","$advSearchInput","$ctSelectAll","$selectAllContainer","$sortingContainer","pathname","pushHistory","setBatchStart","b_start","updateSortingState","default_sort","order","urlStructure","contextInfoUrl","setDefaultPageUrl","menuOptions","backdropSelector","activeColumnsCookie","activeColumns","availableColumns","ModificationDate","EffectiveDate","ExpirationDate","CreationDate","Subject","exclude_from_nav","getObjSize","last_comment_date","total_comments","typeToViewAction","File","Image","Blob","defaultPageTypes","dateFormat","dateStyle","timeStyle","rearrange","properties","sortable_title","moveUrl","tooltip","datatables_options","Backbone","AppView","collectionUrl","queryHelperAttributes","view","targetScope","isMarked","marked","wrapper","$main_toolbar","$personal_tools","expanded","autoOpen","keyboardSupport","onLoad","optionKey","def","onCanMoveTo","moved","folder","dataUrl","tree","implementation","getOptions","patternName","elOptions","tmpOptions","initBasePattern","jquery","plog","Registry","mockupParser","eventName","eventCallback","one","patternProps","child","Error","Surrogate","__super__","autoregister","parser_group_options","parser_multiple","parser_inherit","event_name","event_callback","once","DATA_PREFIX","DATA_STYLE_DISPLAY","get_css_value","as_pixels","as_float","getComputedStyle","getPropertyValue","parseFloat","get_relative_position","reference_el","abs","scrollLeft","get_data","default_value","set_data","toNodeArray","nodes","NodeList","all","unshift","appendChild","find_parents","get_parents","HTMLElement","acquire_attribute","include_empty","include_all","parentElement","offsetWidth","offsetHeight","is_input","test","string","createRange","createContextualFragment","direction","fallback","overflow_y","overflow_x","get_scroll_x","scroll_reference","scrollX","get_scroll_y","scrollY","scrollTo","scroll_to_bottom","delete_data","template_string","template_variables","Function","get_visible_ratio","rect","container_rect","visible_ratio","rect_height","escape_css_id","CSS","escape","element_uuid","uuid","crypto","randomUUID","array","Uint32Array","getRandomValues","find_form","event_listener_map","els","el_events","regexp_from_wildcard","delete","event_type","_cb","await_event","Promise","resolve","await_pattern_init","reject","catch","generic_event","blur_event","click_event","focus_event","input_event","mousedown_event","mouseup_event","scroll_event","submit_event","dragstart_event","dragend_event","writer","oThis","TypeError","aArgs","fToBind","fNOP","fBound","Level","INFO","WARN","FATAL","ConsoleWriter","Logger","_loggers","_parent","_enabled","_level","setWriter","w","output","log_name","messages","route","shift","_getFlag","flag","setEnabled","isEnabled","fatal","logconfig","api","getWriter","ArgumentParser","enum_values","enum_conflicts","groups","possible_groups","group_pattern","json_param_pattern","named_param_pattern","token_pattern","_camelCase","__","p1","alias","original","addGroupToSpec","spec","first_spec","first_name","dest","choices","addJSONArgument","_typeof","_coerce","_set","_split","tokens","quoted","simple","_parseExtendedNotation","argstring","arg","subopt","_parseShorthandNotation","parameter","sense","positional","_parse","sep","extended","_defaults","_cleanupOptions","group_options","inherit","stack","$possible_config_providers","final_length","provider","frame","removeDuplicateObjects","mergeStack","current_value","add_argument","last_btn","submitable_buttons","canditates","activeElement","candidate","disable_re","dont_catch_re","dont_catch","__patternslib_registry","PATTERN_REGISTRY","__patternslib_registry_initialized","ready","transformPattern","transform","initPattern","orderPatterns","Text","plugin_name","jqueryPlugin","thisArg","T","k","O","kValue","singleBoundJQueryPlugin","pat","pluralBoundJQueryPlugin","isObject","wildcard","isElementInViewport","partial","rec","innerWidth","escapeRegExp","findLabel","$label","removeWildcardClass","targets","classes","ensureArray","matcher","class_list","ok","visible","transitions","none","fade","slide","duration","transition","effect","on_complete","t","complete","addURLQueryParameter","fullURL","param","newURL","objs","comparator","list","next_obj","is_duplicate","frame_length","hasValue","selectedIndex","amount","parseLength","reference_length","findRelatives","$relatives","get_bounds","bounds","invalid_value","support","checkCSSFeature","tag","supported","animation_frame","requestAnimationFrame","ms","func","postpone","last_run","isIE","documentMode","jqToNode","force_array","isPrototypeOf","localized_isodate","escape_html","createTextNode","unescape_html","escaped_html","DOMParser","parseFromString","is_iso_date","date_diff","date_1","date_2","utc_1","UTC","utc_2","threshold_list","num_steps","thresholds","is_option_truthy","elementInViewport","befores","b_el","b_date","a_date","offsetDays","dispatch_change_event","display_el","insertAdjacentElement","pat_display_time","outputFormat","PatDisplayTime","display_time_config","locale","_add_additional","add_clear_button","Pikaday","showWeekNumber","onSelect","onClose","minDate","maxDate","pikaday","el_append_to","clear_button","firedBy","Moment","lang","strict","fromNow","rtf","Intl","RelativeTimeFormat","numeric","toDate","calendar","lastWeek","lastDay","sameDay","nextDay","nextWeek","sameElse","noSuffix","dialog_panel","close","tippy","active_class","inactive_class","Tippy","tippy_options","parseOptionsForTippy","defaultProps","arrow","hideOnClick","closing","ignoreAttributes","interactive","onHide","_onHide","onShow","_onShow","setDefaultProps","markInactive","super","placement","pos0","r","b","l","pos1","popperOptions","modifiers","arrowPadding","padding","parsers","flip_options","policy","fallbacks","fallbackPlacements","allowHTML","_initialize_content","popper","tippy_classes","class","close_button","setProps","_get_content","setContent","get_url_parts","data_type_handlers","ajaxDataType","popperInstance","forceUpdate","get_content","tmp","markdown","Markdown","instance","renderForInjection","register_type_handler"],"sourceRoot":""}